// Test more advanced SKALP features

entity TestModule {
    in clk: clock
    in data_in: nat[8]
    out data_out: nat[8]
    out valid: bit[1]
}

impl TestModule {
    signal state: nat[2] = 0
    signal buffer: nat[8] = 0

    on(clk.rise) {
        match state {
            0 => {
                buffer <= data_in
                state <= 1
            }
            1 => {
                data_out <= buffer
                valid <= 1
                state <= 0
            }
            _ => {
                state <= 0
            }
        }
    }
}