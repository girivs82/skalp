"use strict";var ov=Object.create;var Cs=Object.defineProperty;var av=Object.getOwnPropertyDescriptor;var cv=Object.getOwnPropertyNames;var uv=Object.getPrototypeOf,lv=Object.prototype.hasOwnProperty;var F=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),dv=(i,e)=>{for(var t in e)Cs(i,t,{get:e[t],enumerable:!0})},Tf=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of cv(e))!lv.call(i,r)&&r!==t&&Cs(i,r,{get:()=>e[r],enumerable:!(n=av(e,r))||n.enumerable});return i};var Me=(i,e,t)=>(t=i!=null?ov(uv(i)):{},Tf(e||!i||!i.__esModule?Cs(t,"default",{value:i,enumerable:!0}):t,i)),fv=i=>Tf(Cs({},"__esModule",{value:!0}),i);var un=F(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.asPromise=st.thenable=st.typedArray=st.stringArray=st.array=st.func=st.error=st.number=st.string=st.boolean=void 0;function hv(i){return i===!0||i===!1}st.boolean=hv;function Pf(i){return typeof i=="string"||i instanceof String}st.string=Pf;function pv(i){return typeof i=="number"||i instanceof Number}st.number=pv;function gv(i){return i instanceof Error}st.error=gv;function kf(i){return typeof i=="function"}st.func=kf;function Ef(i){return Array.isArray(i)}st.array=Ef;function mv(i){return Ef(i)&&i.every(e=>Pf(e))}st.stringArray=mv;function vv(i,e){return Array.isArray(i)&&i.every(e)}st.typedArray=vv;function xf(i){return i&&kf(i.then)}st.thenable=xf;function yv(i){return i instanceof Promise?i:xf(i)?new Promise((e,t)=>{i.then(n=>e(n),n=>t(n))}):Promise.resolve(i)}st.asPromise=yv});var Ki=F(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.stringArray=kt.array=kt.func=kt.error=kt.number=kt.string=kt.boolean=void 0;function bv(i){return i===!0||i===!1}kt.boolean=bv;function qf(i){return typeof i=="string"||i instanceof String}kt.string=qf;function wv(i){return typeof i=="number"||i instanceof Number}kt.number=wv;function Cv(i){return i instanceof Error}kt.error=Cv;function Sv(i){return typeof i=="function"}kt.func=Sv;function If(i){return Array.isArray(i)}kt.array=If;function Rv(i){return If(i)&&i.every(e=>qf(e))}kt.stringArray=Rv});var Ua=F(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.Message=ne.NotificationType9=ne.NotificationType8=ne.NotificationType7=ne.NotificationType6=ne.NotificationType5=ne.NotificationType4=ne.NotificationType3=ne.NotificationType2=ne.NotificationType1=ne.NotificationType0=ne.NotificationType=ne.RequestType9=ne.RequestType8=ne.RequestType7=ne.RequestType6=ne.RequestType5=ne.RequestType4=ne.RequestType3=ne.RequestType2=ne.RequestType1=ne.RequestType=ne.RequestType0=ne.AbstractMessageSignature=ne.ParameterStructures=ne.ResponseError=ne.ErrorCodes=void 0;var _i=Ki(),Of;(function(i){i.ParseError=-32700,i.InvalidRequest=-32600,i.MethodNotFound=-32601,i.InvalidParams=-32602,i.InternalError=-32603,i.jsonrpcReservedErrorRangeStart=-32099,i.serverErrorStart=-32099,i.MessageWriteError=-32099,i.MessageReadError=-32098,i.PendingResponseRejected=-32097,i.ConnectionInactive=-32096,i.ServerNotInitialized=-32002,i.UnknownErrorCode=-32001,i.jsonrpcReservedErrorRangeEnd=-32e3,i.serverErrorEnd=-32e3})(Of=ne.ErrorCodes||(ne.ErrorCodes={}));var wa=class i extends Error{constructor(e,t,n){super(t),this.code=_i.number(e)?e:Of.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,i.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};ne.ResponseError=wa;var Gt=class i{constructor(e){this.kind=e}static is(e){return e===i.auto||e===i.byName||e===i.byPosition}toString(){return this.kind}};ne.ParameterStructures=Gt;Gt.auto=new Gt("auto");Gt.byPosition=new Gt("byPosition");Gt.byName=new Gt("byName");var ze=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return Gt.auto}};ne.AbstractMessageSignature=ze;var Ca=class extends ze{constructor(e){super(e,0)}};ne.RequestType0=Ca;var Sa=class extends ze{constructor(e,t=Gt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ne.RequestType=Sa;var Ra=class extends ze{constructor(e,t=Gt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ne.RequestType1=Ra;var Da=class extends ze{constructor(e){super(e,2)}};ne.RequestType2=Da;var _a=class extends ze{constructor(e){super(e,3)}};ne.RequestType3=_a;var Ta=class extends ze{constructor(e){super(e,4)}};ne.RequestType4=Ta;var Pa=class extends ze{constructor(e){super(e,5)}};ne.RequestType5=Pa;var ka=class extends ze{constructor(e){super(e,6)}};ne.RequestType6=ka;var Ea=class extends ze{constructor(e){super(e,7)}};ne.RequestType7=Ea;var xa=class extends ze{constructor(e){super(e,8)}};ne.RequestType8=xa;var qa=class extends ze{constructor(e){super(e,9)}};ne.RequestType9=qa;var Ia=class extends ze{constructor(e,t=Gt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ne.NotificationType=Ia;var Oa=class extends ze{constructor(e){super(e,0)}};ne.NotificationType0=Oa;var Fa=class extends ze{constructor(e,t=Gt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ne.NotificationType1=Fa;var La=class extends ze{constructor(e){super(e,2)}};ne.NotificationType2=La;var Ma=class extends ze{constructor(e){super(e,3)}};ne.NotificationType3=Ma;var Na=class extends ze{constructor(e){super(e,4)}};ne.NotificationType4=Na;var Aa=class extends ze{constructor(e){super(e,5)}};ne.NotificationType5=Aa;var $a=class extends ze{constructor(e){super(e,6)}};ne.NotificationType6=$a;var ja=class extends ze{constructor(e){super(e,7)}};ne.NotificationType7=ja;var Wa=class extends ze{constructor(e){super(e,8)}};ne.NotificationType8=Wa;var Ha=class extends ze{constructor(e){super(e,9)}};ne.NotificationType9=Ha;var Dv;(function(i){function e(r){let s=r;return s&&_i.string(s.method)&&(_i.string(s.id)||_i.number(s.id))}i.isRequest=e;function t(r){let s=r;return s&&_i.string(s.method)&&r.id===void 0}i.isNotification=t;function n(r){let s=r;return s&&(s.result!==void 0||!!s.error)&&(_i.string(s.id)||_i.number(s.id)||s.id===null)}i.isResponse=n})(Dv=ne.Message||(ne.Message={}))});var za=F(zn=>{"use strict";var Ff;Object.defineProperty(zn,"__esModule",{value:!0});zn.LRUCache=zn.LinkedMap=zn.Touch=void 0;var Mt;(function(i){i.None=0,i.First=1,i.AsOld=i.First,i.Last=2,i.AsNew=i.Last})(Mt=zn.Touch||(zn.Touch={}));var Ss=class{constructor(){this[Ff]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=Mt.None){let n=this._map.get(e);if(n)return t!==Mt.None&&this.touch(n,t),n.value}set(e,t,n=Mt.None){let r=this._map.get(e);if(r)r.value=t,n!==Mt.None&&this.touch(r,n);else{switch(r={key:e,value:t,next:void 0,previous:void 0},n){case Mt.None:this.addItemLast(r);break;case Mt.First:this.addItemFirst(r);break;case Mt.Last:this.addItemLast(r);break;default:this.addItemLast(r);break}this._map.set(e,r),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,r=this._head;for(;r;){if(t?e.bind(t)(r.value,r.key,this):e(r.value,r.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");r=r.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let r={value:t.key,done:!1};return t=t.next,r}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let r={value:t.value,done:!1};return t=t.next,r}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let r={value:[t.key,t.value],done:!1};return t=t.next,r}else return{value:void 0,done:!0}}};return n}[(Ff=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==Mt.First&&t!==Mt.Last)){if(t===Mt.First){if(e===this._head)return;let n=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(n.previous=r,r.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===Mt.Last){if(e===this._tail)return;let n=e.next,r=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=r,r.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};zn.LinkedMap=Ss;var Ka=class extends Ss{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=Mt.AsNew){return super.get(e,t)}peek(e){return super.get(e,Mt.None)}set(e,t){return super.set(e,t,Mt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};zn.LRUCache=Ka});var Lf=F(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.Disposable=void 0;var _v;(function(i){function e(t){return{dispose:t}}i.create=e})(_v=Cr.Disposable||(Cr.Disposable={}))});var fi=F(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});var Ba;function Va(){if(Ba===void 0)throw new Error("No runtime abstraction layer installed");return Ba}(function(i){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");Ba=t}i.install=e})(Va||(Va={}));Ga.default=Va});var zi=F(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});Ti.Emitter=Ti.Event=void 0;var Tv=fi(),Pv;(function(i){let e={dispose(){}};i.None=function(){return e}})(Pv=Ti.Event||(Ti.Event={}));var Xa=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let r=0,s=this._callbacks.length;r<s;r++)if(this._callbacks[r]===e)if(this._contexts[r]===t){this._callbacks.splice(r,1),this._contexts.splice(r,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),r=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(r[s],e))}catch(a){(0,Tv.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Rs=class i{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new Xa),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let r={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),r.dispose=i._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(r),r}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};Ti.Emitter=Rs;Rs._noop=function(){}});var _s=F(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.CancellationTokenSource=Pi.CancellationToken=void 0;var kv=fi(),Ev=Ki(),Qa=zi(),Ja;(function(i){i.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Qa.Event.None}),i.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Qa.Event.None});function e(t){let n=t;return n&&(n===i.None||n===i.Cancelled||Ev.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}i.is=e})(Ja=Pi.CancellationToken||(Pi.CancellationToken={}));var xv=Object.freeze(function(i,e){let t=(0,kv.default)().timer.setTimeout(i.bind(e),0);return{dispose(){t.dispose()}}}),Ds=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?xv:(this._emitter||(this._emitter=new Qa.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Za=class{get token(){return this._token||(this._token=new Ds),this._token}cancel(){this._token?this._token.cancel():this._token=Ja.Cancelled}dispose(){this._token?this._token instanceof Ds&&this._token.dispose():this._token=Ja.None}};Pi.CancellationTokenSource=Za});var Mf=F(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.SharedArrayReceiverStrategy=Bi.SharedArraySenderStrategy=void 0;var qv=_s(),Sr;(function(i){i.Continue=0,i.Cancelled=1})(Sr||(Sr={}));var Ya=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=Sr.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let r=new Int32Array(n,0,1);Atomics.store(r,0,Sr.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};Bi.SharedArraySenderStrategy=Ya;var ec=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===Sr.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},tc=class{constructor(e){this.token=new ec(e)}cancel(){}dispose(){}},nc=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new qv.CancellationTokenSource:new tc(t)}};Bi.SharedArrayReceiverStrategy=nc});var rc=F(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.Semaphore=void 0;var Iv=fi(),ic=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Iv.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Ts.Semaphore=ic});var Nf=F(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.ReadableStreamMessageReader=Bn.AbstractMessageReader=Bn.MessageReader=void 0;var oc=fi(),Vi=Ki(),sc=zi(),Ov=rc(),Fv;(function(i){function e(t){let n=t;return n&&Vi.func(n.listen)&&Vi.func(n.dispose)&&Vi.func(n.onError)&&Vi.func(n.onClose)&&Vi.func(n.onPartialMessage)}i.is=e})(Fv=Bn.MessageReader||(Bn.MessageReader={}));var Ps=class{constructor(){this.errorEmitter=new sc.Emitter,this.closeEmitter=new sc.Emitter,this.partialMessageEmitter=new sc.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${Vi.string(e.message)?e.message:"unknown"}`)}};Bn.AbstractMessageReader=Ps;var ac;(function(i){function e(t){let n,r,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let u of t.contentDecoders)o.set(u.name,u);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let u of t.contentTypeDecoders)c.set(u.name,u)}return a===void 0&&(a=(0,oc.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}i.fromOptions=e})(ac||(ac={}));var cc=class extends Ps{constructor(e,t){super(),this.readable=e,this.options=ac.fromOptions(t),this.buffer=(0,oc.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new Ov.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let r=n.get("content-length");if(!r){this.fireError(new Error("Header must provide a Content-Length property."));return}let s=parseInt(r);if(isNaN(s)){this.fireError(new Error("Content-Length value must be a number."));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,r=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(r)}).catch(n=>{this.fireError(n)})}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,oc.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};Bn.ReadableStreamMessageReader=cc});var Wf=F(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.WriteableStreamMessageWriter=Vn.AbstractMessageWriter=Vn.MessageWriter=void 0;var Af=fi(),Rr=Ki(),Lv=rc(),$f=zi(),Mv="Content-Length: ",jf=`\r
`,Nv;(function(i){function e(t){let n=t;return n&&Rr.func(n.dispose)&&Rr.func(n.onClose)&&Rr.func(n.onError)&&Rr.func(n.write)}i.is=e})(Nv=Vn.MessageWriter||(Vn.MessageWriter={}));var ks=class{constructor(){this.errorEmitter=new $f.Emitter,this.closeEmitter=new $f.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${Rr.string(e.message)?e.message:"unknown"}`)}};Vn.AbstractMessageWriter=ks;var uc;(function(i){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,Af.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,Af.default)().applicationJson.encoder}}i.fromOptions=e})(uc||(uc={}));var lc=class extends ks{constructor(e,t){super(),this.writable=e,this.options=uc.fromOptions(t),this.errorCount=0,this.writeSemaphore=new Lv.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let r=[];return r.push(Mv,n.byteLength.toString(),jf),r.push(jf),this.doWrite(e,r,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(r){return this.handleError(r,e),Promise.reject(r)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};Vn.WriteableStreamMessageWriter=lc});var Hf=F(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});Es.AbstractMessageBuffer=void 0;var Av=13,$v=10,jv=`\r
`,dc=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,r=0,s=0;e:for(;n<this._chunks.length;){let u=this._chunks[n];for(r=0;r<u.length;){switch(u[r]){case Av:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case $v:switch(t){case 1:t=2;break;case 3:t=4,r++;break e;default:t=0}break;default:t=0}r++}s+=u.byteLength,n++}if(t!==4)return;let o=this._read(s+r),a=new Map,c=this.toString(o,"ascii").split(jv);if(c.length<2)return a;for(let u=0;u<c.length-2;u++){let p=c[u],m=p.indexOf(":");if(m===-1)throw new Error("Message header must separate key and value using :");let g=p.substr(0,m),w=p.substr(m+1).trim();a.set(e?g.toLowerCase():g,w)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,r=0;for(;e>0;){let s=this._chunks[r];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[r]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};Es.AbstractMessageBuffer=dc});var Xf=F(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.createMessageConnection=te.ConnectionOptions=te.MessageStrategy=te.CancellationStrategy=te.CancellationSenderStrategy=te.CancellationReceiverStrategy=te.RequestCancellationReceiverStrategy=te.IdCancellationReceiverStrategy=te.ConnectionStrategy=te.ConnectionError=te.ConnectionErrors=te.LogTraceNotification=te.SetTraceNotification=te.TraceFormat=te.TraceValues=te.Trace=te.NullLogger=te.ProgressType=te.ProgressToken=void 0;var Uf=fi(),Ze=Ki(),se=Ua(),Kf=za(),Dr=zi(),fc=_s(),Tr;(function(i){i.type=new se.NotificationType("$/cancelRequest")})(Tr||(Tr={}));var zf;(function(i){function e(t){return typeof t=="string"||typeof t=="number"}i.is=e})(zf=te.ProgressToken||(te.ProgressToken={}));var _r;(function(i){i.type=new se.NotificationType("$/progress")})(_r||(_r={}));var hc=class{constructor(){}};te.ProgressType=hc;var pc;(function(i){function e(t){return Ze.func(t)}i.is=e})(pc||(pc={}));te.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Fe;(function(i){i[i.Off=0]="Off",i[i.Messages=1]="Messages",i[i.Compact=2]="Compact",i[i.Verbose=3]="Verbose"})(Fe=te.Trace||(te.Trace={}));var Wv;(function(i){i.Off="off",i.Messages="messages",i.Compact="compact",i.Verbose="verbose"})(Wv=te.TraceValues||(te.TraceValues={}));(function(i){function e(n){if(!Ze.string(n))return i.Off;switch(n=n.toLowerCase(),n){case"off":return i.Off;case"messages":return i.Messages;case"compact":return i.Compact;case"verbose":return i.Verbose;default:return i.Off}}i.fromString=e;function t(n){switch(n){case i.Off:return"off";case i.Messages:return"messages";case i.Compact:return"compact";case i.Verbose:return"verbose";default:return"off"}}i.toString=t})(Fe=te.Trace||(te.Trace={}));var mn;(function(i){i.Text="text",i.JSON="json"})(mn=te.TraceFormat||(te.TraceFormat={}));(function(i){function e(t){return Ze.string(t)?(t=t.toLowerCase(),t==="json"?i.JSON:i.Text):i.Text}i.fromString=e})(mn=te.TraceFormat||(te.TraceFormat={}));var Bf;(function(i){i.type=new se.NotificationType("$/setTrace")})(Bf=te.SetTraceNotification||(te.SetTraceNotification={}));var gc;(function(i){i.type=new se.NotificationType("$/logTrace")})(gc=te.LogTraceNotification||(te.LogTraceNotification={}));var xs;(function(i){i[i.Closed=1]="Closed",i[i.Disposed=2]="Disposed",i[i.AlreadyListening=3]="AlreadyListening"})(xs=te.ConnectionErrors||(te.ConnectionErrors={}));var Gi=class i extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,i.prototype)}};te.ConnectionError=Gi;var Vf;(function(i){function e(t){let n=t;return n&&Ze.func(n.cancelUndispatched)}i.is=e})(Vf=te.ConnectionStrategy||(te.ConnectionStrategy={}));var yc;(function(i){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&Ze.func(n.createCancellationTokenSource)&&(n.dispose===void 0||Ze.func(n.dispose))}i.is=e})(yc=te.IdCancellationReceiverStrategy||(te.IdCancellationReceiverStrategy={}));var Gf;(function(i){function e(t){let n=t;return n&&n.kind==="request"&&Ze.func(n.createCancellationTokenSource)&&(n.dispose===void 0||Ze.func(n.dispose))}i.is=e})(Gf=te.RequestCancellationReceiverStrategy||(te.RequestCancellationReceiverStrategy={}));var mc;(function(i){i.Message=Object.freeze({createCancellationTokenSource(t){return new fc.CancellationTokenSource}});function e(t){return yc.is(t)||Gf.is(t)}i.is=e})(mc=te.CancellationReceiverStrategy||(te.CancellationReceiverStrategy={}));var vc;(function(i){i.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(Tr.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&Ze.func(n.sendCancellation)&&Ze.func(n.cleanup)}i.is=e})(vc=te.CancellationSenderStrategy||(te.CancellationSenderStrategy={}));var bc;(function(i){i.Message=Object.freeze({receiver:mc.Message,sender:vc.Message});function e(t){let n=t;return n&&mc.is(n.receiver)&&vc.is(n.sender)}i.is=e})(bc=te.CancellationStrategy||(te.CancellationStrategy={}));var wc;(function(i){function e(t){let n=t;return n&&Ze.func(n.handleMessage)}i.is=e})(wc=te.MessageStrategy||(te.MessageStrategy={}));var Hv;(function(i){function e(t){let n=t;return n&&(bc.is(n.cancellationStrategy)||Vf.is(n.connectionStrategy)||wc.is(n.messageStrategy))}i.is=e})(Hv=te.ConnectionOptions||(te.ConnectionOptions={}));var vn;(function(i){i[i.New=1]="New",i[i.Listening=2]="Listening",i[i.Closed=3]="Closed",i[i.Disposed=4]="Disposed"})(vn||(vn={}));function Uv(i,e,t,n){let r=t!==void 0?t:te.NullLogger,s=0,o=0,a=0,c="2.0",u,p=new Map,m,g=new Map,w=new Map,y,T=new Kf.LinkedMap,C=new Map,S=new Set,P=new Map,x=Fe.Off,q=mn.Text,A,V=vn.New,j=new Dr.Emitter,W=new Dr.Emitter,Y=new Dr.Emitter,ee=new Dr.Emitter,de=new Dr.Emitter,fe=n&&n.cancellationStrategy?n.cancellationStrategy:bc.Message;function Ue(R){if(R===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+R.toString()}function Ge(R){return R===null?"res-unknown-"+(++a).toString():"res-"+R.toString()}function rt(){return"not-"+(++o).toString()}function Je(R,M){se.Message.isRequest(M)?R.set(Ue(M.id),M):se.Message.isResponse(M)?R.set(Ge(M.id),M):R.set(rt(),M)}function Ut(R){}function Xe(){return V===vn.Listening}function Ot(){return V===vn.Closed}function Kt(){return V===vn.Disposed}function kn(){(V===vn.New||V===vn.Listening)&&(V=vn.Closed,W.fire(void 0))}function Pt(R){j.fire([R,void 0,void 0])}function Ri(R){j.fire(R)}i.onClose(kn),i.onError(Pt),e.onClose(kn),e.onError(Ri);function ri(){y||T.size===0||(y=(0,Uf.default)().timer.setImmediate(()=>{y=void 0,$n()}))}function An(R){se.Message.isRequest(R)?Di(R):se.Message.isNotification(R)?oi(R):se.Message.isResponse(R)?si(R):Wn(R)}function $n(){if(T.size===0)return;let R=T.shift();try{let M=n?.messageStrategy;wc.is(M)?M.handleMessage(R,An):An(R)}finally{ri()}}let jn=R=>{try{if(se.Message.isNotification(R)&&R.method===Tr.type.method){let M=R.params.id,z=Ue(M),J=T.get(z);if(se.Message.isRequest(J)){let De=n?.connectionStrategy,Ie=De&&De.cancelUndispatched?De.cancelUndispatched(J,Ut):void 0;if(Ie&&(Ie.error!==void 0||Ie.result!==void 0)){T.delete(z),P.delete(M),Ie.id=J.id,cn(Ie,R.method,Date.now()),e.write(Ie).catch(()=>r.error("Sending response for canceled message failed."));return}}let Te=P.get(M);if(Te!==void 0){Te.cancel(),Ft(R);return}else S.add(M)}Je(T,R)}finally{ri()}};function Di(R){if(Kt())return;function M(he,Pe,f){let O={jsonrpc:c,id:R.id};he instanceof se.ResponseError?O.error=he.toJson():O.result=he===void 0?null:he,cn(O,Pe,f),e.write(O).catch(()=>r.error("Sending response failed."))}function z(he,Pe,f){let O={jsonrpc:c,id:R.id,error:he.toJson()};cn(O,Pe,f),e.write(O).catch(()=>r.error("Sending response failed."))}function J(he,Pe,f){he===void 0&&(he=null);let O={jsonrpc:c,id:R.id,result:he};cn(O,Pe,f),e.write(O).catch(()=>r.error("Sending response failed."))}ci(R);let Te=p.get(R.method),De,Ie;Te&&(De=Te.type,Ie=Te.handler);let Ne=Date.now();if(Ie||u){let he=R.id??String(Date.now()),Pe=yc.is(fe.receiver)?fe.receiver.createCancellationTokenSource(he):fe.receiver.createCancellationTokenSource(R);R.id!==null&&S.has(R.id)&&Pe.cancel(),R.id!==null&&P.set(he,Pe);try{let f;if(Ie)if(R.params===void 0){if(De!==void 0&&De.numberOfParams!==0){z(new se.ResponseError(se.ErrorCodes.InvalidParams,`Request ${R.method} defines ${De.numberOfParams} params but received none.`),R.method,Ne);return}f=Ie(Pe.token)}else if(Array.isArray(R.params)){if(De!==void 0&&De.parameterStructures===se.ParameterStructures.byName){z(new se.ResponseError(se.ErrorCodes.InvalidParams,`Request ${R.method} defines parameters by name but received parameters by position`),R.method,Ne);return}f=Ie(...R.params,Pe.token)}else{if(De!==void 0&&De.parameterStructures===se.ParameterStructures.byPosition){z(new se.ResponseError(se.ErrorCodes.InvalidParams,`Request ${R.method} defines parameters by position but received parameters by name`),R.method,Ne);return}f=Ie(R.params,Pe.token)}else u&&(f=u(R.method,R.params,Pe.token));let O=f;f?O.then?O.then(B=>{P.delete(he),M(B,R.method,Ne)},B=>{P.delete(he),B instanceof se.ResponseError?z(B,R.method,Ne):B&&Ze.string(B.message)?z(new se.ResponseError(se.ErrorCodes.InternalError,`Request ${R.method} failed with message: ${B.message}`),R.method,Ne):z(new se.ResponseError(se.ErrorCodes.InternalError,`Request ${R.method} failed unexpectedly without providing any details.`),R.method,Ne)}):(P.delete(he),M(f,R.method,Ne)):(P.delete(he),J(f,R.method,Ne))}catch(f){P.delete(he),f instanceof se.ResponseError?M(f,R.method,Ne):f&&Ze.string(f.message)?z(new se.ResponseError(se.ErrorCodes.InternalError,`Request ${R.method} failed with message: ${f.message}`),R.method,Ne):z(new se.ResponseError(se.ErrorCodes.InternalError,`Request ${R.method} failed unexpectedly without providing any details.`),R.method,Ne)}}else z(new se.ResponseError(se.ErrorCodes.MethodNotFound,`Unhandled method ${R.method}`),R.method,Ne)}function si(R){if(!Kt())if(R.id===null)R.error?r.error(`Received response message without id: Error is: 
${JSON.stringify(R.error,void 0,4)}`):r.error("Received response message without id. No further error information provided.");else{let M=R.id,z=C.get(M);if(Hn(R,z),z!==void 0){C.delete(M);try{if(R.error){let J=R.error;z.reject(new se.ResponseError(J.code,J.message,J.data))}else if(R.result!==void 0)z.resolve(R.result);else throw new Error("Should never happen.")}catch(J){J.message?r.error(`Response handler '${z.method}' failed with message: ${J.message}`):r.error(`Response handler '${z.method}' failed unexpectedly.`)}}}}function oi(R){if(Kt())return;let M,z;if(R.method===Tr.type.method){let J=R.params.id;S.delete(J),Ft(R);return}else{let J=g.get(R.method);J&&(z=J.handler,M=J.type)}if(z||m)try{if(Ft(R),z)if(R.params===void 0)M!==void 0&&M.numberOfParams!==0&&M.parameterStructures!==se.ParameterStructures.byName&&r.error(`Notification ${R.method} defines ${M.numberOfParams} params but received none.`),z();else if(Array.isArray(R.params)){let J=R.params;R.method===_r.type.method&&J.length===2&&zf.is(J[0])?z({token:J[0],value:J[1]}):(M!==void 0&&(M.parameterStructures===se.ParameterStructures.byName&&r.error(`Notification ${R.method} defines parameters by name but received parameters by position`),M.numberOfParams!==R.params.length&&r.error(`Notification ${R.method} defines ${M.numberOfParams} params but received ${J.length} arguments`)),z(...J))}else M!==void 0&&M.parameterStructures===se.ParameterStructures.byPosition&&r.error(`Notification ${R.method} defines parameters by position but received parameters by name`),z(R.params);else m&&m(R.method,R.params)}catch(J){J.message?r.error(`Notification handler '${R.method}' failed with message: ${J.message}`):r.error(`Notification handler '${R.method}' failed unexpectedly.`)}else Y.fire(R)}function Wn(R){if(!R){r.error("Received empty message.");return}r.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(R,null,4)}`);let M=R;if(Ze.string(M.id)||Ze.number(M.id)){let z=M.id,J=C.get(z);J&&J.reject(new Error("The received response has neither a result nor an error property."))}}function gt(R){if(R!=null)switch(x){case Fe.Verbose:return JSON.stringify(R,null,4);case Fe.Compact:return JSON.stringify(R);default:return}}function ai(R){if(!(x===Fe.Off||!A))if(q===mn.Text){let M;(x===Fe.Verbose||x===Fe.Compact)&&R.params&&(M=`Params: ${gt(R.params)}

`),A.log(`Sending request '${R.method} - (${R.id})'.`,M)}else ut("send-request",R)}function En(R){if(!(x===Fe.Off||!A))if(q===mn.Text){let M;(x===Fe.Verbose||x===Fe.Compact)&&(R.params?M=`Params: ${gt(R.params)}

`:M=`No parameters provided.

`),A.log(`Sending notification '${R.method}'.`,M)}else ut("send-notification",R)}function cn(R,M,z){if(!(x===Fe.Off||!A))if(q===mn.Text){let J;(x===Fe.Verbose||x===Fe.Compact)&&(R.error&&R.error.data?J=`Error data: ${gt(R.error.data)}

`:R.result?J=`Result: ${gt(R.result)}

`:R.error===void 0&&(J=`No result returned.

`)),A.log(`Sending response '${M} - (${R.id})'. Processing request took ${Date.now()-z}ms`,J)}else ut("send-response",R)}function ci(R){if(!(x===Fe.Off||!A))if(q===mn.Text){let M;(x===Fe.Verbose||x===Fe.Compact)&&R.params&&(M=`Params: ${gt(R.params)}

`),A.log(`Received request '${R.method} - (${R.id})'.`,M)}else ut("receive-request",R)}function Ft(R){if(!(x===Fe.Off||!A||R.method===gc.type.method))if(q===mn.Text){let M;(x===Fe.Verbose||x===Fe.Compact)&&(R.params?M=`Params: ${gt(R.params)}

`:M=`No parameters provided.

`),A.log(`Received notification '${R.method}'.`,M)}else ut("receive-notification",R)}function Hn(R,M){if(!(x===Fe.Off||!A))if(q===mn.Text){let z;if((x===Fe.Verbose||x===Fe.Compact)&&(R.error&&R.error.data?z=`Error data: ${gt(R.error.data)}

`:R.result?z=`Result: ${gt(R.result)}

`:R.error===void 0&&(z=`No result returned.

`)),M){let J=R.error?` Request failed: ${R.error.message} (${R.error.code}).`:"";A.log(`Received response '${M.method} - (${R.id})' in ${Date.now()-M.timerStart}ms.${J}`,z)}else A.log(`Received response ${R.id} without active response promise.`,z)}else ut("receive-response",R)}function ut(R,M){if(!A||x===Fe.Off)return;let z={isLSPMessage:!0,type:R,message:M,timestamp:Date.now()};A.log(z)}function pn(){if(Ot())throw new Gi(xs.Closed,"Connection is closed.");if(Kt())throw new Gi(xs.Disposed,"Connection is disposed.")}function Lt(){if(Xe())throw new Gi(xs.AlreadyListening,"Connection is already listening")}function Un(){if(!Xe())throw new Error("Call listen() first.")}function Jt(R){return R===void 0?null:R}function Kn(R){if(R!==null)return R}function ui(R){return R!=null&&!Array.isArray(R)&&typeof R=="object"}function zt(R,M){switch(R){case se.ParameterStructures.auto:return ui(M)?Kn(M):[Jt(M)];case se.ParameterStructures.byName:if(!ui(M))throw new Error("Received parameters by name but param is not an object literal.");return Kn(M);case se.ParameterStructures.byPosition:return[Jt(M)];default:throw new Error(`Unknown parameter structure ${R.toString()}`)}}function li(R,M){let z,J=R.numberOfParams;switch(J){case 0:z=void 0;break;case 1:z=zt(R.parameterStructures,M[0]);break;default:z=[];for(let Te=0;Te<M.length&&Te<J;Te++)z.push(Jt(M[Te]));if(M.length<J)for(let Te=M.length;Te<J;Te++)z.push(null);break}return z}let Zt={sendNotification:(R,...M)=>{pn();let z,J;if(Ze.string(R)){z=R;let De=M[0],Ie=0,Ne=se.ParameterStructures.auto;se.ParameterStructures.is(De)&&(Ie=1,Ne=De);let he=M.length,Pe=he-Ie;switch(Pe){case 0:J=void 0;break;case 1:J=zt(Ne,M[Ie]);break;default:if(Ne===se.ParameterStructures.byName)throw new Error(`Received ${Pe} parameters for 'by Name' notification parameter structure.`);J=M.slice(Ie,he).map(f=>Jt(f));break}}else{let De=M;z=R.method,J=li(R,De)}let Te={jsonrpc:c,method:z,params:J};return En(Te),e.write(Te).catch(De=>{throw r.error("Sending notification failed."),De})},onNotification:(R,M)=>{pn();let z;return Ze.func(R)?m=R:M&&(Ze.string(R)?(z=R,g.set(R,{type:void 0,handler:M})):(z=R.method,g.set(R.method,{type:R,handler:M}))),{dispose:()=>{z!==void 0?g.delete(z):m=void 0}}},onProgress:(R,M,z)=>{if(w.has(M))throw new Error(`Progress handler for token ${M} already registered`);return w.set(M,z),{dispose:()=>{w.delete(M)}}},sendProgress:(R,M,z)=>Zt.sendNotification(_r.type,{token:M,value:z}),onUnhandledProgress:ee.event,sendRequest:(R,...M)=>{pn(),Un();let z,J,Te;if(Ze.string(R)){z=R;let he=M[0],Pe=M[M.length-1],f=0,O=se.ParameterStructures.auto;se.ParameterStructures.is(he)&&(f=1,O=he);let B=M.length;fc.CancellationToken.is(Pe)&&(B=B-1,Te=Pe);let pe=B-f;switch(pe){case 0:J=void 0;break;case 1:J=zt(O,M[f]);break;default:if(O===se.ParameterStructures.byName)throw new Error(`Received ${pe} parameters for 'by Name' request parameter structure.`);J=M.slice(f,B).map(k=>Jt(k));break}}else{let he=M;z=R.method,J=li(R,he);let Pe=R.numberOfParams;Te=fc.CancellationToken.is(he[Pe])?he[Pe]:void 0}let De=s++,Ie;Te&&(Ie=Te.onCancellationRequested(()=>{let he=fe.sender.sendCancellation(Zt,De);return he===void 0?(r.log(`Received no promise from cancellation strategy when cancelling id ${De}`),Promise.resolve()):he.catch(()=>{r.log(`Sending cancellation messages for id ${De} failed`)})}));let Ne={jsonrpc:c,id:De,method:z,params:J};return ai(Ne),typeof fe.sender.enableCancellation=="function"&&fe.sender.enableCancellation(Ne),new Promise(async(he,Pe)=>{let f=pe=>{he(pe),fe.sender.cleanup(De),Ie?.dispose()},O=pe=>{Pe(pe),fe.sender.cleanup(De),Ie?.dispose()},B={method:z,timerStart:Date.now(),resolve:f,reject:O};try{await e.write(Ne),C.set(De,B)}catch(pe){throw r.error("Sending request failed."),B.reject(new se.ResponseError(se.ErrorCodes.MessageWriteError,pe.message?pe.message:"Unknown reason")),pe}})},onRequest:(R,M)=>{pn();let z=null;return pc.is(R)?(z=void 0,u=R):Ze.string(R)?(z=null,M!==void 0&&(z=R,p.set(R,{handler:M,type:void 0}))):M!==void 0&&(z=R.method,p.set(R.method,{type:R,handler:M})),{dispose:()=>{z!==null&&(z!==void 0?p.delete(z):u=void 0)}}},hasPendingResponse:()=>C.size>0,trace:async(R,M,z)=>{let J=!1,Te=mn.Text;z!==void 0&&(Ze.boolean(z)?J=z:(J=z.sendNotification||!1,Te=z.traceFormat||mn.Text)),x=R,q=Te,x===Fe.Off?A=void 0:A=M,J&&!Ot()&&!Kt()&&await Zt.sendNotification(Bf.type,{value:Fe.toString(R)})},onError:j.event,onClose:W.event,onUnhandledNotification:Y.event,onDispose:de.event,end:()=>{e.end()},dispose:()=>{if(Kt())return;V=vn.Disposed,de.fire(void 0);let R=new se.ResponseError(se.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let M of C.values())M.reject(R);C=new Map,P=new Map,S=new Set,T=new Kf.LinkedMap,Ze.func(e.dispose)&&e.dispose(),Ze.func(i.dispose)&&i.dispose()},listen:()=>{pn(),Lt(),V=vn.Listening,i.listen(jn)},inspect:()=>{(0,Uf.default)().console.log("inspect")}};return Zt.onNotification(gc.type,R=>{if(x===Fe.Off||!A)return;let M=x===Fe.Verbose||x===Fe.Compact;A.log(R.message,M?R.verbose:void 0)}),Zt.onNotification(_r.type,R=>{let M=w.get(R.token);M?M(R.value):ee.fire(R)}),Zt}te.createMessageConnection=Uv});var qs=F(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.ProgressType=L.ProgressToken=L.createMessageConnection=L.NullLogger=L.ConnectionOptions=L.ConnectionStrategy=L.AbstractMessageBuffer=L.WriteableStreamMessageWriter=L.AbstractMessageWriter=L.MessageWriter=L.ReadableStreamMessageReader=L.AbstractMessageReader=L.MessageReader=L.SharedArrayReceiverStrategy=L.SharedArraySenderStrategy=L.CancellationToken=L.CancellationTokenSource=L.Emitter=L.Event=L.Disposable=L.LRUCache=L.Touch=L.LinkedMap=L.ParameterStructures=L.NotificationType9=L.NotificationType8=L.NotificationType7=L.NotificationType6=L.NotificationType5=L.NotificationType4=L.NotificationType3=L.NotificationType2=L.NotificationType1=L.NotificationType0=L.NotificationType=L.ErrorCodes=L.ResponseError=L.RequestType9=L.RequestType8=L.RequestType7=L.RequestType6=L.RequestType5=L.RequestType4=L.RequestType3=L.RequestType2=L.RequestType1=L.RequestType0=L.RequestType=L.Message=L.RAL=void 0;L.MessageStrategy=L.CancellationStrategy=L.CancellationSenderStrategy=L.CancellationReceiverStrategy=L.ConnectionError=L.ConnectionErrors=L.LogTraceNotification=L.SetTraceNotification=L.TraceFormat=L.TraceValues=L.Trace=void 0;var je=Ua();Object.defineProperty(L,"Message",{enumerable:!0,get:function(){return je.Message}});Object.defineProperty(L,"RequestType",{enumerable:!0,get:function(){return je.RequestType}});Object.defineProperty(L,"RequestType0",{enumerable:!0,get:function(){return je.RequestType0}});Object.defineProperty(L,"RequestType1",{enumerable:!0,get:function(){return je.RequestType1}});Object.defineProperty(L,"RequestType2",{enumerable:!0,get:function(){return je.RequestType2}});Object.defineProperty(L,"RequestType3",{enumerable:!0,get:function(){return je.RequestType3}});Object.defineProperty(L,"RequestType4",{enumerable:!0,get:function(){return je.RequestType4}});Object.defineProperty(L,"RequestType5",{enumerable:!0,get:function(){return je.RequestType5}});Object.defineProperty(L,"RequestType6",{enumerable:!0,get:function(){return je.RequestType6}});Object.defineProperty(L,"RequestType7",{enumerable:!0,get:function(){return je.RequestType7}});Object.defineProperty(L,"RequestType8",{enumerable:!0,get:function(){return je.RequestType8}});Object.defineProperty(L,"RequestType9",{enumerable:!0,get:function(){return je.RequestType9}});Object.defineProperty(L,"ResponseError",{enumerable:!0,get:function(){return je.ResponseError}});Object.defineProperty(L,"ErrorCodes",{enumerable:!0,get:function(){return je.ErrorCodes}});Object.defineProperty(L,"NotificationType",{enumerable:!0,get:function(){return je.NotificationType}});Object.defineProperty(L,"NotificationType0",{enumerable:!0,get:function(){return je.NotificationType0}});Object.defineProperty(L,"NotificationType1",{enumerable:!0,get:function(){return je.NotificationType1}});Object.defineProperty(L,"NotificationType2",{enumerable:!0,get:function(){return je.NotificationType2}});Object.defineProperty(L,"NotificationType3",{enumerable:!0,get:function(){return je.NotificationType3}});Object.defineProperty(L,"NotificationType4",{enumerable:!0,get:function(){return je.NotificationType4}});Object.defineProperty(L,"NotificationType5",{enumerable:!0,get:function(){return je.NotificationType5}});Object.defineProperty(L,"NotificationType6",{enumerable:!0,get:function(){return je.NotificationType6}});Object.defineProperty(L,"NotificationType7",{enumerable:!0,get:function(){return je.NotificationType7}});Object.defineProperty(L,"NotificationType8",{enumerable:!0,get:function(){return je.NotificationType8}});Object.defineProperty(L,"NotificationType9",{enumerable:!0,get:function(){return je.NotificationType9}});Object.defineProperty(L,"ParameterStructures",{enumerable:!0,get:function(){return je.ParameterStructures}});var Cc=za();Object.defineProperty(L,"LinkedMap",{enumerable:!0,get:function(){return Cc.LinkedMap}});Object.defineProperty(L,"LRUCache",{enumerable:!0,get:function(){return Cc.LRUCache}});Object.defineProperty(L,"Touch",{enumerable:!0,get:function(){return Cc.Touch}});var Kv=Lf();Object.defineProperty(L,"Disposable",{enumerable:!0,get:function(){return Kv.Disposable}});var Qf=zi();Object.defineProperty(L,"Event",{enumerable:!0,get:function(){return Qf.Event}});Object.defineProperty(L,"Emitter",{enumerable:!0,get:function(){return Qf.Emitter}});var Jf=_s();Object.defineProperty(L,"CancellationTokenSource",{enumerable:!0,get:function(){return Jf.CancellationTokenSource}});Object.defineProperty(L,"CancellationToken",{enumerable:!0,get:function(){return Jf.CancellationToken}});var Zf=Mf();Object.defineProperty(L,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return Zf.SharedArraySenderStrategy}});Object.defineProperty(L,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return Zf.SharedArrayReceiverStrategy}});var Sc=Nf();Object.defineProperty(L,"MessageReader",{enumerable:!0,get:function(){return Sc.MessageReader}});Object.defineProperty(L,"AbstractMessageReader",{enumerable:!0,get:function(){return Sc.AbstractMessageReader}});Object.defineProperty(L,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Sc.ReadableStreamMessageReader}});var Rc=Wf();Object.defineProperty(L,"MessageWriter",{enumerable:!0,get:function(){return Rc.MessageWriter}});Object.defineProperty(L,"AbstractMessageWriter",{enumerable:!0,get:function(){return Rc.AbstractMessageWriter}});Object.defineProperty(L,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Rc.WriteableStreamMessageWriter}});var zv=Hf();Object.defineProperty(L,"AbstractMessageBuffer",{enumerable:!0,get:function(){return zv.AbstractMessageBuffer}});var Rt=Xf();Object.defineProperty(L,"ConnectionStrategy",{enumerable:!0,get:function(){return Rt.ConnectionStrategy}});Object.defineProperty(L,"ConnectionOptions",{enumerable:!0,get:function(){return Rt.ConnectionOptions}});Object.defineProperty(L,"NullLogger",{enumerable:!0,get:function(){return Rt.NullLogger}});Object.defineProperty(L,"createMessageConnection",{enumerable:!0,get:function(){return Rt.createMessageConnection}});Object.defineProperty(L,"ProgressToken",{enumerable:!0,get:function(){return Rt.ProgressToken}});Object.defineProperty(L,"ProgressType",{enumerable:!0,get:function(){return Rt.ProgressType}});Object.defineProperty(L,"Trace",{enumerable:!0,get:function(){return Rt.Trace}});Object.defineProperty(L,"TraceValues",{enumerable:!0,get:function(){return Rt.TraceValues}});Object.defineProperty(L,"TraceFormat",{enumerable:!0,get:function(){return Rt.TraceFormat}});Object.defineProperty(L,"SetTraceNotification",{enumerable:!0,get:function(){return Rt.SetTraceNotification}});Object.defineProperty(L,"LogTraceNotification",{enumerable:!0,get:function(){return Rt.LogTraceNotification}});Object.defineProperty(L,"ConnectionErrors",{enumerable:!0,get:function(){return Rt.ConnectionErrors}});Object.defineProperty(L,"ConnectionError",{enumerable:!0,get:function(){return Rt.ConnectionError}});Object.defineProperty(L,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Rt.CancellationReceiverStrategy}});Object.defineProperty(L,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Rt.CancellationSenderStrategy}});Object.defineProperty(L,"CancellationStrategy",{enumerable:!0,get:function(){return Rt.CancellationStrategy}});Object.defineProperty(L,"MessageStrategy",{enumerable:!0,get:function(){return Rt.MessageStrategy}});var Bv=fi();L.RAL=Bv.default});var th=F(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});var Yf=require("util"),Gn=qs(),Is=class i extends Gn.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return i.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new Yf.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Is.emptyBuffer=Buffer.allocUnsafe(0);var Dc=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Gn.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Gn.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Gn.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Gn.Disposable.create(()=>this.stream.off("data",e))}},_c=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Gn.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Gn.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Gn.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,r)=>{let s=o=>{o==null?n():r(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},eh=Object.freeze({messageBuffer:Object.freeze({create:i=>new Is(i)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(i,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(i,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(i,e)=>{try{return i instanceof Buffer?Promise.resolve(JSON.parse(i.toString(e.charset))):Promise.resolve(JSON.parse(new Yf.TextDecoder(e.charset).decode(i)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:i=>new Dc(i),asWritableStream:i=>new _c(i)}),console,timer:Object.freeze({setTimeout(i,e,...t){let n=setTimeout(i,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(i,...e){let t=setImmediate(i,...e);return{dispose:()=>clearImmediate(t)}},setInterval(i,e,...t){let n=setInterval(i,e,...t);return{dispose:()=>clearInterval(n)}}})});function Tc(){return eh}(function(i){function e(){Gn.RAL.install(eh)}i.install=e})(Tc||(Tc={}));Pc.default=Tc});var xi=F(Se=>{"use strict";var Vv=Se&&Se.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Gv=Se&&Se.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Vv(e,i,t)};Object.defineProperty(Se,"__esModule",{value:!0});Se.createMessageConnection=Se.createServerSocketTransport=Se.createClientSocketTransport=Se.createServerPipeTransport=Se.createClientPipeTransport=Se.generateRandomPipeName=Se.StreamMessageWriter=Se.StreamMessageReader=Se.SocketMessageWriter=Se.SocketMessageReader=Se.PortMessageWriter=Se.PortMessageReader=Se.IPCMessageWriter=Se.IPCMessageReader=void 0;var Xi=th();Xi.default.install();var nh=require("path"),Xv=require("os"),Qv=require("crypto"),Ls=require("net"),en=qs();Gv(qs(),Se);var kc=class extends en.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),en.Disposable.create(()=>this.process.off("message",e))}};Se.IPCMessageReader=kc;var Ec=class extends en.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Se.IPCMessageWriter=Ec;var xc=class extends en.AbstractMessageReader{constructor(e){super(),this.onData=new en.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};Se.PortMessageReader=xc;var qc=class extends en.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Se.PortMessageWriter=qc;var ki=class extends en.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,Xi.default)().stream.asReadableStream(e),t)}};Se.SocketMessageReader=ki;var Ei=class extends en.WriteableStreamMessageWriter{constructor(e,t){super((0,Xi.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};Se.SocketMessageWriter=Ei;var Os=class extends en.ReadableStreamMessageReader{constructor(e,t){super((0,Xi.default)().stream.asReadableStream(e),t)}};Se.StreamMessageReader=Os;var Fs=class extends en.WriteableStreamMessageWriter{constructor(e,t){super((0,Xi.default)().stream.asWritableStream(e),t)}};Se.StreamMessageWriter=Fs;var ih=process.env.XDG_RUNTIME_DIR,Jv=new Map([["linux",107],["darwin",103]]);function Zv(){let i=(0,Qv.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${i}-sock`;let e;ih?e=nh.join(ih,`vscode-ipc-${i}.sock`):e=nh.join(Xv.tmpdir(),`vscode-${i}.sock`);let t=Jv.get(process.platform);return t!==void 0&&e.length>t&&(0,Xi.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}Se.generateRandomPipeName=Zv;function Yv(i,e="utf-8"){let t,n=new Promise((r,s)=>{t=r});return new Promise((r,s)=>{let o=(0,Ls.createServer)(a=>{o.close(),t([new ki(a,e),new Ei(a,e)])});o.on("error",s),o.listen(i,()=>{o.removeListener("error",s),r({onConnected:()=>n})})})}Se.createClientPipeTransport=Yv;function ey(i,e="utf-8"){let t=(0,Ls.createConnection)(i);return[new ki(t,e),new Ei(t,e)]}Se.createServerPipeTransport=ey;function ty(i,e="utf-8"){let t,n=new Promise((r,s)=>{t=r});return new Promise((r,s)=>{let o=(0,Ls.createServer)(a=>{o.close(),t([new ki(a,e),new Ei(a,e)])});o.on("error",s),o.listen(i,"127.0.0.1",()=>{o.removeListener("error",s),r({onConnected:()=>n})})})}Se.createClientSocketTransport=ty;function ny(i,e="utf-8"){let t=(0,Ls.createConnection)(i,"127.0.0.1");return[new ki(t,e),new Ei(t,e)]}Se.createServerSocketTransport=ny;function iy(i){let e=i;return e.read!==void 0&&e.addListener!==void 0}function ry(i){let e=i;return e.write!==void 0&&e.addListener!==void 0}function sy(i,e,t,n){t||(t=en.NullLogger);let r=iy(i)?new Os(i):i,s=ry(e)?new Fs(e):e;return en.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,en.createMessageConnection)(r,s,t,n)}Se.createMessageConnection=sy});var Ic=F((p_,rh)=>{"use strict";rh.exports=xi()});var Ns=F((sh,Ms)=>{(function(i){if(typeof Ms=="object"&&typeof Ms.exports=="object"){var e=i(require,sh);e!==void 0&&(Ms.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],i)})(function(i,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.WorkspaceFolder=e.InlayHint=e.InlayHintLabelPart=e.InlayHintKind=e.InlineValueContext=e.InlineValueEvaluatableExpression=e.InlineValueVariableLookup=e.InlineValueText=e.SemanticTokens=e.SemanticTokenModifiers=e.SemanticTokenTypes=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionTriggerKind=e.CodeActionKind=e.DocumentSymbol=e.WorkspaceSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.CompletionItemLabelDetails=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=e.URI=e.DocumentUri=void 0;var t;(function(h){function D(_){return typeof _=="string"}h.is=D})(t=e.DocumentUri||(e.DocumentUri={}));var n;(function(h){function D(_){return typeof _=="string"}h.is=D})(n=e.URI||(e.URI={}));var r;(function(h){h.MIN_VALUE=-2147483648,h.MAX_VALUE=2147483647;function D(_){return typeof _=="number"&&h.MIN_VALUE<=_&&_<=h.MAX_VALUE}h.is=D})(r=e.integer||(e.integer={}));var s;(function(h){h.MIN_VALUE=0,h.MAX_VALUE=2147483647;function D(_){return typeof _=="number"&&h.MIN_VALUE<=_&&_<=h.MAX_VALUE}h.is=D})(s=e.uinteger||(e.uinteger={}));var o;(function(h){function D(b,d){return b===Number.MAX_VALUE&&(b=s.MAX_VALUE),d===Number.MAX_VALUE&&(d=s.MAX_VALUE),{line:b,character:d}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&k.uinteger(d.line)&&k.uinteger(d.character)}h.is=_})(o=e.Position||(e.Position={}));var a;(function(h){function D(b,d,I,N){if(k.uinteger(b)&&k.uinteger(d)&&k.uinteger(I)&&k.uinteger(N))return{start:o.create(b,d),end:o.create(I,N)};if(o.is(b)&&o.is(d))return{start:b,end:d};throw new Error("Range#create called with invalid arguments[".concat(b,", ").concat(d,", ").concat(I,", ").concat(N,"]"))}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&o.is(d.start)&&o.is(d.end)}h.is=_})(a=e.Range||(e.Range={}));var c;(function(h){function D(b,d){return{uri:b,range:d}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&a.is(d.range)&&(k.string(d.uri)||k.undefined(d.uri))}h.is=_})(c=e.Location||(e.Location={}));var u;(function(h){function D(b,d,I,N){return{targetUri:b,targetRange:d,targetSelectionRange:I,originSelectionRange:N}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&a.is(d.targetRange)&&k.string(d.targetUri)&&a.is(d.targetSelectionRange)&&(a.is(d.originSelectionRange)||k.undefined(d.originSelectionRange))}h.is=_})(u=e.LocationLink||(e.LocationLink={}));var p;(function(h){function D(b,d,I,N){return{red:b,green:d,blue:I,alpha:N}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&k.numberRange(d.red,0,1)&&k.numberRange(d.green,0,1)&&k.numberRange(d.blue,0,1)&&k.numberRange(d.alpha,0,1)}h.is=_})(p=e.Color||(e.Color={}));var m;(function(h){function D(b,d){return{range:b,color:d}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&a.is(d.range)&&p.is(d.color)}h.is=_})(m=e.ColorInformation||(e.ColorInformation={}));var g;(function(h){function D(b,d,I){return{label:b,textEdit:d,additionalTextEdits:I}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&k.string(d.label)&&(k.undefined(d.textEdit)||A.is(d))&&(k.undefined(d.additionalTextEdits)||k.typedArray(d.additionalTextEdits,A.is))}h.is=_})(g=e.ColorPresentation||(e.ColorPresentation={}));var w;(function(h){h.Comment="comment",h.Imports="imports",h.Region="region"})(w=e.FoldingRangeKind||(e.FoldingRangeKind={}));var y;(function(h){function D(b,d,I,N,ae,Ke){var Le={startLine:b,endLine:d};return k.defined(I)&&(Le.startCharacter=I),k.defined(N)&&(Le.endCharacter=N),k.defined(ae)&&(Le.kind=ae),k.defined(Ke)&&(Le.collapsedText=Ke),Le}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&k.uinteger(d.startLine)&&k.uinteger(d.startLine)&&(k.undefined(d.startCharacter)||k.uinteger(d.startCharacter))&&(k.undefined(d.endCharacter)||k.uinteger(d.endCharacter))&&(k.undefined(d.kind)||k.string(d.kind))}h.is=_})(y=e.FoldingRange||(e.FoldingRange={}));var T;(function(h){function D(b,d){return{location:b,message:d}}h.create=D;function _(b){var d=b;return k.defined(d)&&c.is(d.location)&&k.string(d.message)}h.is=_})(T=e.DiagnosticRelatedInformation||(e.DiagnosticRelatedInformation={}));var C;(function(h){h.Error=1,h.Warning=2,h.Information=3,h.Hint=4})(C=e.DiagnosticSeverity||(e.DiagnosticSeverity={}));var S;(function(h){h.Unnecessary=1,h.Deprecated=2})(S=e.DiagnosticTag||(e.DiagnosticTag={}));var P;(function(h){function D(_){var b=_;return k.objectLiteral(b)&&k.string(b.href)}h.is=D})(P=e.CodeDescription||(e.CodeDescription={}));var x;(function(h){function D(b,d,I,N,ae,Ke){var Le={range:b,message:d};return k.defined(I)&&(Le.severity=I),k.defined(N)&&(Le.code=N),k.defined(ae)&&(Le.source=ae),k.defined(Ke)&&(Le.relatedInformation=Ke),Le}h.create=D;function _(b){var d,I=b;return k.defined(I)&&a.is(I.range)&&k.string(I.message)&&(k.number(I.severity)||k.undefined(I.severity))&&(k.integer(I.code)||k.string(I.code)||k.undefined(I.code))&&(k.undefined(I.codeDescription)||k.string((d=I.codeDescription)===null||d===void 0?void 0:d.href))&&(k.string(I.source)||k.undefined(I.source))&&(k.undefined(I.relatedInformation)||k.typedArray(I.relatedInformation,T.is))}h.is=_})(x=e.Diagnostic||(e.Diagnostic={}));var q;(function(h){function D(b,d){for(var I=[],N=2;N<arguments.length;N++)I[N-2]=arguments[N];var ae={title:b,command:d};return k.defined(I)&&I.length>0&&(ae.arguments=I),ae}h.create=D;function _(b){var d=b;return k.defined(d)&&k.string(d.title)&&k.string(d.command)}h.is=_})(q=e.Command||(e.Command={}));var A;(function(h){function D(I,N){return{range:I,newText:N}}h.replace=D;function _(I,N){return{range:{start:I,end:I},newText:N}}h.insert=_;function b(I){return{range:I,newText:""}}h.del=b;function d(I){var N=I;return k.objectLiteral(N)&&k.string(N.newText)&&a.is(N.range)}h.is=d})(A=e.TextEdit||(e.TextEdit={}));var V;(function(h){function D(b,d,I){var N={label:b};return d!==void 0&&(N.needsConfirmation=d),I!==void 0&&(N.description=I),N}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&k.string(d.label)&&(k.boolean(d.needsConfirmation)||d.needsConfirmation===void 0)&&(k.string(d.description)||d.description===void 0)}h.is=_})(V=e.ChangeAnnotation||(e.ChangeAnnotation={}));var j;(function(h){function D(_){var b=_;return k.string(b)}h.is=D})(j=e.ChangeAnnotationIdentifier||(e.ChangeAnnotationIdentifier={}));var W;(function(h){function D(I,N,ae){return{range:I,newText:N,annotationId:ae}}h.replace=D;function _(I,N,ae){return{range:{start:I,end:I},newText:N,annotationId:ae}}h.insert=_;function b(I,N){return{range:I,newText:"",annotationId:N}}h.del=b;function d(I){var N=I;return A.is(N)&&(V.is(N.annotationId)||j.is(N.annotationId))}h.is=d})(W=e.AnnotatedTextEdit||(e.AnnotatedTextEdit={}));var Y;(function(h){function D(b,d){return{textDocument:b,edits:d}}h.create=D;function _(b){var d=b;return k.defined(d)&&Ot.is(d.textDocument)&&Array.isArray(d.edits)}h.is=_})(Y=e.TextDocumentEdit||(e.TextDocumentEdit={}));var ee;(function(h){function D(b,d,I){var N={kind:"create",uri:b};return d!==void 0&&(d.overwrite!==void 0||d.ignoreIfExists!==void 0)&&(N.options=d),I!==void 0&&(N.annotationId=I),N}h.create=D;function _(b){var d=b;return d&&d.kind==="create"&&k.string(d.uri)&&(d.options===void 0||(d.options.overwrite===void 0||k.boolean(d.options.overwrite))&&(d.options.ignoreIfExists===void 0||k.boolean(d.options.ignoreIfExists)))&&(d.annotationId===void 0||j.is(d.annotationId))}h.is=_})(ee=e.CreateFile||(e.CreateFile={}));var de;(function(h){function D(b,d,I,N){var ae={kind:"rename",oldUri:b,newUri:d};return I!==void 0&&(I.overwrite!==void 0||I.ignoreIfExists!==void 0)&&(ae.options=I),N!==void 0&&(ae.annotationId=N),ae}h.create=D;function _(b){var d=b;return d&&d.kind==="rename"&&k.string(d.oldUri)&&k.string(d.newUri)&&(d.options===void 0||(d.options.overwrite===void 0||k.boolean(d.options.overwrite))&&(d.options.ignoreIfExists===void 0||k.boolean(d.options.ignoreIfExists)))&&(d.annotationId===void 0||j.is(d.annotationId))}h.is=_})(de=e.RenameFile||(e.RenameFile={}));var fe;(function(h){function D(b,d,I){var N={kind:"delete",uri:b};return d!==void 0&&(d.recursive!==void 0||d.ignoreIfNotExists!==void 0)&&(N.options=d),I!==void 0&&(N.annotationId=I),N}h.create=D;function _(b){var d=b;return d&&d.kind==="delete"&&k.string(d.uri)&&(d.options===void 0||(d.options.recursive===void 0||k.boolean(d.options.recursive))&&(d.options.ignoreIfNotExists===void 0||k.boolean(d.options.ignoreIfNotExists)))&&(d.annotationId===void 0||j.is(d.annotationId))}h.is=_})(fe=e.DeleteFile||(e.DeleteFile={}));var Ue;(function(h){function D(_){var b=_;return b&&(b.changes!==void 0||b.documentChanges!==void 0)&&(b.documentChanges===void 0||b.documentChanges.every(function(d){return k.string(d.kind)?ee.is(d)||de.is(d)||fe.is(d):Y.is(d)}))}h.is=D})(Ue=e.WorkspaceEdit||(e.WorkspaceEdit={}));var Ge=function(){function h(D,_){this.edits=D,this.changeAnnotations=_}return h.prototype.insert=function(D,_,b){var d,I;if(b===void 0?d=A.insert(D,_):j.is(b)?(I=b,d=W.insert(D,_,b)):(this.assertChangeAnnotations(this.changeAnnotations),I=this.changeAnnotations.manage(b),d=W.insert(D,_,I)),this.edits.push(d),I!==void 0)return I},h.prototype.replace=function(D,_,b){var d,I;if(b===void 0?d=A.replace(D,_):j.is(b)?(I=b,d=W.replace(D,_,b)):(this.assertChangeAnnotations(this.changeAnnotations),I=this.changeAnnotations.manage(b),d=W.replace(D,_,I)),this.edits.push(d),I!==void 0)return I},h.prototype.delete=function(D,_){var b,d;if(_===void 0?b=A.del(D):j.is(_)?(d=_,b=W.del(D,_)):(this.assertChangeAnnotations(this.changeAnnotations),d=this.changeAnnotations.manage(_),b=W.del(D,d)),this.edits.push(b),d!==void 0)return d},h.prototype.add=function(D){this.edits.push(D)},h.prototype.all=function(){return this.edits},h.prototype.clear=function(){this.edits.splice(0,this.edits.length)},h.prototype.assertChangeAnnotations=function(D){if(D===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},h}(),rt=function(){function h(D){this._annotations=D===void 0?Object.create(null):D,this._counter=0,this._size=0}return h.prototype.all=function(){return this._annotations},Object.defineProperty(h.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),h.prototype.manage=function(D,_){var b;if(j.is(D)?b=D:(b=this.nextId(),_=D),this._annotations[b]!==void 0)throw new Error("Id ".concat(b," is already in use."));if(_===void 0)throw new Error("No annotation provided for id ".concat(b));return this._annotations[b]=_,this._size++,b},h.prototype.nextId=function(){return this._counter++,this._counter.toString()},h}(),Je=function(){function h(D){var _=this;this._textEditChanges=Object.create(null),D!==void 0?(this._workspaceEdit=D,D.documentChanges?(this._changeAnnotations=new rt(D.changeAnnotations),D.changeAnnotations=this._changeAnnotations.all(),D.documentChanges.forEach(function(b){if(Y.is(b)){var d=new Ge(b.edits,_._changeAnnotations);_._textEditChanges[b.textDocument.uri]=d}})):D.changes&&Object.keys(D.changes).forEach(function(b){var d=new Ge(D.changes[b]);_._textEditChanges[b]=d})):this._workspaceEdit={}}return Object.defineProperty(h.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),h.prototype.getTextEditChange=function(D){if(Ot.is(D)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var _={uri:D.uri,version:D.version},b=this._textEditChanges[_.uri];if(!b){var d=[],I={textDocument:_,edits:d};this._workspaceEdit.documentChanges.push(I),b=new Ge(d,this._changeAnnotations),this._textEditChanges[_.uri]=b}return b}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var b=this._textEditChanges[D];if(!b){var d=[];this._workspaceEdit.changes[D]=d,b=new Ge(d),this._textEditChanges[D]=b}return b}},h.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new rt,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},h.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},h.prototype.createFile=function(D,_,b){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var d;V.is(_)||j.is(_)?d=_:b=_;var I,N;if(d===void 0?I=ee.create(D,b):(N=j.is(d)?d:this._changeAnnotations.manage(d),I=ee.create(D,b,N)),this._workspaceEdit.documentChanges.push(I),N!==void 0)return N},h.prototype.renameFile=function(D,_,b,d){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var I;V.is(b)||j.is(b)?I=b:d=b;var N,ae;if(I===void 0?N=de.create(D,_,d):(ae=j.is(I)?I:this._changeAnnotations.manage(I),N=de.create(D,_,d,ae)),this._workspaceEdit.documentChanges.push(N),ae!==void 0)return ae},h.prototype.deleteFile=function(D,_,b){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var d;V.is(_)||j.is(_)?d=_:b=_;var I,N;if(d===void 0?I=fe.create(D,b):(N=j.is(d)?d:this._changeAnnotations.manage(d),I=fe.create(D,b,N)),this._workspaceEdit.documentChanges.push(I),N!==void 0)return N},h}();e.WorkspaceChange=Je;var Ut;(function(h){function D(b){return{uri:b}}h.create=D;function _(b){var d=b;return k.defined(d)&&k.string(d.uri)}h.is=_})(Ut=e.TextDocumentIdentifier||(e.TextDocumentIdentifier={}));var Xe;(function(h){function D(b,d){return{uri:b,version:d}}h.create=D;function _(b){var d=b;return k.defined(d)&&k.string(d.uri)&&k.integer(d.version)}h.is=_})(Xe=e.VersionedTextDocumentIdentifier||(e.VersionedTextDocumentIdentifier={}));var Ot;(function(h){function D(b,d){return{uri:b,version:d}}h.create=D;function _(b){var d=b;return k.defined(d)&&k.string(d.uri)&&(d.version===null||k.integer(d.version))}h.is=_})(Ot=e.OptionalVersionedTextDocumentIdentifier||(e.OptionalVersionedTextDocumentIdentifier={}));var Kt;(function(h){function D(b,d,I,N){return{uri:b,languageId:d,version:I,text:N}}h.create=D;function _(b){var d=b;return k.defined(d)&&k.string(d.uri)&&k.string(d.languageId)&&k.integer(d.version)&&k.string(d.text)}h.is=_})(Kt=e.TextDocumentItem||(e.TextDocumentItem={}));var kn;(function(h){h.PlainText="plaintext",h.Markdown="markdown";function D(_){var b=_;return b===h.PlainText||b===h.Markdown}h.is=D})(kn=e.MarkupKind||(e.MarkupKind={}));var Pt;(function(h){function D(_){var b=_;return k.objectLiteral(_)&&kn.is(b.kind)&&k.string(b.value)}h.is=D})(Pt=e.MarkupContent||(e.MarkupContent={}));var Ri;(function(h){h.Text=1,h.Method=2,h.Function=3,h.Constructor=4,h.Field=5,h.Variable=6,h.Class=7,h.Interface=8,h.Module=9,h.Property=10,h.Unit=11,h.Value=12,h.Enum=13,h.Keyword=14,h.Snippet=15,h.Color=16,h.File=17,h.Reference=18,h.Folder=19,h.EnumMember=20,h.Constant=21,h.Struct=22,h.Event=23,h.Operator=24,h.TypeParameter=25})(Ri=e.CompletionItemKind||(e.CompletionItemKind={}));var ri;(function(h){h.PlainText=1,h.Snippet=2})(ri=e.InsertTextFormat||(e.InsertTextFormat={}));var An;(function(h){h.Deprecated=1})(An=e.CompletionItemTag||(e.CompletionItemTag={}));var $n;(function(h){function D(b,d,I){return{newText:b,insert:d,replace:I}}h.create=D;function _(b){var d=b;return d&&k.string(d.newText)&&a.is(d.insert)&&a.is(d.replace)}h.is=_})($n=e.InsertReplaceEdit||(e.InsertReplaceEdit={}));var jn;(function(h){h.asIs=1,h.adjustIndentation=2})(jn=e.InsertTextMode||(e.InsertTextMode={}));var Di;(function(h){function D(_){var b=_;return b&&(k.string(b.detail)||b.detail===void 0)&&(k.string(b.description)||b.description===void 0)}h.is=D})(Di=e.CompletionItemLabelDetails||(e.CompletionItemLabelDetails={}));var si;(function(h){function D(_){return{label:_}}h.create=D})(si=e.CompletionItem||(e.CompletionItem={}));var oi;(function(h){function D(_,b){return{items:_||[],isIncomplete:!!b}}h.create=D})(oi=e.CompletionList||(e.CompletionList={}));var Wn;(function(h){function D(b){return b.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}h.fromPlainText=D;function _(b){var d=b;return k.string(d)||k.objectLiteral(d)&&k.string(d.language)&&k.string(d.value)}h.is=_})(Wn=e.MarkedString||(e.MarkedString={}));var gt;(function(h){function D(_){var b=_;return!!b&&k.objectLiteral(b)&&(Pt.is(b.contents)||Wn.is(b.contents)||k.typedArray(b.contents,Wn.is))&&(_.range===void 0||a.is(_.range))}h.is=D})(gt=e.Hover||(e.Hover={}));var ai;(function(h){function D(_,b){return b?{label:_,documentation:b}:{label:_}}h.create=D})(ai=e.ParameterInformation||(e.ParameterInformation={}));var En;(function(h){function D(_,b){for(var d=[],I=2;I<arguments.length;I++)d[I-2]=arguments[I];var N={label:_};return k.defined(b)&&(N.documentation=b),k.defined(d)?N.parameters=d:N.parameters=[],N}h.create=D})(En=e.SignatureInformation||(e.SignatureInformation={}));var cn;(function(h){h.Text=1,h.Read=2,h.Write=3})(cn=e.DocumentHighlightKind||(e.DocumentHighlightKind={}));var ci;(function(h){function D(_,b){var d={range:_};return k.number(b)&&(d.kind=b),d}h.create=D})(ci=e.DocumentHighlight||(e.DocumentHighlight={}));var Ft;(function(h){h.File=1,h.Module=2,h.Namespace=3,h.Package=4,h.Class=5,h.Method=6,h.Property=7,h.Field=8,h.Constructor=9,h.Enum=10,h.Interface=11,h.Function=12,h.Variable=13,h.Constant=14,h.String=15,h.Number=16,h.Boolean=17,h.Array=18,h.Object=19,h.Key=20,h.Null=21,h.EnumMember=22,h.Struct=23,h.Event=24,h.Operator=25,h.TypeParameter=26})(Ft=e.SymbolKind||(e.SymbolKind={}));var Hn;(function(h){h.Deprecated=1})(Hn=e.SymbolTag||(e.SymbolTag={}));var ut;(function(h){function D(_,b,d,I,N){var ae={name:_,kind:b,location:{uri:I,range:d}};return N&&(ae.containerName=N),ae}h.create=D})(ut=e.SymbolInformation||(e.SymbolInformation={}));var pn;(function(h){function D(_,b,d,I){return I!==void 0?{name:_,kind:b,location:{uri:d,range:I}}:{name:_,kind:b,location:{uri:d}}}h.create=D})(pn=e.WorkspaceSymbol||(e.WorkspaceSymbol={}));var Lt;(function(h){function D(b,d,I,N,ae,Ke){var Le={name:b,detail:d,kind:I,range:N,selectionRange:ae};return Ke!==void 0&&(Le.children=Ke),Le}h.create=D;function _(b){var d=b;return d&&k.string(d.name)&&k.number(d.kind)&&a.is(d.range)&&a.is(d.selectionRange)&&(d.detail===void 0||k.string(d.detail))&&(d.deprecated===void 0||k.boolean(d.deprecated))&&(d.children===void 0||Array.isArray(d.children))&&(d.tags===void 0||Array.isArray(d.tags))}h.is=_})(Lt=e.DocumentSymbol||(e.DocumentSymbol={}));var Un;(function(h){h.Empty="",h.QuickFix="quickfix",h.Refactor="refactor",h.RefactorExtract="refactor.extract",h.RefactorInline="refactor.inline",h.RefactorRewrite="refactor.rewrite",h.Source="source",h.SourceOrganizeImports="source.organizeImports",h.SourceFixAll="source.fixAll"})(Un=e.CodeActionKind||(e.CodeActionKind={}));var Jt;(function(h){h.Invoked=1,h.Automatic=2})(Jt=e.CodeActionTriggerKind||(e.CodeActionTriggerKind={}));var Kn;(function(h){function D(b,d,I){var N={diagnostics:b};return d!=null&&(N.only=d),I!=null&&(N.triggerKind=I),N}h.create=D;function _(b){var d=b;return k.defined(d)&&k.typedArray(d.diagnostics,x.is)&&(d.only===void 0||k.typedArray(d.only,k.string))&&(d.triggerKind===void 0||d.triggerKind===Jt.Invoked||d.triggerKind===Jt.Automatic)}h.is=_})(Kn=e.CodeActionContext||(e.CodeActionContext={}));var ui;(function(h){function D(b,d,I){var N={title:b},ae=!0;return typeof d=="string"?(ae=!1,N.kind=d):q.is(d)?N.command=d:N.edit=d,ae&&I!==void 0&&(N.kind=I),N}h.create=D;function _(b){var d=b;return d&&k.string(d.title)&&(d.diagnostics===void 0||k.typedArray(d.diagnostics,x.is))&&(d.kind===void 0||k.string(d.kind))&&(d.edit!==void 0||d.command!==void 0)&&(d.command===void 0||q.is(d.command))&&(d.isPreferred===void 0||k.boolean(d.isPreferred))&&(d.edit===void 0||Ue.is(d.edit))}h.is=_})(ui=e.CodeAction||(e.CodeAction={}));var zt;(function(h){function D(b,d){var I={range:b};return k.defined(d)&&(I.data=d),I}h.create=D;function _(b){var d=b;return k.defined(d)&&a.is(d.range)&&(k.undefined(d.command)||q.is(d.command))}h.is=_})(zt=e.CodeLens||(e.CodeLens={}));var li;(function(h){function D(b,d){return{tabSize:b,insertSpaces:d}}h.create=D;function _(b){var d=b;return k.defined(d)&&k.uinteger(d.tabSize)&&k.boolean(d.insertSpaces)}h.is=_})(li=e.FormattingOptions||(e.FormattingOptions={}));var Zt;(function(h){function D(b,d,I){return{range:b,target:d,data:I}}h.create=D;function _(b){var d=b;return k.defined(d)&&a.is(d.range)&&(k.undefined(d.target)||k.string(d.target))}h.is=_})(Zt=e.DocumentLink||(e.DocumentLink={}));var R;(function(h){function D(b,d){return{range:b,parent:d}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&a.is(d.range)&&(d.parent===void 0||h.is(d.parent))}h.is=_})(R=e.SelectionRange||(e.SelectionRange={}));var M;(function(h){h.namespace="namespace",h.type="type",h.class="class",h.enum="enum",h.interface="interface",h.struct="struct",h.typeParameter="typeParameter",h.parameter="parameter",h.variable="variable",h.property="property",h.enumMember="enumMember",h.event="event",h.function="function",h.method="method",h.macro="macro",h.keyword="keyword",h.modifier="modifier",h.comment="comment",h.string="string",h.number="number",h.regexp="regexp",h.operator="operator",h.decorator="decorator"})(M=e.SemanticTokenTypes||(e.SemanticTokenTypes={}));var z;(function(h){h.declaration="declaration",h.definition="definition",h.readonly="readonly",h.static="static",h.deprecated="deprecated",h.abstract="abstract",h.async="async",h.modification="modification",h.documentation="documentation",h.defaultLibrary="defaultLibrary"})(z=e.SemanticTokenModifiers||(e.SemanticTokenModifiers={}));var J;(function(h){function D(_){var b=_;return k.objectLiteral(b)&&(b.resultId===void 0||typeof b.resultId=="string")&&Array.isArray(b.data)&&(b.data.length===0||typeof b.data[0]=="number")}h.is=D})(J=e.SemanticTokens||(e.SemanticTokens={}));var Te;(function(h){function D(b,d){return{range:b,text:d}}h.create=D;function _(b){var d=b;return d!=null&&a.is(d.range)&&k.string(d.text)}h.is=_})(Te=e.InlineValueText||(e.InlineValueText={}));var De;(function(h){function D(b,d,I){return{range:b,variableName:d,caseSensitiveLookup:I}}h.create=D;function _(b){var d=b;return d!=null&&a.is(d.range)&&k.boolean(d.caseSensitiveLookup)&&(k.string(d.variableName)||d.variableName===void 0)}h.is=_})(De=e.InlineValueVariableLookup||(e.InlineValueVariableLookup={}));var Ie;(function(h){function D(b,d){return{range:b,expression:d}}h.create=D;function _(b){var d=b;return d!=null&&a.is(d.range)&&(k.string(d.expression)||d.expression===void 0)}h.is=_})(Ie=e.InlineValueEvaluatableExpression||(e.InlineValueEvaluatableExpression={}));var Ne;(function(h){function D(b,d){return{frameId:b,stoppedLocation:d}}h.create=D;function _(b){var d=b;return k.defined(d)&&a.is(b.stoppedLocation)}h.is=_})(Ne=e.InlineValueContext||(e.InlineValueContext={}));var he;(function(h){h.Type=1,h.Parameter=2;function D(_){return _===1||_===2}h.is=D})(he=e.InlayHintKind||(e.InlayHintKind={}));var Pe;(function(h){function D(b){return{value:b}}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&(d.tooltip===void 0||k.string(d.tooltip)||Pt.is(d.tooltip))&&(d.location===void 0||c.is(d.location))&&(d.command===void 0||q.is(d.command))}h.is=_})(Pe=e.InlayHintLabelPart||(e.InlayHintLabelPart={}));var f;(function(h){function D(b,d,I){var N={position:b,label:d};return I!==void 0&&(N.kind=I),N}h.create=D;function _(b){var d=b;return k.objectLiteral(d)&&o.is(d.position)&&(k.string(d.label)||k.typedArray(d.label,Pe.is))&&(d.kind===void 0||he.is(d.kind))&&d.textEdits===void 0||k.typedArray(d.textEdits,A.is)&&(d.tooltip===void 0||k.string(d.tooltip)||Pt.is(d.tooltip))&&(d.paddingLeft===void 0||k.boolean(d.paddingLeft))&&(d.paddingRight===void 0||k.boolean(d.paddingRight))}h.is=_})(f=e.InlayHint||(e.InlayHint={}));var O;(function(h){function D(_){var b=_;return k.objectLiteral(b)&&n.is(b.uri)&&k.string(b.name)}h.is=D})(O=e.WorkspaceFolder||(e.WorkspaceFolder={})),e.EOL=[`
`,`\r
`,"\r"];var B;(function(h){function D(I,N,ae,Ke){return new pe(I,N,ae,Ke)}h.create=D;function _(I){var N=I;return!!(k.defined(N)&&k.string(N.uri)&&(k.undefined(N.languageId)||k.string(N.languageId))&&k.uinteger(N.lineCount)&&k.func(N.getText)&&k.func(N.positionAt)&&k.func(N.offsetAt))}h.is=_;function b(I,N){for(var ae=I.getText(),Ke=d(N,function(di,Ui){var wr=di.range.start.line-Ui.range.start.line;return wr===0?di.range.start.character-Ui.range.start.character:wr}),Le=ae.length,Yt=Ke.length-1;Yt>=0;Yt--){var Bt=Ke[Yt],gn=I.offsetAt(Bt.range.start),ye=I.offsetAt(Bt.range.end);if(ye<=Le)ae=ae.substring(0,gn)+Bt.newText+ae.substring(ye,ae.length);else throw new Error("Overlapping edit");Le=gn}return ae}h.applyEdits=b;function d(I,N){if(I.length<=1)return I;var ae=I.length/2|0,Ke=I.slice(0,ae),Le=I.slice(ae);d(Ke,N),d(Le,N);for(var Yt=0,Bt=0,gn=0;Yt<Ke.length&&Bt<Le.length;){var ye=N(Ke[Yt],Le[Bt]);ye<=0?I[gn++]=Ke[Yt++]:I[gn++]=Le[Bt++]}for(;Yt<Ke.length;)I[gn++]=Ke[Yt++];for(;Bt<Le.length;)I[gn++]=Le[Bt++];return I}})(B=e.TextDocument||(e.TextDocument={}));var pe=function(){function h(D,_,b,d){this._uri=D,this._languageId=_,this._version=b,this._content=d,this._lineOffsets=void 0}return Object.defineProperty(h.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),h.prototype.getText=function(D){if(D){var _=this.offsetAt(D.start),b=this.offsetAt(D.end);return this._content.substring(_,b)}return this._content},h.prototype.update=function(D,_){this._content=D.text,this._version=_,this._lineOffsets=void 0},h.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var D=[],_=this._content,b=!0,d=0;d<_.length;d++){b&&(D.push(d),b=!1);var I=_.charAt(d);b=I==="\r"||I===`
`,I==="\r"&&d+1<_.length&&_.charAt(d+1)===`
`&&d++}b&&_.length>0&&D.push(_.length),this._lineOffsets=D}return this._lineOffsets},h.prototype.positionAt=function(D){D=Math.max(Math.min(D,this._content.length),0);var _=this.getLineOffsets(),b=0,d=_.length;if(d===0)return o.create(0,D);for(;b<d;){var I=Math.floor((b+d)/2);_[I]>D?d=I:b=I+1}var N=b-1;return o.create(N,D-_[N])},h.prototype.offsetAt=function(D){var _=this.getLineOffsets();if(D.line>=_.length)return this._content.length;if(D.line<0)return 0;var b=_[D.line],d=D.line+1<_.length?_[D.line+1]:this._content.length;return Math.max(Math.min(b+D.character,d),b)},Object.defineProperty(h.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),h}(),k;(function(h){var D=Object.prototype.toString;function _(ye){return typeof ye<"u"}h.defined=_;function b(ye){return typeof ye>"u"}h.undefined=b;function d(ye){return ye===!0||ye===!1}h.boolean=d;function I(ye){return D.call(ye)==="[object String]"}h.string=I;function N(ye){return D.call(ye)==="[object Number]"}h.number=N;function ae(ye,di,Ui){return D.call(ye)==="[object Number]"&&di<=ye&&ye<=Ui}h.numberRange=ae;function Ke(ye){return D.call(ye)==="[object Number]"&&-2147483648<=ye&&ye<=2147483647}h.integer=Ke;function Le(ye){return D.call(ye)==="[object Number]"&&0<=ye&&ye<=2147483647}h.uinteger=Le;function Yt(ye){return D.call(ye)==="[object Function]"}h.func=Yt;function Bt(ye){return ye!==null&&typeof ye=="object"}h.objectLiteral=Bt;function gn(ye,di){return Array.isArray(ye)&&ye.every(di)}h.typedArray=gn})(k||(k={}))})});var Ye=F(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.ProtocolNotificationType=Nt.ProtocolNotificationType0=Nt.ProtocolRequestType=Nt.ProtocolRequestType0=Nt.RegistrationType=Nt.MessageDirection=void 0;var Qi=xi(),oy;(function(i){i.clientToServer="clientToServer",i.serverToClient="serverToClient",i.both="both"})(oy=Nt.MessageDirection||(Nt.MessageDirection={}));var Oc=class{constructor(e){this.method=e}};Nt.RegistrationType=Oc;var Fc=class extends Qi.RequestType0{constructor(e){super(e)}};Nt.ProtocolRequestType0=Fc;var Lc=class extends Qi.RequestType{constructor(e){super(e,Qi.ParameterStructures.byName)}};Nt.ProtocolRequestType=Lc;var Mc=class extends Qi.NotificationType0{constructor(e){super(e)}};Nt.ProtocolNotificationType0=Mc;var Nc=class extends Qi.NotificationType{constructor(e){super(e,Qi.ParameterStructures.byName)}};Nt.ProtocolNotificationType=Nc});var As=F(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.objectLiteral=dt.typedArray=dt.stringArray=dt.array=dt.func=dt.error=dt.number=dt.string=dt.boolean=void 0;function ay(i){return i===!0||i===!1}dt.boolean=ay;function oh(i){return typeof i=="string"||i instanceof String}dt.string=oh;function cy(i){return typeof i=="number"||i instanceof Number}dt.number=cy;function uy(i){return i instanceof Error}dt.error=uy;function ly(i){return typeof i=="function"}dt.func=ly;function ah(i){return Array.isArray(i)}dt.array=ah;function dy(i){return ah(i)&&i.every(e=>oh(e))}dt.stringArray=dy;function fy(i,e){return Array.isArray(i)&&i.every(e)}dt.typedArray=fy;function hy(i){return i!==null&&typeof i=="object"}dt.objectLiteral=hy});var uh=F(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.ImplementationRequest=void 0;var ch=Ye(),py;(function(i){i.method="textDocument/implementation",i.messageDirection=ch.MessageDirection.clientToServer,i.type=new ch.ProtocolRequestType(i.method)})(py=Pr.ImplementationRequest||(Pr.ImplementationRequest={}))});var dh=F(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.TypeDefinitionRequest=void 0;var lh=Ye(),gy;(function(i){i.method="textDocument/typeDefinition",i.messageDirection=lh.MessageDirection.clientToServer,i.type=new lh.ProtocolRequestType(i.method)})(gy=kr.TypeDefinitionRequest||(kr.TypeDefinitionRequest={}))});var fh=F(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.DidChangeWorkspaceFoldersNotification=hi.WorkspaceFoldersRequest=void 0;var $s=Ye(),my;(function(i){i.method="workspace/workspaceFolders",i.messageDirection=$s.MessageDirection.serverToClient,i.type=new $s.ProtocolRequestType0(i.method)})(my=hi.WorkspaceFoldersRequest||(hi.WorkspaceFoldersRequest={}));var vy;(function(i){i.method="workspace/didChangeWorkspaceFolders",i.messageDirection=$s.MessageDirection.clientToServer,i.type=new $s.ProtocolNotificationType(i.method)})(vy=hi.DidChangeWorkspaceFoldersNotification||(hi.DidChangeWorkspaceFoldersNotification={}))});var ph=F(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.ConfigurationRequest=void 0;var hh=Ye(),yy;(function(i){i.method="workspace/configuration",i.messageDirection=hh.MessageDirection.serverToClient,i.type=new hh.ProtocolRequestType(i.method)})(yy=Er.ConfigurationRequest||(Er.ConfigurationRequest={}))});var gh=F(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.ColorPresentationRequest=pi.DocumentColorRequest=void 0;var js=Ye(),by;(function(i){i.method="textDocument/documentColor",i.messageDirection=js.MessageDirection.clientToServer,i.type=new js.ProtocolRequestType(i.method)})(by=pi.DocumentColorRequest||(pi.DocumentColorRequest={}));var wy;(function(i){i.method="textDocument/colorPresentation",i.messageDirection=js.MessageDirection.clientToServer,i.type=new js.ProtocolRequestType(i.method)})(wy=pi.ColorPresentationRequest||(pi.ColorPresentationRequest={}))});var vh=F(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.FoldingRangeRequest=void 0;var mh=Ye(),Cy;(function(i){i.method="textDocument/foldingRange",i.messageDirection=mh.MessageDirection.clientToServer,i.type=new mh.ProtocolRequestType(i.method)})(Cy=xr.FoldingRangeRequest||(xr.FoldingRangeRequest={}))});var bh=F(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.DeclarationRequest=void 0;var yh=Ye(),Sy;(function(i){i.method="textDocument/declaration",i.messageDirection=yh.MessageDirection.clientToServer,i.type=new yh.ProtocolRequestType(i.method)})(Sy=qr.DeclarationRequest||(qr.DeclarationRequest={}))});var Ch=F(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.SelectionRangeRequest=void 0;var wh=Ye(),Ry;(function(i){i.method="textDocument/selectionRange",i.messageDirection=wh.MessageDirection.clientToServer,i.type=new wh.ProtocolRequestType(i.method)})(Ry=Ir.SelectionRangeRequest||(Ir.SelectionRangeRequest={}))});var Sh=F(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.WorkDoneProgressCancelNotification=yn.WorkDoneProgressCreateRequest=yn.WorkDoneProgress=void 0;var Dy=xi(),Ws=Ye(),_y;(function(i){i.type=new Dy.ProgressType;function e(t){return t===i.type}i.is=e})(_y=yn.WorkDoneProgress||(yn.WorkDoneProgress={}));var Ty;(function(i){i.method="window/workDoneProgress/create",i.messageDirection=Ws.MessageDirection.serverToClient,i.type=new Ws.ProtocolRequestType(i.method)})(Ty=yn.WorkDoneProgressCreateRequest||(yn.WorkDoneProgressCreateRequest={}));var Py;(function(i){i.method="window/workDoneProgress/cancel",i.messageDirection=Ws.MessageDirection.clientToServer,i.type=new Ws.ProtocolNotificationType(i.method)})(Py=yn.WorkDoneProgressCancelNotification||(yn.WorkDoneProgressCancelNotification={}))});var Rh=F(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.CallHierarchyOutgoingCallsRequest=bn.CallHierarchyIncomingCallsRequest=bn.CallHierarchyPrepareRequest=void 0;var Ji=Ye(),ky;(function(i){i.method="textDocument/prepareCallHierarchy",i.messageDirection=Ji.MessageDirection.clientToServer,i.type=new Ji.ProtocolRequestType(i.method)})(ky=bn.CallHierarchyPrepareRequest||(bn.CallHierarchyPrepareRequest={}));var Ey;(function(i){i.method="callHierarchy/incomingCalls",i.messageDirection=Ji.MessageDirection.clientToServer,i.type=new Ji.ProtocolRequestType(i.method)})(Ey=bn.CallHierarchyIncomingCallsRequest||(bn.CallHierarchyIncomingCallsRequest={}));var xy;(function(i){i.method="callHierarchy/outgoingCalls",i.messageDirection=Ji.MessageDirection.clientToServer,i.type=new Ji.ProtocolRequestType(i.method)})(xy=bn.CallHierarchyOutgoingCallsRequest||(bn.CallHierarchyOutgoingCallsRequest={}))});var Dh=F(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.SemanticTokensRefreshRequest=ft.SemanticTokensRangeRequest=ft.SemanticTokensDeltaRequest=ft.SemanticTokensRequest=ft.SemanticTokensRegistrationType=ft.TokenFormat=void 0;var Xn=Ye(),qy;(function(i){i.Relative="relative"})(qy=ft.TokenFormat||(ft.TokenFormat={}));var Hs;(function(i){i.method="textDocument/semanticTokens",i.type=new Xn.RegistrationType(i.method)})(Hs=ft.SemanticTokensRegistrationType||(ft.SemanticTokensRegistrationType={}));var Iy;(function(i){i.method="textDocument/semanticTokens/full",i.messageDirection=Xn.MessageDirection.clientToServer,i.type=new Xn.ProtocolRequestType(i.method),i.registrationMethod=Hs.method})(Iy=ft.SemanticTokensRequest||(ft.SemanticTokensRequest={}));var Oy;(function(i){i.method="textDocument/semanticTokens/full/delta",i.messageDirection=Xn.MessageDirection.clientToServer,i.type=new Xn.ProtocolRequestType(i.method),i.registrationMethod=Hs.method})(Oy=ft.SemanticTokensDeltaRequest||(ft.SemanticTokensDeltaRequest={}));var Fy;(function(i){i.method="textDocument/semanticTokens/range",i.messageDirection=Xn.MessageDirection.clientToServer,i.type=new Xn.ProtocolRequestType(i.method),i.registrationMethod=Hs.method})(Fy=ft.SemanticTokensRangeRequest||(ft.SemanticTokensRangeRequest={}));var Ly;(function(i){i.method="workspace/semanticTokens/refresh",i.messageDirection=Xn.MessageDirection.serverToClient,i.type=new Xn.ProtocolRequestType0(i.method)})(Ly=ft.SemanticTokensRefreshRequest||(ft.SemanticTokensRefreshRequest={}))});var Th=F(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.ShowDocumentRequest=void 0;var _h=Ye(),My;(function(i){i.method="window/showDocument",i.messageDirection=_h.MessageDirection.serverToClient,i.type=new _h.ProtocolRequestType(i.method)})(My=Or.ShowDocumentRequest||(Or.ShowDocumentRequest={}))});var kh=F(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.LinkedEditingRangeRequest=void 0;var Ph=Ye(),Ny;(function(i){i.method="textDocument/linkedEditingRange",i.messageDirection=Ph.MessageDirection.clientToServer,i.type=new Ph.ProtocolRequestType(i.method)})(Ny=Fr.LinkedEditingRangeRequest||(Fr.LinkedEditingRangeRequest={}))});var Eh=F(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.WillDeleteFilesRequest=et.DidDeleteFilesNotification=et.DidRenameFilesNotification=et.WillRenameFilesRequest=et.DidCreateFilesNotification=et.WillCreateFilesRequest=et.FileOperationPatternKind=void 0;var ln=Ye(),Ay;(function(i){i.file="file",i.folder="folder"})(Ay=et.FileOperationPatternKind||(et.FileOperationPatternKind={}));var $y;(function(i){i.method="workspace/willCreateFiles",i.messageDirection=ln.MessageDirection.clientToServer,i.type=new ln.ProtocolRequestType(i.method)})($y=et.WillCreateFilesRequest||(et.WillCreateFilesRequest={}));var jy;(function(i){i.method="workspace/didCreateFiles",i.messageDirection=ln.MessageDirection.clientToServer,i.type=new ln.ProtocolNotificationType(i.method)})(jy=et.DidCreateFilesNotification||(et.DidCreateFilesNotification={}));var Wy;(function(i){i.method="workspace/willRenameFiles",i.messageDirection=ln.MessageDirection.clientToServer,i.type=new ln.ProtocolRequestType(i.method)})(Wy=et.WillRenameFilesRequest||(et.WillRenameFilesRequest={}));var Hy;(function(i){i.method="workspace/didRenameFiles",i.messageDirection=ln.MessageDirection.clientToServer,i.type=new ln.ProtocolNotificationType(i.method)})(Hy=et.DidRenameFilesNotification||(et.DidRenameFilesNotification={}));var Uy;(function(i){i.method="workspace/didDeleteFiles",i.messageDirection=ln.MessageDirection.clientToServer,i.type=new ln.ProtocolNotificationType(i.method)})(Uy=et.DidDeleteFilesNotification||(et.DidDeleteFilesNotification={}));var Ky;(function(i){i.method="workspace/willDeleteFiles",i.messageDirection=ln.MessageDirection.clientToServer,i.type=new ln.ProtocolRequestType(i.method)})(Ky=et.WillDeleteFilesRequest||(et.WillDeleteFilesRequest={}))});var qh=F(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.MonikerRequest=wn.MonikerKind=wn.UniquenessLevel=void 0;var xh=Ye(),zy;(function(i){i.document="document",i.project="project",i.group="group",i.scheme="scheme",i.global="global"})(zy=wn.UniquenessLevel||(wn.UniquenessLevel={}));var By;(function(i){i.$import="import",i.$export="export",i.local="local"})(By=wn.MonikerKind||(wn.MonikerKind={}));var Vy;(function(i){i.method="textDocument/moniker",i.messageDirection=xh.MessageDirection.clientToServer,i.type=new xh.ProtocolRequestType(i.method)})(Vy=wn.MonikerRequest||(wn.MonikerRequest={}))});var Ih=F(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.TypeHierarchySubtypesRequest=Cn.TypeHierarchySupertypesRequest=Cn.TypeHierarchyPrepareRequest=void 0;var Zi=Ye(),Gy;(function(i){i.method="textDocument/prepareTypeHierarchy",i.messageDirection=Zi.MessageDirection.clientToServer,i.type=new Zi.ProtocolRequestType(i.method)})(Gy=Cn.TypeHierarchyPrepareRequest||(Cn.TypeHierarchyPrepareRequest={}));var Xy;(function(i){i.method="typeHierarchy/supertypes",i.messageDirection=Zi.MessageDirection.clientToServer,i.type=new Zi.ProtocolRequestType(i.method)})(Xy=Cn.TypeHierarchySupertypesRequest||(Cn.TypeHierarchySupertypesRequest={}));var Qy;(function(i){i.method="typeHierarchy/subtypes",i.messageDirection=Zi.MessageDirection.clientToServer,i.type=new Zi.ProtocolRequestType(i.method)})(Qy=Cn.TypeHierarchySubtypesRequest||(Cn.TypeHierarchySubtypesRequest={}))});var Oh=F(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.InlineValueRefreshRequest=gi.InlineValueRequest=void 0;var Us=Ye(),Jy;(function(i){i.method="textDocument/inlineValue",i.messageDirection=Us.MessageDirection.clientToServer,i.type=new Us.ProtocolRequestType(i.method)})(Jy=gi.InlineValueRequest||(gi.InlineValueRequest={}));var Zy;(function(i){i.method="workspace/inlineValue/refresh",i.messageDirection=Us.MessageDirection.serverToClient,i.type=new Us.ProtocolRequestType0(i.method)})(Zy=gi.InlineValueRefreshRequest||(gi.InlineValueRefreshRequest={}))});var Fh=F(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.InlayHintRefreshRequest=Sn.InlayHintResolveRequest=Sn.InlayHintRequest=void 0;var Yi=Ye(),Yy;(function(i){i.method="textDocument/inlayHint",i.messageDirection=Yi.MessageDirection.clientToServer,i.type=new Yi.ProtocolRequestType(i.method)})(Yy=Sn.InlayHintRequest||(Sn.InlayHintRequest={}));var eb;(function(i){i.method="inlayHint/resolve",i.messageDirection=Yi.MessageDirection.clientToServer,i.type=new Yi.ProtocolRequestType(i.method)})(eb=Sn.InlayHintResolveRequest||(Sn.InlayHintResolveRequest={}));var tb;(function(i){i.method="workspace/inlayHint/refresh",i.messageDirection=Yi.MessageDirection.serverToClient,i.type=new Yi.ProtocolRequestType0(i.method)})(tb=Sn.InlayHintRefreshRequest||(Sn.InlayHintRefreshRequest={}))});var Mh=F(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.DiagnosticRefreshRequest=Dt.WorkspaceDiagnosticRequest=Dt.DocumentDiagnosticRequest=Dt.DocumentDiagnosticReportKind=Dt.DiagnosticServerCancellationData=void 0;var Lh=xi(),nb=As(),er=Ye(),ib;(function(i){function e(t){let n=t;return n&&nb.boolean(n.retriggerRequest)}i.is=e})(ib=Dt.DiagnosticServerCancellationData||(Dt.DiagnosticServerCancellationData={}));var rb;(function(i){i.Full="full",i.Unchanged="unchanged"})(rb=Dt.DocumentDiagnosticReportKind||(Dt.DocumentDiagnosticReportKind={}));var sb;(function(i){i.method="textDocument/diagnostic",i.messageDirection=er.MessageDirection.clientToServer,i.type=new er.ProtocolRequestType(i.method),i.partialResult=new Lh.ProgressType})(sb=Dt.DocumentDiagnosticRequest||(Dt.DocumentDiagnosticRequest={}));var ob;(function(i){i.method="workspace/diagnostic",i.messageDirection=er.MessageDirection.clientToServer,i.type=new er.ProtocolRequestType(i.method),i.partialResult=new Lh.ProgressType})(ob=Dt.WorkspaceDiagnosticRequest||(Dt.WorkspaceDiagnosticRequest={}));var ab;(function(i){i.method="workspace/diagnostic/refresh",i.messageDirection=er.MessageDirection.serverToClient,i.type=new er.ProtocolRequestType0(i.method)})(ab=Dt.DiagnosticRefreshRequest||(Dt.DiagnosticRefreshRequest={}))});var $h=F(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.DidCloseNotebookDocumentNotification=ke.DidSaveNotebookDocumentNotification=ke.DidChangeNotebookDocumentNotification=ke.NotebookCellArrayChange=ke.DidOpenNotebookDocumentNotification=ke.NotebookDocumentSyncRegistrationType=ke.NotebookDocument=ke.NotebookCell=ke.ExecutionSummary=ke.NotebookCellKind=void 0;var Lr=Ns(),Rn=As(),qn=Ye(),Nh;(function(i){i.Markup=1,i.Code=2;function e(t){return t===1||t===2}i.is=e})(Nh=ke.NotebookCellKind||(ke.NotebookCellKind={}));var Ah;(function(i){function e(r,s){let o={executionOrder:r};return(s===!0||s===!1)&&(o.success=s),o}i.create=e;function t(r){let s=r;return Rn.objectLiteral(s)&&Lr.uinteger.is(s.executionOrder)&&(s.success===void 0||Rn.boolean(s.success))}i.is=t;function n(r,s){return r===s?!0:r==null||s===null||s===void 0?!1:r.executionOrder===s.executionOrder&&r.success===s.success}i.equals=n})(Ah=ke.ExecutionSummary||(ke.ExecutionSummary={}));var Ac;(function(i){function e(s,o){return{kind:s,document:o}}i.create=e;function t(s){let o=s;return Rn.objectLiteral(o)&&Nh.is(o.kind)&&Lr.DocumentUri.is(o.document)&&(o.metadata===void 0||Rn.objectLiteral(o.metadata))}i.is=t;function n(s,o){let a=new Set;return s.document!==o.document&&a.add("document"),s.kind!==o.kind&&a.add("kind"),s.executionSummary!==o.executionSummary&&a.add("executionSummary"),(s.metadata!==void 0||o.metadata!==void 0)&&!r(s.metadata,o.metadata)&&a.add("metadata"),(s.executionSummary!==void 0||o.executionSummary!==void 0)&&!Ah.equals(s.executionSummary,o.executionSummary)&&a.add("executionSummary"),a}i.diff=n;function r(s,o){if(s===o)return!0;if(s==null||o===null||o===void 0||typeof s!=typeof o||typeof s!="object")return!1;let a=Array.isArray(s),c=Array.isArray(o);if(a!==c)return!1;if(a&&c){if(s.length!==o.length)return!1;for(let u=0;u<s.length;u++)if(!r(s[u],o[u]))return!1}if(Rn.objectLiteral(s)&&Rn.objectLiteral(o)){let u=Object.keys(s),p=Object.keys(o);if(u.length!==p.length||(u.sort(),p.sort(),!r(u,p)))return!1;for(let m=0;m<u.length;m++){let g=u[m];if(!r(s[g],o[g]))return!1}}return!0}})(Ac=ke.NotebookCell||(ke.NotebookCell={}));var cb;(function(i){function e(n,r,s,o){return{uri:n,notebookType:r,version:s,cells:o}}i.create=e;function t(n){let r=n;return Rn.objectLiteral(r)&&Rn.string(r.uri)&&Lr.integer.is(r.version)&&Rn.typedArray(r.cells,Ac.is)}i.is=t})(cb=ke.NotebookDocument||(ke.NotebookDocument={}));var Mr;(function(i){i.method="notebookDocument/sync",i.messageDirection=qn.MessageDirection.clientToServer,i.type=new qn.RegistrationType(i.method)})(Mr=ke.NotebookDocumentSyncRegistrationType||(ke.NotebookDocumentSyncRegistrationType={}));var ub;(function(i){i.method="notebookDocument/didOpen",i.messageDirection=qn.MessageDirection.clientToServer,i.type=new qn.ProtocolNotificationType(i.method),i.registrationMethod=Mr.method})(ub=ke.DidOpenNotebookDocumentNotification||(ke.DidOpenNotebookDocumentNotification={}));var lb;(function(i){function e(n){let r=n;return Rn.objectLiteral(r)&&Lr.uinteger.is(r.start)&&Lr.uinteger.is(r.deleteCount)&&(r.cells===void 0||Rn.typedArray(r.cells,Ac.is))}i.is=e;function t(n,r,s){let o={start:n,deleteCount:r};return s!==void 0&&(o.cells=s),o}i.create=t})(lb=ke.NotebookCellArrayChange||(ke.NotebookCellArrayChange={}));var db;(function(i){i.method="notebookDocument/didChange",i.messageDirection=qn.MessageDirection.clientToServer,i.type=new qn.ProtocolNotificationType(i.method),i.registrationMethod=Mr.method})(db=ke.DidChangeNotebookDocumentNotification||(ke.DidChangeNotebookDocumentNotification={}));var fb;(function(i){i.method="notebookDocument/didSave",i.messageDirection=qn.MessageDirection.clientToServer,i.type=new qn.ProtocolNotificationType(i.method),i.registrationMethod=Mr.method})(fb=ke.DidSaveNotebookDocumentNotification||(ke.DidSaveNotebookDocumentNotification={}));var hb;(function(i){i.method="notebookDocument/didClose",i.messageDirection=qn.MessageDirection.clientToServer,i.type=new qn.ProtocolNotificationType(i.method),i.registrationMethod=Mr.method})(hb=ke.DidCloseNotebookDocumentNotification||(ke.DidCloseNotebookDocumentNotification={}))});var Gh=F(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.WorkspaceSymbolRequest=v.CodeActionResolveRequest=v.CodeActionRequest=v.DocumentSymbolRequest=v.DocumentHighlightRequest=v.ReferencesRequest=v.DefinitionRequest=v.SignatureHelpRequest=v.SignatureHelpTriggerKind=v.HoverRequest=v.CompletionResolveRequest=v.CompletionRequest=v.CompletionTriggerKind=v.PublishDiagnosticsNotification=v.WatchKind=v.RelativePattern=v.FileChangeType=v.DidChangeWatchedFilesNotification=v.WillSaveTextDocumentWaitUntilRequest=v.WillSaveTextDocumentNotification=v.TextDocumentSaveReason=v.DidSaveTextDocumentNotification=v.DidCloseTextDocumentNotification=v.DidChangeTextDocumentNotification=v.TextDocumentContentChangeEvent=v.DidOpenTextDocumentNotification=v.TextDocumentSyncKind=v.TelemetryEventNotification=v.LogMessageNotification=v.ShowMessageRequest=v.ShowMessageNotification=v.MessageType=v.DidChangeConfigurationNotification=v.ExitNotification=v.ShutdownRequest=v.InitializedNotification=v.InitializeErrorCodes=v.InitializeRequest=v.WorkDoneProgressOptions=v.TextDocumentRegistrationOptions=v.StaticRegistrationOptions=v.PositionEncodingKind=v.FailureHandlingKind=v.ResourceOperationKind=v.UnregistrationRequest=v.RegistrationRequest=v.DocumentSelector=v.NotebookCellTextDocumentFilter=v.NotebookDocumentFilter=v.TextDocumentFilter=void 0;v.TypeHierarchySubtypesRequest=v.TypeHierarchyPrepareRequest=v.MonikerRequest=v.MonikerKind=v.UniquenessLevel=v.WillDeleteFilesRequest=v.DidDeleteFilesNotification=v.WillRenameFilesRequest=v.DidRenameFilesNotification=v.WillCreateFilesRequest=v.DidCreateFilesNotification=v.FileOperationPatternKind=v.LinkedEditingRangeRequest=v.ShowDocumentRequest=v.SemanticTokensRegistrationType=v.SemanticTokensRefreshRequest=v.SemanticTokensRangeRequest=v.SemanticTokensDeltaRequest=v.SemanticTokensRequest=v.TokenFormat=v.CallHierarchyPrepareRequest=v.CallHierarchyOutgoingCallsRequest=v.CallHierarchyIncomingCallsRequest=v.WorkDoneProgressCancelNotification=v.WorkDoneProgressCreateRequest=v.WorkDoneProgress=v.SelectionRangeRequest=v.DeclarationRequest=v.FoldingRangeRequest=v.ColorPresentationRequest=v.DocumentColorRequest=v.ConfigurationRequest=v.DidChangeWorkspaceFoldersNotification=v.WorkspaceFoldersRequest=v.TypeDefinitionRequest=v.ImplementationRequest=v.ApplyWorkspaceEditRequest=v.ExecuteCommandRequest=v.PrepareRenameRequest=v.RenameRequest=v.PrepareSupportDefaultBehavior=v.DocumentOnTypeFormattingRequest=v.DocumentRangeFormattingRequest=v.DocumentFormattingRequest=v.DocumentLinkResolveRequest=v.DocumentLinkRequest=v.CodeLensRefreshRequest=v.CodeLensResolveRequest=v.CodeLensRequest=v.WorkspaceSymbolResolveRequest=void 0;v.DidCloseNotebookDocumentNotification=v.DidSaveNotebookDocumentNotification=v.DidChangeNotebookDocumentNotification=v.NotebookCellArrayChange=v.DidOpenNotebookDocumentNotification=v.NotebookDocumentSyncRegistrationType=v.NotebookDocument=v.NotebookCell=v.ExecutionSummary=v.NotebookCellKind=v.DiagnosticRefreshRequest=v.WorkspaceDiagnosticRequest=v.DocumentDiagnosticRequest=v.DocumentDiagnosticReportKind=v.DiagnosticServerCancellationData=v.InlayHintRefreshRequest=v.InlayHintResolveRequest=v.InlayHintRequest=v.InlineValueRefreshRequest=v.InlineValueRequest=v.TypeHierarchySupertypesRequest=void 0;var K=Ye(),jh=Ns(),_t=As(),pb=uh();Object.defineProperty(v,"ImplementationRequest",{enumerable:!0,get:function(){return pb.ImplementationRequest}});var gb=dh();Object.defineProperty(v,"TypeDefinitionRequest",{enumerable:!0,get:function(){return gb.TypeDefinitionRequest}});var Wh=fh();Object.defineProperty(v,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return Wh.WorkspaceFoldersRequest}});Object.defineProperty(v,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return Wh.DidChangeWorkspaceFoldersNotification}});var mb=ph();Object.defineProperty(v,"ConfigurationRequest",{enumerable:!0,get:function(){return mb.ConfigurationRequest}});var Hh=gh();Object.defineProperty(v,"DocumentColorRequest",{enumerable:!0,get:function(){return Hh.DocumentColorRequest}});Object.defineProperty(v,"ColorPresentationRequest",{enumerable:!0,get:function(){return Hh.ColorPresentationRequest}});var vb=vh();Object.defineProperty(v,"FoldingRangeRequest",{enumerable:!0,get:function(){return vb.FoldingRangeRequest}});var yb=bh();Object.defineProperty(v,"DeclarationRequest",{enumerable:!0,get:function(){return yb.DeclarationRequest}});var bb=Ch();Object.defineProperty(v,"SelectionRangeRequest",{enumerable:!0,get:function(){return bb.SelectionRangeRequest}});var $c=Sh();Object.defineProperty(v,"WorkDoneProgress",{enumerable:!0,get:function(){return $c.WorkDoneProgress}});Object.defineProperty(v,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return $c.WorkDoneProgressCreateRequest}});Object.defineProperty(v,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return $c.WorkDoneProgressCancelNotification}});var jc=Rh();Object.defineProperty(v,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return jc.CallHierarchyIncomingCallsRequest}});Object.defineProperty(v,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return jc.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(v,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return jc.CallHierarchyPrepareRequest}});var tr=Dh();Object.defineProperty(v,"TokenFormat",{enumerable:!0,get:function(){return tr.TokenFormat}});Object.defineProperty(v,"SemanticTokensRequest",{enumerable:!0,get:function(){return tr.SemanticTokensRequest}});Object.defineProperty(v,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return tr.SemanticTokensDeltaRequest}});Object.defineProperty(v,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return tr.SemanticTokensRangeRequest}});Object.defineProperty(v,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return tr.SemanticTokensRefreshRequest}});Object.defineProperty(v,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return tr.SemanticTokensRegistrationType}});var wb=Th();Object.defineProperty(v,"ShowDocumentRequest",{enumerable:!0,get:function(){return wb.ShowDocumentRequest}});var Cb=kh();Object.defineProperty(v,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return Cb.LinkedEditingRangeRequest}});var qi=Eh();Object.defineProperty(v,"FileOperationPatternKind",{enumerable:!0,get:function(){return qi.FileOperationPatternKind}});Object.defineProperty(v,"DidCreateFilesNotification",{enumerable:!0,get:function(){return qi.DidCreateFilesNotification}});Object.defineProperty(v,"WillCreateFilesRequest",{enumerable:!0,get:function(){return qi.WillCreateFilesRequest}});Object.defineProperty(v,"DidRenameFilesNotification",{enumerable:!0,get:function(){return qi.DidRenameFilesNotification}});Object.defineProperty(v,"WillRenameFilesRequest",{enumerable:!0,get:function(){return qi.WillRenameFilesRequest}});Object.defineProperty(v,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return qi.DidDeleteFilesNotification}});Object.defineProperty(v,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return qi.WillDeleteFilesRequest}});var Wc=qh();Object.defineProperty(v,"UniquenessLevel",{enumerable:!0,get:function(){return Wc.UniquenessLevel}});Object.defineProperty(v,"MonikerKind",{enumerable:!0,get:function(){return Wc.MonikerKind}});Object.defineProperty(v,"MonikerRequest",{enumerable:!0,get:function(){return Wc.MonikerRequest}});var Hc=Ih();Object.defineProperty(v,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return Hc.TypeHierarchyPrepareRequest}});Object.defineProperty(v,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return Hc.TypeHierarchySubtypesRequest}});Object.defineProperty(v,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return Hc.TypeHierarchySupertypesRequest}});var Uh=Oh();Object.defineProperty(v,"InlineValueRequest",{enumerable:!0,get:function(){return Uh.InlineValueRequest}});Object.defineProperty(v,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return Uh.InlineValueRefreshRequest}});var Uc=Fh();Object.defineProperty(v,"InlayHintRequest",{enumerable:!0,get:function(){return Uc.InlayHintRequest}});Object.defineProperty(v,"InlayHintResolveRequest",{enumerable:!0,get:function(){return Uc.InlayHintResolveRequest}});Object.defineProperty(v,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return Uc.InlayHintRefreshRequest}});var Nr=Mh();Object.defineProperty(v,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return Nr.DiagnosticServerCancellationData}});Object.defineProperty(v,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return Nr.DocumentDiagnosticReportKind}});Object.defineProperty(v,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return Nr.DocumentDiagnosticRequest}});Object.defineProperty(v,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return Nr.WorkspaceDiagnosticRequest}});Object.defineProperty(v,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return Nr.DiagnosticRefreshRequest}});var In=$h();Object.defineProperty(v,"NotebookCellKind",{enumerable:!0,get:function(){return In.NotebookCellKind}});Object.defineProperty(v,"ExecutionSummary",{enumerable:!0,get:function(){return In.ExecutionSummary}});Object.defineProperty(v,"NotebookCell",{enumerable:!0,get:function(){return In.NotebookCell}});Object.defineProperty(v,"NotebookDocument",{enumerable:!0,get:function(){return In.NotebookDocument}});Object.defineProperty(v,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return In.NotebookDocumentSyncRegistrationType}});Object.defineProperty(v,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return In.DidOpenNotebookDocumentNotification}});Object.defineProperty(v,"NotebookCellArrayChange",{enumerable:!0,get:function(){return In.NotebookCellArrayChange}});Object.defineProperty(v,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return In.DidChangeNotebookDocumentNotification}});Object.defineProperty(v,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return In.DidSaveNotebookDocumentNotification}});Object.defineProperty(v,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return In.DidCloseNotebookDocumentNotification}});var Kh;(function(i){function e(t){let n=t;return _t.string(n.language)||_t.string(n.scheme)||_t.string(n.pattern)}i.is=e})(Kh=v.TextDocumentFilter||(v.TextDocumentFilter={}));var zh;(function(i){function e(t){let n=t;return _t.objectLiteral(n)&&(_t.string(n.notebookType)||_t.string(n.scheme)||_t.string(n.pattern))}i.is=e})(zh=v.NotebookDocumentFilter||(v.NotebookDocumentFilter={}));var Bh;(function(i){function e(t){let n=t;return _t.objectLiteral(n)&&(_t.string(n.notebook)||zh.is(n.notebook))&&(n.language===void 0||_t.string(n.language))}i.is=e})(Bh=v.NotebookCellTextDocumentFilter||(v.NotebookCellTextDocumentFilter={}));var Vh;(function(i){function e(t){if(!Array.isArray(t))return!1;for(let n of t)if(!_t.string(n)&&!Kh.is(n)&&!Bh.is(n))return!1;return!0}i.is=e})(Vh=v.DocumentSelector||(v.DocumentSelector={}));var Sb;(function(i){i.method="client/registerCapability",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolRequestType(i.method)})(Sb=v.RegistrationRequest||(v.RegistrationRequest={}));var Rb;(function(i){i.method="client/unregisterCapability",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolRequestType(i.method)})(Rb=v.UnregistrationRequest||(v.UnregistrationRequest={}));var Db;(function(i){i.Create="create",i.Rename="rename",i.Delete="delete"})(Db=v.ResourceOperationKind||(v.ResourceOperationKind={}));var _b;(function(i){i.Abort="abort",i.Transactional="transactional",i.TextOnlyTransactional="textOnlyTransactional",i.Undo="undo"})(_b=v.FailureHandlingKind||(v.FailureHandlingKind={}));var Tb;(function(i){i.UTF8="utf-8",i.UTF16="utf-16",i.UTF32="utf-32"})(Tb=v.PositionEncodingKind||(v.PositionEncodingKind={}));var Pb;(function(i){function e(t){let n=t;return n&&_t.string(n.id)&&n.id.length>0}i.hasId=e})(Pb=v.StaticRegistrationOptions||(v.StaticRegistrationOptions={}));var kb;(function(i){function e(t){let n=t;return n&&(n.documentSelector===null||Vh.is(n.documentSelector))}i.is=e})(kb=v.TextDocumentRegistrationOptions||(v.TextDocumentRegistrationOptions={}));var Eb;(function(i){function e(n){let r=n;return _t.objectLiteral(r)&&(r.workDoneProgress===void 0||_t.boolean(r.workDoneProgress))}i.is=e;function t(n){let r=n;return r&&_t.boolean(r.workDoneProgress)}i.hasWorkDoneProgress=t})(Eb=v.WorkDoneProgressOptions||(v.WorkDoneProgressOptions={}));var xb;(function(i){i.method="initialize",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(xb=v.InitializeRequest||(v.InitializeRequest={}));var qb;(function(i){i.unknownProtocolVersion=1})(qb=v.InitializeErrorCodes||(v.InitializeErrorCodes={}));var Ib;(function(i){i.method="initialized",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(Ib=v.InitializedNotification||(v.InitializedNotification={}));var Ob;(function(i){i.method="shutdown",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType0(i.method)})(Ob=v.ShutdownRequest||(v.ShutdownRequest={}));var Fb;(function(i){i.method="exit",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType0(i.method)})(Fb=v.ExitNotification||(v.ExitNotification={}));var Lb;(function(i){i.method="workspace/didChangeConfiguration",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(Lb=v.DidChangeConfigurationNotification||(v.DidChangeConfigurationNotification={}));var Mb;(function(i){i.Error=1,i.Warning=2,i.Info=3,i.Log=4})(Mb=v.MessageType||(v.MessageType={}));var Nb;(function(i){i.method="window/showMessage",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolNotificationType(i.method)})(Nb=v.ShowMessageNotification||(v.ShowMessageNotification={}));var Ab;(function(i){i.method="window/showMessageRequest",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolRequestType(i.method)})(Ab=v.ShowMessageRequest||(v.ShowMessageRequest={}));var $b;(function(i){i.method="window/logMessage",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolNotificationType(i.method)})($b=v.LogMessageNotification||(v.LogMessageNotification={}));var jb;(function(i){i.method="telemetry/event",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolNotificationType(i.method)})(jb=v.TelemetryEventNotification||(v.TelemetryEventNotification={}));var Wb;(function(i){i.None=0,i.Full=1,i.Incremental=2})(Wb=v.TextDocumentSyncKind||(v.TextDocumentSyncKind={}));var Hb;(function(i){i.method="textDocument/didOpen",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(Hb=v.DidOpenTextDocumentNotification||(v.DidOpenTextDocumentNotification={}));var Ub;(function(i){function e(n){let r=n;return r!=null&&typeof r.text=="string"&&r.range!==void 0&&(r.rangeLength===void 0||typeof r.rangeLength=="number")}i.isIncremental=e;function t(n){let r=n;return r!=null&&typeof r.text=="string"&&r.range===void 0&&r.rangeLength===void 0}i.isFull=t})(Ub=v.TextDocumentContentChangeEvent||(v.TextDocumentContentChangeEvent={}));var Kb;(function(i){i.method="textDocument/didChange",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(Kb=v.DidChangeTextDocumentNotification||(v.DidChangeTextDocumentNotification={}));var zb;(function(i){i.method="textDocument/didClose",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(zb=v.DidCloseTextDocumentNotification||(v.DidCloseTextDocumentNotification={}));var Bb;(function(i){i.method="textDocument/didSave",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(Bb=v.DidSaveTextDocumentNotification||(v.DidSaveTextDocumentNotification={}));var Vb;(function(i){i.Manual=1,i.AfterDelay=2,i.FocusOut=3})(Vb=v.TextDocumentSaveReason||(v.TextDocumentSaveReason={}));var Gb;(function(i){i.method="textDocument/willSave",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(Gb=v.WillSaveTextDocumentNotification||(v.WillSaveTextDocumentNotification={}));var Xb;(function(i){i.method="textDocument/willSaveWaitUntil",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(Xb=v.WillSaveTextDocumentWaitUntilRequest||(v.WillSaveTextDocumentWaitUntilRequest={}));var Qb;(function(i){i.method="workspace/didChangeWatchedFiles",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolNotificationType(i.method)})(Qb=v.DidChangeWatchedFilesNotification||(v.DidChangeWatchedFilesNotification={}));var Jb;(function(i){i.Created=1,i.Changed=2,i.Deleted=3})(Jb=v.FileChangeType||(v.FileChangeType={}));var Zb;(function(i){function e(t){let n=t;return _t.objectLiteral(n)&&(jh.URI.is(n.baseUri)||jh.WorkspaceFolder.is(n.baseUri))&&_t.string(n.pattern)}i.is=e})(Zb=v.RelativePattern||(v.RelativePattern={}));var Yb;(function(i){i.Create=1,i.Change=2,i.Delete=4})(Yb=v.WatchKind||(v.WatchKind={}));var ew;(function(i){i.method="textDocument/publishDiagnostics",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolNotificationType(i.method)})(ew=v.PublishDiagnosticsNotification||(v.PublishDiagnosticsNotification={}));var tw;(function(i){i.Invoked=1,i.TriggerCharacter=2,i.TriggerForIncompleteCompletions=3})(tw=v.CompletionTriggerKind||(v.CompletionTriggerKind={}));var nw;(function(i){i.method="textDocument/completion",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(nw=v.CompletionRequest||(v.CompletionRequest={}));var iw;(function(i){i.method="completionItem/resolve",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(iw=v.CompletionResolveRequest||(v.CompletionResolveRequest={}));var rw;(function(i){i.method="textDocument/hover",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(rw=v.HoverRequest||(v.HoverRequest={}));var sw;(function(i){i.Invoked=1,i.TriggerCharacter=2,i.ContentChange=3})(sw=v.SignatureHelpTriggerKind||(v.SignatureHelpTriggerKind={}));var ow;(function(i){i.method="textDocument/signatureHelp",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(ow=v.SignatureHelpRequest||(v.SignatureHelpRequest={}));var aw;(function(i){i.method="textDocument/definition",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(aw=v.DefinitionRequest||(v.DefinitionRequest={}));var cw;(function(i){i.method="textDocument/references",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(cw=v.ReferencesRequest||(v.ReferencesRequest={}));var uw;(function(i){i.method="textDocument/documentHighlight",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(uw=v.DocumentHighlightRequest||(v.DocumentHighlightRequest={}));var lw;(function(i){i.method="textDocument/documentSymbol",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(lw=v.DocumentSymbolRequest||(v.DocumentSymbolRequest={}));var dw;(function(i){i.method="textDocument/codeAction",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(dw=v.CodeActionRequest||(v.CodeActionRequest={}));var fw;(function(i){i.method="codeAction/resolve",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(fw=v.CodeActionResolveRequest||(v.CodeActionResolveRequest={}));var hw;(function(i){i.method="workspace/symbol",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(hw=v.WorkspaceSymbolRequest||(v.WorkspaceSymbolRequest={}));var pw;(function(i){i.method="workspaceSymbol/resolve",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(pw=v.WorkspaceSymbolResolveRequest||(v.WorkspaceSymbolResolveRequest={}));var gw;(function(i){i.method="textDocument/codeLens",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(gw=v.CodeLensRequest||(v.CodeLensRequest={}));var mw;(function(i){i.method="codeLens/resolve",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(mw=v.CodeLensResolveRequest||(v.CodeLensResolveRequest={}));var vw;(function(i){i.method="workspace/codeLens/refresh",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolRequestType0(i.method)})(vw=v.CodeLensRefreshRequest||(v.CodeLensRefreshRequest={}));var yw;(function(i){i.method="textDocument/documentLink",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(yw=v.DocumentLinkRequest||(v.DocumentLinkRequest={}));var bw;(function(i){i.method="documentLink/resolve",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(bw=v.DocumentLinkResolveRequest||(v.DocumentLinkResolveRequest={}));var ww;(function(i){i.method="textDocument/formatting",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(ww=v.DocumentFormattingRequest||(v.DocumentFormattingRequest={}));var Cw;(function(i){i.method="textDocument/rangeFormatting",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(Cw=v.DocumentRangeFormattingRequest||(v.DocumentRangeFormattingRequest={}));var Sw;(function(i){i.method="textDocument/onTypeFormatting",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(Sw=v.DocumentOnTypeFormattingRequest||(v.DocumentOnTypeFormattingRequest={}));var Rw;(function(i){i.Identifier=1})(Rw=v.PrepareSupportDefaultBehavior||(v.PrepareSupportDefaultBehavior={}));var Dw;(function(i){i.method="textDocument/rename",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(Dw=v.RenameRequest||(v.RenameRequest={}));var _w;(function(i){i.method="textDocument/prepareRename",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(_w=v.PrepareRenameRequest||(v.PrepareRenameRequest={}));var Tw;(function(i){i.method="workspace/executeCommand",i.messageDirection=K.MessageDirection.clientToServer,i.type=new K.ProtocolRequestType(i.method)})(Tw=v.ExecuteCommandRequest||(v.ExecuteCommandRequest={}));var Pw;(function(i){i.method="workspace/applyEdit",i.messageDirection=K.MessageDirection.serverToClient,i.type=new K.ProtocolRequestType("workspace/applyEdit")})(Pw=v.ApplyWorkspaceEditRequest||(v.ApplyWorkspaceEditRequest={}))});var Qh=F(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});Ks.createProtocolConnection=void 0;var Xh=xi();function kw(i,e,t,n){return Xh.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,Xh.createMessageConnection)(i,e,t,n)}Ks.createProtocolConnection=kw});var Jh=F(At=>{"use strict";var Ew=At&&At.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),zs=At&&At.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Ew(e,i,t)};Object.defineProperty(At,"__esModule",{value:!0});At.LSPErrorCodes=At.createProtocolConnection=void 0;zs(xi(),At);zs(Ns(),At);zs(Ye(),At);zs(Gh(),At);var xw=Qh();Object.defineProperty(At,"createProtocolConnection",{enumerable:!0,get:function(){return xw.createProtocolConnection}});var qw;(function(i){i.lspReservedErrorRangeStart=-32899,i.RequestFailed=-32803,i.ServerCancelled=-32802,i.ContentModified=-32801,i.RequestCancelled=-32800,i.lspReservedErrorRangeEnd=-32800})(qw=At.LSPErrorCodes||(At.LSPErrorCodes={}))});var ce=F(On=>{"use strict";var Iw=On&&On.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Zh=On&&On.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Iw(e,i,t)};Object.defineProperty(On,"__esModule",{value:!0});On.createProtocolConnection=void 0;var Ow=Ic();Zh(Ic(),On);Zh(Jh(),On);function Fw(i,e,t,n){return(0,Ow.createMessageConnection)(i,e,t,n)}On.createProtocolConnection=Fw});var Bs=F(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.forEach=Et.mapAsync=Et.map=Et.clearTestMode=Et.setTestMode=Et.Semaphore=Et.Delayer=void 0;var $r=ce(),Kc=class{constructor(e){this.defaultDelay=e,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(e,t=this.defaultDelay){return this.task=e,t>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(n=>{this.onSuccess=n}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var n=this.task();return this.task=void 0,n})),(t>=0||this.timeout===void 0)&&(this.timeout=(0,$r.RAL)().timer.setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},t>=0?t:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let e=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,e}isTriggered(){return this.timeout!==void 0}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){this.timeout!==void 0&&(this.timeout.dispose(),this.timeout=void 0)}};Et.Delayer=Kc;var zc=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,$r.RAL)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Et.Semaphore=zc;var Bc=!1;function Lw(){Bc=!0}Et.setTestMode=Lw;function Mw(){Bc=!1}Et.clearTestMode=Mw;var Yh=15,Ar=class{constructor(e=Yh){this.yieldAfter=Bc===!0?Math.max(e,2):Math.max(e,Yh),this.startTime=Date.now(),this.counter=0,this.total=0,this.counterInterval=1}start(){this.counter=0,this.total=0,this.counterInterval=1,this.startTime=Date.now()}shouldYield(){if(++this.counter>=this.counterInterval){let e=Date.now()-this.startTime,t=Math.max(0,this.yieldAfter-e);if(this.total+=this.counter,this.counter=0,e>=this.yieldAfter||t<=1)return this.counterInterval=1,this.total=0,!0;switch(e){case 0:case 1:this.counterInterval=this.total*2;break}}return!1}};async function Nw(i,e,t,n){if(i.length===0)return[];let r=new Array(i.length),s=new Ar(n?.yieldAfter);function o(c){s.start();for(let u=c;u<i.length;u++)if(r[u]=e(i[u]),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),u+1;return-1}let a=o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,$r.RAL)().timer.setImmediate(()=>{c(o(a))})});return r}Et.map=Nw;async function Aw(i,e,t,n){if(i.length===0)return[];let r=new Array(i.length),s=new Ar(n?.yieldAfter);async function o(c){s.start();for(let u=c;u<i.length;u++)if(r[u]=await e(i[u],t),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),u+1;return-1}let a=await o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,$r.RAL)().timer.setImmediate(()=>{c(o(a))})});return r}Et.mapAsync=Aw;async function $w(i,e,t,n){if(i.length===0)return;let r=new Ar(n?.yieldAfter);function s(a){r.start();for(let c=a;c<i.length;c++)if(e(i[c]),r.shouldYield())return n?.yieldCallback&&n.yieldCallback(),c+1;return-1}let o=s(0);for(;o!==-1&&!(t!==void 0&&t.isCancellationRequested);)o=await new Promise(a=>{(0,$r.RAL)().timer.setImmediate(()=>{a(s(o))})})}Et.forEach=$w});var Xc=F(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});var jw=require("vscode"),Vc=class extends jw.CompletionItem{constructor(e){super(e)}};Gc.default=Vc});var Zc=F(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});var Ww=require("vscode"),Qc=class extends Ww.CodeLens{constructor(e){super(e)}};Jc.default=Qc});var tu=F(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});var Hw=require("vscode"),Yc=class extends Hw.DocumentLink{constructor(e,t){super(e,t)}};eu.default=Yc});var ru=F(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});var Uw=require("vscode"),nu=class extends Uw.CodeAction{constructor(e,t){super(e),this.data=t}};iu.default=nu});var au=F(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.ProtocolDiagnostic=Ii.DiagnosticCode=void 0;var Kw=require("vscode"),su=un(),zw;(function(i){function e(t){let n=t;return n!=null&&(su.number(n.value)||su.string(n.value))&&su.string(n.target)}i.is=e})(zw=Ii.DiagnosticCode||(Ii.DiagnosticCode={}));var ou=class extends Kw.Diagnostic{constructor(e,t,n,r){super(e,t,n),this.data=r,this.hasDiagnosticCode=!1}};Ii.ProtocolDiagnostic=ou});var lu=F(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});var Bw=require("vscode"),cu=class extends Bw.CallHierarchyItem{constructor(e,t,n,r,s,o,a){super(e,t,n,r,s,o),a!==void 0&&(this.data=a)}};uu.default=cu});var hu=F(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});var Vw=require("vscode"),du=class extends Vw.TypeHierarchyItem{constructor(e,t,n,r,s,o,a){super(e,t,n,r,s,o),a!==void 0&&(this.data=a)}};fu.default=du});var mu=F(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});var Vs=require("vscode"),pu=class extends Vs.SymbolInformation{constructor(e,t,n,r,s){let o=!(r instanceof Vs.Uri);super(e,t,n,o?r:new Vs.Location(r,new Vs.Range(0,0,0,0))),this.hasRange=o,s!==void 0&&(this.data=s)}};gu.default=pu});var bu=F(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});var Gw=require("vscode"),vu=class extends Gw.InlayHint{constructor(e,t,n){super(e,t,n)}};yu.default=vu});var np=F(Gs=>{"use strict";Object.defineProperty(Gs,"__esModule",{value:!0});Gs.createConverter=void 0;var ht=require("vscode"),ge=ce(),nr=un(),ep=Bs(),Xw=Xc(),Qw=Zc(),Jw=tu(),Zw=ru(),tp=au(),Yw=lu(),eC=hu(),tC=mu(),nC=bu(),wu;(function(i){function e(t){let n=t;return n&&!!n.inserting&&!!n.replacing}i.is=e})(wu||(wu={}));function iC(i){let t=i||(f=>f.toString());function n(f){return t(f)}function r(f){return{uri:t(f.uri)}}function s(f){return{uri:t(f.uri),languageId:f.languageId,version:f.version,text:f.getText()}}function o(f){return{uri:t(f.uri),version:f.version}}function a(f){return{textDocument:s(f)}}function c(f){let O=f;return!!O.document&&!!O.contentChanges}function u(f){let O=f;return!!O.uri&&!!O.version}function p(f,O,B){if(u(f))return{textDocument:{uri:t(f.uri),version:f.version},contentChanges:[{text:f.getText()}]};if(c(f)){let pe=O,k=B;return{textDocument:{uri:t(pe),version:k},contentChanges:f.contentChanges.map(D=>{let _=D.range;return{range:{start:{line:_.start.line,character:_.start.character},end:{line:_.end.line,character:_.end.character}},rangeLength:D.rangeLength,text:D.text}})}}else throw Error("Unsupported text document change parameter")}function m(f){return{textDocument:r(f)}}function g(f,O=!1){let B={textDocument:r(f)};return O&&(B.text=f.getText()),B}function w(f){switch(f){case ht.TextDocumentSaveReason.Manual:return ge.TextDocumentSaveReason.Manual;case ht.TextDocumentSaveReason.AfterDelay:return ge.TextDocumentSaveReason.AfterDelay;case ht.TextDocumentSaveReason.FocusOut:return ge.TextDocumentSaveReason.FocusOut}return ge.TextDocumentSaveReason.Manual}function y(f){return{textDocument:r(f.document),reason:w(f.reason)}}function T(f){return{files:f.files.map(O=>({uri:t(O)}))}}function C(f){return{files:f.files.map(O=>({oldUri:t(O.oldUri),newUri:t(O.newUri)}))}}function S(f){return{files:f.files.map(O=>({uri:t(O)}))}}function P(f){return{files:f.files.map(O=>({uri:t(O)}))}}function x(f){return{files:f.files.map(O=>({oldUri:t(O.oldUri),newUri:t(O.newUri)}))}}function q(f){return{files:f.files.map(O=>({uri:t(O)}))}}function A(f,O){return{textDocument:r(f),position:rt(O)}}function V(f){switch(f){case ht.CompletionTriggerKind.TriggerCharacter:return ge.CompletionTriggerKind.TriggerCharacter;case ht.CompletionTriggerKind.TriggerForIncompleteCompletions:return ge.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return ge.CompletionTriggerKind.Invoked}}function j(f,O,B){return{textDocument:r(f),position:rt(O),context:{triggerKind:V(B.triggerKind),triggerCharacter:B.triggerCharacter}}}function W(f){switch(f){case ht.SignatureHelpTriggerKind.Invoke:return ge.SignatureHelpTriggerKind.Invoked;case ht.SignatureHelpTriggerKind.TriggerCharacter:return ge.SignatureHelpTriggerKind.TriggerCharacter;case ht.SignatureHelpTriggerKind.ContentChange:return ge.SignatureHelpTriggerKind.ContentChange}}function Y(f){return{label:f.label}}function ee(f){return f.map(Y)}function de(f){return{label:f.label,parameters:ee(f.parameters)}}function fe(f){return f.map(de)}function Ue(f){return f===void 0?f:{signatures:fe(f.signatures),activeSignature:f.activeSignature,activeParameter:f.activeParameter}}function Ge(f,O,B){return{textDocument:r(f),position:rt(O),context:{isRetrigger:B.isRetrigger,triggerCharacter:B.triggerCharacter,triggerKind:W(B.triggerKind),activeSignatureHelp:Ue(B.activeSignatureHelp)}}}function rt(f){return{line:f.line,character:f.character}}function Je(f){return f==null?f:{line:f.line>ge.uinteger.MAX_VALUE?ge.uinteger.MAX_VALUE:f.line,character:f.character>ge.uinteger.MAX_VALUE?ge.uinteger.MAX_VALUE:f.character}}function Ut(f,O){return ep.map(f,Je,O)}function Xe(f){return f==null?f:{start:Je(f.start),end:Je(f.end)}}function Ot(f){return f==null?f:ge.Location.create(n(f.uri),Xe(f.range))}function Kt(f){switch(f){case ht.DiagnosticSeverity.Error:return ge.DiagnosticSeverity.Error;case ht.DiagnosticSeverity.Warning:return ge.DiagnosticSeverity.Warning;case ht.DiagnosticSeverity.Information:return ge.DiagnosticSeverity.Information;case ht.DiagnosticSeverity.Hint:return ge.DiagnosticSeverity.Hint}}function kn(f){if(!f)return;let O=[];for(let B of f){let pe=Pt(B);pe!==void 0&&O.push(pe)}return O.length>0?O:void 0}function Pt(f){switch(f){case ht.DiagnosticTag.Unnecessary:return ge.DiagnosticTag.Unnecessary;case ht.DiagnosticTag.Deprecated:return ge.DiagnosticTag.Deprecated;default:return}}function Ri(f){return{message:f.message,location:Ot(f.location)}}function ri(f){return f.map(Ri)}function An(f){if(f!=null)return nr.number(f)||nr.string(f)?f:{value:f.value,target:n(f.target)}}function $n(f){let O=ge.Diagnostic.create(Xe(f.range),f.message),B=f instanceof tp.ProtocolDiagnostic?f:void 0;B!==void 0&&B.data!==void 0&&(O.data=B.data);let pe=An(f.code);return tp.DiagnosticCode.is(pe)?B!==void 0&&B.hasDiagnosticCode?O.code=pe:(O.code=pe.value,O.codeDescription={href:pe.target}):O.code=pe,nr.number(f.severity)&&(O.severity=Kt(f.severity)),Array.isArray(f.tags)&&(O.tags=kn(f.tags)),f.relatedInformation&&(O.relatedInformation=ri(f.relatedInformation)),f.source&&(O.source=f.source),O}function jn(f,O){return f==null?f:ep.map(f,$n,O)}function Di(f,O){switch(f){case"$string":return O;case ge.MarkupKind.PlainText:return{kind:f,value:O};case ge.MarkupKind.Markdown:return{kind:f,value:O.value};default:return`Unsupported Markup content received. Kind is: ${f}`}}function si(f){switch(f){case ht.CompletionItemTag.Deprecated:return ge.CompletionItemTag.Deprecated}}function oi(f){if(f===void 0)return f;let O=[];for(let B of f){let pe=si(B);pe!==void 0&&O.push(pe)}return O}function Wn(f,O){return O!==void 0?O:f+1}function gt(f,O=!1){let B,pe;nr.string(f.label)?B=f.label:(B=f.label.label,O&&(f.label.detail!==void 0||f.label.description!==void 0)&&(pe={detail:f.label.detail,description:f.label.description}));let k={label:B};pe!==void 0&&(k.labelDetails=pe);let h=f instanceof Xw.default?f:void 0;f.detail&&(k.detail=f.detail),f.documentation&&(!h||h.documentationFormat==="$string"?k.documentation=f.documentation:k.documentation=Di(h.documentationFormat,f.documentation)),f.filterText&&(k.filterText=f.filterText),ai(k,f),nr.number(f.kind)&&(k.kind=Wn(f.kind,h&&h.originalItemKind)),f.sortText&&(k.sortText=f.sortText),f.additionalTextEdits&&(k.additionalTextEdits=ci(f.additionalTextEdits)),f.commitCharacters&&(k.commitCharacters=f.commitCharacters.slice()),f.command&&(k.command=zt(f.command)),(f.preselect===!0||f.preselect===!1)&&(k.preselect=f.preselect);let D=oi(f.tags);if(h){if(h.data!==void 0&&(k.data=h.data),h.deprecated===!0||h.deprecated===!1){if(h.deprecated===!0&&D!==void 0&&D.length>0){let _=D.indexOf(ht.CompletionItemTag.Deprecated);_!==-1&&D.splice(_,1)}k.deprecated=h.deprecated}h.insertTextMode!==void 0&&(k.insertTextMode=h.insertTextMode)}return D!==void 0&&D.length>0&&(k.tags=D),k.insertTextMode===void 0&&f.keepWhitespace===!0&&(k.insertTextMode=ge.InsertTextMode.adjustIndentation),k}function ai(f,O){let B=ge.InsertTextFormat.PlainText,pe,k;O.textEdit?(pe=O.textEdit.newText,k=O.textEdit.range):O.insertText instanceof ht.SnippetString?(B=ge.InsertTextFormat.Snippet,pe=O.insertText.value):pe=O.insertText,O.range&&(k=O.range),f.insertTextFormat=B,O.fromEdit&&pe!==void 0&&k!==void 0?f.textEdit=En(pe,k):f.insertText=pe}function En(f,O){return wu.is(O)?ge.InsertReplaceEdit.create(f,Xe(O.inserting),Xe(O.replacing)):{newText:f,range:Xe(O)}}function cn(f){return{range:Xe(f.range),newText:f.newText}}function ci(f){return f==null?f:f.map(cn)}function Ft(f){return f<=ht.SymbolKind.TypeParameter?f+1:ge.SymbolKind.Property}function Hn(f){return f}function ut(f){return f.map(Hn)}function pn(f,O,B){return{textDocument:r(f),position:rt(O),context:{includeDeclaration:B.includeDeclaration}}}async function Lt(f,O){let B=ge.CodeAction.create(f.title);if(f instanceof Zw.default&&f.data!==void 0&&(B.data=f.data),f.kind!==void 0&&(B.kind=Kn(f.kind)),f.diagnostics!==void 0&&(B.diagnostics=await jn(f.diagnostics,O)),f.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return f.command!==void 0&&(B.command=zt(f.command)),f.isPreferred!==void 0&&(B.isPreferred=f.isPreferred),f.disabled!==void 0&&(B.disabled={reason:f.disabled.reason}),B}async function Un(f,O){if(f==null)return f;let B;return f.only&&nr.string(f.only.value)&&(B=[f.only.value]),ge.CodeActionContext.create(await jn(f.diagnostics,O),B,Jt(f.triggerKind))}function Jt(f){switch(f){case ht.CodeActionTriggerKind.Invoke:return ge.CodeActionTriggerKind.Invoked;case ht.CodeActionTriggerKind.Automatic:return ge.CodeActionTriggerKind.Automatic;default:return}}function Kn(f){if(f!=null)return f.value}function ui(f){return f==null?f:ge.InlineValueContext.create(f.frameId,Xe(f.stoppedLocation))}function zt(f){let O=ge.Command.create(f.title,f.command);return f.arguments&&(O.arguments=f.arguments),O}function li(f){let O=ge.CodeLens.create(Xe(f.range));return f.command&&(O.command=zt(f.command)),f instanceof Qw.default&&f.data&&(O.data=f.data),O}function Zt(f,O){let B={tabSize:f.tabSize,insertSpaces:f.insertSpaces};return O.trimTrailingWhitespace&&(B.trimTrailingWhitespace=!0),O.trimFinalNewlines&&(B.trimFinalNewlines=!0),O.insertFinalNewline&&(B.insertFinalNewline=!0),B}function R(f){return{textDocument:r(f)}}function M(f){return{textDocument:r(f)}}function z(f){let O=ge.DocumentLink.create(Xe(f.range));f.target&&(O.target=n(f.target)),f.tooltip!==void 0&&(O.tooltip=f.tooltip);let B=f instanceof Jw.default?f:void 0;return B&&B.data&&(O.data=B.data),O}function J(f){return{textDocument:r(f)}}function Te(f){let O={name:f.name,kind:Ft(f.kind),uri:n(f.uri),range:Xe(f.range),selectionRange:Xe(f.selectionRange)};return f.detail!==void 0&&f.detail.length>0&&(O.detail=f.detail),f.tags!==void 0&&(O.tags=ut(f.tags)),f instanceof Yw.default&&f.data!==void 0&&(O.data=f.data),O}function De(f){let O={name:f.name,kind:Ft(f.kind),uri:n(f.uri),range:Xe(f.range),selectionRange:Xe(f.selectionRange)};return f.detail!==void 0&&f.detail.length>0&&(O.detail=f.detail),f.tags!==void 0&&(O.tags=ut(f.tags)),f instanceof eC.default&&f.data!==void 0&&(O.data=f.data),O}function Ie(f){let O=f instanceof tC.default?{name:f.name,kind:Ft(f.kind),location:f.hasRange?Ot(f.location):{uri:t(f.location.uri)},data:f.data}:{name:f.name,kind:Ft(f.kind),location:Ot(f.location)};return f.tags!==void 0&&(O.tags=ut(f.tags)),f.containerName!==""&&(O.containerName=f.containerName),O}function Ne(f){let O=typeof f.label=="string"?f.label:f.label.map(he),B=ge.InlayHint.create(Je(f.position),O);return f.kind!==void 0&&(B.kind=f.kind),f.textEdits!==void 0&&(B.textEdits=ci(f.textEdits)),f.tooltip!==void 0&&(B.tooltip=Pe(f.tooltip)),f.paddingLeft!==void 0&&(B.paddingLeft=f.paddingLeft),f.paddingRight!==void 0&&(B.paddingRight=f.paddingRight),f instanceof nC.default&&f.data!==void 0&&(B.data=f.data),B}function he(f){let O=ge.InlayHintLabelPart.create(f.value);return f.location!==void 0&&(O.location=Ot(f.location)),f.command!==void 0&&(O.command=zt(f.command)),f.tooltip!==void 0&&(O.tooltip=Pe(f.tooltip)),O}function Pe(f){return typeof f=="string"?f:{kind:ge.MarkupKind.Markdown,value:f.value}}return{asUri:n,asTextDocumentIdentifier:r,asTextDocumentItem:s,asVersionedTextDocumentIdentifier:o,asOpenTextDocumentParams:a,asChangeTextDocumentParams:p,asCloseTextDocumentParams:m,asSaveTextDocumentParams:g,asWillSaveTextDocumentParams:y,asDidCreateFilesParams:T,asDidRenameFilesParams:C,asDidDeleteFilesParams:S,asWillCreateFilesParams:P,asWillRenameFilesParams:x,asWillDeleteFilesParams:q,asTextDocumentPositionParams:A,asCompletionParams:j,asSignatureHelpParams:Ge,asWorkerPosition:rt,asRange:Xe,asPosition:Je,asPositions:Ut,asLocation:Ot,asDiagnosticSeverity:Kt,asDiagnosticTag:Pt,asDiagnostic:$n,asDiagnostics:jn,asCompletionItem:gt,asTextEdit:cn,asSymbolKind:Ft,asSymbolTag:Hn,asSymbolTags:ut,asReferenceParams:pn,asCodeAction:Lt,asCodeActionContext:Un,asInlineValueContext:ui,asCommand:zt,asCodeLens:li,asFormattingOptions:Zt,asDocumentSymbolParams:R,asCodeLensParams:M,asDocumentLink:z,asDocumentLinkParams:J,asCallHierarchyItem:Te,asTypeHierarchyItem:De,asInlayHint:Ne,asWorkspaceSymbol:Ie}}Gs.createConverter=iC});var sp=F(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.createConverter=void 0;var G=require("vscode"),oe=ce(),dn=un(),Ee=Bs(),rC=Xc(),sC=Zc(),oC=tu(),aC=ru(),ip=au(),cC=lu(),uC=hu(),lC=mu(),dC=bu(),rp=ce(),Xs;(function(i){function e(t){let n=t;return n&&dn.string(n.language)&&dn.string(n.value)}i.is=e})(Xs||(Xs={}));function fC(i,e,t){let r=i||(l=>G.Uri.parse(l));function s(l){return r(l)}function o(l){let E=[];for(let $ of l)if(typeof $=="string")E.push($);else if(rp.NotebookCellTextDocumentFilter.is($))if(typeof $.notebook=="string")E.push({notebookType:$.notebook,language:$.language});else{let ie=$.notebook.notebookType??"*";E.push({notebookType:ie,scheme:$.notebook.scheme,pattern:$.notebook.pattern,language:$.language})}else rp.TextDocumentFilter.is($)&&E.push({language:$.language,scheme:$.scheme,pattern:$.pattern});return E}async function a(l,E){return Ee.map(l,u,E)}function c(l){let E=new Array(l.length);for(let $=0;$<l.length;$++)E[$]=u(l[$]);return E}function u(l){let E=new ip.ProtocolDiagnostic(y(l.range),l.message,C(l.severity),l.data);if(l.code!==void 0){if(typeof l.code=="string"||typeof l.code=="number")oe.CodeDescription.is(l.codeDescription)?E.code={value:l.code,target:s(l.codeDescription.href)}:E.code=l.code;else if(ip.DiagnosticCode.is(l.code)){E.hasDiagnosticCode=!0;let $=l.code;E.code={value:$.value,target:s($.target)}}}return l.source&&(E.source=l.source),l.relatedInformation&&(E.relatedInformation=p(l.relatedInformation)),Array.isArray(l.tags)&&(E.tags=m(l.tags)),E}function p(l){let E=new Array(l.length);for(let $=0;$<l.length;$++){let ie=l[$];E[$]=new G.DiagnosticRelatedInformation(Pt(ie.location),ie.message)}return E}function m(l){if(!l)return;let E=[];for(let $ of l){let ie=g($);ie!==void 0&&E.push(ie)}return E.length>0?E:void 0}function g(l){switch(l){case oe.DiagnosticTag.Unnecessary:return G.DiagnosticTag.Unnecessary;case oe.DiagnosticTag.Deprecated:return G.DiagnosticTag.Deprecated;default:return}}function w(l){return l?new G.Position(l.line,l.character):void 0}function y(l){return l?new G.Range(l.start.line,l.start.character,l.end.line,l.end.character):void 0}async function T(l,E){return Ee.map(l,$=>new G.Range($.start.line,$.start.character,$.end.line,$.end.character),E)}function C(l){if(l==null)return G.DiagnosticSeverity.Error;switch(l){case oe.DiagnosticSeverity.Error:return G.DiagnosticSeverity.Error;case oe.DiagnosticSeverity.Warning:return G.DiagnosticSeverity.Warning;case oe.DiagnosticSeverity.Information:return G.DiagnosticSeverity.Information;case oe.DiagnosticSeverity.Hint:return G.DiagnosticSeverity.Hint}return G.DiagnosticSeverity.Error}function S(l){if(dn.string(l))return x(l);if(Xs.is(l))return x().appendCodeblock(l.value,l.language);if(Array.isArray(l)){let E=[];for(let $ of l){let ie=x();Xs.is($)?ie.appendCodeblock($.value,$.language):ie.appendMarkdown($),E.push(ie)}return E}else return x(l)}function P(l){if(dn.string(l))return l;switch(l.kind){case oe.MarkupKind.Markdown:return x(l.value);case oe.MarkupKind.PlainText:return l.value;default:return`Unsupported Markup content received. Kind is: ${l.kind}`}}function x(l){let E;if(l===void 0||typeof l=="string")E=new G.MarkdownString(l);else switch(l.kind){case oe.MarkupKind.Markdown:E=new G.MarkdownString(l.value);break;case oe.MarkupKind.PlainText:E=new G.MarkdownString,E.appendText(l.value);break;default:E=new G.MarkdownString,E.appendText(`Unsupported Markup content received. Kind is: ${l.kind}`);break}return E.isTrusted=e,E.supportHtml=t,E}function q(l){if(l)return new G.Hover(S(l.contents),y(l.range))}async function A(l,E,$){if(!l)return;if(Array.isArray(l))return Ee.map(l,xn=>ee(xn,E),$);let ie=l,{defaultRange:Vt,commitCharacters:St}=V(ie,E),Oe=await Ee.map(ie.items,xn=>ee(xn,St,Vt,ie.itemDefaults?.insertTextMode,ie.itemDefaults?.insertTextFormat,ie.itemDefaults?.data),$);return new G.CompletionList(Oe,ie.isIncomplete)}function V(l,E){let $=l.itemDefaults?.editRange,ie=l.itemDefaults?.commitCharacters??E;return oe.Range.is($)?{defaultRange:y($),commitCharacters:ie}:$!==void 0?{defaultRange:{inserting:y($.insert),replacing:y($.replace)},commitCharacters:ie}:{defaultRange:void 0,commitCharacters:ie}}function j(l){return oe.CompletionItemKind.Text<=l&&l<=oe.CompletionItemKind.TypeParameter?[l-1,void 0]:[G.CompletionItemKind.Text,l]}function W(l){switch(l){case oe.CompletionItemTag.Deprecated:return G.CompletionItemTag.Deprecated}}function Y(l){if(l==null)return[];let E=[];for(let $ of l){let ie=W($);ie!==void 0&&E.push(ie)}return E}function ee(l,E,$,ie,Vt,St){let Oe=Y(l.tags),xn=de(l),Ae=new rC.default(xn);l.detail&&(Ae.detail=l.detail),l.documentation&&(Ae.documentation=P(l.documentation),Ae.documentationFormat=dn.string(l.documentation)?"$string":l.documentation.kind),l.filterText&&(Ae.filterText=l.filterText);let ws=fe(l,$,Vt);if(ws&&(Ae.insertText=ws.text,Ae.range=ws.range,Ae.fromEdit=ws.fromEdit),dn.number(l.kind)){let[sv,_f]=j(l.kind);Ae.kind=sv,_f&&(Ae.originalItemKind=_f)}l.sortText&&(Ae.sortText=l.sortText),l.additionalTextEdits&&(Ae.additionalTextEdits=Je(l.additionalTextEdits));let Rf=l.commitCharacters!==void 0?dn.stringArray(l.commitCharacters)?l.commitCharacters:void 0:E;Rf&&(Ae.commitCharacters=Rf.slice()),l.command&&(Ae.command=ut(l.command)),(l.deprecated===!0||l.deprecated===!1)&&(Ae.deprecated=l.deprecated,l.deprecated===!0&&Oe.push(G.CompletionItemTag.Deprecated)),(l.preselect===!0||l.preselect===!1)&&(Ae.preselect=l.preselect);let Df=l.data??St;Df!==void 0&&(Ae.data=Df),Oe.length>0&&(Ae.tags=Oe);let ba=l.insertTextMode??ie;return ba!==void 0&&(Ae.insertTextMode=ba,ba===oe.InsertTextMode.asIs&&(Ae.keepWhitespace=!0)),Ae}function de(l){return oe.CompletionItemLabelDetails.is(l.labelDetails)?{label:l.label,detail:l.labelDetails.detail,description:l.labelDetails.description}:l.label}function fe(l,E,$){let ie=l.insertTextFormat??$;if(l.textEdit!==void 0||E!==void 0){let[Vt,St]=l.textEdit!==void 0?Ue(l.textEdit):[E,l.textEditText??l.label];return ie===oe.InsertTextFormat.Snippet?{text:new G.SnippetString(St),range:Vt,fromEdit:!0}:{text:St,range:Vt,fromEdit:!0}}else return l.insertText?ie===oe.InsertTextFormat.Snippet?{text:new G.SnippetString(l.insertText),fromEdit:!1}:{text:l.insertText,fromEdit:!1}:void 0}function Ue(l){return oe.InsertReplaceEdit.is(l)?[{inserting:y(l.insert),replacing:y(l.replace)},l.newText]:[y(l.range),l.newText]}function Ge(l){if(l)return new G.TextEdit(y(l.range),l.newText)}async function rt(l,E){if(l)return Ee.map(l,Ge,E)}function Je(l){if(!l)return;let E=new Array(l.length);for(let $=0;$<l.length;$++)E[$]=Ge(l[$]);return E}async function Ut(l,E){if(!l)return;let $=new G.SignatureHelp;return dn.number(l.activeSignature)?$.activeSignature=l.activeSignature:$.activeSignature=0,dn.number(l.activeParameter)?$.activeParameter=l.activeParameter:$.activeParameter=0,l.signatures&&($.signatures=await Xe(l.signatures,E)),$}async function Xe(l,E){return Ee.mapAsync(l,Ot,E)}async function Ot(l,E){let $=new G.SignatureInformation(l.label);return l.documentation!==void 0&&($.documentation=P(l.documentation)),l.parameters!==void 0&&($.parameters=await Kt(l.parameters,E)),l.activeParameter!==void 0&&($.activeParameter=l.activeParameter),$}function Kt(l,E){return Ee.map(l,kn,E)}function kn(l){let E=new G.ParameterInformation(l.label);return l.documentation&&(E.documentation=P(l.documentation)),E}function Pt(l){return l?new G.Location(r(l.uri),y(l.range)):void 0}async function Ri(l,E){if(l)return $n(l,E)}async function ri(l,E){if(l)return $n(l,E)}function An(l){if(!l)return;let E={targetUri:r(l.targetUri),targetRange:y(l.targetRange),originSelectionRange:y(l.originSelectionRange),targetSelectionRange:y(l.targetSelectionRange)};if(!E.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return E}async function $n(l,E){if(l)if(dn.array(l)){if(l.length===0)return[];if(oe.LocationLink.is(l[0])){let $=l;return Ee.map($,An,E)}else{let $=l;return Ee.map($,Pt,E)}}else return oe.LocationLink.is(l)?[An(l)]:Pt(l)}async function jn(l,E){if(l)return Ee.map(l,Pt,E)}async function Di(l,E){if(l)return Ee.map(l,si,E)}function si(l){let E=new G.DocumentHighlight(y(l.range));return dn.number(l.kind)&&(E.kind=oi(l.kind)),E}function oi(l){switch(l){case oe.DocumentHighlightKind.Text:return G.DocumentHighlightKind.Text;case oe.DocumentHighlightKind.Read:return G.DocumentHighlightKind.Read;case oe.DocumentHighlightKind.Write:return G.DocumentHighlightKind.Write}return G.DocumentHighlightKind.Text}async function Wn(l,E){if(l)return Ee.map(l,cn,E)}function gt(l){return l<=oe.SymbolKind.TypeParameter?l-1:G.SymbolKind.Property}function ai(l){switch(l){case oe.SymbolTag.Deprecated:return G.SymbolTag.Deprecated;default:return}}function En(l){if(l==null)return;let E=[];for(let $ of l){let ie=ai($);ie!==void 0&&E.push(ie)}return E.length===0?void 0:E}function cn(l){let E=l.data,$=l.location,ie=$.range===void 0||E!==void 0?new lC.default(l.name,gt(l.kind),l.containerName??"",$.range===void 0?r($.uri):new G.Location(r(l.location.uri),y($.range)),E):new G.SymbolInformation(l.name,gt(l.kind),l.containerName??"",new G.Location(r(l.location.uri),y($.range)));return Hn(ie,l),ie}async function ci(l,E){if(l!=null)return Ee.map(l,Ft,E)}function Ft(l){let E=new G.DocumentSymbol(l.name,l.detail||"",gt(l.kind),y(l.range),y(l.selectionRange));if(Hn(E,l),l.children!==void 0&&l.children.length>0){let $=[];for(let ie of l.children)$.push(Ft(ie));E.children=$}return E}function Hn(l,E){l.tags=En(E.tags),E.deprecated&&(l.tags?l.tags.includes(G.SymbolTag.Deprecated)||(l.tags=l.tags.concat(G.SymbolTag.Deprecated)):l.tags=[G.SymbolTag.Deprecated])}function ut(l){let E={title:l.title,command:l.command};return l.arguments&&(E.arguments=l.arguments),E}async function pn(l,E){if(l)return Ee.map(l,ut,E)}let Lt=new Map;Lt.set(oe.CodeActionKind.Empty,G.CodeActionKind.Empty),Lt.set(oe.CodeActionKind.QuickFix,G.CodeActionKind.QuickFix),Lt.set(oe.CodeActionKind.Refactor,G.CodeActionKind.Refactor),Lt.set(oe.CodeActionKind.RefactorExtract,G.CodeActionKind.RefactorExtract),Lt.set(oe.CodeActionKind.RefactorInline,G.CodeActionKind.RefactorInline),Lt.set(oe.CodeActionKind.RefactorRewrite,G.CodeActionKind.RefactorRewrite),Lt.set(oe.CodeActionKind.Source,G.CodeActionKind.Source),Lt.set(oe.CodeActionKind.SourceOrganizeImports,G.CodeActionKind.SourceOrganizeImports);function Un(l){if(l==null)return;let E=Lt.get(l);if(E)return E;let $=l.split(".");E=G.CodeActionKind.Empty;for(let ie of $)E=E.append(ie);return E}function Jt(l){if(l!=null)return l.map(E=>Un(E))}async function Kn(l,E){if(l==null)return;let $=new aC.default(l.title,l.data);return l.kind!==void 0&&($.kind=Un(l.kind)),l.diagnostics!==void 0&&($.diagnostics=c(l.diagnostics)),l.edit!==void 0&&($.edit=await Zt(l.edit,E)),l.command!==void 0&&($.command=ut(l.command)),l.isPreferred!==void 0&&($.isPreferred=l.isPreferred),l.disabled!==void 0&&($.disabled={reason:l.disabled.reason}),$}function ui(l,E){return Ee.mapAsync(l,async $=>oe.Command.is($)?ut($):Kn($,E),E)}function zt(l){if(!l)return;let E=new sC.default(y(l.range));return l.command&&(E.command=ut(l.command)),l.data!==void 0&&l.data!==null&&(E.data=l.data),E}async function li(l,E){if(l)return Ee.map(l,zt,E)}async function Zt(l,E){if(!l)return;let $=new Map;if(l.changeAnnotations!==void 0){let St=l.changeAnnotations;await Ee.forEach(Object.keys(St),Oe=>{let xn=R(St[Oe]);$.set(Oe,xn)},E)}let ie=St=>{if(St!==void 0)return $.get(St)},Vt=new G.WorkspaceEdit;if(l.documentChanges){let St=l.documentChanges;await Ee.forEach(St,Oe=>{if(oe.CreateFile.is(Oe))Vt.createFile(r(Oe.uri),Oe.options,ie(Oe.annotationId));else if(oe.RenameFile.is(Oe))Vt.renameFile(r(Oe.oldUri),r(Oe.newUri),Oe.options,ie(Oe.annotationId));else if(oe.DeleteFile.is(Oe))Vt.deleteFile(r(Oe.uri),Oe.options,ie(Oe.annotationId));else if(oe.TextDocumentEdit.is(Oe)){let xn=r(Oe.textDocument.uri);for(let Ae of Oe.edits)oe.AnnotatedTextEdit.is(Ae)?Vt.replace(xn,y(Ae.range),Ae.newText,ie(Ae.annotationId)):Vt.replace(xn,y(Ae.range),Ae.newText)}else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(Oe,void 0,4)}`)},E)}else if(l.changes){let St=l.changes;await Ee.forEach(Object.keys(St),Oe=>{Vt.set(r(Oe),Je(St[Oe]))},E)}return Vt}function R(l){if(l!==void 0)return{label:l.label,needsConfirmation:!!l.needsConfirmation,description:l.description}}function M(l){let E=y(l.range),$=l.target?s(l.target):void 0,ie=new oC.default(E,$);return l.tooltip!==void 0&&(ie.tooltip=l.tooltip),l.data!==void 0&&l.data!==null&&(ie.data=l.data),ie}async function z(l,E){if(l)return Ee.map(l,M,E)}function J(l){return new G.Color(l.red,l.green,l.blue,l.alpha)}function Te(l){return new G.ColorInformation(y(l.range),J(l.color))}async function De(l,E){if(l)return Ee.map(l,Te,E)}function Ie(l){let E=new G.ColorPresentation(l.label);return E.additionalTextEdits=Je(l.additionalTextEdits),l.textEdit&&(E.textEdit=Ge(l.textEdit)),E}async function Ne(l,E){if(l)return Ee.map(l,Ie,E)}function he(l){if(l)switch(l){case oe.FoldingRangeKind.Comment:return G.FoldingRangeKind.Comment;case oe.FoldingRangeKind.Imports:return G.FoldingRangeKind.Imports;case oe.FoldingRangeKind.Region:return G.FoldingRangeKind.Region}}function Pe(l){return new G.FoldingRange(l.startLine,l.endLine,he(l.kind))}async function f(l,E){if(l)return Ee.map(l,Pe,E)}function O(l){return new G.SelectionRange(y(l.range),l.parent?O(l.parent):void 0)}async function B(l,E){return Array.isArray(l)?Ee.map(l,O,E):[]}function pe(l){return oe.InlineValueText.is(l)?new G.InlineValueText(y(l.range),l.text):oe.InlineValueVariableLookup.is(l)?new G.InlineValueVariableLookup(y(l.range),l.variableName,l.caseSensitiveLookup):new G.InlineValueEvaluatableExpression(y(l.range),l.expression)}async function k(l,E){return Array.isArray(l)?Ee.map(l,pe,E):[]}async function h(l,E){let $=typeof l.label=="string"?l.label:await Ee.map(l.label,D,E),ie=new dC.default(w(l.position),$);return l.kind!==void 0&&(ie.kind=l.kind),l.textEdits!==void 0&&(ie.textEdits=await rt(l.textEdits,E)),l.tooltip!==void 0&&(ie.tooltip=_(l.tooltip)),l.paddingLeft!==void 0&&(ie.paddingLeft=l.paddingLeft),l.paddingRight!==void 0&&(ie.paddingRight=l.paddingRight),l.data!==void 0&&(ie.data=l.data),ie}function D(l){let E=new G.InlayHintLabelPart(l.value);return l.location!==void 0&&(E.location=Pt(l.location)),l.tooltip!==void 0&&(E.tooltip=_(l.tooltip)),l.command!==void 0&&(E.command=ut(l.command)),E}function _(l){return typeof l=="string"?l:x(l)}async function b(l,E){if(Array.isArray(l))return Ee.mapAsync(l,h,E)}function d(l){if(l===null)return;let E=new cC.default(gt(l.kind),l.name,l.detail||"",s(l.uri),y(l.range),y(l.selectionRange),l.data);return l.tags!==void 0&&(E.tags=En(l.tags)),E}async function I(l,E){if(l!==null)return Ee.map(l,d,E)}async function N(l,E){return new G.CallHierarchyIncomingCall(d(l.from),await T(l.fromRanges,E))}async function ae(l,E){if(l!==null)return Ee.mapAsync(l,N,E)}async function Ke(l,E){return new G.CallHierarchyOutgoingCall(d(l.to),await T(l.fromRanges,E))}async function Le(l,E){if(l!==null)return Ee.mapAsync(l,Ke,E)}async function Yt(l,E){if(l!=null)return new G.SemanticTokens(new Uint32Array(l.data),l.resultId)}function Bt(l){return new G.SemanticTokensEdit(l.start,l.deleteCount,l.data!==void 0?new Uint32Array(l.data):void 0)}async function gn(l,E){if(l!=null)return new G.SemanticTokensEdits(l.edits.map(Bt),l.resultId)}function ye(l){return l}async function di(l,E){if(l!=null)return new G.LinkedEditingRanges(await T(l.ranges,E),Ui(l.wordPattern))}function Ui(l){if(l!=null)return new RegExp(l)}function wr(l){if(l===null)return;let E=new uC.default(gt(l.kind),l.name,l.detail||"",s(l.uri),y(l.range),y(l.selectionRange),l.data);return l.tags!==void 0&&(E.tags=En(l.tags)),E}async function iv(l,E){if(l!==null)return Ee.map(l,wr,E)}function rv(l){if(dn.string(l))return l;if(oe.RelativePattern.is(l)){if(oe.URI.is(l.baseUri))return new G.RelativePattern(s(l.baseUri),l.pattern);if(oe.WorkspaceFolder.is(l.baseUri)){let E=G.workspace.getWorkspaceFolder(s(l.baseUri.uri));return E!==void 0?new G.RelativePattern(E,l.pattern):void 0}}}return{asUri:s,asDocumentSelector:o,asDiagnostics:a,asDiagnostic:u,asRange:y,asRanges:T,asPosition:w,asDiagnosticSeverity:C,asDiagnosticTag:g,asHover:q,asCompletionResult:A,asCompletionItem:ee,asTextEdit:Ge,asTextEdits:rt,asSignatureHelp:Ut,asSignatureInformations:Xe,asSignatureInformation:Ot,asParameterInformations:Kt,asParameterInformation:kn,asDeclarationResult:Ri,asDefinitionResult:ri,asLocation:Pt,asReferences:jn,asDocumentHighlights:Di,asDocumentHighlight:si,asDocumentHighlightKind:oi,asSymbolKind:gt,asSymbolTag:ai,asSymbolTags:En,asSymbolInformations:Wn,asSymbolInformation:cn,asDocumentSymbols:ci,asDocumentSymbol:Ft,asCommand:ut,asCommands:pn,asCodeAction:Kn,asCodeActionKind:Un,asCodeActionKinds:Jt,asCodeActionResult:ui,asCodeLens:zt,asCodeLenses:li,asWorkspaceEdit:Zt,asDocumentLink:M,asDocumentLinks:z,asFoldingRangeKind:he,asFoldingRange:Pe,asFoldingRanges:f,asColor:J,asColorInformation:Te,asColorInformations:De,asColorPresentation:Ie,asColorPresentations:Ne,asSelectionRange:O,asSelectionRanges:B,asInlineValue:pe,asInlineValues:k,asInlayHint:h,asInlayHints:b,asSemanticTokensLegend:ye,asSemanticTokens:Yt,asSemanticTokensEdit:Bt,asSemanticTokensEdits:gn,asCallHierarchyItem:d,asCallHierarchyItems:I,asCallHierarchyIncomingCall:N,asCallHierarchyIncomingCalls:ae,asCallHierarchyOutgoingCall:Ke,asCallHierarchyOutgoingCalls:Le,asLinkedEditingRanges:di,asTypeHierarchyItem:wr,asTypeHierarchyItems:iv,asGlobPattern:rv}}Qs.createConverter=fC});var tt=F(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.generateUuid=fn.parse=fn.isUUID=fn.v4=fn.empty=void 0;var jr=class{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}},Wr=class i extends jr{constructor(){super([i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),"-",i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),"-","4",i._randomHex(),i._randomHex(),i._randomHex(),"-",i._oneOf(i._timeHighBits),i._randomHex(),i._randomHex(),i._randomHex(),"-",i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex(),i._randomHex()].join(""))}static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return i._oneOf(i._chars)}};Wr._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];Wr._timeHighBits=["8","9","a","b"];fn.empty=new jr("00000000-0000-0000-0000-000000000000");function op(){return new Wr}fn.v4=op;var hC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function ap(i){return hC.test(i)}fn.isUUID=ap;function pC(i){if(!ap(i))throw new Error("invalid uuid");return new jr(i)}fn.parse=pC;function gC(){return op().asHex()}fn.generateUuid=gC});var Su=F(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.ProgressPart=void 0;var cp=require("vscode"),up=ce(),lp=un(),Cu=class{constructor(e,t,n){this._client=e,this._token=t,this._reported=0,this._infinite=!1,this._lspProgressDisposable=this._client.onProgress(up.WorkDoneProgress.type,this._token,r=>{switch(r.kind){case"begin":this.begin(r);break;case"report":this.report(r);break;case"end":this.done(),n&&n(this);break}})}begin(e){this._infinite=e.percentage===void 0,this._lspProgressDisposable!==void 0&&cp.window.withProgress({location:cp.ProgressLocation.Window,cancellable:e.cancellable,title:e.title},async(t,n)=>{if(this._lspProgressDisposable!==void 0)return this._progress=t,this._cancellationToken=n,this._tokenDisposable=this._cancellationToken.onCancellationRequested(()=>{this._client.sendNotification(up.WorkDoneProgressCancelNotification.type,{token:this._token})}),this.report(e),new Promise((r,s)=>{this._resolve=r,this._reject=s})})}report(e){if(this._infinite&&lp.string(e.message))this._progress!==void 0&&this._progress.report({message:e.message});else if(lp.number(e.percentage)){let t=Math.max(0,Math.min(e.percentage,100)),n=Math.max(0,t-this._reported);this._reported+=n,this._progress!==void 0&&this._progress.report({message:e.message,increment:n})}}cancel(){this.cleanup(),this._reject!==void 0&&(this._reject(),this._resolve=void 0,this._reject=void 0)}done(){this.cleanup(),this._resolve!==void 0&&(this._resolve(),this._resolve=void 0,this._reject=void 0)}cleanup(){this._lspProgressDisposable!==void 0&&(this._lspProgressDisposable.dispose(),this._lspProgressDisposable=void 0),this._tokenDisposable!==void 0&&(this._tokenDisposable.dispose(),this._tokenDisposable=void 0),this._progress=void 0,this._cancellationToken=void 0}};Js.ProgressPart=Cu});var _e=F(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.WorkspaceFeature=pt.TextDocumentLanguageFeature=pt.TextDocumentEventFeature=pt.DynamicDocumentFeature=pt.DynamicFeature=pt.StaticFeature=pt.ensure=pt.LSPCancellationError=void 0;var Oi=require("vscode"),Ru=ce(),$t=un(),dp=tt(),Du=class extends Oi.CancellationError{constructor(e){super(),this.data=e}};pt.LSPCancellationError=Du;function mC(i,e){return i[e]===void 0&&(i[e]={}),i[e]}pt.ensure=mC;var vC;(function(i){function e(t){let n=t;return n!=null&&$t.func(n.fillClientCapabilities)&&$t.func(n.initialize)&&$t.func(n.getState)&&$t.func(n.dispose)&&(n.fillInitializeParams===void 0||$t.func(n.fillInitializeParams))}i.is=e})(vC=pt.StaticFeature||(pt.StaticFeature={}));var yC;(function(i){function e(t){let n=t;return n!=null&&$t.func(n.fillClientCapabilities)&&$t.func(n.initialize)&&$t.func(n.getState)&&$t.func(n.dispose)&&(n.fillInitializeParams===void 0||$t.func(n.fillInitializeParams))&&$t.func(n.register)&&$t.func(n.unregister)&&n.registrationType!==void 0}i.is=e})(yC=pt.DynamicFeature||(pt.DynamicFeature={}));var Hr=class{constructor(e){this._client=e}getState(){let e=this.getDocumentSelectors(),t=0;for(let r of e){t++;for(let s of Oi.workspace.textDocuments)if(Oi.languages.match(r,s)>0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}let n=t>0;return{kind:"document",id:this.registrationType.method,registrations:n,matches:!1}}};pt.DynamicDocumentFeature=Hr;var _u=class extends Hr{constructor(e,t,n,r,s,o,a){super(e),this._event=t,this._type=n,this._middleware=r,this._createParams=s,this._textDocument=o,this._selectorFilter=a,this._selectors=new Map,this._onNotificationSent=new Oi.EventEmitter}static textDocumentFilter(e,t){for(let n of e)if(Oi.languages.match(n,t)>0)return!0;return!1}getStateInfo(){return[this._selectors.values(),!1]}getDocumentSelectors(){return this._selectors.values()}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(t=>{this.callback(t).catch(n=>{this._client.error(`Sending document notification ${this._type.method} failed.`,n)})})),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}async callback(e){let t=async n=>{let r=this._createParams(n);await this._client.sendNotification(this._type,r),this.notificationSent(this.getTextDocument(n),this._type,r)};if(this.matches(e)){let n=this._middleware();return n?n(e,r=>t(r)):t(e)}}matches(e){return this._client.hasDedicatedTextSynchronizationFeature(this._textDocument(e))?!1:!this._selectorFilter||this._selectorFilter(this._selectors.values(),e)}get onNotificationSent(){return this._onNotificationSent.event}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._selectors.clear(),this._onNotificationSent.dispose(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getProvider(e){for(let t of this._selectors.values())if(Oi.languages.match(t,e)>0)return{send:n=>this.callback(n)}}};pt.TextDocumentEventFeature=_u;var Tu=class extends Hr{constructor(e,t){super(e),this._registrationType=t,this._registrations=new Map}*getDocumentSelectors(){for(let e of this._registrations.values()){let t=e.data.registerOptions.documentSelector;t!==null&&(yield this._client.protocol2CodeConverter.asDocumentSelector(t))}}get registrationType(){return this._registrationType}register(e){if(!e.registerOptions.documentSelector)return;let t=this.registerLanguageProvider(e.registerOptions,e.id);this._registrations.set(e.id,{disposable:t[0],data:e,provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}dispose(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getRegistration(e,t){if(t){if(Ru.TextDocumentRegistrationOptions.is(t)){let n=Ru.StaticRegistrationOptions.hasId(t)?t.id:dp.generateUuid(),r=t.documentSelector??e;if(r)return[n,Object.assign({},t,{documentSelector:r})]}else if($t.boolean(t)&&t===!0||Ru.WorkDoneProgressOptions.is(t)){if(!e)return[void 0,void 0];let n=$t.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e});return[dp.generateUuid(),n]}}else return[void 0,void 0];return[void 0,void 0]}getRegistrationOptions(e,t){if(!(!e||!t))return $t.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e})}getProvider(e){for(let t of this._registrations.values()){let n=t.data.registerOptions.documentSelector;if(n!==null&&Oi.languages.match(this._client.protocol2CodeConverter.asDocumentSelector(n),e)>0)return t.provider}}getAllProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};pt.TextDocumentLanguageFeature=Tu;var Pu=class{constructor(e,t){this._client=e,this._registrationType=t,this._registrations=new Map}getState(){let e=this._registrations.size>0;return{kind:"workspace",id:this._registrationType.method,registrations:e}}get registrationType(){return this._registrationType}register(e){let t=this.registerLanguageProvider(e.registerOptions);this._registrations.set(e.id,{disposable:t[0],provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}dispose(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};pt.WorkspaceFeature=Pu});var hp=F((nT,fp)=>{var bC=typeof process=="object"&&process&&process.platform==="win32";fp.exports=bC?{sep:"\\"}:{sep:"/"}});var yp=F((iT,vp)=>{"use strict";vp.exports=gp;function gp(i,e,t){i instanceof RegExp&&(i=pp(i,t)),e instanceof RegExp&&(e=pp(e,t));var n=mp(i,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+i.length,n[1]),post:t.slice(n[1]+e.length)}}function pp(i,e){var t=e.match(i);return t?t[0]:null}gp.range=mp;function mp(i,e,t){var n,r,s,o,a,c=t.indexOf(i),u=t.indexOf(e,c+1),p=c;if(c>=0&&u>0){if(i===e)return[c,u];for(n=[],s=t.length;p>=0&&!a;)p==c?(n.push(p),c=t.indexOf(i,p+1)):n.length==1?a=[n.pop(),u]:(r=n.pop(),r<s&&(s=r,o=u),u=t.indexOf(e,p+1)),p=c<u&&c>=0?c:u;n.length&&(a=[s,o])}return a}});var Tp=F((rT,_p)=>{var bp=yp();_p.exports=SC;var wp="\0SLASH"+Math.random()+"\0",Cp="\0OPEN"+Math.random()+"\0",Eu="\0CLOSE"+Math.random()+"\0",Sp="\0COMMA"+Math.random()+"\0",Rp="\0PERIOD"+Math.random()+"\0";function ku(i){return parseInt(i,10)==i?parseInt(i,10):i.charCodeAt(0)}function wC(i){return i.split("\\\\").join(wp).split("\\{").join(Cp).split("\\}").join(Eu).split("\\,").join(Sp).split("\\.").join(Rp)}function CC(i){return i.split(wp).join("\\").split(Cp).join("{").split(Eu).join("}").split(Sp).join(",").split(Rp).join(".")}function Dp(i){if(!i)return[""];var e=[],t=bp("{","}",i);if(!t)return i.split(",");var n=t.pre,r=t.body,s=t.post,o=n.split(",");o[o.length-1]+="{"+r+"}";var a=Dp(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function SC(i){return i?(i.substr(0,2)==="{}"&&(i="\\{\\}"+i.substr(2)),Ur(wC(i),!0).map(CC)):[]}function RC(i){return"{"+i+"}"}function DC(i){return/^-?0\d/.test(i)}function _C(i,e){return i<=e}function TC(i,e){return i>=e}function Ur(i,e){var t=[],n=bp("{","}",i);if(!n)return[i];var r=n.pre,s=n.post.length?Ur(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<s.length;o++){var a=r+"{"+n.body+"}"+s[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),p=c||u,m=n.body.indexOf(",")>=0;if(!p&&!m)return n.post.match(/,(?!,).*\}/)?(i=n.pre+"{"+n.body+Eu+n.post,Ur(i)):[i];var g;if(p)g=n.body.split(/\.\./);else if(g=Dp(n.body),g.length===1&&(g=Ur(g[0],!1).map(RC),g.length===1))return s.map(function(ee){return n.pre+g[0]+ee});var w;if(p){var y=ku(g[0]),T=ku(g[1]),C=Math.max(g[0].length,g[1].length),S=g.length==3?Math.abs(ku(g[2])):1,P=_C,x=T<y;x&&(S*=-1,P=TC);var q=g.some(DC);w=[];for(var A=y;P(A,T);A+=S){var V;if(u)V=String.fromCharCode(A),V==="\\"&&(V="");else if(V=String(A),q){var j=C-V.length;if(j>0){var W=new Array(j+1).join("0");A<0?V="-"+W+V.slice(1):V=W+V}}w.push(V)}}else{w=[];for(var Y=0;Y<g.length;Y++)w.push.apply(w,Ur(g[Y],!1))}for(var Y=0;Y<w.length;Y++)for(var o=0;o<s.length;o++){var a=r+w[Y]+s[o];(!e||p||a)&&t.push(a)}}return t}});var Ys=F((oT,Fu)=>{var tn=Fu.exports=(i,e,t={})=>(Zs(e),!t.nocomment&&e.charAt(0)==="#"?!1:new ir(e,t).match(i));Fu.exports=tn;var Iu=hp();tn.sep=Iu.sep;var Dn=Symbol("globstar **");tn.GLOBSTAR=Dn;var PC=Tp(),Pp={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},Ou="[^/]",xu=Ou+"*?",kC="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",EC="(?:(?!(?:\\/|^)\\.).)*?",xp=i=>i.split("").reduce((e,t)=>(e[t]=!0,e),{}),kp=xp("().*{}+?[]^$\\!"),xC=xp("[.("),Ep=/\/+/;tn.filter=(i,e={})=>(t,n,r)=>tn(t,i,e);var mi=(i,e={})=>{let t={};return Object.keys(i).forEach(n=>t[n]=i[n]),Object.keys(e).forEach(n=>t[n]=e[n]),t};tn.defaults=i=>{if(!i||typeof i!="object"||!Object.keys(i).length)return tn;let e=tn,t=(n,r,s)=>e(n,r,mi(i,s));return t.Minimatch=class extends e.Minimatch{constructor(r,s){super(r,mi(i,s))}},t.Minimatch.defaults=n=>e.defaults(mi(i,n)).Minimatch,t.filter=(n,r)=>e.filter(n,mi(i,r)),t.defaults=n=>e.defaults(mi(i,n)),t.makeRe=(n,r)=>e.makeRe(n,mi(i,r)),t.braceExpand=(n,r)=>e.braceExpand(n,mi(i,r)),t.match=(n,r,s)=>e.match(n,r,mi(i,s)),t};tn.braceExpand=(i,e)=>qp(i,e);var qp=(i,e={})=>(Zs(i),e.nobrace||!/\{(?:(?!\{).)*\}/.test(i)?[i]:PC(i)),qC=1024*64,Zs=i=>{if(typeof i!="string")throw new TypeError("invalid pattern");if(i.length>qC)throw new TypeError("pattern is too long")},qu=Symbol("subparse");tn.makeRe=(i,e)=>new ir(i,e||{}).makeRe();tn.match=(i,e,t={})=>{let n=new ir(e,t);return i=i.filter(r=>n.match(r)),n.options.nonull&&!i.length&&i.push(e),i};var IC=i=>i.replace(/\\(.)/g,"$1"),OC=i=>i.replace(/\\([^-\]])/g,"$1"),FC=i=>i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),LC=i=>i.replace(/[[\]\\]/g,"\\$&"),ir=class{constructor(e,t){Zs(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let n=this.globSet=this.braceExpand();t.debug&&(this.debug=(...r)=>console.error(...r)),this.debug(this.pattern,n),n=this.globParts=n.map(r=>r.split(Ep)),this.debug(this.pattern,n),n=n.map((r,s,o)=>r.map(this.parse,this)),this.debug(this.pattern,n),n=n.filter(r=>r.indexOf(!1)===-1),this.debug(this.pattern,n),this.set=n}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,t=!1,n=0;for(let r=0;r<e.length&&e.charAt(r)==="!";r++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n){var r=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,o=0,a=e.length,c=t.length;s<a&&o<c;s++,o++){this.debug("matchOne loop");var u=t[o],p=e[s];if(this.debug(t,u,p),u===!1)return!1;if(u===Dn){this.debug("GLOBSTAR",[t,u,p]);var m=s,g=o+1;if(g===c){for(this.debug("** at the end");s<a;s++)if(e[s]==="."||e[s]===".."||!r.dot&&e[s].charAt(0)===".")return!1;return!0}for(;m<a;){var w=e[m];if(this.debug(`
globstar while`,e,m,t,g,w),this.matchOne(e.slice(m),t.slice(g),n))return this.debug("globstar found match!",m,a,w),!0;if(w==="."||w===".."||!r.dot&&w.charAt(0)==="."){this.debug("dot detected!",e,m,t,g);break}this.debug("globstar swallow a segment, and continue"),m++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,m,t,g),m===a))}var y;if(typeof u=="string"?(y=p===u,this.debug("string match",u,p,y)):(y=p.match(u),this.debug("pattern match",u,p,y)),!y)return!1}if(s===a&&o===c)return!0;if(s===a)return n;if(o===c)return s===a-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return qp(this.pattern,this.options)}parse(e,t){Zs(e);let n=this.options;if(e==="**")if(n.noglobstar)e="*";else return Dn;if(e==="")return"";let r="",s=!1,o=!1,a=[],c=[],u,p=!1,m=-1,g=-1,w,y,T,C=e.charAt(0)===".",S=n.dot||C,P=()=>C?"":S?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",x=j=>j.charAt(0)==="."?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",q=()=>{if(u){switch(u){case"*":r+=xu,s=!0;break;case"?":r+=Ou,s=!0;break;default:r+="\\"+u;break}this.debug("clearStateChar %j %j",u,r),u=!1}};for(let j=0,W;j<e.length&&(W=e.charAt(j));j++){if(this.debug("%s	%s %s %j",e,j,r,W),o){if(W==="/")return!1;kp[W]&&(r+="\\"),r+=W,o=!1;continue}switch(W){case"/":return!1;case"\\":if(p&&e.charAt(j+1)==="-"){r+=W;continue}q(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,j,r,W),p){this.debug("  in class"),W==="!"&&j===g+1&&(W="^"),r+=W;continue}this.debug("call clearStateChar %j",u),q(),u=W,n.noext&&q();continue;case"(":{if(p){r+="(";continue}if(!u){r+="\\(";continue}let Y={type:u,start:j-1,reStart:r.length,open:Pp[u].open,close:Pp[u].close};this.debug(this.pattern,"	",Y),a.push(Y),r+=Y.open,Y.start===0&&Y.type!=="!"&&(C=!0,r+=x(e.slice(j+1))),this.debug("plType %j %j",u,r),u=!1;continue}case")":{let Y=a[a.length-1];if(p||!Y){r+="\\)";continue}a.pop(),q(),s=!0,y=Y,r+=y.close,y.type==="!"&&c.push(Object.assign(y,{reEnd:r.length}));continue}case"|":{let Y=a[a.length-1];if(p||!Y){r+="\\|";continue}q(),r+="|",Y.start===0&&Y.type!=="!"&&(C=!0,r+=x(e.slice(j+1)));continue}case"[":if(q(),p){r+="\\"+W;continue}p=!0,g=j,m=r.length,r+=W;continue;case"]":if(j===g+1||!p){r+="\\"+W;continue}w=e.substring(g+1,j);try{RegExp("["+LC(OC(w))+"]"),r+=W}catch{r=r.substring(0,m)+"(?:$.)"}s=!0,p=!1;continue;default:q(),kp[W]&&!(W==="^"&&p)&&(r+="\\"),r+=W;break}}for(p&&(w=e.slice(g+1),T=this.parse(w,qu),r=r.substring(0,m)+"\\["+T[0],s=s||T[1]),y=a.pop();y;y=a.pop()){let j;j=r.slice(y.reStart+y.open.length),this.debug("setting tail",r,y),j=j.replace(/((?:\\{2}){0,64})(\\?)\|/g,(Y,ee,de)=>(de||(de="\\"),ee+ee+de+"|")),this.debug(`tail=%j
   %s`,j,j,y,r);let W=y.type==="*"?xu:y.type==="?"?Ou:"\\"+y.type;s=!0,r=r.slice(0,y.reStart)+W+"\\("+j}q(),o&&(r+="\\\\");let A=xC[r.charAt(0)];for(let j=c.length-1;j>-1;j--){let W=c[j],Y=r.slice(0,W.reStart),ee=r.slice(W.reStart,W.reEnd-8),de=r.slice(W.reEnd),fe=r.slice(W.reEnd-8,W.reEnd)+de,Ue=Y.split(")").length,Ge=Y.split("(").length-Ue,rt=de;for(let Ut=0;Ut<Ge;Ut++)rt=rt.replace(/\)[+*?]?/,"");de=rt;let Je=de===""&&t!==qu?"(?:$|\\/)":"";r=Y+ee+de+Je+fe}if(r!==""&&s&&(r="(?=.)"+r),A&&(r=P()+r),t===qu)return[r,s];if(n.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return IC(e);let V=n.nocase?"i":"";try{return Object.assign(new RegExp("^"+r+"$",V),{_glob:e,_src:r})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,n=t.noglobstar?xu:t.dot?kC:EC,r=t.nocase?"i":"",s=e.map(o=>(o=o.map(a=>typeof a=="string"?FC(a):a===Dn?Dn:a._src).reduce((a,c)=>(a[a.length-1]===Dn&&c===Dn||a.push(c),a),[]),o.forEach((a,c)=>{a!==Dn||o[c-1]===Dn||(c===0?o.length>1?o[c+1]="(?:\\/|"+n+"\\/)?"+o[c+1]:o[c]=n:c===o.length-1?o[c-1]+="(?:\\/|"+n+")?":(o[c-1]+="(?:\\/|\\/"+n+"\\/)"+o[c+1],o[c+1]=Dn))}),o.filter(a=>a!==Dn).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,r)}catch{this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let n=this.options;Iu.sep!=="/"&&(e=e.split(Iu.sep).join("/")),e=e.split(Ep),this.debug(this.pattern,"split",e);let r=this.set;this.debug(this.pattern,"set",r);let s;for(let o=e.length-1;o>=0&&(s=e[o],!s);o--);for(let o=0;o<r.length;o++){let a=r[o],c=e;if(n.matchBase&&a.length===1&&(c=[s]),this.matchOne(c,a,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return tn.defaults(e).Minimatch}};tn.Minimatch=ir});var Uu=F(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.DiagnosticFeature=Fn.DiagnosticPullMode=Fn.vsdiag=void 0;var MC=Ys(),Re=require("vscode"),ot=ce(),NC=tt(),Lu=_e();function eo(i,e){return i[e]===void 0&&(i[e]={}),i[e]}var _n;(function(i){let e;(function(t){t.full="full",t.unChanged="unChanged"})(e=i.DocumentDiagnosticReportKind||(i.DocumentDiagnosticReportKind={}))})(_n=Fn.vsdiag||(Fn.vsdiag={}));var Mu;(function(i){i.onType="onType",i.onSave="onSave"})(Mu=Fn.DiagnosticPullMode||(Fn.DiagnosticPullMode={}));var xt;(function(i){i.active="open",i.reschedule="reschedule",i.outDated="drop"})(xt||(xt={}));var Nu=class i{constructor(){this.open=new Set,this._onOpen=new Re.EventEmitter,this._onClose=new Re.EventEmitter,i.fillTabResources(this.open);let e=t=>{if(t.closed.length===0&&t.opened.length===0)return;let n=this.open,r=new Set;i.fillTabResources(r);let s=new Set,o=new Set(r);for(let a of n.values())r.has(a)?o.delete(a):s.add(a);if(this.open=r,s.size>0){let a=new Set;for(let c of s)a.add(Re.Uri.parse(c));this._onClose.fire(a)}if(o.size>0){let a=new Set;for(let c of o)a.add(Re.Uri.parse(c));this._onOpen.fire(a)}};Re.window.tabGroups.onDidChangeTabs!==void 0?this.disposable=Re.window.tabGroups.onDidChangeTabs(e):this.disposable={dispose:()=>{}}}get onClose(){return this._onClose.event}get onOpen(){return this._onOpen.event}dispose(){this.disposable.dispose()}isActive(e){return e instanceof Re.Uri?Re.window.activeTextEditor?.document.uri===e:Re.window.activeTextEditor?.document===e}isVisible(e){let t=e instanceof Re.Uri?e:e.uri;return this.open.has(t.toString())}getTabResources(){let e=new Set;return i.fillTabResources(new Set,e),e}static fillTabResources(e,t){let n=e??new Set;for(let r of Re.window.tabGroups.all)for(let s of r.tabs){let o=s.input,a;o instanceof Re.TabInputText?a=o.uri:o instanceof Re.TabInputTextDiff&&(a=o.modified),a!==void 0&&!n.has(a.toString())&&(n.add(a.toString()),t!==void 0&&t.add(a))}}},mt;(function(i){i[i.document=1]="document",i[i.workspace=2]="workspace"})(mt||(mt={}));var Qn;(function(i){function e(t){return t instanceof Re.Uri?t.toString():t.uri.toString()}i.asKey=e})(Qn||(Qn={}));var Au=class{constructor(){this.documentPullStates=new Map,this.workspacePullStates=new Map}track(e,t,n){let r=e===mt.document?this.documentPullStates:this.workspacePullStates,[s,o,a]=t instanceof Re.Uri?[t.toString(),t,n]:[t.uri.toString(),t.uri,t.version],c=r.get(s);return c===void 0&&(c={document:o,pulledVersion:a,resultId:void 0},r.set(s,c)),c}update(e,t,n,r){let s=e===mt.document?this.documentPullStates:this.workspacePullStates,[o,a,c,u]=t instanceof Re.Uri?[t.toString(),t,n,r]:[t.uri.toString(),t.uri,t.version,n],p=s.get(o);p===void 0?(p={document:a,pulledVersion:c,resultId:u},s.set(o,p)):(p.pulledVersion=c,p.resultId=u)}unTrack(e,t){let n=Qn.asKey(t);(e===mt.document?this.documentPullStates:this.workspacePullStates).delete(n)}tracks(e,t){let n=Qn.asKey(t);return(e===mt.document?this.documentPullStates:this.workspacePullStates).has(n)}getResultId(e,t){let n=Qn.asKey(t);return(e===mt.document?this.documentPullStates:this.workspacePullStates).get(n)?.resultId}getAllResultIds(){let e=[];for(let[t,n]of this.workspacePullStates)this.documentPullStates.has(t)&&(n=this.documentPullStates.get(t)),n.resultId!==void 0&&e.push({uri:t,value:n.resultId});return e}},$u=class{constructor(e,t,n){this.client=e,this.tabs=t,this.options=n,this.isDisposed=!1,this.onDidChangeDiagnosticsEmitter=new Re.EventEmitter,this.provider=this.createProvider(),this.diagnostics=Re.languages.createDiagnosticCollection(n.identifier),this.openRequests=new Map,this.documentStates=new Au,this.workspaceErrorCounter=0}knows(e,t){let n=t instanceof Re.Uri?t:t.uri;return this.documentStates.tracks(e,t)||this.openRequests.has(n.toString())}forget(e,t){this.documentStates.unTrack(e,t)}pull(e,t){if(this.isDisposed)return;let n=e instanceof Re.Uri?e:e.uri;this.pullAsync(e).then(()=>{t&&t()},r=>{this.client.error(`Document pull failed for text document ${n.toString()}`,r,!1)})}async pullAsync(e,t){if(this.isDisposed)return;let n=e instanceof Re.Uri,r=n?e:e.uri,s=r.toString();t=n?t:e.version;let o=this.openRequests.get(s),a=n?this.documentStates.track(mt.document,e,t):this.documentStates.track(mt.document,e);if(o===void 0){let c=new Re.CancellationTokenSource;this.openRequests.set(s,{state:xt.active,document:e,version:t,tokenSource:c});let u,p;try{u=await this.provider.provideDiagnostics(e,a.resultId,c.token)??{kind:_n.DocumentDiagnosticReportKind.full,items:[]}}catch(m){if(m instanceof Lu.LSPCancellationError&&ot.DiagnosticServerCancellationData.is(m.data)&&m.data.retriggerRequest===!1&&(p={state:xt.outDated,document:e}),p===void 0&&m instanceof Re.CancellationError)p={state:xt.reschedule,document:e};else throw m}if(p=p??this.openRequests.get(s),p===void 0){this.client.error(`Lost request state in diagnostic pull model. Clearing diagnostics for ${s}`),this.diagnostics.delete(r);return}if(this.openRequests.delete(s),!this.tabs.isVisible(e)){this.documentStates.unTrack(mt.document,e);return}if(p.state===xt.outDated)return;u!==void 0&&(u.kind===_n.DocumentDiagnosticReportKind.full&&this.diagnostics.set(r,u.items),a.pulledVersion=t,a.resultId=u.resultId),p.state===xt.reschedule&&this.pull(e)}else o.state===xt.active?(o.tokenSource.cancel(),this.openRequests.set(s,{state:xt.reschedule,document:o.document})):o.state===xt.outDated&&this.openRequests.set(s,{state:xt.reschedule,document:o.document})}forgetDocument(e){let t=e instanceof Re.Uri?e:e.uri,n=t.toString(),r=this.openRequests.get(n);this.options.workspaceDiagnostics?r!==void 0?this.openRequests.set(n,{state:xt.reschedule,document:e}):this.pull(e,()=>{this.forget(mt.document,e)}):(r!==void 0&&(r.state===xt.active&&r.tokenSource.cancel(),this.openRequests.set(n,{state:xt.outDated,document:e})),this.diagnostics.delete(t),this.forget(mt.document,e))}pullWorkspace(){this.isDisposed||this.pullWorkspaceAsync().then(()=>{this.workspaceTimeout=(0,ot.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3)},e=>{!(e instanceof Lu.LSPCancellationError)&&!ot.DiagnosticServerCancellationData.is(e.data)&&(this.client.error("Workspace diagnostic pull failed.",e,!1),this.workspaceErrorCounter++),this.workspaceErrorCounter<=5&&(this.workspaceTimeout=(0,ot.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3))})}async pullWorkspaceAsync(){if(!this.provider.provideWorkspaceDiagnostics||this.isDisposed)return;this.workspaceCancellation!==void 0&&(this.workspaceCancellation.cancel(),this.workspaceCancellation=void 0),this.workspaceCancellation=new Re.CancellationTokenSource;let e=this.documentStates.getAllResultIds().map(t=>({uri:this.client.protocol2CodeConverter.asUri(t.uri),value:t.value}));await this.provider.provideWorkspaceDiagnostics(e,this.workspaceCancellation.token,t=>{if(!(!t||this.isDisposed))for(let n of t.items)n.kind===_n.DocumentDiagnosticReportKind.full&&(this.documentStates.tracks(mt.document,n.uri)||this.diagnostics.set(n.uri,n.items)),this.documentStates.update(mt.workspace,n.uri,n.version??void 0,n.resultId)})}createProvider(){let e={onDidChangeDiagnostics:this.onDidChangeDiagnosticsEmitter.event,provideDiagnostics:(t,n,r)=>{let s=(a,c,u)=>{let p={identifier:this.options.identifier,textDocument:{uri:this.client.code2ProtocolConverter.asUri(a instanceof Re.Uri?a:a.uri)},previousResultId:c};return this.isDisposed===!0||!this.client.isRunning()?{kind:_n.DocumentDiagnosticReportKind.full,items:[]}:this.client.sendRequest(ot.DocumentDiagnosticRequest.type,p,u).then(async m=>m==null||this.isDisposed||u.isCancellationRequested?{kind:_n.DocumentDiagnosticReportKind.full,items:[]}:m.kind===ot.DocumentDiagnosticReportKind.Full?{kind:_n.DocumentDiagnosticReportKind.full,resultId:m.resultId,items:await this.client.protocol2CodeConverter.asDiagnostics(m.items,u)}:{kind:_n.DocumentDiagnosticReportKind.unChanged,resultId:m.resultId},m=>this.client.handleFailedRequest(ot.DocumentDiagnosticRequest.type,u,m,{kind:_n.DocumentDiagnosticReportKind.full,items:[]}))},o=this.client.middleware;return o.provideDiagnostics?o.provideDiagnostics(t,n,r,s):s(t,n,r)}};return this.options.workspaceDiagnostics&&(e.provideWorkspaceDiagnostics=(t,n,r)=>{let s=async u=>u.kind===ot.DocumentDiagnosticReportKind.Full?{kind:_n.DocumentDiagnosticReportKind.full,uri:this.client.protocol2CodeConverter.asUri(u.uri),resultId:u.resultId,version:u.version,items:await this.client.protocol2CodeConverter.asDiagnostics(u.items,n)}:{kind:_n.DocumentDiagnosticReportKind.unChanged,uri:this.client.protocol2CodeConverter.asUri(u.uri),resultId:u.resultId,version:u.version},o=u=>{let p=[];for(let m of u)p.push({uri:this.client.code2ProtocolConverter.asUri(m.uri),value:m.value});return p},a=(u,p)=>{let m=(0,NC.generateUuid)(),g=this.client.onProgress(ot.WorkspaceDiagnosticRequest.partialResult,m,async y=>{if(y==null){r(null);return}let T={items:[]};for(let C of y.items)try{T.items.push(await s(C))}catch(S){this.client.error("Converting workspace diagnostics failed.",S)}r(T)}),w={identifier:this.options.identifier,previousResultIds:o(u),partialResultToken:m};return this.isDisposed===!0||!this.client.isRunning()?{items:[]}:this.client.sendRequest(ot.WorkspaceDiagnosticRequest.type,w,p).then(async y=>{if(p.isCancellationRequested)return{items:[]};let T={items:[]};for(let C of y.items)T.items.push(await s(C));return g.dispose(),r(T),{items:[]}},y=>(g.dispose(),this.client.handleFailedRequest(ot.DocumentDiagnosticRequest.type,p,y,{items:[]})))},c=this.client.middleware;return c.provideWorkspaceDiagnostics?c.provideWorkspaceDiagnostics(t,n,r,a):a(t,n,r)}),e}dispose(){this.isDisposed=!0,this.workspaceCancellation?.cancel(),this.workspaceTimeout?.dispose();for(let[e,t]of this.openRequests)t.state===xt.active&&t.tokenSource.cancel(),this.openRequests.set(e,{state:xt.outDated,document:t.document});this.diagnostics.dispose()}},ju=class{constructor(e){this.diagnosticRequestor=e,this.documents=new ot.LinkedMap,this.isDisposed=!1}add(e){if(this.isDisposed===!0)return;let t=Qn.asKey(e);this.documents.has(t)||(this.documents.set(t,e,ot.Touch.Last),this.trigger())}remove(e){let t=Qn.asKey(e);this.documents.delete(t),this.documents.size===0?this.stop():t===this.endDocumentKey()&&(this.endDocument=this.documents.last)}trigger(){if(this.isDisposed!==!0){if(this.intervalHandle!==void 0){this.endDocument=this.documents.last;return}this.endDocument=this.documents.last,this.intervalHandle=(0,ot.RAL)().timer.setInterval(()=>{let e=this.documents.first;if(e!==void 0){let t=Qn.asKey(e);this.diagnosticRequestor.pull(e),this.documents.set(t,e,ot.Touch.Last),t===this.endDocumentKey()&&this.stop()}},200)}}dispose(){this.isDisposed=!0,this.stop(),this.documents.clear()}stop(){this.intervalHandle?.dispose(),this.intervalHandle=void 0,this.endDocument=void 0}endDocumentKey(){return this.endDocument!==void 0?Qn.asKey(this.endDocument):void 0}},Wu=class{constructor(e,t,n){let r=e.clientOptions.diagnosticPullOptions??{onChange:!0,onSave:!1},s=e.protocol2CodeConverter.asDocumentSelector(n.documentSelector),o=[],a=y=>{let T=n.documentSelector;if(r.match!==void 0)return r.match(T,y);for(let C of T)if(ot.TextDocumentFilter.is(C)){if(typeof C=="string"||C.language!==void 0&&C.language!=="*"||C.scheme!==void 0&&C.scheme!=="*"&&C.scheme!==y.scheme)return!1;if(C.pattern!==void 0){let S=new MC.Minimatch(C.pattern,{noext:!0});if(!S.makeRe()||!S.match(y.fsPath))return!1}}return!0},c=y=>y instanceof Re.Uri?a(y):Re.languages.match(s,y)>0&&t.isVisible(y),u=y=>y instanceof Re.Uri?this.activeTextDocument?.uri.toString()===y.toString():this.activeTextDocument===y;this.diagnosticRequestor=new $u(e,t,n),this.backgroundScheduler=new ju(this.diagnosticRequestor);let p=y=>{!c(y)||!n.interFileDependencies||u(y)||this.backgroundScheduler.add(y)};this.activeTextDocument=Re.window.activeTextEditor?.document,Re.window.onDidChangeActiveTextEditor(y=>{let T=this.activeTextDocument;this.activeTextDocument=y?.document,T!==void 0&&p(T),this.activeTextDocument!==void 0&&this.backgroundScheduler.remove(this.activeTextDocument)});let m=e.getFeature(ot.DidOpenTextDocumentNotification.method);o.push(m.onNotificationSent(y=>{let T=y.textDocument;this.diagnosticRequestor.knows(mt.document,T)||c(T)&&this.diagnosticRequestor.pull(T,()=>{p(T)})})),t.onOpen(y=>{for(let T of y){if(this.diagnosticRequestor.knows(mt.document,T))continue;let C=T.toString(),S;for(let P of Re.workspace.textDocuments)if(C===P.uri.toString()){S=P;break}S!==void 0&&c(S)?this.diagnosticRequestor.pull(S,()=>{p(S)}):c(T)&&this.diagnosticRequestor.pull(T,()=>{p(T)})}});let g=new Set;for(let y of Re.workspace.textDocuments)c(y)&&(this.diagnosticRequestor.pull(y,()=>{p(y)}),g.add(y.uri.toString()));if(r.onTabs===!0)for(let y of t.getTabResources())!g.has(y.toString())&&c(y)&&this.diagnosticRequestor.pull(y,()=>{p(y)});if(r.onChange===!0){let y=e.getFeature(ot.DidChangeTextDocumentNotification.method);o.push(y.onNotificationSent(async T=>{let C=T.textDocument;(r.filter===void 0||!r.filter(C,Mu.onType))&&this.diagnosticRequestor.knows(mt.document,C)&&this.diagnosticRequestor.pull(C,()=>{this.backgroundScheduler.trigger()})}))}if(r.onSave===!0){let y=e.getFeature(ot.DidSaveTextDocumentNotification.method);o.push(y.onNotificationSent(T=>{let C=T.textDocument;(r.filter===void 0||!r.filter(C,Mu.onSave))&&this.diagnosticRequestor.knows(mt.document,C)&&this.diagnosticRequestor.pull(T.textDocument,()=>{this.backgroundScheduler.trigger()})}))}let w=e.getFeature(ot.DidCloseTextDocumentNotification.method);o.push(w.onNotificationSent(y=>{this.cleanUpDocument(y.textDocument)})),t.onClose(y=>{for(let T of y)this.cleanUpDocument(T)}),this.diagnosticRequestor.onDidChangeDiagnosticsEmitter.event(()=>{for(let y of Re.workspace.textDocuments)c(y)&&this.diagnosticRequestor.pull(y)}),n.workspaceDiagnostics===!0&&n.identifier!=="da348dc5-c30a-4515-9d98-31ff3be38d14"&&this.diagnosticRequestor.pullWorkspace(),this.disposable=Re.Disposable.from(...o,this.backgroundScheduler,this.diagnosticRequestor)}get onDidChangeDiagnosticsEmitter(){return this.diagnosticRequestor.onDidChangeDiagnosticsEmitter}get diagnostics(){return this.diagnosticRequestor.provider}cleanUpDocument(e){this.diagnosticRequestor.knows(mt.document,e)&&(this.diagnosticRequestor.forgetDocument(e),this.backgroundScheduler.remove(e))}},Hu=class extends Lu.TextDocumentLanguageFeature{constructor(e){super(e,ot.DocumentDiagnosticRequest.type)}fillClientCapabilities(e){let t=eo(eo(e,"textDocument"),"diagnostic");t.dynamicRegistration=!0,t.relatedDocumentSupport=!1,eo(eo(e,"workspace"),"diagnostics").refreshSupport=!0}initialize(e,t){this._client.onRequest(ot.DiagnosticRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeDiagnosticsEmitter.fire()});let[r,s]=this.getRegistration(t,e.diagnosticProvider);!r||!s||this.register({id:r,registerOptions:s})}dispose(){this.tabs!==void 0&&(this.tabs.dispose(),this.tabs=void 0),super.dispose()}registerLanguageProvider(e){this.tabs===void 0&&(this.tabs=new Nu);let t=new Wu(this._client,this.tabs,e);return[t.disposable,t]}};Fn.DiagnosticFeature=Hu});var Fp=F(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.NotebookDocumentSyncFeature=void 0;var qt=require("vscode"),AC=Ys(),Jn=ce(),$C=tt(),Ip=un();function Op(i,e){return i[e]===void 0&&(i[e]={}),i[e]}var rr;(function(i){let e;(function(t){function n(g,w){return{version:g.version,uri:w.asUri(g.uri)}}t.asVersionedNotebookDocumentIdentifier=n;function r(g,w,y){let T=Jn.NotebookDocument.create(y.asUri(g.uri),g.notebookType,g.version,s(w,y));return Object.keys(g.metadata).length>0&&(T.metadata=o(g.metadata)),T}t.asNotebookDocument=r;function s(g,w){return g.map(y=>a(y,w))}t.asNotebookCells=s;function o(g){return u(new Set,g)}t.asMetadata=o;function a(g,w){let y=Jn.NotebookCell.create(c(g.kind),w.asUri(g.document.uri));return Object.keys(g.metadata).length>0&&(y.metadata=o(g.metadata)),g.executionSummary!==void 0&&Ip.number(g.executionSummary.executionOrder)&&Ip.boolean(g.executionSummary.success)&&(y.executionSummary={executionOrder:g.executionSummary.executionOrder,success:g.executionSummary.success}),y}t.asNotebookCell=a;function c(g){switch(g){case qt.NotebookCellKind.Markup:return Jn.NotebookCellKind.Markup;case qt.NotebookCellKind.Code:return Jn.NotebookCellKind.Code}}function u(g,w){if(g.has(w))throw new Error("Can't deep copy cyclic structures.");if(Array.isArray(w)){let y=[];for(let T of w)if(T!==null&&typeof T=="object"||Array.isArray(T))y.push(u(g,T));else{if(T instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");y.push(T)}return y}else{let y=Object.keys(w),T=Object.create(null);for(let C of y){let S=w[C];if(S!==null&&typeof S=="object"||Array.isArray(S))T[C]=u(g,S);else{if(S instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");T[C]=S}}return T}}function p(g,w){let y=w.asChangeTextDocumentParams(g,g.document.uri,g.document.version);return{document:y.textDocument,changes:y.contentChanges}}t.asTextContentChange=p;function m(g,w){let y=Object.create(null);if(g.metadata&&(y.metadata=i.c2p.asMetadata(g.metadata)),g.cells!==void 0){let T=Object.create(null),C=g.cells;C.structure&&(T.structure={array:{start:C.structure.array.start,deleteCount:C.structure.array.deleteCount,cells:C.structure.array.cells!==void 0?C.structure.array.cells.map(S=>i.c2p.asNotebookCell(S,w)):void 0},didOpen:C.structure.didOpen!==void 0?C.structure.didOpen.map(S=>w.asOpenTextDocumentParams(S.document).textDocument):void 0,didClose:C.structure.didClose!==void 0?C.structure.didClose.map(S=>w.asCloseTextDocumentParams(S.document).textDocument):void 0}),C.data!==void 0&&(T.data=C.data.map(S=>i.c2p.asNotebookCell(S,w))),C.textContent!==void 0&&(T.textContent=C.textContent.map(S=>i.c2p.asTextContentChange(S,w))),Object.keys(T).length>0&&(y.cells=T)}return y}t.asNotebookDocumentChangeEvent=m})(e=i.c2p||(i.c2p={}))})(rr||(rr={}));var Ku;(function(i){function e(a,c,u){let p=a.length,m=c.length,g=0;for(;g<m&&g<p&&t(a[g],c[g],u);)g++;if(g<m&&g<p){let w=p-1,y=m-1;for(;w>=0&&y>=0&&t(a[w],c[y],u);)w--,y--;let T=w+1-g,C=g===y+1?void 0:c.slice(g,y+1);return C!==void 0?{start:g,deleteCount:T,cells:C}:{start:g,deleteCount:T}}else return g<m?{start:g,deleteCount:0,cells:c.slice(g)}:g<p?{start:g,deleteCount:p-g}:void 0}i.computeDiff=e;function t(a,c,u=!0){return a.kind!==c.kind||a.document.uri.toString()!==c.document.uri.toString()||a.document.languageId!==c.document.languageId||!n(a.executionSummary,c.executionSummary)?!1:!u||u&&s(a.metadata,c.metadata)}function n(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.executionOrder===c.executionOrder&&a.success===c.success&&r(a.timing,c.timing)}function r(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.startTime===c.startTime&&a.endTime===c.endTime}function s(a,c){if(a===c)return!0;if(a==null||c===null||c===void 0||typeof a!=typeof c||typeof a!="object")return!1;let u=Array.isArray(a),p=Array.isArray(c);if(u!==p)return!1;if(u&&p){if(a.length!==c.length)return!1;for(let m=0;m<a.length;m++)if(!s(a[m],c[m]))return!1}if(o(a)&&o(c)){let m=Object.keys(a),g=Object.keys(c);if(m.length!==g.length||(m.sort(),g.sort(),!s(m,g)))return!1;for(let w=0;w<m.length;w++){let y=m[w];if(!s(a[y],c[y]))return!1}return!0}return!1}function o(a){return a!==null&&typeof a=="object"}i.isObjectLiteral=o})(Ku||(Ku={}));var zu;(function(i){function e(t,n){if(typeof t=="string")return t==="*"||n.notebookType===t;if(t.notebookType!==void 0&&t.notebookType!=="*"&&n.notebookType!==t.notebookType)return!1;let r=n.uri;if(t.scheme!==void 0&&t.scheme!=="*"&&r.scheme!==t.scheme)return!1;if(t.pattern!==void 0){let s=new AC.Minimatch(t.pattern,{noext:!0});if(!s.makeRe()||!s.match(r.fsPath))return!1}return!0}i.matchNotebook=e})(zu||(zu={}));var to;(function(i){function e(n){let r=n.notebookSelector,s=[];for(let o of r){let a=(typeof o.notebook=="string"?o.notebook:o.notebook?.notebookType)??"*",c=typeof o.notebook=="string"?void 0:o.notebook?.scheme,u=typeof o.notebook=="string"?void 0:o.notebook?.pattern;if(o.cells!==void 0)for(let p of o.cells)s.push(t(a,c,u,p.language));else s.push(t(a,c,u,void 0))}return s}i.asDocumentSelector=e;function t(n,r,s,o){return r===void 0&&s===void 0?{notebook:n,language:o}:{notebook:{notebookType:n,scheme:r,pattern:s},language:o}}})(to||(to={}));var no;(function(i){function e(t){return{cells:t,uris:new Set(t.map(n=>n.document.uri.toString()))}}i.create=e})(no||(no={}));var sr=class{constructor(e,t){this.client=e,this.options=t,this.notebookSyncInfo=new Map,this.notebookDidOpen=new Set,this.disposables=[],this.selector=e.protocol2CodeConverter.asDocumentSelector(to.asDocumentSelector(t)),qt.workspace.onDidOpenNotebookDocument(n=>{this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n)},void 0,this.disposables);for(let n of qt.workspace.notebookDocuments)this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n);qt.workspace.onDidChangeNotebookDocument(n=>this.didChangeNotebookDocument(n),void 0,this.disposables),this.options.save===!0&&qt.workspace.onDidSaveNotebookDocument(n=>this.didSave(n),void 0,this.disposables),qt.workspace.onDidCloseNotebookDocument(n=>{this.didClose(n),this.notebookDidOpen.delete(n.uri.toString())},void 0,this.disposables)}getState(){for(let e of qt.workspace.notebookDocuments)if(this.getMatchingCells(e)!==void 0)return{kind:"document",id:"$internal",registrations:!0,matches:!0};return{kind:"document",id:"$internal",registrations:!0,matches:!1}}get mode(){return"notebook"}handles(e){return qt.languages.match(this.selector,e)>0}didOpenNotebookCellTextDocument(e,t){if(qt.languages.match(this.selector,t.document)===0||!this.notebookDidOpen.has(e.uri.toString()))return;let n=this.notebookSyncInfo.get(e.uri.toString()),r=this.cellMatches(e,t);if(n!==void 0){let s=n.uris.has(t.document.uri.toString());if(r&&s||!r&&!s)return;if(r){let o=this.getMatchingCells(e);if(o!==void 0){let a=this.asNotebookDocumentChangeEvent(e,void 0,n,o);a!==void 0&&this.doSendChange(a,o).catch(()=>{})}}}else r&&this.doSendOpen(e,[t]).catch(()=>{})}didChangeNotebookCellTextDocument(e,t){qt.languages.match(this.selector,t.document)!==0&&this.doSendChange({notebook:e,cells:{textContent:[t]}},void 0).catch(()=>{})}didCloseNotebookCellTextDocument(e,t){let n=this.notebookSyncInfo.get(e.uri.toString());if(n===void 0)return;let r=t.document.uri,s=n.cells.findIndex(o=>o.document.uri.toString()===r.toString());if(s!==-1)if(s===0&&n.cells.length===1)this.doSendClose(e,n.cells).catch(()=>{});else{let o=n.cells.slice(),a=o.splice(s,1);this.doSendChange({notebook:e,cells:{structure:{array:{start:s,deleteCount:1},didClose:a}}},o).catch(()=>{})}}dispose(){for(let e of this.disposables)e.dispose()}didOpen(e,t=this.getMatchingCells(e),n=this.notebookSyncInfo.get(e.uri.toString())){if(n!==void 0)if(t!==void 0){let r=this.asNotebookDocumentChangeEvent(e,void 0,n,t);r!==void 0&&this.doSendChange(r,t).catch(()=>{})}else this.doSendClose(e,[]).catch(()=>{});else{if(t===void 0)return;this.doSendOpen(e,t).catch(()=>{})}}didChangeNotebookDocument(e){let t=e.notebook,n=this.notebookSyncInfo.get(t.uri.toString());if(n===void 0){if(e.contentChanges.length===0)return;let r=this.getMatchingCells(t);if(r===void 0)return;this.didOpen(t,r,n)}else{let r=this.getMatchingCells(t);if(r===void 0){this.didClose(t,n);return}let s=this.asNotebookDocumentChangeEvent(e.notebook,e,n,r);s!==void 0&&this.doSendChange(s,r).catch(()=>{})}}didSave(e){this.notebookSyncInfo.get(e.uri.toString())!==void 0&&this.doSendSave(e).catch(()=>{})}didClose(e,t=this.notebookSyncInfo.get(e.uri.toString())){if(t===void 0)return;let n=e.getCells().filter(r=>t.uris.has(r.document.uri.toString()));this.doSendClose(e,n).catch(()=>{})}async sendDidOpenNotebookDocument(e){let t=this.getMatchingCells(e);if(t!==void 0)return this.doSendOpen(e,t)}async doSendOpen(e,t){let n=async(s,o)=>{let a=rr.c2p.asNotebookDocument(s,o,this.client.code2ProtocolConverter),c=o.map(u=>this.client.code2ProtocolConverter.asTextDocumentItem(u.document));try{await this.client.sendNotification(Jn.DidOpenNotebookDocumentNotification.type,{notebookDocument:a,cellTextDocuments:c})}catch(u){throw this.client.error("Sending DidOpenNotebookDocumentNotification failed",u),u}},r=this.client.middleware?.notebooks;return this.notebookSyncInfo.set(e.uri.toString(),no.create(t)),r?.didOpen!==void 0?r.didOpen(e,t,n):n(e,t)}async sendDidChangeNotebookDocument(e){return this.doSendChange(e,void 0)}async doSendChange(e,t=this.getMatchingCells(e.notebook)){let n=async s=>{try{await this.client.sendNotification(Jn.DidChangeNotebookDocumentNotification.type,{notebookDocument:rr.c2p.asVersionedNotebookDocumentIdentifier(s.notebook,this.client.code2ProtocolConverter),change:rr.c2p.asNotebookDocumentChangeEvent(s,this.client.code2ProtocolConverter)})}catch(o){throw this.client.error("Sending DidChangeNotebookDocumentNotification failed",o),o}},r=this.client.middleware?.notebooks;return e.cells?.structure!==void 0&&this.notebookSyncInfo.set(e.notebook.uri.toString(),no.create(t??[])),r?.didChange!==void 0?r?.didChange(e,n):n(e)}async sendDidSaveNotebookDocument(e){return this.doSendSave(e)}async doSendSave(e){let t=async r=>{try{await this.client.sendNotification(Jn.DidSaveNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(r.uri)}})}catch(s){throw this.client.error("Sending DidSaveNotebookDocumentNotification failed",s),s}},n=this.client.middleware?.notebooks;return n?.didSave!==void 0?n.didSave(e,t):t(e)}async sendDidCloseNotebookDocument(e){return this.doSendClose(e,this.getMatchingCells(e)??[])}async doSendClose(e,t){let n=async(s,o)=>{try{await this.client.sendNotification(Jn.DidCloseNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(s.uri)},cellTextDocuments:o.map(a=>this.client.code2ProtocolConverter.asTextDocumentIdentifier(a.document))})}catch(a){throw this.client.error("Sending DidCloseNotebookDocumentNotification failed",a),a}},r=this.client.middleware?.notebooks;return this.notebookSyncInfo.delete(e.uri.toString()),r?.didClose!==void 0?r.didClose(e,t,n):n(e,t)}asNotebookDocumentChangeEvent(e,t,n,r){if(t!==void 0&&t.notebook!==e)throw new Error("Notebook must be identical");let s={notebook:e};t?.metadata!==void 0&&(s.metadata=rr.c2p.asMetadata(t.metadata));let o;if(t?.cellChanges!==void 0&&t.cellChanges.length>0){let a=[];o=new Set(r.map(c=>c.document.uri.toString()));for(let c of t.cellChanges)o.has(c.cell.document.uri.toString())&&(c.executionSummary!==void 0||c.metadata!==void 0)&&a.push(c.cell);a.length>0&&(s.cells=s.cells??{},s.cells.data=a)}if((t?.contentChanges!==void 0&&t.contentChanges.length>0||t===void 0)&&n!==void 0&&r!==void 0){let a=n.cells,c=r,u=Ku.computeDiff(a,c,!1),p,m;if(u!==void 0){p=u.cells===void 0?new Map:new Map(u.cells.map(y=>[y.document.uri.toString(),y])),m=u.deleteCount===0?new Map:new Map(a.slice(u.start,u.start+u.deleteCount).map(y=>[y.document.uri.toString(),y]));for(let y of Array.from(m.keys()))p.has(y)&&(m.delete(y),p.delete(y));s.cells=s.cells??{};let g=[],w=[];if(p.size>0||m.size>0){for(let y of p.values())g.push(y);for(let y of m.values())w.push(y)}s.cells.structure={array:u,didOpen:g,didClose:w}}}return Object.keys(s).length>1?s:void 0}getMatchingCells(e,t=e.getCells()){if(this.options.notebookSelector!==void 0){for(let n of this.options.notebookSelector)if(n.notebook===void 0||zu.matchNotebook(n.notebook,e)){let r=this.filterCells(e,t,n.cells);return r.length===0?void 0:r}}}cellMatches(e,t){let n=this.getMatchingCells(e,[t]);return n!==void 0&&n[0]===t}filterCells(e,t,n){let r=n!==void 0?t.filter(s=>{let o=s.document.languageId;return n.some(a=>a.language==="*"||o===a.language)}):t;return typeof this.client.clientOptions.notebookDocumentOptions?.filterCells=="function"?this.client.clientOptions.notebookDocumentOptions.filterCells(e,r):r}},io=class i{constructor(e){this.client=e,this.registrations=new Map,this.registrationType=Jn.NotebookDocumentSyncRegistrationType.type,qt.workspace.onDidOpenTextDocument(t=>{if(t.uri.scheme!==i.CellScheme)return;let[n,r]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||r===void 0))for(let s of this.registrations.values())s instanceof sr&&s.didOpenNotebookCellTextDocument(n,r)}),qt.workspace.onDidChangeTextDocument(t=>{if(t.contentChanges.length===0)return;let n=t.document;if(n.uri.scheme!==i.CellScheme)return;let[r]=this.findNotebookDocumentAndCell(n);if(r!==void 0)for(let s of this.registrations.values())s instanceof sr&&s.didChangeNotebookCellTextDocument(r,t)}),qt.workspace.onDidCloseTextDocument(t=>{if(t.uri.scheme!==i.CellScheme)return;let[n,r]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||r===void 0))for(let s of this.registrations.values())s instanceof sr&&s.didCloseNotebookCellTextDocument(n,r)})}getState(){if(this.registrations.size===0)return{kind:"document",id:this.registrationType.method,registrations:!1,matches:!1};for(let e of this.registrations.values()){let t=e.getState();if(t.kind==="document"&&t.registrations===!0&&t.matches===!0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!1}}fillClientCapabilities(e){let t=Op(Op(e,"notebookDocument"),"synchronization");t.dynamicRegistration=!0,t.executionSummarySupport=!0}preInitialize(e){let t=e.notebookDocumentSync;t!==void 0&&(this.dedicatedChannel=this.client.protocol2CodeConverter.asDocumentSelector(to.asDocumentSelector(t)))}initialize(e){let t=e.notebookDocumentSync;if(t===void 0)return;let n=t.id??$C.generateUuid();this.register({id:n,registerOptions:t})}register(e){let t=new sr(this.client,e.registerOptions);this.registrations.set(e.id,t)}unregister(e){let t=this.registrations.get(e);t&&t.dispose()}dispose(){for(let e of this.registrations.values())e.dispose();this.registrations.clear()}handles(e){if(e.uri.scheme!==i.CellScheme)return!1;if(this.dedicatedChannel!==void 0&&qt.languages.match(this.dedicatedChannel,e)>0)return!0;for(let t of this.registrations.values())if(t.handles(e))return!0;return!1}getProvider(e){for(let t of this.registrations.values())if(t.handles(e.document))return t}findNotebookDocumentAndCell(e){let t=e.uri.toString();for(let n of qt.workspace.notebookDocuments)for(let r of n.getCells())if(r.document.uri.toString()===t)return[n,r];return[void 0,void 0]}};ro.NotebookDocumentSyncFeature=io;io.CellScheme="vscode-notebook-cell"});var Mp=F(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.SyncConfigurationFeature=vi.toJSONObject=vi.ConfigurationFeature=void 0;var or=require("vscode"),Kr=ce(),jC=un(),WC=tt(),Lp=_e(),Bu=class{constructor(e){this._client=e}getState(){return{kind:"static"}}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.configuration=!0}initialize(){let e=this._client;e.onRequest(Kr.ConfigurationRequest.type,(t,n)=>{let r=o=>{let a=[];for(let c of o.items){let u=c.scopeUri!==void 0&&c.scopeUri!==null?this._client.protocol2CodeConverter.asUri(c.scopeUri):void 0;a.push(this.getConfiguration(u,c.section!==null?c.section:void 0))}return a},s=e.middleware.workspace;return s&&s.configuration?s.configuration(t,n,r):r(t,n)})}getConfiguration(e,t){let n=null;if(t){let r=t.lastIndexOf(".");if(r===-1)n=Fi(or.workspace.getConfiguration(void 0,e).get(t));else{let s=or.workspace.getConfiguration(t.substr(0,r),e);s&&(n=Fi(s.get(t.substr(r+1))))}}else{let r=or.workspace.getConfiguration(void 0,e);n={};for(let s of Object.keys(r))r.has(s)&&(n[s]=Fi(r.get(s)))}return n===void 0&&(n=null),n}dispose(){}};vi.ConfigurationFeature=Bu;function Fi(i){if(i){if(Array.isArray(i))return i.map(Fi);if(typeof i=="object"){let e=Object.create(null);for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=Fi(i[t]));return e}}return i}vi.toJSONObject=Fi;var Vu=class{constructor(e){this._client=e,this.isDisposed=!1,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Kr.DidChangeConfigurationNotification.type}fillClientCapabilities(e){(0,Lp.ensure)((0,Lp.ensure)(e,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){let e=this._client.clientOptions.synchronize?.configurationSection;e!==void 0&&this.register({id:WC.generateUuid(),registerOptions:{section:e}})}register(e){let t=or.workspace.onDidChangeConfiguration(n=>{this.onDidChangeConfiguration(e.registerOptions.section,n)});this._listeners.set(e.id,t),e.registerOptions.section!==void 0&&this.onDidChangeConfiguration(e.registerOptions.section,void 0)}unregister(e){let t=this._listeners.get(e);t&&(this._listeners.delete(e),t.dispose())}dispose(){for(let e of this._listeners.values())e.dispose();this._listeners.clear(),this.isDisposed=!0}onDidChangeConfiguration(e,t){if(this.isDisposed)return;let n;if(jC.string(e)?n=[e]:n=e,n!==void 0&&t!==void 0&&!n.some(a=>t.affectsConfiguration(a)))return;let r=async o=>o===void 0?this._client.sendNotification(Kr.DidChangeConfigurationNotification.type,{settings:null}):this._client.sendNotification(Kr.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(o)}),s=this._client.middleware.workspace?.didChangeConfiguration;(s?s(n,r):r(n)).catch(o=>{this._client.error(`Sending notification ${Kr.DidChangeConfigurationNotification.type.method} failed`,o)})}extractSettingsInformation(e){function t(s,o){let a=s;for(let c=0;c<o.length-1;c++){let u=a[o[c]];u||(u=Object.create(null),a[o[c]]=u),a=u}return a}let n=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,r=Object.create(null);for(let s=0;s<e.length;s++){let o=e[s],a=o.indexOf("."),c=null;if(a>=0?c=or.workspace.getConfiguration(o.substr(0,a),n).get(o.substr(a+1)):c=or.workspace.getConfiguration(void 0,n).get(o),c){let u=e[s].split(".");t(r,u)[u[u.length-1]]=Fi(c)}}return r}};vi.SyncConfigurationFeature=Vu});var Np=F(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.DidSaveTextDocumentFeature=Xt.WillSaveWaitUntilFeature=Xt.WillSaveFeature=Xt.DidChangeTextDocumentFeature=Xt.DidCloseTextDocumentFeature=Xt.DidOpenTextDocumentFeature=void 0;var nn=require("vscode"),$e=ce(),nt=_e(),ar=tt(),Gu=class extends nt.TextDocumentEventFeature{constructor(e,t){super(e,nn.workspace.onDidOpenTextDocument,$e.DidOpenTextDocumentNotification.type,()=>e.middleware.didOpen,n=>e.code2ProtocolConverter.asOpenTextDocumentParams(n),n=>n,nt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t}get openDocuments(){return this._syncedDocuments.values()}fillClientCapabilities(e){(0,nt.ensure)((0,nt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:ar.generateUuid(),registerOptions:{documentSelector:t}})}get registrationType(){return $e.DidOpenTextDocumentNotification.type}register(e){if(super.register(e),!e.registerOptions.documentSelector)return;let t=this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector);nn.workspace.textDocuments.forEach(n=>{let r=n.uri.toString();if(!this._syncedDocuments.has(r)&&nn.languages.match(t,n)>0&&!this._client.hasDedicatedTextSynchronizationFeature(n)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));(s.didOpen?s.didOpen(n,o):o(n)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)}),this._syncedDocuments.set(r,n)}})}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.set(e.uri.toString(),e),super.notificationSent(e,t,n)}};Xt.DidOpenTextDocumentFeature=Gu;var Xu=class extends nt.TextDocumentEventFeature{constructor(e,t,n){super(e,nn.workspace.onDidCloseTextDocument,$e.DidCloseTextDocumentNotification.type,()=>e.middleware.didClose,r=>e.code2ProtocolConverter.asCloseTextDocumentParams(r),r=>r,nt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t,this._pendingTextDocumentChanges=n}get registrationType(){return $e.DidCloseTextDocumentNotification.type}fillClientCapabilities(e){(0,nt.ensure)((0,nt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:ar.generateUuid(),registerOptions:{documentSelector:t}})}async callback(e){await super.callback(e),this._pendingTextDocumentChanges.delete(e.uri.toString())}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.delete(e.uri.toString()),super.notificationSent(e,t,n)}unregister(e){let t=this._selectors.get(e);super.unregister(e);let n=this._selectors.values();this._syncedDocuments.forEach(r=>{if(nn.languages.match(t,r)>0&&!this._selectorFilter(n,r)&&!this._client.hasDedicatedTextSynchronizationFeature(r)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));this._syncedDocuments.delete(r.uri.toString()),(s.didClose?s.didClose(r,o):o(r)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)})}})}};Xt.DidCloseTextDocumentFeature=Xu;var Qu=class extends nt.DynamicDocumentFeature{constructor(e,t){super(e),this._changeData=new Map,this._onNotificationSent=new nn.EventEmitter,this._onPendingChangeAdded=new nn.EventEmitter,this._pendingTextDocumentChanges=t,this._syncKind=$e.TextDocumentSyncKind.None}get onNotificationSent(){return this._onNotificationSent.event}get onPendingChangeAdded(){return this._onPendingChangeAdded.event}get syncKind(){return this._syncKind}get registrationType(){return $e.DidChangeTextDocumentNotification.type}fillClientCapabilities(e){(0,nt.ensure)((0,nt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.change!==void 0&&n.change!==$e.TextDocumentSyncKind.None&&this.register({id:ar.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},{syncKind:n.change})})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=nn.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(e.id,{syncKind:e.registerOptions.syncKind,documentSelector:this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)}),this.updateSyncKind(e.registerOptions.syncKind))}*getDocumentSelectors(){for(let e of this._changeData.values())yield e.documentSelector}async callback(e){if(e.contentChanges.length===0)return;let t=e.document.uri,n=e.document.version,r=[];for(let s of this._changeData.values())if(nn.languages.match(s.documentSelector,e.document)>0&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let o=this._client.middleware;if(s.syncKind===$e.TextDocumentSyncKind.Incremental){let a=async c=>{let u=this._client.code2ProtocolConverter.asChangeTextDocumentParams(c,t,n);await this._client.sendNotification($e.DidChangeTextDocumentNotification.type,u),this.notificationSent(c.document,$e.DidChangeTextDocumentNotification.type,u)};r.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}else if(s.syncKind===$e.TextDocumentSyncKind.Full){let a=async c=>{let u=c.document.uri.toString();this._pendingTextDocumentChanges.set(u,c.document),this._onPendingChangeAdded.fire()};r.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}}return Promise.all(r).then(void 0,s=>{throw this._client.error(`Sending document notification ${$e.DidChangeTextDocumentNotification.type.method} failed`,s),s})}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){if(this._changeData.delete(e),this._changeData.size===0)this._listener&&(this._listener.dispose(),this._listener=void 0),this._syncKind=$e.TextDocumentSyncKind.None;else{this._syncKind=$e.TextDocumentSyncKind.None;for(let t of this._changeData.values())if(this.updateSyncKind(t.syncKind),this._syncKind===$e.TextDocumentSyncKind.Full)break}}dispose(){this._pendingTextDocumentChanges.clear(),this._changeData.clear(),this._syncKind=$e.TextDocumentSyncKind.None,this._listener&&(this._listener.dispose(),this._listener=void 0)}getPendingDocumentChanges(e){if(this._pendingTextDocumentChanges.size===0)return[];let t;if(e.size===0)t=Array.from(this._pendingTextDocumentChanges.values()),this._pendingTextDocumentChanges.clear();else{t=[];for(let n of this._pendingTextDocumentChanges)e.has(n[0])||(t.push(n[1]),this._pendingTextDocumentChanges.delete(n[0]))}return t}getProvider(e){for(let t of this._changeData.values())if(nn.languages.match(t.documentSelector,e)>0)return{send:n=>this.callback(n)}}updateSyncKind(e){if(this._syncKind!==$e.TextDocumentSyncKind.Full)switch(e){case $e.TextDocumentSyncKind.Full:this._syncKind=e;break;case $e.TextDocumentSyncKind.Incremental:this._syncKind===$e.TextDocumentSyncKind.None&&(this._syncKind=$e.TextDocumentSyncKind.Incremental);break}}};Xt.DidChangeTextDocumentFeature=Qu;var Ju=class extends nt.TextDocumentEventFeature{constructor(e){super(e,nn.workspace.onWillSaveTextDocument,$e.WillSaveTextDocumentNotification.type,()=>e.middleware.willSave,t=>e.code2ProtocolConverter.asWillSaveTextDocumentParams(t),t=>t.document,(t,n)=>nt.TextDocumentEventFeature.textDocumentFilter(t,n.document))}get registrationType(){return $e.WillSaveTextDocumentNotification.type}fillClientCapabilities(e){let t=(0,nt.ensure)((0,nt.ensure)(e,"textDocument"),"synchronization");t.willSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSave&&this.register({id:ar.generateUuid(),registerOptions:{documentSelector:t}})}getTextDocument(e){return e.document}};Xt.WillSaveFeature=Ju;var Zu=class extends nt.DynamicDocumentFeature{constructor(e){super(e),this._selectors=new Map}getDocumentSelectors(){return this._selectors.values()}get registrationType(){return $e.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(e){let t=(0,nt.ensure)((0,nt.ensure)(e,"textDocument"),"synchronization");t.willSaveWaitUntil=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSaveWaitUntil&&this.register({id:ar.generateUuid(),registerOptions:{documentSelector:t}})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=nn.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}callback(e){if(nt.TextDocumentEventFeature.textDocumentFilter(this._selectors.values(),e.document)&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let t=this._client.middleware,n=r=>this._client.sendRequest($e.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(r)).then(async s=>{let o=await this._client.protocol2CodeConverter.asTextEdits(s);return o===void 0?[]:o});e.waitUntil(t.willSaveWaitUntil?t.willSaveWaitUntil(e,n):n(e))}}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}};Xt.WillSaveWaitUntilFeature=Zu;var Yu=class extends nt.TextDocumentEventFeature{constructor(e){super(e,nn.workspace.onDidSaveTextDocument,$e.DidSaveTextDocumentNotification.type,()=>e.middleware.didSave,t=>e.code2ProtocolConverter.asSaveTextDocumentParams(t,this._includeText),t=>t,nt.TextDocumentEventFeature.textDocumentFilter),this._includeText=!1}get registrationType(){return $e.DidSaveTextDocumentNotification.type}fillClientCapabilities(e){(0,nt.ensure)((0,nt.ensure)(e,"textDocument"),"synchronization").didSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;if(t&&n&&n.save){let r=typeof n.save=="boolean"?{includeText:!1}:{includeText:!!n.save.includeText};this.register({id:ar.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},r)})}}register(e){this._includeText=!!e.registerOptions.includeText,super.register(e)}getTextDocument(e){return e}};Xt.DidSaveTextDocumentFeature=Yu});var Ap=F(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.CompletionItemFeature=void 0;var HC=require("vscode"),we=ce(),el=_e(),UC=tt(),KC=[we.CompletionItemKind.Text,we.CompletionItemKind.Method,we.CompletionItemKind.Function,we.CompletionItemKind.Constructor,we.CompletionItemKind.Field,we.CompletionItemKind.Variable,we.CompletionItemKind.Class,we.CompletionItemKind.Interface,we.CompletionItemKind.Module,we.CompletionItemKind.Property,we.CompletionItemKind.Unit,we.CompletionItemKind.Value,we.CompletionItemKind.Enum,we.CompletionItemKind.Keyword,we.CompletionItemKind.Snippet,we.CompletionItemKind.Color,we.CompletionItemKind.File,we.CompletionItemKind.Reference,we.CompletionItemKind.Folder,we.CompletionItemKind.EnumMember,we.CompletionItemKind.Constant,we.CompletionItemKind.Struct,we.CompletionItemKind.Event,we.CompletionItemKind.Operator,we.CompletionItemKind.TypeParameter],tl=class extends el.TextDocumentLanguageFeature{constructor(e){super(e,we.CompletionRequest.type),this.labelDetailsSupport=new Map}fillClientCapabilities(e){let t=(0,el.ensure)((0,el.ensure)(e,"textDocument"),"completion");t.dynamicRegistration=!0,t.contextSupport=!0,t.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[we.MarkupKind.Markdown,we.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0,tagSupport:{valueSet:[we.CompletionItemTag.Deprecated]},insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]},insertTextModeSupport:{valueSet:[we.InsertTextMode.asIs,we.InsertTextMode.adjustIndentation]},labelDetailsSupport:!0},t.insertTextMode=we.InsertTextMode.adjustIndentation,t.completionItemKind={valueSet:KC},t.completionList={itemDefaults:["commitCharacters","editRange","insertTextFormat","insertTextMode"]}}initialize(e,t){let n=this.getRegistrationOptions(t,e.completionProvider);n&&this.register({id:UC.generateUuid(),registerOptions:n})}registerLanguageProvider(e,t){this.labelDetailsSupport.set(t,!!e.completionItem?.labelDetailsSupport);let n=e.triggerCharacters??[],r=e.allCommitCharacters,s=e.documentSelector,o={provideCompletionItems:(a,c,u,p)=>{let m=this._client,g=this._client.middleware,w=(y,T,C,S)=>m.sendRequest(we.CompletionRequest.type,m.code2ProtocolConverter.asCompletionParams(y,T,C),S).then(P=>S.isCancellationRequested?null:m.protocol2CodeConverter.asCompletionResult(P,r,S),P=>m.handleFailedRequest(we.CompletionRequest.type,S,P,null));return g.provideCompletionItem?g.provideCompletionItem(a,c,p,u,w):w(a,c,p,u)},resolveCompletionItem:e.resolveProvider?(a,c)=>{let u=this._client,p=this._client.middleware,m=(g,w)=>u.sendRequest(we.CompletionResolveRequest.type,u.code2ProtocolConverter.asCompletionItem(g,!!this.labelDetailsSupport.get(t)),w).then(y=>w.isCancellationRequested?null:u.protocol2CodeConverter.asCompletionItem(y),y=>u.handleFailedRequest(we.CompletionResolveRequest.type,w,y,g));return p.resolveCompletionItem?p.resolveCompletionItem(a,c,m):m(a,c)}:void 0};return[HC.languages.registerCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(s),o,...n),o]}};so.CompletionItemFeature=tl});var $p=F(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.HoverFeature=void 0;var zC=require("vscode"),zr=ce(),nl=_e(),BC=tt(),il=class extends nl.TextDocumentLanguageFeature{constructor(e){super(e,zr.HoverRequest.type)}fillClientCapabilities(e){let t=(0,nl.ensure)((0,nl.ensure)(e,"textDocument"),"hover");t.dynamicRegistration=!0,t.contentFormat=[zr.MarkupKind.Markdown,zr.MarkupKind.PlainText]}initialize(e,t){let n=this.getRegistrationOptions(t,e.hoverProvider);n&&this.register({id:BC.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideHover:(r,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(zr.HoverRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(w=>g.isCancellationRequested?null:a.protocol2CodeConverter.asHover(w),w=>a.handleFailedRequest(zr.HoverRequest.type,g,w,null)),u=a.middleware;return u.provideHover?u.provideHover(r,s,o,c):c(r,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return zC.languages.registerHoverProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};oo.HoverFeature=il});var jp=F(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.DefinitionFeature=void 0;var VC=require("vscode"),rl=ce(),sl=_e(),GC=tt(),ol=class extends sl.TextDocumentLanguageFeature{constructor(e){super(e,rl.DefinitionRequest.type)}fillClientCapabilities(e){let t=(0,sl.ensure)((0,sl.ensure)(e,"textDocument"),"definition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.definitionProvider);n&&this.register({id:GC.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDefinition:(r,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(rl.DefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(w=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(w,g),w=>a.handleFailedRequest(rl.DefinitionRequest.type,g,w,null)),u=a.middleware;return u.provideDefinition?u.provideDefinition(r,s,o,c):c(r,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return VC.languages.registerDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};ao.DefinitionFeature=ol});var Hp=F(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.SignatureHelpFeature=void 0;var Wp=require("vscode"),Br=ce(),al=_e(),XC=tt(),cl=class extends al.TextDocumentLanguageFeature{constructor(e){super(e,Br.SignatureHelpRequest.type)}fillClientCapabilities(e){let t=(0,al.ensure)((0,al.ensure)(e,"textDocument"),"signatureHelp");t.dynamicRegistration=!0,t.signatureInformation={documentationFormat:[Br.MarkupKind.Markdown,Br.MarkupKind.PlainText]},t.signatureInformation.parameterInformation={labelOffsetSupport:!0},t.signatureInformation.activeParameterSupport=!0,t.contextSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.signatureHelpProvider);n&&this.register({id:XC.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t={provideSignatureHelp:(n,r,s,o)=>{let a=this._client,c=(p,m,g,w)=>a.sendRequest(Br.SignatureHelpRequest.type,a.code2ProtocolConverter.asSignatureHelpParams(p,m,g),w).then(y=>w.isCancellationRequested?null:a.protocol2CodeConverter.asSignatureHelp(y,w),y=>a.handleFailedRequest(Br.SignatureHelpRequest.type,w,y,null)),u=a.middleware;return u.provideSignatureHelp?u.provideSignatureHelp(n,r,o,s,c):c(n,r,o,s)}};return[this.registerProvider(e,t),t]}registerProvider(e,t){let n=this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector);if(e.retriggerCharacters===void 0){let r=e.triggerCharacters||[];return Wp.languages.registerSignatureHelpProvider(n,t,...r)}else{let r={triggerCharacters:e.triggerCharacters||[],retriggerCharacters:e.retriggerCharacters||[]};return Wp.languages.registerSignatureHelpProvider(n,t,r)}}};co.SignatureHelpFeature=cl});var Up=F(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.DocumentHighlightFeature=void 0;var QC=require("vscode"),ul=ce(),ll=_e(),JC=tt(),dl=class extends ll.TextDocumentLanguageFeature{constructor(e){super(e,ul.DocumentHighlightRequest.type)}fillClientCapabilities(e){(0,ll.ensure)((0,ll.ensure)(e,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentHighlightProvider);n&&this.register({id:JC.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentHighlights:(r,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(ul.DocumentHighlightRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(w=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDocumentHighlights(w,g),w=>a.handleFailedRequest(ul.DocumentHighlightRequest.type,g,w,null)),u=a.middleware;return u.provideDocumentHighlights?u.provideDocumentHighlights(r,s,o,c):c(r,s,o)}};return[QC.languages.registerDocumentHighlightProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};uo.DocumentHighlightFeature=dl});var pl=F(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.DocumentSymbolFeature=Ln.SupportedSymbolTags=Ln.SupportedSymbolKinds=void 0;var ZC=require("vscode"),xe=ce(),fl=_e(),YC=tt();Ln.SupportedSymbolKinds=[xe.SymbolKind.File,xe.SymbolKind.Module,xe.SymbolKind.Namespace,xe.SymbolKind.Package,xe.SymbolKind.Class,xe.SymbolKind.Method,xe.SymbolKind.Property,xe.SymbolKind.Field,xe.SymbolKind.Constructor,xe.SymbolKind.Enum,xe.SymbolKind.Interface,xe.SymbolKind.Function,xe.SymbolKind.Variable,xe.SymbolKind.Constant,xe.SymbolKind.String,xe.SymbolKind.Number,xe.SymbolKind.Boolean,xe.SymbolKind.Array,xe.SymbolKind.Object,xe.SymbolKind.Key,xe.SymbolKind.Null,xe.SymbolKind.EnumMember,xe.SymbolKind.Struct,xe.SymbolKind.Event,xe.SymbolKind.Operator,xe.SymbolKind.TypeParameter];Ln.SupportedSymbolTags=[xe.SymbolTag.Deprecated];var hl=class extends fl.TextDocumentLanguageFeature{constructor(e){super(e,xe.DocumentSymbolRequest.type)}fillClientCapabilities(e){let t=(0,fl.ensure)((0,fl.ensure)(e,"textDocument"),"documentSymbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:Ln.SupportedSymbolKinds},t.hierarchicalDocumentSymbolSupport=!0,t.tagSupport={valueSet:Ln.SupportedSymbolTags},t.labelSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentSymbolProvider);n&&this.register({id:YC.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentSymbols:(s,o)=>{let a=this._client,c=async(p,m)=>{try{let g=await a.sendRequest(xe.DocumentSymbolRequest.type,a.code2ProtocolConverter.asDocumentSymbolParams(p),m);if(m.isCancellationRequested||g===void 0||g===null)return null;if(g.length===0)return[];{let w=g[0];return xe.DocumentSymbol.is(w)?await a.protocol2CodeConverter.asDocumentSymbols(g,m):await a.protocol2CodeConverter.asSymbolInformations(g,m)}}catch(g){return a.handleFailedRequest(xe.DocumentSymbolRequest.type,m,g,null)}},u=a.middleware;return u.provideDocumentSymbols?u.provideDocumentSymbols(s,o,c):c(s,o)}},r=e.label!==void 0?{label:e.label}:void 0;return[ZC.languages.registerDocumentSymbolProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,r),n]}};Ln.DocumentSymbolFeature=hl});var zp=F(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.WorkspaceSymbolFeature=void 0;var eS=require("vscode"),Vr=ce(),gl=_e(),Kp=pl(),tS=tt(),ml=class extends gl.WorkspaceFeature{constructor(e){super(e,Vr.WorkspaceSymbolRequest.type)}fillClientCapabilities(e){let t=(0,gl.ensure)((0,gl.ensure)(e,"workspace"),"symbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:Kp.SupportedSymbolKinds},t.tagSupport={valueSet:Kp.SupportedSymbolTags},t.resolveSupport={properties:["location.range"]}}initialize(e){e.workspaceSymbolProvider&&this.register({id:tS.generateUuid(),registerOptions:e.workspaceSymbolProvider===!0?{workDoneProgress:!1}:e.workspaceSymbolProvider})}registerLanguageProvider(e){let t={provideWorkspaceSymbols:(n,r)=>{let s=this._client,o=(c,u)=>s.sendRequest(Vr.WorkspaceSymbolRequest.type,{query:c},u).then(p=>u.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformations(p,u),p=>s.handleFailedRequest(Vr.WorkspaceSymbolRequest.type,u,p,null)),a=s.middleware;return a.provideWorkspaceSymbols?a.provideWorkspaceSymbols(n,r,o):o(n,r)},resolveWorkspaceSymbol:e.resolveProvider===!0?(n,r)=>{let s=this._client,o=(c,u)=>s.sendRequest(Vr.WorkspaceSymbolResolveRequest.type,s.code2ProtocolConverter.asWorkspaceSymbol(c),u).then(p=>u.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformation(p),p=>s.handleFailedRequest(Vr.WorkspaceSymbolResolveRequest.type,u,p,null)),a=s.middleware;return a.resolveWorkspaceSymbol?a.resolveWorkspaceSymbol(n,r,o):o(n,r)}:void 0};return[eS.languages.registerWorkspaceSymbolProvider(t),t]}};lo.WorkspaceSymbolFeature=ml});var Bp=F(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.ReferencesFeature=void 0;var nS=require("vscode"),vl=ce(),yl=_e(),iS=tt(),bl=class extends yl.TextDocumentLanguageFeature{constructor(e){super(e,vl.ReferencesRequest.type)}fillClientCapabilities(e){(0,yl.ensure)((0,yl.ensure)(e,"textDocument"),"references").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.referencesProvider);n&&this.register({id:iS.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideReferences:(r,s,o,a)=>{let c=this._client,u=(m,g,w,y)=>c.sendRequest(vl.ReferencesRequest.type,c.code2ProtocolConverter.asReferenceParams(m,g,w),y).then(T=>y.isCancellationRequested?null:c.protocol2CodeConverter.asReferences(T,y),T=>c.handleFailedRequest(vl.ReferencesRequest.type,y,T,null)),p=c.middleware;return p.provideReferences?p.provideReferences(r,s,o,a,u):u(r,s,o,a)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return nS.languages.registerReferenceProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};fo.ReferencesFeature=bl});var Vp=F(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.CodeActionFeature=void 0;var rS=require("vscode"),rn=ce(),sS=tt(),wl=_e(),Cl=class extends wl.TextDocumentLanguageFeature{constructor(e){super(e,rn.CodeActionRequest.type)}fillClientCapabilities(e){let t=(0,wl.ensure)((0,wl.ensure)(e,"textDocument"),"codeAction");t.dynamicRegistration=!0,t.isPreferredSupport=!0,t.disabledSupport=!0,t.dataSupport=!0,t.resolveSupport={properties:["edit"]},t.codeActionLiteralSupport={codeActionKind:{valueSet:[rn.CodeActionKind.Empty,rn.CodeActionKind.QuickFix,rn.CodeActionKind.Refactor,rn.CodeActionKind.RefactorExtract,rn.CodeActionKind.RefactorInline,rn.CodeActionKind.RefactorRewrite,rn.CodeActionKind.Source,rn.CodeActionKind.SourceOrganizeImports]}},t.honorsChangeAnnotations=!1}initialize(e,t){let n=this.getRegistrationOptions(t,e.codeActionProvider);n&&this.register({id:sS.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideCodeActions:(r,s,o,a)=>{let c=this._client,u=async(m,g,w,y)=>{let T={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g),context:await c.code2ProtocolConverter.asCodeActionContext(w,y)};return c.sendRequest(rn.CodeActionRequest.type,T,y).then(C=>y.isCancellationRequested||C===null||C===void 0?null:c.protocol2CodeConverter.asCodeActionResult(C,y),C=>c.handleFailedRequest(rn.CodeActionRequest.type,y,C,null))},p=c.middleware;return p.provideCodeActions?p.provideCodeActions(r,s,o,a,u):u(r,s,o,a)},resolveCodeAction:e.resolveProvider?(r,s)=>{let o=this._client,a=this._client.middleware,c=async(u,p)=>o.sendRequest(rn.CodeActionResolveRequest.type,await o.code2ProtocolConverter.asCodeAction(u,p),p).then(m=>p.isCancellationRequested?u:o.protocol2CodeConverter.asCodeAction(m,p),m=>o.handleFailedRequest(rn.CodeActionResolveRequest.type,p,m,u));return a.resolveCodeAction?a.resolveCodeAction(r,s,c):c(r,s)}:void 0};return[rS.languages.registerCodeActionsProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.codeActionKinds?{providedCodeActionKinds:this._client.protocol2CodeConverter.asCodeActionKinds(e.codeActionKinds)}:void 0),n]}};ho.CodeActionFeature=Cl});var Xp=F(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.CodeLensFeature=void 0;var Gp=require("vscode"),cr=ce(),oS=tt(),Gr=_e(),Sl=class extends Gr.TextDocumentLanguageFeature{constructor(e){super(e,cr.CodeLensRequest.type)}fillClientCapabilities(e){(0,Gr.ensure)((0,Gr.ensure)(e,"textDocument"),"codeLens").dynamicRegistration=!0,(0,Gr.ensure)((0,Gr.ensure)(e,"workspace"),"codeLens").refreshSupport=!0}initialize(e,t){this._client.onRequest(cr.CodeLensRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeCodeLensEmitter.fire()});let r=this.getRegistrationOptions(t,e.codeLensProvider);r&&this.register({id:oS.generateUuid(),registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n=new Gp.EventEmitter,r={onDidChangeCodeLenses:n.event,provideCodeLenses:(s,o)=>{let a=this._client,c=(p,m)=>a.sendRequest(cr.CodeLensRequest.type,a.code2ProtocolConverter.asCodeLensParams(p),m).then(g=>m.isCancellationRequested?null:a.protocol2CodeConverter.asCodeLenses(g,m),g=>a.handleFailedRequest(cr.CodeLensRequest.type,m,g,null)),u=a.middleware;return u.provideCodeLenses?u.provideCodeLenses(s,o,c):c(s,o)},resolveCodeLens:e.resolveProvider?(s,o)=>{let a=this._client,c=(p,m)=>a.sendRequest(cr.CodeLensResolveRequest.type,a.code2ProtocolConverter.asCodeLens(p),m).then(g=>m.isCancellationRequested?p:a.protocol2CodeConverter.asCodeLens(g),g=>a.handleFailedRequest(cr.CodeLensResolveRequest.type,m,g,p)),u=a.middleware;return u.resolveCodeLens?u.resolveCodeLens(s,o,c):c(s,o)}:void 0};return[Gp.languages.registerCodeLensProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),r),{provider:r,onDidChangeCodeLensEmitter:n}]}};po.CodeLensFeature=Sl});var Qp=F(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.DocumentOnTypeFormattingFeature=yi.DocumentRangeFormattingFeature=yi.DocumentFormattingFeature=void 0;var go=require("vscode"),Zn=ce(),Tl=tt(),Yn=_e(),Xr;(function(i){function e(t){let n=go.workspace.getConfiguration("files",t);return{trimTrailingWhitespace:n.get("trimTrailingWhitespace"),trimFinalNewlines:n.get("trimFinalNewlines"),insertFinalNewline:n.get("insertFinalNewline")}}i.fromConfiguration=e})(Xr||(Xr={}));var Rl=class extends Yn.TextDocumentLanguageFeature{constructor(e){super(e,Zn.DocumentFormattingRequest.type)}fillClientCapabilities(e){(0,Yn.ensure)((0,Yn.ensure)(e,"textDocument"),"formatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentFormattingProvider);n&&this.register({id:Tl.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentFormattingEdits:(r,s,o)=>{let a=this._client,c=(p,m,g)=>{let w={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),options:a.code2ProtocolConverter.asFormattingOptions(m,Xr.fromConfiguration(p))};return a.sendRequest(Zn.DocumentFormattingRequest.type,w,g).then(y=>g.isCancellationRequested?null:a.protocol2CodeConverter.asTextEdits(y,g),y=>a.handleFailedRequest(Zn.DocumentFormattingRequest.type,g,y,null))},u=a.middleware;return u.provideDocumentFormattingEdits?u.provideDocumentFormattingEdits(r,s,o,c):c(r,s,o)}};return[go.languages.registerDocumentFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};yi.DocumentFormattingFeature=Rl;var Dl=class extends Yn.TextDocumentLanguageFeature{constructor(e){super(e,Zn.DocumentRangeFormattingRequest.type)}fillClientCapabilities(e){(0,Yn.ensure)((0,Yn.ensure)(e,"textDocument"),"rangeFormatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentRangeFormattingProvider);n&&this.register({id:Tl.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentRangeFormattingEdits:(r,s,o,a)=>{let c=this._client,u=(m,g,w,y)=>{let T={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g),options:c.code2ProtocolConverter.asFormattingOptions(w,Xr.fromConfiguration(m))};return c.sendRequest(Zn.DocumentRangeFormattingRequest.type,T,y).then(C=>y.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(C,y),C=>c.handleFailedRequest(Zn.DocumentRangeFormattingRequest.type,y,C,null))},p=c.middleware;return p.provideDocumentRangeFormattingEdits?p.provideDocumentRangeFormattingEdits(r,s,o,a,u):u(r,s,o,a)}};return[go.languages.registerDocumentRangeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};yi.DocumentRangeFormattingFeature=Dl;var _l=class extends Yn.TextDocumentLanguageFeature{constructor(e){super(e,Zn.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(e){(0,Yn.ensure)((0,Yn.ensure)(e,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentOnTypeFormattingProvider);n&&this.register({id:Tl.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideOnTypeFormattingEdits:(s,o,a,c,u)=>{let p=this._client,m=(w,y,T,C,S)=>{let P={textDocument:p.code2ProtocolConverter.asTextDocumentIdentifier(w),position:p.code2ProtocolConverter.asPosition(y),ch:T,options:p.code2ProtocolConverter.asFormattingOptions(C,Xr.fromConfiguration(w))};return p.sendRequest(Zn.DocumentOnTypeFormattingRequest.type,P,S).then(x=>S.isCancellationRequested?null:p.protocol2CodeConverter.asTextEdits(x,S),x=>p.handleFailedRequest(Zn.DocumentOnTypeFormattingRequest.type,S,x,null))},g=p.middleware;return g.provideOnTypeFormattingEdits?g.provideOnTypeFormattingEdits(s,o,a,c,u,m):m(s,o,a,c,u)}},r=e.moreTriggerCharacter||[];return[go.languages.registerOnTypeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.firstTriggerCharacter,...r),n]}};yi.DocumentOnTypeFormattingFeature=_l});var Zp=F(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});mo.RenameFeature=void 0;var aS=require("vscode"),Li=ce(),cS=tt(),Jp=un(),Pl=_e(),kl=class extends Pl.TextDocumentLanguageFeature{constructor(e){super(e,Li.RenameRequest.type)}fillClientCapabilities(e){let t=(0,Pl.ensure)((0,Pl.ensure)(e,"textDocument"),"rename");t.dynamicRegistration=!0,t.prepareSupport=!0,t.prepareSupportDefaultBehavior=Li.PrepareSupportDefaultBehavior.Identifier,t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.renameProvider);n&&(Jp.boolean(e.renameProvider)&&(n.prepareProvider=!1),this.register({id:cS.generateUuid(),registerOptions:n}))}registerLanguageProvider(e){let t=e.documentSelector,n={provideRenameEdits:(r,s,o,a)=>{let c=this._client,u=(m,g,w,y)=>{let T={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),position:c.code2ProtocolConverter.asPosition(g),newName:w};return c.sendRequest(Li.RenameRequest.type,T,y).then(C=>y.isCancellationRequested?null:c.protocol2CodeConverter.asWorkspaceEdit(C,y),C=>c.handleFailedRequest(Li.RenameRequest.type,y,C,null,!1))},p=c.middleware;return p.provideRenameEdits?p.provideRenameEdits(r,s,o,a,u):u(r,s,o,a)},prepareRename:e.prepareProvider?(r,s,o)=>{let a=this._client,c=(p,m,g)=>{let w={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),position:a.code2ProtocolConverter.asPosition(m)};return a.sendRequest(Li.PrepareRenameRequest.type,w,g).then(y=>g.isCancellationRequested?null:Li.Range.is(y)?a.protocol2CodeConverter.asRange(y):this.isDefaultBehavior(y)?y.defaultBehavior===!0?null:Promise.reject(new Error("The element can't be renamed.")):y&&Li.Range.is(y.range)?{range:a.protocol2CodeConverter.asRange(y.range),placeholder:y.placeholder}:Promise.reject(new Error("The element can't be renamed.")),y=>{throw typeof y.message=="string"?new Error(y.message):new Error("The element can't be renamed.")})},u=a.middleware;return u.prepareRename?u.prepareRename(r,s,o,c):c(r,s,o)}:void 0};return[this.registerProvider(t,n),n]}registerProvider(e,t){return aS.languages.registerRenameProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}isDefaultBehavior(e){let t=e;return t&&Jp.boolean(t.defaultBehavior)}};mo.RenameFeature=kl});var Yp=F(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.DocumentLinkFeature=void 0;var uS=require("vscode"),Qr=ce(),El=_e(),lS=tt(),xl=class extends El.TextDocumentLanguageFeature{constructor(e){super(e,Qr.DocumentLinkRequest.type)}fillClientCapabilities(e){let t=(0,El.ensure)((0,El.ensure)(e,"textDocument"),"documentLink");t.dynamicRegistration=!0,t.tooltipSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentLinkProvider);n&&this.register({id:lS.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentLinks:(r,s)=>{let o=this._client,a=(u,p)=>o.sendRequest(Qr.DocumentLinkRequest.type,o.code2ProtocolConverter.asDocumentLinkParams(u),p).then(m=>p.isCancellationRequested?null:o.protocol2CodeConverter.asDocumentLinks(m,p),m=>o.handleFailedRequest(Qr.DocumentLinkRequest.type,p,m,null)),c=o.middleware;return c.provideDocumentLinks?c.provideDocumentLinks(r,s,a):a(r,s)},resolveDocumentLink:e.resolveProvider?(r,s)=>{let o=this._client,a=(u,p)=>o.sendRequest(Qr.DocumentLinkResolveRequest.type,o.code2ProtocolConverter.asDocumentLink(u),p).then(m=>p.isCancellationRequested?u:o.protocol2CodeConverter.asDocumentLink(m),m=>o.handleFailedRequest(Qr.DocumentLinkResolveRequest.type,p,m,u)),c=o.middleware;return c.resolveDocumentLink?c.resolveDocumentLink(r,s,a):a(r,s)}:void 0};return[uS.languages.registerDocumentLinkProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};vo.DocumentLinkFeature=xl});var tg=F(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.ExecuteCommandFeature=void 0;var dS=require("vscode"),ql=ce(),fS=tt(),eg=_e(),Il=class{constructor(e){this._client=e,this._commands=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._commands.size>0}}get registrationType(){return ql.ExecuteCommandRequest.type}fillClientCapabilities(e){(0,eg.ensure)((0,eg.ensure)(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:fS.generateUuid(),registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){let t=this._client,n=t.middleware,r=(s,o)=>{let a={command:s,arguments:o};return t.sendRequest(ql.ExecuteCommandRequest.type,a).then(void 0,c=>t.handleFailedRequest(ql.ExecuteCommandRequest.type,void 0,c,void 0))};if(e.registerOptions.commands){let s=[];for(let o of e.registerOptions.commands)s.push(dS.commands.registerCommand(o,(...a)=>n.executeCommand?n.executeCommand(o,a,r):r(o,a)));this._commands.set(e.id,s)}}unregister(e){let t=this._commands.get(e);t&&t.forEach(n=>n.dispose())}dispose(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}};yo.ExecuteCommandFeature=Il});var ng=F(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.FileSystemWatcherFeature=void 0;var hS=require("vscode"),Mi=ce(),bo=_e(),Ol=class{constructor(e,t){this._client=e,this._notifyFileEvent=t,this._watchers=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._watchers.size>0}}get registrationType(){return Mi.DidChangeWatchedFilesNotification.type}fillClientCapabilities(e){(0,bo.ensure)((0,bo.ensure)(e,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0,(0,bo.ensure)((0,bo.ensure)(e,"workspace"),"didChangeWatchedFiles").relativePatternSupport=!0}initialize(e,t){}register(e){if(!Array.isArray(e.registerOptions.watchers))return;let t=[];for(let n of e.registerOptions.watchers){let r=this._client.protocol2CodeConverter.asGlobPattern(n.globPattern);if(r===void 0)continue;let s=!0,o=!0,a=!0;n.kind!==void 0&&n.kind!==null&&(s=(n.kind&Mi.WatchKind.Create)!==0,o=(n.kind&Mi.WatchKind.Change)!==0,a=(n.kind&Mi.WatchKind.Delete)!==0);let c=hS.workspace.createFileSystemWatcher(r,!s,!o,!a);this.hookListeners(c,s,o,a,t),t.push(c)}this._watchers.set(e.id,t)}registerRaw(e,t){let n=[];for(let r of t)this.hookListeners(r,!0,!0,!0,n);this._watchers.set(e,n)}hookListeners(e,t,n,r,s){t&&e.onDidCreate(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Mi.FileChangeType.Created}),null,s),n&&e.onDidChange(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Mi.FileChangeType.Changed}),null,s),r&&e.onDidDelete(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Mi.FileChangeType.Deleted}),null,s)}unregister(e){let t=this._watchers.get(e);if(t)for(let n of t)n.dispose()}dispose(){this._watchers.forEach(e=>{for(let t of e)t.dispose()}),this._watchers.clear()}};wo.FileSystemWatcherFeature=Ol});var ig=F(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.ColorProviderFeature=void 0;var pS=require("vscode"),Jr=ce(),Fl=_e(),Ll=class extends Fl.TextDocumentLanguageFeature{constructor(e){super(e,Jr.DocumentColorRequest.type)}fillClientCapabilities(e){(0,Fl.ensure)((0,Fl.ensure)(e,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.colorProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n={provideColorPresentations:(r,s,o)=>{let a=this._client,c=(p,m,g)=>{let w={color:p,textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(m.document),range:a.code2ProtocolConverter.asRange(m.range)};return a.sendRequest(Jr.ColorPresentationRequest.type,w,g).then(y=>g.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorPresentations(y,g),y=>a.handleFailedRequest(Jr.ColorPresentationRequest.type,g,y,null))},u=a.middleware;return u.provideColorPresentations?u.provideColorPresentations(r,s,o,c):c(r,s,o)},provideDocumentColors:(r,s)=>{let o=this._client,a=(u,p)=>{let m={textDocument:o.code2ProtocolConverter.asTextDocumentIdentifier(u)};return o.sendRequest(Jr.DocumentColorRequest.type,m,p).then(g=>p.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorInformations(g,p),g=>o.handleFailedRequest(Jr.DocumentColorRequest.type,p,g,null))},c=o.middleware;return c.provideDocumentColors?c.provideDocumentColors(r,s,a):a(r,s)}};return[pS.languages.registerColorProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Co.ColorProviderFeature=Ll});var rg=F(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.ImplementationFeature=void 0;var gS=require("vscode"),Ml=ce(),Nl=_e(),Al=class extends Nl.TextDocumentLanguageFeature{constructor(e){super(e,Ml.ImplementationRequest.type)}fillClientCapabilities(e){let t=(0,Nl.ensure)((0,Nl.ensure)(e,"textDocument"),"implementation");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.implementationProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n={provideImplementation:(r,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(Ml.ImplementationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(w=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(w,g),w=>a.handleFailedRequest(Ml.ImplementationRequest.type,g,w,null)),u=a.middleware;return u.provideImplementation?u.provideImplementation(r,s,o,c):c(r,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return gS.languages.registerImplementationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};So.ImplementationFeature=Al});var sg=F(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.TypeDefinitionFeature=void 0;var mS=require("vscode"),$l=ce(),Zr=_e(),jl=class extends Zr.TextDocumentLanguageFeature{constructor(e){super(e,$l.TypeDefinitionRequest.type)}fillClientCapabilities(e){(0,Zr.ensure)((0,Zr.ensure)(e,"textDocument"),"typeDefinition").dynamicRegistration=!0;let t=(0,Zr.ensure)((0,Zr.ensure)(e,"textDocument"),"typeDefinition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.typeDefinitionProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n={provideTypeDefinition:(r,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest($l.TypeDefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(w=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(w,g),w=>a.handleFailedRequest($l.TypeDefinitionRequest.type,g,w,null)),u=a.middleware;return u.provideTypeDefinition?u.provideTypeDefinition(r,s,o,c):c(r,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return mS.languages.registerTypeDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ro.TypeDefinitionFeature=jl});var og=F(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.WorkspaceFoldersFeature=ur.arrayDiff=void 0;var vS=tt(),Do=require("vscode"),Yr=ce();function Wl(i,e){if(i!=null)return i[e]}function Hl(i,e){return i.filter(t=>e.indexOf(t)<0)}ur.arrayDiff=Hl;var Ul=class{constructor(e){this._client=e,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Yr.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(e){let t=Do.workspace.workspaceFolders;this.initializeWithFolders(t),t===void 0?e.workspaceFolders=null:e.workspaceFolders=t.map(n=>this.asProtocol(n))}initializeWithFolders(e){this._initialFolders=e}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.workspaceFolders=!0}initialize(e){let t=this._client;t.onRequest(Yr.WorkspaceFoldersRequest.type,s=>{let o=()=>{let c=Do.workspace.workspaceFolders;return c===void 0?null:c.map(p=>this.asProtocol(p))},a=t.middleware.workspace;return a&&a.workspaceFolders?a.workspaceFolders(s,o):o(s)});let n=Wl(Wl(Wl(e,"workspace"),"workspaceFolders"),"changeNotifications"),r;typeof n=="string"?r=n:n===!0&&(r=vS.generateUuid()),r&&this.register({id:r,registerOptions:void 0})}sendInitialEvent(e){let t;if(this._initialFolders&&e){let n=Hl(this._initialFolders,e),r=Hl(e,this._initialFolders);(r.length>0||n.length>0)&&(t=this.doSendEvent(r,n))}else this._initialFolders?t=this.doSendEvent([],this._initialFolders):e&&(t=this.doSendEvent(e,[]));t!==void 0&&t.catch(n=>{this._client.error(`Sending notification ${Yr.DidChangeWorkspaceFoldersNotification.type.method} failed`,n)})}doSendEvent(e,t){let n={event:{added:e.map(r=>this.asProtocol(r)),removed:t.map(r=>this.asProtocol(r))}};return this._client.sendNotification(Yr.DidChangeWorkspaceFoldersNotification.type,n)}register(e){let t=e.id,n=this._client,r=Do.workspace.onDidChangeWorkspaceFolders(s=>{let o=u=>this.doSendEvent(u.added,u.removed),a=n.middleware.workspace;(a&&a.didChangeWorkspaceFolders?a.didChangeWorkspaceFolders(s,o):o(s)).catch(u=>{this._client.error(`Sending notification ${Yr.DidChangeWorkspaceFoldersNotification.type.method} failed`,u)})});this._listeners.set(t,r),this.sendInitialEvent(Do.workspace.workspaceFolders)}unregister(e){let t=this._listeners.get(e);t!==void 0&&(this._listeners.delete(e),t.dispose())}dispose(){for(let e of this._listeners.values())e.dispose();this._listeners.clear()}asProtocol(e){return e===void 0?null:{uri:this._client.code2ProtocolConverter.asUri(e.uri),name:e.name}}};ur.WorkspaceFoldersFeature=Ul});var ag=F(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.FoldingRangeFeature=void 0;var yS=require("vscode"),lr=ce(),Kl=_e(),zl=class extends Kl.TextDocumentLanguageFeature{constructor(e){super(e,lr.FoldingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Kl.ensure)((0,Kl.ensure)(e,"textDocument"),"foldingRange");t.dynamicRegistration=!0,t.rangeLimit=5e3,t.lineFoldingOnly=!0,t.foldingRangeKind={valueSet:[lr.FoldingRangeKind.Comment,lr.FoldingRangeKind.Imports,lr.FoldingRangeKind.Region]},t.foldingRange={collapsedText:!1}}initialize(e,t){let[n,r]=this.getRegistration(t,e.foldingRangeProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n={provideFoldingRanges:(r,s,o)=>{let a=this._client,c=(p,m,g)=>{let w={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p)};return a.sendRequest(lr.FoldingRangeRequest.type,w,g).then(y=>g.isCancellationRequested?null:a.protocol2CodeConverter.asFoldingRanges(y,g),y=>a.handleFailedRequest(lr.FoldingRangeRequest.type,g,y,null))},u=a.middleware;return u.provideFoldingRanges?u.provideFoldingRanges(r,s,o,c):c(r,s,o)}};return[yS.languages.registerFoldingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};_o.FoldingRangeFeature=zl});var cg=F(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.DeclarationFeature=void 0;var bS=require("vscode"),Bl=ce(),Vl=_e(),Gl=class extends Vl.TextDocumentLanguageFeature{constructor(e){super(e,Bl.DeclarationRequest.type)}fillClientCapabilities(e){let t=(0,Vl.ensure)((0,Vl.ensure)(e,"textDocument"),"declaration");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.declarationProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDeclaration:(r,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(Bl.DeclarationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(w=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDeclarationResult(w,g),w=>a.handleFailedRequest(Bl.DeclarationRequest.type,g,w,null)),u=a.middleware;return u.provideDeclaration?u.provideDeclaration(r,s,o,c):c(r,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return bS.languages.registerDeclarationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};To.DeclarationFeature=Gl});var ug=F(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.SelectionRangeFeature=void 0;var wS=require("vscode"),Xl=ce(),Ql=_e(),Jl=class extends Ql.TextDocumentLanguageFeature{constructor(e){super(e,Xl.SelectionRangeRequest.type)}fillClientCapabilities(e){let t=(0,Ql.ensure)((0,Ql.ensure)(e,"textDocument"),"selectionRange");t.dynamicRegistration=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.selectionRangeProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n={provideSelectionRanges:(r,s,o)=>{let a=this._client,c=async(p,m,g)=>{let w={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),positions:await a.code2ProtocolConverter.asPositions(m,g)};return a.sendRequest(Xl.SelectionRangeRequest.type,w,g).then(y=>g.isCancellationRequested?null:a.protocol2CodeConverter.asSelectionRanges(y,g),y=>a.handleFailedRequest(Xl.SelectionRangeRequest.type,g,y,null))},u=a.middleware;return u.provideSelectionRanges?u.provideSelectionRanges(r,s,o,c):c(r,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return wS.languages.registerSelectionRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Po.SelectionRangeFeature=Jl});var dg=F(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.ProgressFeature=void 0;var lg=ce(),CS=Su();function SS(i,e){return i[e]===void 0&&(i[e]=Object.create(null)),i[e]}var Zl=class{constructor(e){this._client=e,this.activeParts=new Set}getState(){return{kind:"window",id:lg.WorkDoneProgressCreateRequest.method,registrations:this.activeParts.size>0}}fillClientCapabilities(e){SS(e,"window").workDoneProgress=!0}initialize(){let e=this._client,t=r=>{this.activeParts.delete(r)},n=r=>{this.activeParts.add(new CS.ProgressPart(this._client,r.token,t))};e.onRequest(lg.WorkDoneProgressCreateRequest.type,n)}dispose(){for(let e of this.activeParts)e.done();this.activeParts.clear()}};ko.ProgressFeature=Zl});var fg=F(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.CallHierarchyFeature=void 0;var RS=require("vscode"),Ni=ce(),Yl=_e(),ed=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareCallHierarchy(e,t,n){let r=this.client,s=this.middleware,o=(a,c,u)=>{let p=r.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return r.sendRequest(Ni.CallHierarchyPrepareRequest.type,p,u).then(m=>u.isCancellationRequested?null:r.protocol2CodeConverter.asCallHierarchyItems(m,u),m=>r.handleFailedRequest(Ni.CallHierarchyPrepareRequest.type,u,m,null))};return s.prepareCallHierarchy?s.prepareCallHierarchy(e,t,n,o):o(e,t,n)}provideCallHierarchyIncomingCalls(e,t){let n=this.client,r=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(Ni.CallHierarchyIncomingCallsRequest.type,c,a).then(u=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyIncomingCalls(u,a),u=>n.handleFailedRequest(Ni.CallHierarchyIncomingCallsRequest.type,a,u,null))};return r.provideCallHierarchyIncomingCalls?r.provideCallHierarchyIncomingCalls(e,t,s):s(e,t)}provideCallHierarchyOutgoingCalls(e,t){let n=this.client,r=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(Ni.CallHierarchyOutgoingCallsRequest.type,c,a).then(u=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyOutgoingCalls(u,a),u=>n.handleFailedRequest(Ni.CallHierarchyOutgoingCallsRequest.type,a,u,null))};return r.provideCallHierarchyOutgoingCalls?r.provideCallHierarchyOutgoingCalls(e,t,s):s(e,t)}},td=class extends Yl.TextDocumentLanguageFeature{constructor(e){super(e,Ni.CallHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=e,n=(0,Yl.ensure)((0,Yl.ensure)(t,"textDocument"),"callHierarchy");n.dynamicRegistration=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.callHierarchyProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=this._client,n=new ed(t);return[RS.languages.registerCallHierarchyProvider(this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};Eo.CallHierarchyFeature=td});var hg=F(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.SemanticTokensFeature=void 0;var xo=require("vscode"),ue=ce(),es=_e(),DS=un(),nd=class extends es.TextDocumentLanguageFeature{constructor(e){super(e,ue.SemanticTokensRegistrationType.type)}fillClientCapabilities(e){let t=(0,es.ensure)((0,es.ensure)(e,"textDocument"),"semanticTokens");t.dynamicRegistration=!0,t.tokenTypes=[ue.SemanticTokenTypes.namespace,ue.SemanticTokenTypes.type,ue.SemanticTokenTypes.class,ue.SemanticTokenTypes.enum,ue.SemanticTokenTypes.interface,ue.SemanticTokenTypes.struct,ue.SemanticTokenTypes.typeParameter,ue.SemanticTokenTypes.parameter,ue.SemanticTokenTypes.variable,ue.SemanticTokenTypes.property,ue.SemanticTokenTypes.enumMember,ue.SemanticTokenTypes.event,ue.SemanticTokenTypes.function,ue.SemanticTokenTypes.method,ue.SemanticTokenTypes.macro,ue.SemanticTokenTypes.keyword,ue.SemanticTokenTypes.modifier,ue.SemanticTokenTypes.comment,ue.SemanticTokenTypes.string,ue.SemanticTokenTypes.number,ue.SemanticTokenTypes.regexp,ue.SemanticTokenTypes.operator,ue.SemanticTokenTypes.decorator],t.tokenModifiers=[ue.SemanticTokenModifiers.declaration,ue.SemanticTokenModifiers.definition,ue.SemanticTokenModifiers.readonly,ue.SemanticTokenModifiers.static,ue.SemanticTokenModifiers.deprecated,ue.SemanticTokenModifiers.abstract,ue.SemanticTokenModifiers.async,ue.SemanticTokenModifiers.modification,ue.SemanticTokenModifiers.documentation,ue.SemanticTokenModifiers.defaultLibrary],t.formats=[ue.TokenFormat.Relative],t.requests={range:!0,full:{delta:!0}},t.multilineTokenSupport=!1,t.overlappingTokenSupport=!1,t.serverCancelSupport=!0,t.augmentsSyntaxTokens=!0,(0,es.ensure)((0,es.ensure)(e,"workspace"),"semanticTokens").refreshSupport=!0}initialize(e,t){this._client.onRequest(ue.SemanticTokensRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeSemanticTokensEmitter.fire()});let[r,s]=this.getRegistration(t,e.semanticTokensProvider);!r||!s||this.register({id:r,registerOptions:s})}registerLanguageProvider(e){let t=e.documentSelector,n=DS.boolean(e.full)?e.full:e.full!==void 0,r=e.full!==void 0&&typeof e.full!="boolean"&&e.full.delta===!0,s=new xo.EventEmitter,o=n?{onDidChangeSemanticTokens:s.event,provideDocumentSemanticTokens:(w,y)=>{let T=this._client,C=T.middleware,S=(P,x)=>{let q={textDocument:T.code2ProtocolConverter.asTextDocumentIdentifier(P)};return T.sendRequest(ue.SemanticTokensRequest.type,q,x).then(A=>x.isCancellationRequested?null:T.protocol2CodeConverter.asSemanticTokens(A,x),A=>T.handleFailedRequest(ue.SemanticTokensRequest.type,x,A,null))};return C.provideDocumentSemanticTokens?C.provideDocumentSemanticTokens(w,y,S):S(w,y)},provideDocumentSemanticTokensEdits:r?(w,y,T)=>{let C=this._client,S=C.middleware,P=(x,q,A)=>{let V={textDocument:C.code2ProtocolConverter.asTextDocumentIdentifier(x),previousResultId:q};return C.sendRequest(ue.SemanticTokensDeltaRequest.type,V,A).then(async j=>A.isCancellationRequested?null:ue.SemanticTokens.is(j)?await C.protocol2CodeConverter.asSemanticTokens(j,A):await C.protocol2CodeConverter.asSemanticTokensEdits(j,A),j=>C.handleFailedRequest(ue.SemanticTokensDeltaRequest.type,A,j,null))};return S.provideDocumentSemanticTokensEdits?S.provideDocumentSemanticTokensEdits(w,y,T,P):P(w,y,T)}:void 0}:void 0,c=e.range===!0?{provideDocumentRangeSemanticTokens:(w,y,T)=>{let C=this._client,S=C.middleware,P=(x,q,A)=>{let V={textDocument:C.code2ProtocolConverter.asTextDocumentIdentifier(x),range:C.code2ProtocolConverter.asRange(q)};return C.sendRequest(ue.SemanticTokensRangeRequest.type,V,A).then(j=>A.isCancellationRequested?null:C.protocol2CodeConverter.asSemanticTokens(j,A),j=>C.handleFailedRequest(ue.SemanticTokensRangeRequest.type,A,j,null))};return S.provideDocumentRangeSemanticTokens?S.provideDocumentRangeSemanticTokens(w,y,T,P):P(w,y,T)}}:void 0,u=[],p=this._client,m=p.protocol2CodeConverter.asSemanticTokensLegend(e.legend),g=p.protocol2CodeConverter.asDocumentSelector(t);return o!==void 0&&u.push(xo.languages.registerDocumentSemanticTokensProvider(g,o,m)),c!==void 0&&u.push(xo.languages.registerDocumentRangeSemanticTokensProvider(g,c,m)),[new xo.Disposable(()=>u.forEach(w=>w.dispose())),{range:c,full:o,onDidChangeSemanticTokensEmitter:s}]}};qo.SemanticTokensFeature=nd});var mg=F(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.WillDeleteFilesFeature=Qt.WillRenameFilesFeature=Qt.WillCreateFilesFeature=Qt.DidDeleteFilesFeature=Qt.DidRenameFilesFeature=Qt.DidCreateFilesFeature=void 0;var hn=require("vscode"),_S=Ys(),ei=ce(),TS=tt();function pg(i,e){return i[e]===void 0&&(i[e]={}),i[e]}function PS(i,e){return i[e]}function gg(i,e,t){i[e]=t}var ts=class i{constructor(e,t,n,r,s){this._client=e,this._event=t,this._registrationType=n,this._clientCapability=r,this._serverCapability=s,this._filters=new Map}getState(){return{kind:"workspace",id:this._registrationType.method,registrations:this._filters.size>0}}filterSize(){return this._filters.size}get registrationType(){return this._registrationType}fillClientCapabilities(e){let t=pg(pg(e,"workspace"),"fileOperations");gg(t,"dynamicRegistration",!0),gg(t,this._clientCapability,!0)}initialize(e){let t=e.workspace?.fileOperations,n=t!==void 0?PS(t,this._serverCapability):void 0;if(n?.filters!==void 0)try{this.register({id:TS.generateUuid(),registerOptions:{filters:n.filters}})}catch(r){this._client.warn(`Ignoring invalid glob pattern for ${this._serverCapability} registration: ${r}`)}}register(e){this._listener||(this._listener=this._event(this.send,this));let t=e.registerOptions.filters.map(n=>{let r=new _S.Minimatch(n.pattern.glob,i.asMinimatchOptions(n.pattern.options));if(!r.makeRe())throw new Error(`Invalid pattern ${n.pattern.glob}!`);return{scheme:n.scheme,matcher:r,kind:n.pattern.matches}});this._filters.set(e.id,t)}unregister(e){this._filters.delete(e),this._filters.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._filters.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getFileType(e){return i.getFileType(e)}async filter(e,t){let n=await Promise.all(e.files.map(async s=>{let o=t(s),a=o.fsPath.replace(/\\/g,"/");for(let c of this._filters.values())for(let u of c)if(!(u.scheme!==void 0&&u.scheme!==o.scheme)){if(u.matcher.match(a)){if(u.kind===void 0)return!0;let p=await this.getFileType(o);if(p===void 0)return this._client.error(`Failed to determine file type for ${o.toString()}.`),!0;if(p===hn.FileType.File&&u.kind===ei.FileOperationPatternKind.file||p===hn.FileType.Directory&&u.kind===ei.FileOperationPatternKind.folder)return!0}else if(u.kind===ei.FileOperationPatternKind.folder&&await i.getFileType(o)===hn.FileType.Directory&&u.matcher.match(`${a}/`))return!0}return!1})),r=e.files.filter((s,o)=>n[o]);return{...e,files:r}}static async getFileType(e){try{return(await hn.workspace.fs.stat(e)).type}catch{return}}static asMinimatchOptions(e){if(e!==void 0&&e.ignoreCase===!0)return{nocase:!0}}},Io=class extends ts{constructor(e,t,n,r,s,o,a){super(e,t,n,r,s),this._notificationType=n,this._accessUri=o,this._createParams=a}async send(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=async r=>this._client.sendNotification(this._notificationType,this._createParams(r));return this.doSend(t,n)}}},Oo=class extends Io{constructor(){super(...arguments),this._fsPathFileTypes=new Map}async getFileType(e){let t=e.fsPath;if(this._fsPathFileTypes.has(t))return this._fsPathFileTypes.get(t);let n=await ts.getFileType(e);return n&&this._fsPathFileTypes.set(t,n),n}async cacheFileTypes(e,t){await this.filter(e,t)}clearFileTypeCache(){this._fsPathFileTypes.clear()}unregister(e){super.unregister(e),this.filterSize()===0&&this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}dispose(){super.dispose(),this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}},id=class extends Io{constructor(e){super(e,hn.workspace.onDidCreateFiles,ei.DidCreateFilesNotification.type,"didCreate","didCreate",t=>t,e.code2ProtocolConverter.asDidCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.didCreateFiles?n.didCreateFiles(e,t):t(e)}};Qt.DidCreateFilesFeature=id;var rd=class extends Oo{constructor(e){super(e,hn.workspace.onDidRenameFiles,ei.DidRenameFilesNotification.type,"didRename","didRename",t=>t.oldUri,e.code2ProtocolConverter.asDidRenameFilesParams)}register(e){this._willListener||(this._willListener=hn.workspace.onWillRenameFiles(this.willRename,this)),super.register(e)}willRename(e){e.waitUntil(this.cacheFileTypes(e,t=>t.oldUri))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didRenameFiles?n.didRenameFiles(e,t):t(e)}};Qt.DidRenameFilesFeature=rd;var sd=class extends Oo{constructor(e){super(e,hn.workspace.onDidDeleteFiles,ei.DidDeleteFilesNotification.type,"didDelete","didDelete",t=>t,e.code2ProtocolConverter.asDidDeleteFilesParams)}register(e){this._willListener||(this._willListener=hn.workspace.onWillDeleteFiles(this.willDelete,this)),super.register(e)}willDelete(e){e.waitUntil(this.cacheFileTypes(e,t=>t))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didDeleteFiles?n.didDeleteFiles(e,t):t(e)}};Qt.DidDeleteFilesFeature=sd;var ns=class extends ts{constructor(e,t,n,r,s,o,a){super(e,t,n,r,s),this._requestType=n,this._accessUri=o,this._createParams=a}async send(e){let t=this.waitUntil(e);e.waitUntil(t)}async waitUntil(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=r=>this._client.sendRequest(this._requestType,this._createParams(r),r.token).then(this._client.protocol2CodeConverter.asWorkspaceEdit);return this.doSend(t,n)}else return}},od=class extends ns{constructor(e){super(e,hn.workspace.onWillCreateFiles,ei.WillCreateFilesRequest.type,"willCreate","willCreate",t=>t,e.code2ProtocolConverter.asWillCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willCreateFiles?n.willCreateFiles(e,t):t(e)}};Qt.WillCreateFilesFeature=od;var ad=class extends ns{constructor(e){super(e,hn.workspace.onWillRenameFiles,ei.WillRenameFilesRequest.type,"willRename","willRename",t=>t.oldUri,e.code2ProtocolConverter.asWillRenameFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willRenameFiles?n.willRenameFiles(e,t):t(e)}};Qt.WillRenameFilesFeature=ad;var cd=class extends ns{constructor(e){super(e,hn.workspace.onWillDeleteFiles,ei.WillDeleteFilesRequest.type,"willDelete","willDelete",t=>t,e.code2ProtocolConverter.asWillDeleteFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willDeleteFiles?n.willDeleteFiles(e,t):t(e)}};Qt.WillDeleteFilesFeature=cd});var vg=F(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.LinkedEditingFeature=void 0;var kS=require("vscode"),ud=ce(),ld=_e(),dd=class extends ld.TextDocumentLanguageFeature{constructor(e){super(e,ud.LinkedEditingRangeRequest.type)}fillClientCapabilities(e){let t=(0,ld.ensure)((0,ld.ensure)(e,"textDocument"),"linkedEditingRange");t.dynamicRegistration=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.linkedEditingRangeProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n={provideLinkedEditingRanges:(r,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(ud.LinkedEditingRangeRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(w=>g.isCancellationRequested?null:a.protocol2CodeConverter.asLinkedEditingRanges(w,g),w=>a.handleFailedRequest(ud.LinkedEditingRangeRequest.type,g,w,null)),u=a.middleware;return u.provideLinkedEditingRange?u.provideLinkedEditingRange(r,s,o,c):c(r,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return kS.languages.registerLinkedEditingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Fo.LinkedEditingFeature=dd});var yg=F(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.TypeHierarchyFeature=void 0;var ES=require("vscode"),Ai=ce(),fd=_e(),hd=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareTypeHierarchy(e,t,n){let r=this.client,s=this.middleware,o=(a,c,u)=>{let p=r.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return r.sendRequest(Ai.TypeHierarchyPrepareRequest.type,p,u).then(m=>u.isCancellationRequested?null:r.protocol2CodeConverter.asTypeHierarchyItems(m,u),m=>r.handleFailedRequest(Ai.TypeHierarchyPrepareRequest.type,u,m,null))};return s.prepareTypeHierarchy?s.prepareTypeHierarchy(e,t,n,o):o(e,t,n)}provideTypeHierarchySupertypes(e,t){let n=this.client,r=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(Ai.TypeHierarchySupertypesRequest.type,c,a).then(u=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(u,a),u=>n.handleFailedRequest(Ai.TypeHierarchySupertypesRequest.type,a,u,null))};return r.provideTypeHierarchySupertypes?r.provideTypeHierarchySupertypes(e,t,s):s(e,t)}provideTypeHierarchySubtypes(e,t){let n=this.client,r=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(Ai.TypeHierarchySubtypesRequest.type,c,a).then(u=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(u,a),u=>n.handleFailedRequest(Ai.TypeHierarchySubtypesRequest.type,a,u,null))};return r.provideTypeHierarchySubtypes?r.provideTypeHierarchySubtypes(e,t,s):s(e,t)}},pd=class extends fd.TextDocumentLanguageFeature{constructor(e){super(e,Ai.TypeHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=(0,fd.ensure)((0,fd.ensure)(e,"textDocument"),"typeHierarchy");t.dynamicRegistration=!0}initialize(e,t){let[n,r]=this.getRegistration(t,e.typeHierarchyProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=this._client,n=new hd(t);return[ES.languages.registerTypeHierarchyProvider(t.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};Lo.TypeHierarchyFeature=pd});var wg=F(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.InlineValueFeature=void 0;var bg=require("vscode"),Mo=ce(),is=_e(),gd=class extends is.TextDocumentLanguageFeature{constructor(e){super(e,Mo.InlineValueRequest.type)}fillClientCapabilities(e){(0,is.ensure)((0,is.ensure)(e,"textDocument"),"inlineValue").dynamicRegistration=!0,(0,is.ensure)((0,is.ensure)(e,"workspace"),"inlineValue").refreshSupport=!0}initialize(e,t){this._client.onRequest(Mo.InlineValueRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlineValues.fire()});let[n,r]=this.getRegistration(t,e.inlineValueProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n=new bg.EventEmitter,r={onDidChangeInlineValues:n.event,provideInlineValues:(s,o,a,c)=>{let u=this._client,p=(g,w,y,T)=>{let C={textDocument:u.code2ProtocolConverter.asTextDocumentIdentifier(g),range:u.code2ProtocolConverter.asRange(w),context:u.code2ProtocolConverter.asInlineValueContext(y)};return u.sendRequest(Mo.InlineValueRequest.type,C,T).then(S=>T.isCancellationRequested?null:u.protocol2CodeConverter.asInlineValues(S,T),S=>u.handleFailedRequest(Mo.InlineValueRequest.type,T,S,null))},m=u.middleware;return m.provideInlineValues?m.provideInlineValues(s,o,a,c,p):p(s,o,a,c)}};return[this.registerProvider(t,r),{provider:r,onDidChangeInlineValues:n}]}registerProvider(e,t){return bg.languages.registerInlineValuesProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};No.InlineValueFeature=gd});var Sg=F(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.InlayHintsFeature=void 0;var Cg=require("vscode"),dr=ce(),rs=_e(),md=class extends rs.TextDocumentLanguageFeature{constructor(e){super(e,dr.InlayHintRequest.type)}fillClientCapabilities(e){let t=(0,rs.ensure)((0,rs.ensure)(e,"textDocument"),"inlayHint");t.dynamicRegistration=!0,t.resolveSupport={properties:["tooltip","textEdits","label.tooltip","label.location","label.command"]},(0,rs.ensure)((0,rs.ensure)(e,"workspace"),"inlayHint").refreshSupport=!0}initialize(e,t){this._client.onRequest(dr.InlayHintRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlayHints.fire()});let[n,r]=this.getRegistration(t,e.inlayHintProvider);!n||!r||this.register({id:n,registerOptions:r})}registerLanguageProvider(e){let t=e.documentSelector,n=new Cg.EventEmitter,r={onDidChangeInlayHints:n.event,provideInlayHints:(s,o,a)=>{let c=this._client,u=async(m,g,w)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g)};try{let T=await c.sendRequest(dr.InlayHintRequest.type,y,w);return w.isCancellationRequested?null:c.protocol2CodeConverter.asInlayHints(T,w)}catch(T){return c.handleFailedRequest(dr.InlayHintRequest.type,w,T,null)}},p=c.middleware;return p.provideInlayHints?p.provideInlayHints(s,o,a,u):u(s,o,a)}};return r.resolveInlayHint=e.resolveProvider===!0?(s,o)=>{let a=this._client,c=async(p,m)=>{try{let g=await a.sendRequest(dr.InlayHintResolveRequest.type,a.code2ProtocolConverter.asInlayHint(p),m);if(m.isCancellationRequested)return null;let w=a.protocol2CodeConverter.asInlayHint(g,m);return m.isCancellationRequested?null:w}catch(g){return a.handleFailedRequest(dr.InlayHintResolveRequest.type,m,g,null)}},u=a.middleware;return u.resolveInlayHint?u.resolveInlayHint(s,o,c):c(s,o)}:void 0,[this.registerProvider(t,r),{provider:r,onDidChangeInlayHints:n}]}registerProvider(e,t){return Cg.languages.registerInlayHintsProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ao.InlayHintsFeature=md});var wd=F(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.ProposedFeatures=Be.BaseLanguageClient=Be.MessageTransports=Be.SuspendMode=Be.State=Be.CloseAction=Be.ErrorAction=Be.RevealOutputChannelOn=void 0;var qe=require("vscode"),H=ce(),xS=np(),qS=sp(),Mn=un(),$o=Bs(),Rg=tt(),IS=Su(),Tn=_e(),OS=Uu(),Dg=Fp(),_g=Mp(),fr=Np(),FS=Ap(),LS=$p(),MS=jp(),NS=Hp(),AS=Up(),$S=pl(),jS=zp(),WS=Bp(),HS=Vp(),US=Xp(),vd=Qp(),KS=Zp(),zS=Yp(),BS=tg(),VS=ng(),GS=ig(),XS=rg(),QS=sg(),JS=og(),ZS=ag(),YS=cg(),eR=ug(),tR=dg(),nR=fg(),iR=hg(),hr=mg(),rR=vg(),sR=yg(),oR=wg(),aR=Sg(),ss;(function(i){i[i.Info=1]="Info",i[i.Warn=2]="Warn",i[i.Error=3]="Error",i[i.Never=4]="Never"})(ss=Be.RevealOutputChannelOn||(Be.RevealOutputChannelOn={}));var Wo;(function(i){i[i.Continue=1]="Continue",i[i.Shutdown=2]="Shutdown"})(Wo=Be.ErrorAction||(Be.ErrorAction={}));var $i;(function(i){i[i.DoNotRestart=1]="DoNotRestart",i[i.Restart=2]="Restart"})($i=Be.CloseAction||(Be.CloseAction={}));var jo;(function(i){i[i.Stopped=1]="Stopped",i[i.Starting=3]="Starting",i[i.Running=2]="Running"})(jo=Be.State||(Be.State={}));var cR;(function(i){i.off="off",i.on="on"})(cR=Be.SuspendMode||(Be.SuspendMode={}));var yd=class{constructor(e,t){this.client=e,this.maxRestartCount=t,this.restarts=[]}error(e,t,n){return n&&n<=3?{action:Wo.Continue}:{action:Wo.Shutdown}}closed(){return this.restarts.push(Date.now()),this.restarts.length<=this.maxRestartCount?{action:$i.Restart}:this.restarts[this.restarts.length-1]-this.restarts[0]<=3*60*1e3?{action:$i.DoNotRestart,message:`The ${this.client.name} server crashed ${this.maxRestartCount+1} times in the last 3 minutes. The server will not be restarted. See the output for more information.`}:(this.restarts.shift(),{action:$i.Restart})}},ve;(function(i){i.Initial="initial",i.Starting="starting",i.StartFailed="startFailed",i.Running="running",i.Stopping="stopping",i.Stopped="stopped"})(ve||(ve={}));var uR;(function(i){function e(t){return t&&H.MessageReader.is(t.reader)&&H.MessageWriter.is(t.writer)}i.is=e})(uR=Be.MessageTransports||(Be.MessageTransports={}));var os=class i{constructor(e,t,n){this._traceFormat=H.TraceFormat.Text,this._diagnosticQueue=new Map,this._diagnosticQueueState={state:"idle"},this._features=[],this._dynamicFeatures=new Map,this.workspaceEditLock=new $o.Semaphore(1),this._id=e,this._name=t,n=n||{};let r={isTrusted:!1,supportHtml:!1};n.markdown!==void 0&&(r.isTrusted=n.markdown.isTrusted===!0,r.supportHtml=n.markdown.supportHtml===!0),this._clientOptions={documentSelector:n.documentSelector??[],synchronize:n.synchronize??{},diagnosticCollectionName:n.diagnosticCollectionName,outputChannelName:n.outputChannelName??this._name,revealOutputChannelOn:n.revealOutputChannelOn??ss.Error,stdioEncoding:n.stdioEncoding??"utf8",initializationOptions:n.initializationOptions,initializationFailedHandler:n.initializationFailedHandler,progressOnInitialization:!!n.progressOnInitialization,errorHandler:n.errorHandler??this.createDefaultErrorHandler(n.connectionOptions?.maxRestartCount),middleware:n.middleware??{},uriConverters:n.uriConverters,workspaceFolder:n.workspaceFolder,connectionOptions:n.connectionOptions,markdown:r,diagnosticPullOptions:n.diagnosticPullOptions??{onChange:!0,onSave:!1},notebookDocumentOptions:n.notebookDocumentOptions??{}},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this._state=ve.Initial,this._ignoredRegistrations=new Set,this._listeners=[],this._notificationHandlers=new Map,this._pendingNotificationHandlers=new Map,this._notificationDisposables=new Map,this._requestHandlers=new Map,this._pendingRequestHandlers=new Map,this._requestDisposables=new Map,this._progressHandlers=new Map,this._pendingProgressHandlers=new Map,this._progressDisposables=new Map,this._connection=void 0,this._initializeResult=void 0,n.outputChannel?(this._outputChannel=n.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._traceOutputChannel=n.traceOutputChannel,this._diagnostics=void 0,this._pendingOpenNotifications=new Set,this._pendingChangeSemaphore=new $o.Semaphore(1),this._pendingChangeDelayer=new $o.Delayer(250),this._fileEvents=[],this._fileEventDelayer=new $o.Delayer(250),this._onStop=void 0,this._telemetryEmitter=new H.Emitter,this._stateChangeEmitter=new H.Emitter,this._trace=H.Trace.Off,this._tracer={log:(s,o)=>{Mn.string(s)?this.logTrace(s,o):this.logObjectTrace(s)}},this._c2p=xS.createConverter(n.uriConverters?n.uriConverters.code2Protocol:void 0),this._p2c=qS.createConverter(n.uriConverters?n.uriConverters.protocol2Code:void 0,this._clientOptions.markdown.isTrusted,this._clientOptions.markdown.supportHtml),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get name(){return this._name}get middleware(){return this._clientOptions.middleware??Object.create(null)}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=qe.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get traceOutputChannel(){return this._traceOutputChannel?this._traceOutputChannel:this.outputChannel}get diagnostics(){return this._diagnostics}get state(){return this.getPublicState()}get $state(){return this._state}set $state(e){let t=this.getPublicState();this._state=e;let n=this.getPublicState();n!==t&&this._stateChangeEmitter.fire({oldState:t,newState:n})}getPublicState(){switch(this.$state){case ve.Starting:return jo.Starting;case ve.Running:return jo.Running;default:return jo.Stopped}}get initializeResult(){return this._initializeResult}async sendRequest(e,...t){if(this.$state===ve.StartFailed||this.$state===ve.Stopping||this.$state===ve.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=await this.$start();return this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full&&await this.sendPendingFullTextDocumentChanges(n),n.sendRequest(e,...t)}onRequest(e,t){let n=typeof e=="string"?e:e.method;this._requestHandlers.set(n,t);let r=this.activeConnection(),s;return r!==void 0?(this._requestDisposables.set(n,r.onRequest(e,t)),s={dispose:()=>{let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}):(this._pendingRequestHandlers.set(n,t),s={dispose:()=>{this._pendingRequestHandlers.delete(n);let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}),{dispose:()=>{this._requestHandlers.delete(n),s.dispose()}}}async sendNotification(e,t){if(this.$state===ve.StartFailed||this.$state===ve.Stopping||this.$state===ve.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full,r;n&&typeof e!="string"&&e.method===H.DidOpenTextDocumentNotification.method&&(r=t?.textDocument.uri,this._pendingOpenNotifications.add(r));let s=await this.$start();return n&&await this.sendPendingFullTextDocumentChanges(s),r!==void 0&&this._pendingOpenNotifications.delete(r),s.sendNotification(e,t)}onNotification(e,t){let n=typeof e=="string"?e:e.method;this._notificationHandlers.set(n,t);let r=this.activeConnection(),s;return r!==void 0?(this._notificationDisposables.set(n,r.onNotification(e,t)),s={dispose:()=>{let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}):(this._pendingNotificationHandlers.set(n,t),s={dispose:()=>{this._pendingNotificationHandlers.delete(n);let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}),{dispose:()=>{this._notificationHandlers.delete(n),s.dispose()}}}async sendProgress(e,t,n){if(this.$state===ve.StartFailed||this.$state===ve.Stopping||this.$state===ve.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));try{return(await this.$start()).sendProgress(e,t,n)}catch(r){throw this.error(`Sending progress for token ${t} failed.`,r),r}}onProgress(e,t,n){this._progressHandlers.set(t,{type:e,handler:n});let r=this.activeConnection(),s,o=this._clientOptions.middleware?.handleWorkDoneProgress,a=H.WorkDoneProgress.is(e)&&o!==void 0?c=>{o(t,c,()=>n(c))}:n;return r!==void 0?(this._progressDisposables.set(t,r.onProgress(e,t,a)),s={dispose:()=>{let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}):(this._pendingProgressHandlers.set(t,{type:e,handler:n}),s={dispose:()=>{this._pendingProgressHandlers.delete(t);let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}),{dispose:()=>{this._progressHandlers.delete(t),s.dispose()}}}createDefaultErrorHandler(e){if(e!==void 0&&e<0)throw new Error(`Invalid maxRestartCount: ${e}`);return new yd(this,e??4)}async setTrace(e){this._trace=e;let t=this.activeConnection();t!==void 0&&await t.trace(this._trace,this._tracer,{sendNotification:!1,traceFormat:this._traceFormat})}data2String(e){if(e instanceof H.ResponseError){let t=e;return`  Message: ${t.message}
  Code: ${t.code} ${t.data?`
`+t.data.toString():""}`}return e instanceof Error?Mn.string(e.stack)?e.stack:e.message:Mn.string(e)?e:e.toString()}info(e,t,n=!0){this.outputChannel.appendLine(`[Info  - ${new Date().toLocaleTimeString()}] ${e}`),t!=null&&this.outputChannel.appendLine(this.data2String(t)),n&&this._clientOptions.revealOutputChannelOn<=ss.Info&&this.showNotificationMessage(H.MessageType.Info,e)}warn(e,t,n=!0){this.outputChannel.appendLine(`[Warn  - ${new Date().toLocaleTimeString()}] ${e}`),t!=null&&this.outputChannel.appendLine(this.data2String(t)),n&&this._clientOptions.revealOutputChannelOn<=ss.Warn&&this.showNotificationMessage(H.MessageType.Warning,e)}error(e,t,n=!0){this.outputChannel.appendLine(`[Error - ${new Date().toLocaleTimeString()}] ${e}`),t!=null&&this.outputChannel.appendLine(this.data2String(t)),(n==="force"||n&&this._clientOptions.revealOutputChannelOn<=ss.Error)&&this.showNotificationMessage(H.MessageType.Error,e)}showNotificationMessage(e,t){t=t??"A request has failed. See the output for more information.",(e===H.MessageType.Error?qe.window.showErrorMessage:e===H.MessageType.Warning?qe.window.showWarningMessage:qe.window.showInformationMessage)(t,"Go to output").then(r=>{r!==void 0&&this.outputChannel.show(!0)})}logTrace(e,t){this.traceOutputChannel.appendLine(`[Trace - ${new Date().toLocaleTimeString()}] ${e}`),t&&this.traceOutputChannel.appendLine(this.data2String(t))}logObjectTrace(e){e.isLSPMessage&&e.type?this.traceOutputChannel.append(`[LSP   - ${new Date().toLocaleTimeString()}] `):this.traceOutputChannel.append(`[Trace - ${new Date().toLocaleTimeString()}] `),e&&this.traceOutputChannel.appendLine(`${JSON.stringify(e)}`)}needsStart(){return this.$state===ve.Initial||this.$state===ve.Stopping||this.$state===ve.Stopped}needsStop(){return this.$state===ve.Starting||this.$state===ve.Running}activeConnection(){return this.$state===ve.Running&&this._connection!==void 0?this._connection:void 0}isRunning(){return this.$state===ve.Running}async start(){if(this._disposed==="disposing"||this._disposed==="disposed")throw new Error("Client got disposed and can't be restarted.");if(this.$state===ve.Stopping)throw new Error("Client is currently stopping. Can only restart a full stopped client");if(this._onStart!==void 0)return this._onStart;let[e,t,n]=this.createOnStartPromise();this._onStart=e,this._diagnostics===void 0&&(this._diagnostics=this._clientOptions.diagnosticCollectionName?qe.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):qe.languages.createDiagnosticCollection());for(let[r,s]of this._notificationHandlers)this._pendingNotificationHandlers.has(r)||this._pendingNotificationHandlers.set(r,s);for(let[r,s]of this._requestHandlers)this._pendingRequestHandlers.has(r)||this._pendingRequestHandlers.set(r,s);for(let[r,s]of this._progressHandlers)this._pendingProgressHandlers.has(r)||this._pendingProgressHandlers.set(r,s);this.$state=ve.Starting;try{let r=await this.createConnection();r.onNotification(H.LogMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:this.error(s.message,void 0,!1);break;case H.MessageType.Warning:this.warn(s.message,void 0,!1);break;case H.MessageType.Info:this.info(s.message,void 0,!1);break;default:this.outputChannel.appendLine(s.message)}}),r.onNotification(H.ShowMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:qe.window.showErrorMessage(s.message);break;case H.MessageType.Warning:qe.window.showWarningMessage(s.message);break;case H.MessageType.Info:qe.window.showInformationMessage(s.message);break;default:qe.window.showInformationMessage(s.message)}}),r.onRequest(H.ShowMessageRequest.type,s=>{let o;switch(s.type){case H.MessageType.Error:o=qe.window.showErrorMessage;break;case H.MessageType.Warning:o=qe.window.showWarningMessage;break;case H.MessageType.Info:o=qe.window.showInformationMessage;break;default:o=qe.window.showInformationMessage}let a=s.actions||[];return o(s.message,...a)}),r.onNotification(H.TelemetryEventNotification.type,s=>{this._telemetryEmitter.fire(s)}),r.onRequest(H.ShowDocumentRequest.type,async s=>{let o=async c=>{let u=this.protocol2CodeConverter.asUri(c.uri);try{if(c.external===!0)return{success:await qe.env.openExternal(u)};{let p={};return c.selection!==void 0&&(p.selection=this.protocol2CodeConverter.asRange(c.selection)),c.takeFocus===void 0||c.takeFocus===!1?p.preserveFocus=!0:c.takeFocus===!0&&(p.preserveFocus=!1),await qe.window.showTextDocument(u,p),{success:!0}}}catch{return{success:!1}}},a=this._clientOptions.middleware.window?.showDocument;return a!==void 0?a(s,o):o(s)}),r.listen(),await this.initialize(r),t()}catch(r){this.$state=ve.StartFailed,this.error(`${this._name} client: couldn't create connection to server.`,r,"force"),n(r)}return this._onStart}createOnStartPromise(){let e,t;return[new Promise((r,s)=>{e=r,t=s}),e,t]}async initialize(e){this.refreshTrace(e,!1);let t=this._clientOptions.initializationOptions,[n,r]=this._clientOptions.workspaceFolder!==void 0?[this._clientOptions.workspaceFolder.uri.fsPath,[{uri:this._c2p.asUri(this._clientOptions.workspaceFolder.uri),name:this._clientOptions.workspaceFolder.name}]]:[this._clientGetRootPath(),null],s={processId:null,clientInfo:{name:qe.env.appName,version:qe.version},locale:this.getLocale(),rootPath:n||null,rootUri:n?this._c2p.asUri(qe.Uri.file(n)):null,capabilities:this.computeClientCapabilities(),initializationOptions:Mn.func(t)?t():t,trace:H.Trace.toString(this._trace),workspaceFolders:r};if(this.fillInitializeParams(s),this._clientOptions.progressOnInitialization){let o=Rg.generateUuid(),a=new IS.ProgressPart(e,o);s.workDoneToken=o;try{let c=await this.doInitialize(e,s);return a.done(),c}catch(c){throw a.cancel(),c}}else return this.doInitialize(e,s)}async doInitialize(e,t){try{let n=await e.initialize(t);if(n.capabilities.positionEncoding!==void 0&&n.capabilities.positionEncoding!==H.PositionEncodingKind.UTF16)throw new Error(`Unsupported position encoding (${n.capabilities.positionEncoding}) received from server ${this.name}`);this._initializeResult=n,this.$state=ve.Running;let r;Mn.number(n.capabilities.textDocumentSync)?n.capabilities.textDocumentSync===H.TextDocumentSyncKind.None?r={openClose:!1,change:H.TextDocumentSyncKind.None,save:void 0}:r={openClose:!0,change:n.capabilities.textDocumentSync,save:{includeText:!1}}:n.capabilities.textDocumentSync!==void 0&&n.capabilities.textDocumentSync!==null&&(r=n.capabilities.textDocumentSync),this._capabilities=Object.assign({},n.capabilities,{resolvedTextDocumentSync:r}),e.onNotification(H.PublishDiagnosticsNotification.type,s=>this.handleDiagnostics(s)),e.onRequest(H.RegistrationRequest.type,s=>this.handleRegistrationRequest(s)),e.onRequest("client/registerFeature",s=>this.handleRegistrationRequest(s)),e.onRequest(H.UnregistrationRequest.type,s=>this.handleUnregistrationRequest(s)),e.onRequest("client/unregisterFeature",s=>this.handleUnregistrationRequest(s)),e.onRequest(H.ApplyWorkspaceEditRequest.type,s=>this.handleApplyWorkspaceEdit(s));for(let[s,o]of this._pendingNotificationHandlers)this._notificationDisposables.set(s,e.onNotification(s,o));this._pendingNotificationHandlers.clear();for(let[s,o]of this._pendingRequestHandlers)this._requestDisposables.set(s,e.onRequest(s,o));this._pendingRequestHandlers.clear();for(let[s,o]of this._pendingProgressHandlers)this._progressDisposables.set(s,e.onProgress(o.type,s,o.handler));return this._pendingProgressHandlers.clear(),await e.sendNotification(H.InitializedNotification.type,{}),this.hookFileEvents(e),this.hookConfigurationChanged(e),this.initializeFeatures(e),n}catch(n){throw this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(n)?this.initialize(e):this.stop():n instanceof H.ResponseError&&n.data&&n.data.retry?qe.window.showErrorMessage(n.message,{title:"Retry",id:"retry"}).then(r=>{r&&r.id==="retry"?this.initialize(e):this.stop()}):(n&&n.message&&qe.window.showErrorMessage(n.message),this.error("Server initialization failed.",n),this.stop()),n}}_clientGetRootPath(){let e=qe.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}stop(e=2e3){return this.shutdown("stop",e)}dispose(e=2e3){try{return this._disposed="disposing",this.stop(e)}finally{this._disposed="disposed"}}async shutdown(e,t){if(this.$state===ve.Stopped||this.$state===ve.Initial)return;if(this.$state===ve.Stopping){if(this._onStop!==void 0)return this._onStop;throw new Error("Client is stopping but no stop promise available.")}let n=this.activeConnection();if(n===void 0||this.$state!==ve.Running)throw new Error(`Client is not running and can't be stopped. It's current state is: ${this.$state}`);this._initializeResult=void 0,this.$state=ve.Stopping,this.cleanUp(e);let r=new Promise(o=>{(0,H.RAL)().timer.setTimeout(o,t)}),s=(async o=>(await o.shutdown(),await o.exit(),o))(n);return this._onStop=Promise.race([r,s]).then(o=>{if(o!==void 0)o.end(),o.dispose();else throw this.error("Stopping server timed out",void 0,!1),new Error("Stopping the server timed out")},o=>{throw this.error("Stopping server failed",o,!1),o}).finally(()=>{this.$state=ve.Stopped,e==="stop"&&this.cleanUpChannel(),this._onStart=void 0,this._onStop=void 0,this._connection=void 0,this._ignoredRegistrations.clear()})}cleanUp(e){this._fileEvents=[],this._fileEventDelayer.cancel();let t=this._listeners.splice(0,this._listeners.length);for(let n of t)n.dispose();this._syncedDocuments&&this._syncedDocuments.clear();for(let n of Array.from(this._features.entries()).map(r=>r[1]).reverse())n.dispose();e==="stop"&&this._diagnostics!==void 0&&(this._diagnostics.dispose(),this._diagnostics=void 0),this._idleInterval!==void 0&&(this._idleInterval.dispose(),this._idleInterval=void 0)}cleanUpChannel(){this._outputChannel!==void 0&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0)}notifyFileEvent(e){let t=this;async function n(s){return t._fileEvents.push(s),t._fileEventDelayer.trigger(async()=>{await t.sendNotification(H.DidChangeWatchedFilesNotification.type,{changes:t._fileEvents}),t._fileEvents=[]})}let r=this.clientOptions.middleware?.workspace;(r?.didChangeWatchedFile?r.didChangeWatchedFile(e,n):n(e)).catch(s=>{t.error("Notify file events failed.",s)})}async sendPendingFullTextDocumentChanges(e){return this._pendingChangeSemaphore.lock(async()=>{try{let t=this._didChangeTextDocumentFeature.getPendingDocumentChanges(this._pendingOpenNotifications);if(t.length===0)return;for(let n of t){let r=this.code2ProtocolConverter.asChangeTextDocumentParams(n);await e.sendNotification(H.DidChangeTextDocumentNotification.type,r),this._didChangeTextDocumentFeature.notificationSent(n,H.DidChangeTextDocumentNotification.type,r)}}catch(t){throw this.error("Sending pending changes failed",t,!1),t}})}triggerPendingChangeDelivery(){this._pendingChangeDelayer.trigger(async()=>{let e=this.activeConnection();if(e===void 0){this.triggerPendingChangeDelivery();return}await this.sendPendingFullTextDocumentChanges(e)}).catch(e=>this.error("Delivering pending changes failed",e,!1))}handleDiagnostics(e){if(!this._diagnostics)return;let t=e.uri;this._diagnosticQueueState.state==="busy"&&this._diagnosticQueueState.document===t&&this._diagnosticQueueState.tokenSource.cancel(),this._diagnosticQueue.set(e.uri,e.diagnostics),this.triggerDiagnosticQueue()}triggerDiagnosticQueue(){(0,H.RAL)().timer.setImmediate(()=>{this.workDiagnosticQueue()})}workDiagnosticQueue(){if(this._diagnosticQueueState.state==="busy")return;let e=this._diagnosticQueue.entries().next();if(e.done===!0)return;let[t,n]=e.value;this._diagnosticQueue.delete(t);let r=new qe.CancellationTokenSource;this._diagnosticQueueState={state:"busy",document:t,tokenSource:r},this._p2c.asDiagnostics(n,r.token).then(s=>{if(!r.token.isCancellationRequested){let o=this._p2c.asUri(t),a=this.clientOptions.middleware;a.handleDiagnostics?a.handleDiagnostics(o,s,(c,u)=>this.setDiagnostics(c,u)):this.setDiagnostics(o,s)}}).finally(()=>{this._diagnosticQueueState={state:"idle"},this.triggerDiagnosticQueue()})}setDiagnostics(e,t){this._diagnostics&&this._diagnostics.set(e,t)}getLocale(){return qe.env.language}async $start(){if(this.$state===ve.StartFailed)throw new Error("Previous start failed. Can't restart server.");await this.start();let e=this.activeConnection();if(e===void 0)throw new Error("Starting server failed");return e}async createConnection(){let e=(r,s,o)=>{this.handleConnectionError(r,s,o).catch(a=>this.error("Handling connection error failed",a))},t=()=>{this.handleConnectionClosed().catch(r=>this.error("Handling connection close failed",r))},n=await this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8");return this._connection=lR(n.reader,n.writer,e,t,this._clientOptions.connectionOptions),this._connection}async handleConnectionClosed(){if(this.$state===ve.Stopped)return;try{this._connection!==void 0&&this._connection.dispose()}catch{}let e={action:$i.DoNotRestart};if(this.$state!==ve.Stopping)try{e=await this._clientOptions.errorHandler.closed()}catch{}this._connection=void 0,e.action===$i.DoNotRestart?(this.error(e.message??"Connection to server got closed. Server will not be restarted.",void 0,e.handled===!0?!1:"force"),this.cleanUp("stop"),this.$state===ve.Starting?this.$state=ve.StartFailed:this.$state=ve.Stopped,this._onStop=Promise.resolve(),this._onStart=void 0):e.action===$i.Restart&&(this.info(e.message??"Connection to server got closed. Server will restart.",!e.handled),this.cleanUp("restart"),this.$state=ve.Initial,this._onStop=Promise.resolve(),this._onStart=void 0,this.start().catch(t=>this.error("Restarting server failed",t,"force")))}async handleConnectionError(e,t,n){let r=await this._clientOptions.errorHandler.error(e,t,n);r.action===Wo.Shutdown&&(this.error(r.message??`Client ${this._name}: connection to server is erroring. Shutting down server.`,void 0,r.handled===!0?!1:"force"),this.stop().catch(s=>{this.error("Stopping server failed",s,!1)}))}hookConfigurationChanged(e){this._listeners.push(qe.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(e,!0)}))}refreshTrace(e,t=!1){let n=qe.workspace.getConfiguration(this._id),r=H.Trace.Off,s=H.TraceFormat.Text;if(n){let o=n.get("trace.server","off");typeof o=="string"?r=H.Trace.fromString(o):(r=H.Trace.fromString(n.get("trace.server.verbosity","off")),s=H.TraceFormat.fromString(n.get("trace.server.format","text")))}this._trace=r,this._traceFormat=s,e.trace(this._trace,this._tracer,{sendNotification:t,traceFormat:this._traceFormat}).catch(o=>{this.error("Updating trace failed with error",o,!1)})}hookFileEvents(e){let t=this._clientOptions.synchronize.fileEvents;if(!t)return;let n;Mn.array(t)?n=t:n=[t],n&&this._dynamicFeatures.get(H.DidChangeWatchedFilesNotification.type.method).registerRaw(Rg.generateUuid(),n)}registerFeatures(e){for(let t of e)this.registerFeature(t)}registerFeature(e){if(this._features.push(e),Tn.DynamicFeature.is(e)){let t=e.registrationType;this._dynamicFeatures.set(t.method,e)}}getFeature(e){return this._dynamicFeatures.get(e)}hasDedicatedTextSynchronizationFeature(e){let t=this.getFeature(H.NotebookDocumentSyncRegistrationType.method);return t===void 0||!(t instanceof Dg.NotebookDocumentSyncFeature)?!1:t.handles(e)}registerBuiltinFeatures(){let e=new Map;this.registerFeature(new _g.ConfigurationFeature(this)),this.registerFeature(new fr.DidOpenTextDocumentFeature(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new fr.DidChangeTextDocumentFeature(this,e),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new fr.WillSaveFeature(this)),this.registerFeature(new fr.WillSaveWaitUntilFeature(this)),this.registerFeature(new fr.DidSaveTextDocumentFeature(this)),this.registerFeature(new fr.DidCloseTextDocumentFeature(this,this._syncedDocuments,e)),this.registerFeature(new VS.FileSystemWatcherFeature(this,t=>this.notifyFileEvent(t))),this.registerFeature(new FS.CompletionItemFeature(this)),this.registerFeature(new LS.HoverFeature(this)),this.registerFeature(new NS.SignatureHelpFeature(this)),this.registerFeature(new MS.DefinitionFeature(this)),this.registerFeature(new WS.ReferencesFeature(this)),this.registerFeature(new AS.DocumentHighlightFeature(this)),this.registerFeature(new $S.DocumentSymbolFeature(this)),this.registerFeature(new jS.WorkspaceSymbolFeature(this)),this.registerFeature(new HS.CodeActionFeature(this)),this.registerFeature(new US.CodeLensFeature(this)),this.registerFeature(new vd.DocumentFormattingFeature(this)),this.registerFeature(new vd.DocumentRangeFormattingFeature(this)),this.registerFeature(new vd.DocumentOnTypeFormattingFeature(this)),this.registerFeature(new KS.RenameFeature(this)),this.registerFeature(new zS.DocumentLinkFeature(this)),this.registerFeature(new BS.ExecuteCommandFeature(this)),this.registerFeature(new _g.SyncConfigurationFeature(this)),this.registerFeature(new QS.TypeDefinitionFeature(this)),this.registerFeature(new XS.ImplementationFeature(this)),this.registerFeature(new GS.ColorProviderFeature(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new JS.WorkspaceFoldersFeature(this)),this.registerFeature(new ZS.FoldingRangeFeature(this)),this.registerFeature(new YS.DeclarationFeature(this)),this.registerFeature(new eR.SelectionRangeFeature(this)),this.registerFeature(new tR.ProgressFeature(this)),this.registerFeature(new nR.CallHierarchyFeature(this)),this.registerFeature(new iR.SemanticTokensFeature(this)),this.registerFeature(new rR.LinkedEditingFeature(this)),this.registerFeature(new hr.DidCreateFilesFeature(this)),this.registerFeature(new hr.DidRenameFilesFeature(this)),this.registerFeature(new hr.DidDeleteFilesFeature(this)),this.registerFeature(new hr.WillCreateFilesFeature(this)),this.registerFeature(new hr.WillRenameFilesFeature(this)),this.registerFeature(new hr.WillDeleteFilesFeature(this)),this.registerFeature(new sR.TypeHierarchyFeature(this)),this.registerFeature(new oR.InlineValueFeature(this)),this.registerFeature(new aR.InlayHintsFeature(this)),this.registerFeature(new OS.DiagnosticFeature(this)),this.registerFeature(new Dg.NotebookDocumentSyncFeature(this))}registerProposedFeatures(){this.registerFeatures(Tg.createAll(this))}fillInitializeParams(e){for(let t of this._features)Mn.func(t.fillInitializeParams)&&t.fillInitializeParams(e)}computeClientCapabilities(){let e={};(0,Tn.ensure)(e,"workspace").applyEdit=!0;let t=(0,Tn.ensure)((0,Tn.ensure)(e,"workspace"),"workspaceEdit");t.documentChanges=!0,t.resourceOperations=[H.ResourceOperationKind.Create,H.ResourceOperationKind.Rename,H.ResourceOperationKind.Delete],t.failureHandling=H.FailureHandlingKind.TextOnlyTransactional,t.normalizesLineEndings=!0,t.changeAnnotationSupport={groupsOnLabel:!0};let n=(0,Tn.ensure)((0,Tn.ensure)(e,"textDocument"),"publishDiagnostics");n.relatedInformation=!0,n.versionSupport=!1,n.tagSupport={valueSet:[H.DiagnosticTag.Unnecessary,H.DiagnosticTag.Deprecated]},n.codeDescriptionSupport=!0,n.dataSupport=!0;let r=(0,Tn.ensure)(e,"window"),s=(0,Tn.ensure)(r,"showMessage");s.messageActionItem={additionalPropertiesSupport:!0};let o=(0,Tn.ensure)(r,"showDocument");o.support=!0;let a=(0,Tn.ensure)(e,"general");a.staleRequestSupport={cancel:!0,retryOnContentModified:Array.from(i.RequestsToCancelOnContentModified)},a.regularExpressions={engine:"ECMAScript",version:"ES2020"},a.markdown={parser:"marked",version:"1.1.0"},a.positionEncodings=["utf-16"],this._clientOptions.markdown.supportHtml&&(a.markdown.allowedTags=["ul","li","p","code","blockquote","ol","h1","h2","h3","h4","h5","h6","hr","em","pre","table","thead","tbody","tr","th","td","div","del","a","strong","br","img","span"]);for(let c of this._features)c.fillClientCapabilities(e);return e}initializeFeatures(e){let t=this._clientOptions.documentSelector;for(let n of this._features)Mn.func(n.preInitialize)&&n.preInitialize(this._capabilities,t);for(let n of this._features)n.initialize(this._capabilities,t)}async handleRegistrationRequest(e){if(!this.isRunning()){for(let t of e.registrations)this._ignoredRegistrations.add(t.id);return}for(let t of e.registrations){let n=this._dynamicFeatures.get(t.method);if(n===void 0)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Registration failed.`));let r=t.registerOptions??{};r.documentSelector=r.documentSelector??this._clientOptions.documentSelector;let s={id:t.id,registerOptions:r};try{n.register(s)}catch(o){return Promise.reject(o)}}}async handleUnregistrationRequest(e){for(let t of e.unregisterations){if(this._ignoredRegistrations.has(t.id))continue;let n=this._dynamicFeatures.get(t.method);if(!n)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Unregistration failed.`));n.unregister(t.id)}}async handleApplyWorkspaceEdit(e){let t=e.edit,n=await this.workspaceEditLock.lock(()=>this._p2c.asWorkspaceEdit(t)),r=new Map;qe.workspace.textDocuments.forEach(o=>r.set(o.uri.toString(),o));let s=!1;if(t.documentChanges){for(let o of t.documentChanges)if(H.TextDocumentEdit.is(o)&&o.textDocument.version&&o.textDocument.version>=0){let a=this._p2c.asUri(o.textDocument.uri).toString(),c=r.get(a);if(c&&c.version!==o.textDocument.version){s=!0;break}}}return s?Promise.resolve({applied:!1}):Mn.asPromise(qe.workspace.applyEdit(n).then(o=>({applied:o})))}handleFailedRequest(e,t,n,r,s=!0){if(n instanceof H.ResponseError){if(n.code===H.ErrorCodes.PendingResponseRejected||n.code===H.ErrorCodes.ConnectionInactive)return r;if(n.code===H.LSPErrorCodes.RequestCancelled||n.code===H.LSPErrorCodes.ServerCancelled){if(t!==void 0&&t.isCancellationRequested)return r;throw n.data!==void 0?new Tn.LSPCancellationError(n.data):new qe.CancellationError}else if(n.code===H.LSPErrorCodes.ContentModified){if(i.RequestsToCancelOnContentModified.has(e.method)||i.CancellableResolveCalls.has(e.method))throw new qe.CancellationError;return r}}throw this.error(`Request ${e.method} failed.`,n,s),n}};Be.BaseLanguageClient=os;os.RequestsToCancelOnContentModified=new Set([H.SemanticTokensRequest.method,H.SemanticTokensRangeRequest.method,H.SemanticTokensDeltaRequest.method]);os.CancellableResolveCalls=new Set([H.CompletionResolveRequest.method,H.CodeLensResolveRequest.method,H.CodeActionResolveRequest.method,H.InlayHintResolveRequest.method,H.DocumentLinkResolveRequest.method,H.WorkspaceSymbolResolveRequest.method]);var bd=class{error(e){(0,H.RAL)().console.error(e)}warn(e){(0,H.RAL)().console.warn(e)}info(e){(0,H.RAL)().console.info(e)}log(e){(0,H.RAL)().console.log(e)}};function lR(i,e,t,n,r){let s=new bd,o=(0,H.createProtocolConnection)(i,e,s,r);return o.onError(c=>{t(c[0],c[1],c[2])}),o.onClose(n),{listen:()=>o.listen(),sendRequest:o.sendRequest,onRequest:o.onRequest,hasPendingResponse:o.hasPendingResponse,sendNotification:o.sendNotification,onNotification:o.onNotification,onProgress:o.onProgress,sendProgress:o.sendProgress,trace:(c,u,p)=>{let m={sendNotification:!1,traceFormat:H.TraceFormat.Text};return p===void 0?o.trace(c,u,m):(Mn.boolean(p),o.trace(c,u,p))},initialize:c=>o.sendRequest(H.InitializeRequest.type,c),shutdown:()=>o.sendRequest(H.ShutdownRequest.type,void 0),exit:()=>o.sendNotification(H.ExitNotification.type),end:()=>o.end(),dispose:()=>o.dispose()}}var Tg;(function(i){function e(t){return[]}i.createAll=e})(Tg=Be.ProposedFeatures||(Be.ProposedFeatures={}))});var kg=F(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.terminate=void 0;var Pg=require("child_process"),dR=require("path"),fR=process.platform==="win32",hR=process.platform==="darwin",pR=process.platform==="linux";function gR(i,e){if(fR)try{let r={stdio:["pipe","pipe","ignore"]};return e&&(r.cwd=e),Pg.execFileSync("taskkill",["/T","/F","/PID",i.pid.toString()],r),!0}catch{return!1}else if(pR||hR)try{var t=(0,dR.join)(__dirname,"terminateProcess.sh"),n=Pg.spawnSync(t,[i.pid.toString()]);return!n.error}catch{return!1}else return i.kill("SIGKILL"),!0}Ho.terminate=gR});var Cd=F((UT,Eg)=>{"use strict";Eg.exports=ce()});var as=F((KT,xg)=>{"use strict";var mR=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...i)=>console.error("SEMVER",...i):()=>{};xg.exports=mR});var Uo=F((zT,qg)=>{"use strict";var vR="2.0.0",yR=Number.MAX_SAFE_INTEGER||9007199254740991,bR=16,wR=250,CR=["major","premajor","minor","preminor","patch","prepatch","prerelease"];qg.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:bR,MAX_SAFE_BUILD_LENGTH:wR,MAX_SAFE_INTEGER:yR,RELEASE_TYPES:CR,SEMVER_SPEC_VERSION:vR,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Ko=F((Nn,Ig)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Sd,MAX_SAFE_BUILD_LENGTH:SR,MAX_LENGTH:RR}=Uo(),DR=as();Nn=Ig.exports={};var _R=Nn.re=[],TR=Nn.safeRe=[],X=Nn.src=[],PR=Nn.safeSrc=[],Q=Nn.t={},kR=0,Rd="[a-zA-Z0-9-]",ER=[["\\s",1],["\\d",RR],[Rd,SR]],xR=i=>{for(let[e,t]of ER)i=i.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return i},le=(i,e,t)=>{let n=xR(e),r=kR++;DR(i,r,e),Q[i]=r,X[r]=e,PR[r]=n,_R[r]=new RegExp(e,t?"g":void 0),TR[r]=new RegExp(n,t?"g":void 0)};le("NUMERICIDENTIFIER","0|[1-9]\\d*");le("NUMERICIDENTIFIERLOOSE","\\d+");le("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Rd}*`);le("MAINVERSION",`(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})`);le("MAINVERSIONLOOSE",`(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})`);le("PRERELEASEIDENTIFIER",`(?:${X[Q.NONNUMERICIDENTIFIER]}|${X[Q.NUMERICIDENTIFIER]})`);le("PRERELEASEIDENTIFIERLOOSE",`(?:${X[Q.NONNUMERICIDENTIFIER]}|${X[Q.NUMERICIDENTIFIERLOOSE]})`);le("PRERELEASE",`(?:-(${X[Q.PRERELEASEIDENTIFIER]}(?:\\.${X[Q.PRERELEASEIDENTIFIER]})*))`);le("PRERELEASELOOSE",`(?:-?(${X[Q.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${X[Q.PRERELEASEIDENTIFIERLOOSE]})*))`);le("BUILDIDENTIFIER",`${Rd}+`);le("BUILD",`(?:\\+(${X[Q.BUILDIDENTIFIER]}(?:\\.${X[Q.BUILDIDENTIFIER]})*))`);le("FULLPLAIN",`v?${X[Q.MAINVERSION]}${X[Q.PRERELEASE]}?${X[Q.BUILD]}?`);le("FULL",`^${X[Q.FULLPLAIN]}$`);le("LOOSEPLAIN",`[v=\\s]*${X[Q.MAINVERSIONLOOSE]}${X[Q.PRERELEASELOOSE]}?${X[Q.BUILD]}?`);le("LOOSE",`^${X[Q.LOOSEPLAIN]}$`);le("GTLT","((?:<|>)?=?)");le("XRANGEIDENTIFIERLOOSE",`${X[Q.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);le("XRANGEIDENTIFIER",`${X[Q.NUMERICIDENTIFIER]}|x|X|\\*`);le("XRANGEPLAIN",`[v=\\s]*(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:${X[Q.PRERELEASE]})?${X[Q.BUILD]}?)?)?`);le("XRANGEPLAINLOOSE",`[v=\\s]*(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:${X[Q.PRERELEASELOOSE]})?${X[Q.BUILD]}?)?)?`);le("XRANGE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAIN]}$`);le("XRANGELOOSE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAINLOOSE]}$`);le("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Sd}})(?:\\.(\\d{1,${Sd}}))?(?:\\.(\\d{1,${Sd}}))?`);le("COERCE",`${X[Q.COERCEPLAIN]}(?:$|[^\\d])`);le("COERCEFULL",X[Q.COERCEPLAIN]+`(?:${X[Q.PRERELEASE]})?(?:${X[Q.BUILD]})?(?:$|[^\\d])`);le("COERCERTL",X[Q.COERCE],!0);le("COERCERTLFULL",X[Q.COERCEFULL],!0);le("LONETILDE","(?:~>?)");le("TILDETRIM",`(\\s*)${X[Q.LONETILDE]}\\s+`,!0);Nn.tildeTrimReplace="$1~";le("TILDE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAIN]}$`);le("TILDELOOSE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAINLOOSE]}$`);le("LONECARET","(?:\\^)");le("CARETTRIM",`(\\s*)${X[Q.LONECARET]}\\s+`,!0);Nn.caretTrimReplace="$1^";le("CARET",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAIN]}$`);le("CARETLOOSE",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAINLOOSE]}$`);le("COMPARATORLOOSE",`^${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]})$|^$`);le("COMPARATOR",`^${X[Q.GTLT]}\\s*(${X[Q.FULLPLAIN]})$|^$`);le("COMPARATORTRIM",`(\\s*)${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]}|${X[Q.XRANGEPLAIN]})`,!0);Nn.comparatorTrimReplace="$1$2$3";le("HYPHENRANGE",`^\\s*(${X[Q.XRANGEPLAIN]})\\s+-\\s+(${X[Q.XRANGEPLAIN]})\\s*$`);le("HYPHENRANGELOOSE",`^\\s*(${X[Q.XRANGEPLAINLOOSE]})\\s+-\\s+(${X[Q.XRANGEPLAINLOOSE]})\\s*$`);le("STAR","(<|>)?=?\\s*\\*");le("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");le("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var zo=F((BT,Og)=>{"use strict";var qR=Object.freeze({loose:!0}),IR=Object.freeze({}),OR=i=>i?typeof i!="object"?qR:i:IR;Og.exports=OR});var Ng=F((VT,Mg)=>{"use strict";var Fg=/^[0-9]+$/,Lg=(i,e)=>{if(typeof i=="number"&&typeof e=="number")return i===e?0:i<e?-1:1;let t=Fg.test(i),n=Fg.test(e);return t&&n&&(i=+i,e=+e),i===e?0:t&&!n?-1:n&&!t?1:i<e?-1:1},FR=(i,e)=>Lg(e,i);Mg.exports={compareIdentifiers:Lg,rcompareIdentifiers:FR}});var cs=F((GT,$g)=>{"use strict";var Bo=as(),{MAX_LENGTH:Ag,MAX_SAFE_INTEGER:Vo}=Uo(),{safeRe:Go,t:Xo}=Ko(),LR=zo(),{compareIdentifiers:Dd}=Ng(),_d=class i{constructor(e,t){if(t=LR(t),e instanceof i){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Ag)throw new TypeError(`version is longer than ${Ag} characters`);Bo("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Go[Xo.LOOSE]:Go[Xo.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Vo||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Vo||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Vo||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){let s=+r;if(s>=0&&s<Vo)return s}return r}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Bo("SemVer.compare",this.version,this.options,e),!(e instanceof i)){if(typeof e=="string"&&e===this.version)return 0;e=new i(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof i||(e=new i(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof i||(e=new i(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],r=e.prerelease[t];if(Bo("prerelease compare",t,n,r),n===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(n===void 0)return-1;if(n===r)continue;return Dd(n,r)}while(++t)}compareBuild(e){e instanceof i||(e=new i(e,this.options));let t=0;do{let n=this.build[t],r=e.build[t];if(Bo("build compare",t,n,r),n===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(n===void 0)return-1;if(n===r)continue;return Dd(n,r)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let r=`-${t}`.match(this.options.loose?Go[Xo.PRERELEASELOOSE]:Go[Xo.PRERELEASE]);if(!r||r[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let r=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[r];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(r)}}if(t){let s=[t,r];n===!1&&(s=[t]),Dd(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};$g.exports=_d});var Hg=F((XT,Wg)=>{"use strict";var jg=cs(),MR=(i,e,t=!1)=>{if(i instanceof jg)return i;try{return new jg(i,e)}catch(n){if(!t)return null;throw n}};Wg.exports=MR});var Kg=F((QT,Ug)=>{"use strict";var Td=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let r=this.map.keys().next().value;this.delete(r)}this.map.set(e,t)}return this}};Ug.exports=Td});var ji=F((JT,Bg)=>{"use strict";var zg=cs(),NR=(i,e,t)=>new zg(i,t).compare(new zg(e,t));Bg.exports=NR});var Gg=F((ZT,Vg)=>{"use strict";var AR=ji(),$R=(i,e,t)=>AR(i,e,t)===0;Vg.exports=$R});var Qg=F((YT,Xg)=>{"use strict";var jR=ji(),WR=(i,e,t)=>jR(i,e,t)!==0;Xg.exports=WR});var Zg=F((eP,Jg)=>{"use strict";var HR=ji(),UR=(i,e,t)=>HR(i,e,t)>0;Jg.exports=UR});var em=F((tP,Yg)=>{"use strict";var KR=ji(),zR=(i,e,t)=>KR(i,e,t)>=0;Yg.exports=zR});var nm=F((nP,tm)=>{"use strict";var BR=ji(),VR=(i,e,t)=>BR(i,e,t)<0;tm.exports=VR});var rm=F((iP,im)=>{"use strict";var GR=ji(),XR=(i,e,t)=>GR(i,e,t)<=0;im.exports=XR});var om=F((rP,sm)=>{"use strict";var QR=Gg(),JR=Qg(),ZR=Zg(),YR=em(),eD=nm(),tD=rm(),nD=(i,e,t,n)=>{switch(e){case"===":return typeof i=="object"&&(i=i.version),typeof t=="object"&&(t=t.version),i===t;case"!==":return typeof i=="object"&&(i=i.version),typeof t=="object"&&(t=t.version),i!==t;case"":case"=":case"==":return QR(i,t,n);case"!=":return JR(i,t,n);case">":return ZR(i,t,n);case">=":return YR(i,t,n);case"<":return eD(i,t,n);case"<=":return tD(i,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};sm.exports=nD});var hm=F((sP,fm)=>{"use strict";var us=Symbol("SemVer ANY"),Ed=class i{static get ANY(){return us}constructor(e,t){if(t=am(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),kd("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===us?this.value="":this.value=this.operator+this.semver.version,kd("comp",this)}parse(e){let t=this.options.loose?cm[um.COMPARATORLOOSE]:cm[um.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new lm(n[2],this.options.loose):this.semver=us}toString(){return this.value}test(e){if(kd("Comparator.test",e,this.options.loose),this.semver===us||e===us)return!0;if(typeof e=="string")try{e=new lm(e,this.options)}catch{return!1}return Pd(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new dm(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new dm(this.value,t).test(e.semver):(t=am(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Pd(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Pd(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};fm.exports=Ed;var am=zo(),{safeRe:cm,t:um}=Ko(),Pd=om(),kd=as(),lm=cs(),dm=xd()});var xd=F((oP,vm)=>{"use strict";var iD=/\s+/g,qd=class i{constructor(e,t){if(t=sD(t),e instanceof i)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new i(e.raw,t);if(e instanceof Id)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(iD," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(r=>!gm(r[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let r of this.set)if(r.length===1&&fD(r[0])){this.set=[r];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&lD)|(this.options.loose&&dD))+":"+e,r=pm.get(n);if(r)return r;let s=this.options.loose,o=s?jt[It.HYPHENRANGELOOSE]:jt[It.HYPHENRANGE];e=e.replace(o,SD(this.options.includePrerelease)),Ve("hyphen replace",e),e=e.replace(jt[It.COMPARATORTRIM],aD),Ve("comparator trim",e),e=e.replace(jt[It.TILDETRIM],cD),Ve("tilde trim",e),e=e.replace(jt[It.CARETTRIM],uD),Ve("caret trim",e);let a=e.split(" ").map(m=>hD(m,this.options)).join(" ").split(/\s+/).map(m=>CD(m,this.options));s&&(a=a.filter(m=>(Ve("loose invalid filter",m,this.options),!!m.match(jt[It.COMPARATORLOOSE])))),Ve("range list",a);let c=new Map,u=a.map(m=>new Id(m,this.options));for(let m of u){if(gm(m))return[m];c.set(m.value,m)}c.size>1&&c.has("")&&c.delete("");let p=[...c.values()];return pm.set(n,p),p}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Range is required");return this.set.some(n=>mm(n,t)&&e.set.some(r=>mm(r,t)&&n.every(s=>r.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new oD(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(RD(this.set[t],e,this.options))return!0;return!1}};vm.exports=qd;var rD=Kg(),pm=new rD,sD=zo(),Id=hm(),Ve=as(),oD=cs(),{safeRe:jt,t:It,comparatorTrimReplace:aD,tildeTrimReplace:cD,caretTrimReplace:uD}=Ko(),{FLAG_INCLUDE_PRERELEASE:lD,FLAG_LOOSE:dD}=Uo(),gm=i=>i.value==="<0.0.0-0",fD=i=>i.value==="",mm=(i,e)=>{let t=!0,n=i.slice(),r=n.pop();for(;t&&n.length;)t=n.every(s=>r.intersects(s,e)),r=n.pop();return t},hD=(i,e)=>(i=i.replace(jt[It.BUILD],""),Ve("comp",i,e),i=mD(i,e),Ve("caret",i),i=pD(i,e),Ve("tildes",i),i=yD(i,e),Ve("xrange",i),i=wD(i,e),Ve("stars",i),i),Wt=i=>!i||i.toLowerCase()==="x"||i==="*",pD=(i,e)=>i.trim().split(/\s+/).map(t=>gD(t,e)).join(" "),gD=(i,e)=>{let t=e.loose?jt[It.TILDELOOSE]:jt[It.TILDE];return i.replace(t,(n,r,s,o,a)=>{Ve("tilde",i,n,r,s,o,a);let c;return Wt(r)?c="":Wt(s)?c=`>=${r}.0.0 <${+r+1}.0.0-0`:Wt(o)?c=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:a?(Ve("replaceTilde pr",a),c=`>=${r}.${s}.${o}-${a} <${r}.${+s+1}.0-0`):c=`>=${r}.${s}.${o} <${r}.${+s+1}.0-0`,Ve("tilde return",c),c})},mD=(i,e)=>i.trim().split(/\s+/).map(t=>vD(t,e)).join(" "),vD=(i,e)=>{Ve("caret",i,e);let t=e.loose?jt[It.CARETLOOSE]:jt[It.CARET],n=e.includePrerelease?"-0":"";return i.replace(t,(r,s,o,a,c)=>{Ve("caret",i,r,s,o,a,c);let u;return Wt(s)?u="":Wt(o)?u=`>=${s}.0.0${n} <${+s+1}.0.0-0`:Wt(a)?s==="0"?u=`>=${s}.${o}.0${n} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.0${n} <${+s+1}.0.0-0`:c?(Ve("replaceCaret pr",c),s==="0"?o==="0"?u=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:u=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(Ve("no pr"),s==="0"?o==="0"?u=`>=${s}.${o}.${a}${n} <${s}.${o}.${+a+1}-0`:u=`>=${s}.${o}.${a}${n} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),Ve("caret return",u),u})},yD=(i,e)=>(Ve("replaceXRanges",i,e),i.split(/\s+/).map(t=>bD(t,e)).join(" ")),bD=(i,e)=>{i=i.trim();let t=e.loose?jt[It.XRANGELOOSE]:jt[It.XRANGE];return i.replace(t,(n,r,s,o,a,c)=>{Ve("xRange",i,n,r,s,o,a,c);let u=Wt(s),p=u||Wt(o),m=p||Wt(a),g=m;return r==="="&&g&&(r=""),c=e.includePrerelease?"-0":"",u?r===">"||r==="<"?n="<0.0.0-0":n="*":r&&g?(p&&(o=0),a=0,r===">"?(r=">=",p?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):r==="<="&&(r="<",p?s=+s+1:o=+o+1),r==="<"&&(c="-0"),n=`${r+s}.${o}.${a}${c}`):p?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:m&&(n=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),Ve("xRange return",n),n})},wD=(i,e)=>(Ve("replaceStars",i,e),i.trim().replace(jt[It.STAR],"")),CD=(i,e)=>(Ve("replaceGTE0",i,e),i.trim().replace(jt[e.includePrerelease?It.GTE0PRE:It.GTE0],"")),SD=i=>(e,t,n,r,s,o,a,c,u,p,m,g)=>(Wt(n)?t="":Wt(r)?t=`>=${n}.0.0${i?"-0":""}`:Wt(s)?t=`>=${n}.${r}.0${i?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${i?"-0":""}`,Wt(u)?c="":Wt(p)?c=`<${+u+1}.0.0-0`:Wt(m)?c=`<${u}.${+p+1}.0-0`:g?c=`<=${u}.${p}.${m}-${g}`:i?c=`<${u}.${p}.${+m+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),RD=(i,e,t)=>{for(let n=0;n<i.length;n++)if(!i[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<i.length;n++)if(Ve(i[n].semver),i[n].semver!==Id.ANY&&i[n].semver.prerelease.length>0){let r=i[n].semver;if(r.major===e.major&&r.minor===e.minor&&r.patch===e.patch)return!0}return!1}return!0}});var bm=F((aP,ym)=>{"use strict";var DD=xd(),_D=(i,e,t)=>{try{e=new DD(e,t)}catch{return!1}return e.test(i)};ym.exports=_D});var Cm=F(sn=>{"use strict";var TD=sn&&sn.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Od=sn&&sn.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&TD(e,i,t)};Object.defineProperty(sn,"__esModule",{value:!0});sn.DiagnosticPullMode=sn.vsdiag=void 0;Od(ce(),sn);Od(_e(),sn);var wm=Uu();Object.defineProperty(sn,"vsdiag",{enumerable:!0,get:function(){return wm.vsdiag}});Object.defineProperty(sn,"DiagnosticPullMode",{enumerable:!0,get:function(){return wm.DiagnosticPullMode}});Od(wd(),sn)});var _m=F(Ht=>{"use strict";var PD=Ht&&Ht.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Dm=Ht&&Ht.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&PD(e,i,t)};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.SettingMonitor=Ht.LanguageClient=Ht.TransportKind=void 0;var ti=require("child_process"),Fd=require("fs"),Ld=require("path"),wi=require("vscode"),Qe=un(),Sm=wd(),kD=kg(),it=Cd(),ED=Hg(),xD=bm();Dm(Cd(),Ht);Dm(Cm(),Ht);var Rm="^1.67.0",at;(function(i){i[i.stdio=0]="stdio",i[i.ipc=1]="ipc",i[i.pipe=2]="pipe",i[i.socket=3]="socket"})(at=Ht.TransportKind||(Ht.TransportKind={}));var bi;(function(i){function e(t){let n=t;return n&&n.kind===at.socket&&Qe.number(n.port)}i.isSocket=e})(bi||(bi={}));var Md;(function(i){function e(t){return Qe.string(t.command)}i.is=e})(Md||(Md={}));var Nd;(function(i){function e(t){return Qe.string(t.module)}i.is=e})(Nd||(Nd={}));var Ad;(function(i){function e(t){let n=t;return n&&n.writer!==void 0&&n.reader!==void 0}i.is=e})(Ad||(Ad={}));var $d;(function(i){function e(t){let n=t;return n&&n.process!==void 0&&typeof n.detached=="boolean"}i.is=e})($d||($d={}));var jd=class extends Sm.BaseLanguageClient{constructor(e,t,n,r,s){let o,a,c,u,p;Qe.string(t)?(o=e,a=t,c=n,u=r,p=!!s):(o=e.toLowerCase(),a=e,c=t,u=n,p=r),p===void 0&&(p=!1),super(o,a,u),this._serverOptions=c,this._forceDebug=p,this._isInDebugMode=p;try{this.checkVersion()}catch(m){throw Qe.string(m.message)&&this.outputChannel.appendLine(m.message),m}}checkVersion(){let e=ED(wi.version);if(!e)throw new Error(`No valid VS Code version detected. Version string is: ${wi.version}`);if(e.prerelease&&e.prerelease.length>0&&(e.prerelease=[]),!xD(e,Rm))throw new Error(`The language client requires VS Code version ${Rm} but received version ${wi.version}`)}get isInDebugMode(){return this._isInDebugMode}async restart(){await this.stop(),this.isInDebugMode?(await new Promise(e=>setTimeout(e,1e3)),await this.start()):await this.start()}stop(e=2e3){return super.stop(e).finally(()=>{if(this._serverProcess){let t=this._serverProcess;this._serverProcess=void 0,(this._isDetached===void 0||!this._isDetached)&&this.checkProcessDied(t),this._isDetached=void 0}})}checkProcessDied(e){!e||e.pid===void 0||setTimeout(()=>{try{e.pid!==void 0&&(process.kill(e.pid,0),(0,kD.terminate)(e))}catch{}},2e3)}handleConnectionClosed(){return this._serverProcess=void 0,super.handleConnectionClosed()}fillInitializeParams(e){super.fillInitializeParams(e),e.processId===null&&(e.processId=process.pid)}createMessageTransports(e){function t(p,m){if(!p&&!m)return;let g=Object.create(null);return Object.keys(process.env).forEach(w=>g[w]=process.env[w]),m&&(g.ELECTRON_RUN_AS_NODE="1",g.ELECTRON_NO_ASAR="1"),p&&Object.keys(p).forEach(w=>g[w]=p[w]),g}let n=["--debug=","--debug-brk=","--inspect=","--inspect-brk="],r=["--debug","--debug-brk","--inspect","--inspect-brk"];function s(){let p=process.execArgv;return p?p.some(m=>n.some(g=>m.startsWith(g))||r.some(g=>m===g)):!1}function o(p){if(p.stdin===null||p.stdout===null||p.stderr===null)throw new Error("Process created without stdio streams")}let a=this._serverOptions;if(Qe.func(a))return a().then(p=>{if(Sm.MessageTransports.is(p))return this._isDetached=!!p.detached,p;if(Ad.is(p))return this._isDetached=!!p.detached,{reader:new it.StreamMessageReader(p.reader),writer:new it.StreamMessageWriter(p.writer)};{let m;return $d.is(p)?(m=p.process,this._isDetached=p.detached):(m=p,this._isDetached=!1),m.stderr.on("data",g=>this.outputChannel.append(Qe.string(g)?g:g.toString(e))),{reader:new it.StreamMessageReader(m.stdout),writer:new it.StreamMessageWriter(m.stdin)}}});let c,u=a;return u.run||u.debug?this._forceDebug||s()?(c=u.debug,this._isInDebugMode=!0):(c=u.run,this._isInDebugMode=!1):c=a,this._getServerWorkingDir(c.options).then(p=>{if(Nd.is(c)&&c.module){let m=c,g=m.transport||at.stdio;if(m.runtime){let w=[],y=m.options??Object.create(null);y.execArgv&&y.execArgv.forEach(P=>w.push(P)),w.push(m.module),m.args&&m.args.forEach(P=>w.push(P));let T=Object.create(null);T.cwd=p,T.env=t(y.env,!1);let C=this._getRuntimePath(m.runtime,p),S;if(g===at.ipc?(T.stdio=[null,null,null,"ipc"],w.push("--node-ipc")):g===at.stdio?w.push("--stdio"):g===at.pipe?(S=(0,it.generateRandomPipeName)(),w.push(`--pipe=${S}`)):bi.isSocket(g)&&w.push(`--socket=${g.port}`),w.push(`--clientProcessId=${process.pid.toString()}`),g===at.ipc||g===at.stdio){let P=ti.spawn(C,w,T);return!P||!P.pid?pr(P,`Launching server using runtime ${C} failed.`):(this._serverProcess=P,P.stderr.on("data",x=>this.outputChannel.append(Qe.string(x)?x:x.toString(e))),g===at.ipc?(P.stdout.on("data",x=>this.outputChannel.append(Qe.string(x)?x:x.toString(e))),Promise.resolve({reader:new it.IPCMessageReader(P),writer:new it.IPCMessageWriter(P)})):Promise.resolve({reader:new it.StreamMessageReader(P.stdout),writer:new it.StreamMessageWriter(P.stdin)}))}else{if(g===at.pipe)return(0,it.createClientPipeTransport)(S).then(P=>{let x=ti.spawn(C,w,T);return!x||!x.pid?pr(x,`Launching server using runtime ${C} failed.`):(this._serverProcess=x,x.stderr.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),x.stdout.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),P.onConnected().then(q=>({reader:q[0],writer:q[1]})))});if(bi.isSocket(g))return(0,it.createClientSocketTransport)(g.port).then(P=>{let x=ti.spawn(C,w,T);return!x||!x.pid?pr(x,`Launching server using runtime ${C} failed.`):(this._serverProcess=x,x.stderr.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),x.stdout.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),P.onConnected().then(q=>({reader:q[0],writer:q[1]})))})}}else{let w;return new Promise((y,T)=>{let C=(m.args&&m.args.slice())??[];g===at.ipc?C.push("--node-ipc"):g===at.stdio?C.push("--stdio"):g===at.pipe?(w=(0,it.generateRandomPipeName)(),C.push(`--pipe=${w}`)):bi.isSocket(g)&&C.push(`--socket=${g.port}`),C.push(`--clientProcessId=${process.pid.toString()}`);let S=m.options??Object.create(null);if(S.env=t(S.env,!0),S.execArgv=S.execArgv||[],S.cwd=p,S.silent=!0,g===at.ipc||g===at.stdio){let P=ti.fork(m.module,C||[],S);o(P),this._serverProcess=P,P.stderr.on("data",x=>this.outputChannel.append(Qe.string(x)?x:x.toString(e))),g===at.ipc?(P.stdout.on("data",x=>this.outputChannel.append(Qe.string(x)?x:x.toString(e))),y({reader:new it.IPCMessageReader(this._serverProcess),writer:new it.IPCMessageWriter(this._serverProcess)})):y({reader:new it.StreamMessageReader(P.stdout),writer:new it.StreamMessageWriter(P.stdin)})}else g===at.pipe?(0,it.createClientPipeTransport)(w).then(P=>{let x=ti.fork(m.module,C||[],S);o(x),this._serverProcess=x,x.stderr.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),x.stdout.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),P.onConnected().then(q=>{y({reader:q[0],writer:q[1]})},T)},T):bi.isSocket(g)&&(0,it.createClientSocketTransport)(g.port).then(P=>{let x=ti.fork(m.module,C||[],S);o(x),this._serverProcess=x,x.stderr.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),x.stdout.on("data",q=>this.outputChannel.append(Qe.string(q)?q:q.toString(e))),P.onConnected().then(q=>{y({reader:q[0],writer:q[1]})},T)},T)})}}else if(Md.is(c)&&c.command){let m=c,g=c.args!==void 0?c.args.slice(0):[],w,y=c.transport;if(y===at.stdio)g.push("--stdio");else if(y===at.pipe)w=(0,it.generateRandomPipeName)(),g.push(`--pipe=${w}`);else if(bi.isSocket(y))g.push(`--socket=${y.port}`);else if(y===at.ipc)throw new Error("Transport kind ipc is not support for command executable");let T=Object.assign({},m.options);if(T.cwd=T.cwd||p,y===void 0||y===at.stdio){let C=ti.spawn(m.command,g,T);return!C||!C.pid?pr(C,`Launching server using command ${m.command} failed.`):(C.stderr.on("data",S=>this.outputChannel.append(Qe.string(S)?S:S.toString(e))),this._serverProcess=C,this._isDetached=!!T.detached,Promise.resolve({reader:new it.StreamMessageReader(C.stdout),writer:new it.StreamMessageWriter(C.stdin)}))}else{if(y===at.pipe)return(0,it.createClientPipeTransport)(w).then(C=>{let S=ti.spawn(m.command,g,T);return!S||!S.pid?pr(S,`Launching server using command ${m.command} failed.`):(this._serverProcess=S,this._isDetached=!!T.detached,S.stderr.on("data",P=>this.outputChannel.append(Qe.string(P)?P:P.toString(e))),S.stdout.on("data",P=>this.outputChannel.append(Qe.string(P)?P:P.toString(e))),C.onConnected().then(P=>({reader:P[0],writer:P[1]})))});if(bi.isSocket(y))return(0,it.createClientSocketTransport)(y.port).then(C=>{let S=ti.spawn(m.command,g,T);return!S||!S.pid?pr(S,`Launching server using command ${m.command} failed.`):(this._serverProcess=S,this._isDetached=!!T.detached,S.stderr.on("data",P=>this.outputChannel.append(Qe.string(P)?P:P.toString(e))),S.stdout.on("data",P=>this.outputChannel.append(Qe.string(P)?P:P.toString(e))),C.onConnected().then(P=>({reader:P[0],writer:P[1]})))})}}return Promise.reject(new Error("Unsupported server configuration "+JSON.stringify(a,null,4)))})}_getRuntimePath(e,t){if(Ld.isAbsolute(e))return e;let n=this._mainGetRootPath();if(n!==void 0){let r=Ld.join(n,e);if(Fd.existsSync(r))return r}if(t!==void 0){let r=Ld.join(t,e);if(Fd.existsSync(r))return r}return e}_mainGetRootPath(){let e=wi.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}_getServerWorkingDir(e){let t=e&&e.cwd;return t||(t=this.clientOptions.workspaceFolder?this.clientOptions.workspaceFolder.uri.fsPath:this._mainGetRootPath()),t?new Promise(n=>{Fd.lstat(t,(r,s)=>{n(!r&&s.isDirectory()?t:void 0)})}):Promise.resolve(void 0)}};Ht.LanguageClient=jd;var Wd=class{constructor(e,t){this._client=e,this._setting=t,this._listeners=[]}start(){return wi.workspace.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this._listeners),this.onDidChangeConfiguration(),new wi.Disposable(()=>{this._client.needsStop()&&this._client.stop()})}onDidChangeConfiguration(){let e=this._setting.indexOf("."),t=e>=0?this._setting.substr(0,e):this._setting,n=e>=0?this._setting.substr(e+1):void 0,r=n?wi.workspace.getConfiguration(t).get(n,!1):wi.workspace.getConfiguration(t);r&&this._client.needsStart()?this._client.start().catch(s=>this._client.error("Start failed after configuration change",s,"force")):!r&&this._client.needsStop()&&this._client.stop().catch(s=>this._client.error("Stop failed after configuration change",s,"force"))}};Ht.SettingMonitor=Wd;function pr(i,e){return i===null?Promise.reject(e):new Promise((t,n)=>{i.on("error",r=>{n(`${e} ${r}`)}),setImmediate(()=>n(e))})}});var Pm=F((lP,Tm)=>{"use strict";Tm.exports=_m()});var ia=F(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.Event=Ci.Response=Ci.Message=void 0;var vs=class{constructor(e){this.seq=0,this.type=e}};Ci.Message=vs;var Kd=class extends vs{constructor(e,t){super("response"),this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}};Ci.Response=Kd;var zd=class extends vs{constructor(e,t){super("event"),this.event=e,t&&(this.body=t)}};Ci.Event=zd});var Im=F(sa=>{"use strict";Object.defineProperty(sa,"__esModule",{value:!0});sa.ProtocolServer=void 0;var qD=require("events"),ys=ia(),Bd=class{get event(){return this._event||(this._event=(e,t)=>{this._listener=e,this._this=t;let n;return n={dispose:()=>{this._listener=void 0,this._this=void 0}},n}),this._event}fire(e){if(this._listener)try{this._listener.call(this._this,e)}catch{}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}},ra=class i extends qD.EventEmitter{constructor(){super(),this._sendMessage=new Bd,this._sequence=1,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(e){if(e.type==="request")this.dispatchRequest(e);else if(e.type==="response"){let t=e,n=this._pendingRequests.get(t.request_seq);n&&(this._pendingRequests.delete(t.request_seq),n(t))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(e,t){this._writableStream=t,this._rawData=Buffer.alloc(0),e.on("data",n=>this._handleData(n)),e.on("close",()=>{this._emitEvent(new ys.Event("close"))}),e.on("error",n=>{this._emitEvent(new ys.Event("error","inStream error: "+(n&&n.message)))}),t.on("error",n=>{this._emitEvent(new ys.Event("error","outStream error: "+(n&&n.message)))}),e.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(e){this._send("event",e)}sendResponse(e){e.seq>0?console.error(`attempt to send more than one response for command ${e.command}`):this._send("response",e)}sendRequest(e,t,n,r){let s={command:e};if(t&&Object.keys(t).length>0&&(s.arguments=t),this._send("request",s),r){this._pendingRequests.set(s.seq,r);let o=setTimeout(()=>{clearTimeout(o);let a=this._pendingRequests.get(s.seq);a&&(this._pendingRequests.delete(s.seq),a(new ys.Response(s,"timeout")))},n)}}dispatchRequest(e){}_emitEvent(e){this.emit(e.event,e)}_send(e,t){if(t.type=e,t.seq=this._sequence++,this._writableStream){let n=JSON.stringify(t);this._writableStream.write(`Content-Length: ${Buffer.byteLength(n,"utf8")}\r
\r
${n}`,"utf8")}this._sendMessage.fire(t)}_handleData(e){for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){let t=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,t.length>0)try{let n=JSON.parse(t);this.handleMessage(n)}catch(n){this._emitEvent(new ys.Event("error","Error handling data: "+(n&&n.message)))}continue}}else{let t=this._rawData.indexOf(i.TWO_CRLF);if(t!==-1){let r=this._rawData.toString("utf8",0,t).split(`\r
`);for(let s=0;s<r.length;s++){let o=r[s].split(/: +/);o[0]=="Content-Length"&&(this._contentLength=+o[1])}this._rawData=this._rawData.slice(t+i.TWO_CRLF.length);continue}}break}}};sa.ProtocolServer=ra;ra.TWO_CRLF=`\r
\r
`});var Om=F(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.runDebugAdapter=void 0;var ID=require("net");function OD(i){let e=0;if(process.argv.slice(2).forEach(function(n,r,s){let o=/^--server=(\d{4,5})$/.exec(n);o&&(e=parseInt(o[1],10))}),e>0)console.error(`waiting for debug protocol on port ${e}`),ID.createServer(n=>{console.error(">> accepted connection from client"),n.on("end",()=>{console.error(`>> client connection closed
`)});let r=new i(!1,!0);r.setRunAsServer(!0),r.start(n,n)}).listen(e);else{let n=new i(!1);process.on("SIGTERM",()=>{n.shutdown()}),n.start(process.stdin,process.stdout)}}oa.runDebugAdapter=OD});var ca=F(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.DebugSession=re.ErrorDestination=re.MemoryEvent=re.InvalidatedEvent=re.ProgressEndEvent=re.ProgressUpdateEvent=re.ProgressStartEvent=re.CapabilitiesEvent=re.LoadedSourceEvent=re.ModuleEvent=re.BreakpointEvent=re.ThreadEvent=re.OutputEvent=re.ExitedEvent=re.TerminatedEvent=re.InitializedEvent=re.ContinuedEvent=re.StoppedEvent=re.CompletionItem=re.Module=re.Breakpoint=re.Variable=re.Thread=re.StackFrame=re.Scope=re.Source=void 0;var FD=Im(),Tt=ia(),LD=Om(),Fm=require("url"),Vd=class{constructor(e,t,n=0,r,s){this.name=e,this.path=t,this.sourceReference=n,r&&(this.origin=r),s&&(this.adapterData=s)}};re.Source=Vd;var Gd=class{constructor(e,t,n=!1){this.name=e,this.variablesReference=t,this.expensive=n}};re.Scope=Gd;var Xd=class{constructor(e,t,n,r=0,s=0){this.id=e,this.source=n,this.line=r,this.column=s,this.name=t}};re.StackFrame=Xd;var Qd=class{constructor(e,t){this.id=e,t?this.name=t:this.name="Thread #"+e}};re.Thread=Qd;var Jd=class{constructor(e,t,n=0,r,s){this.name=e,this.value=t,this.variablesReference=n,typeof s=="number"&&(this.namedVariables=s),typeof r=="number"&&(this.indexedVariables=r)}};re.Variable=Jd;var Zd=class{constructor(e,t,n,r){this.verified=e;let s=this;typeof t=="number"&&(s.line=t),typeof n=="number"&&(s.column=n),r&&(s.source=r)}setId(e){this.id=e}};re.Breakpoint=Zd;var Yd=class{constructor(e,t){this.id=e,this.name=t}};re.Module=Yd;var ef=class{constructor(e,t,n=0){this.label=e,this.start=t,this.length=n}};re.CompletionItem=ef;var tf=class extends Tt.Event{constructor(e,t,n){super("stopped"),this.body={reason:e},typeof t=="number"&&(this.body.threadId=t),typeof n=="string"&&(this.body.text=n)}};re.StoppedEvent=tf;var nf=class extends Tt.Event{constructor(e,t){super("continued"),this.body={threadId:e},typeof t=="boolean"&&(this.body.allThreadsContinued=t)}};re.ContinuedEvent=nf;var rf=class extends Tt.Event{constructor(){super("initialized")}};re.InitializedEvent=rf;var sf=class extends Tt.Event{constructor(e){if(super("terminated"),typeof e=="boolean"||e){let t=this;t.body={restart:e}}}};re.TerminatedEvent=sf;var of=class extends Tt.Event{constructor(e){super("exited"),this.body={exitCode:e}}};re.ExitedEvent=of;var af=class extends Tt.Event{constructor(e,t="console",n){super("output"),this.body={category:t,output:e},n!==void 0&&(this.body.data=n)}};re.OutputEvent=af;var cf=class extends Tt.Event{constructor(e,t){super("thread"),this.body={reason:e,threadId:t}}};re.ThreadEvent=cf;var uf=class extends Tt.Event{constructor(e,t){super("breakpoint"),this.body={reason:e,breakpoint:t}}};re.BreakpointEvent=uf;var lf=class extends Tt.Event{constructor(e,t){super("module"),this.body={reason:e,module:t}}};re.ModuleEvent=lf;var df=class extends Tt.Event{constructor(e,t){super("loadedSource"),this.body={reason:e,source:t}}};re.LoadedSourceEvent=df;var ff=class extends Tt.Event{constructor(e){super("capabilities"),this.body={capabilities:e}}};re.CapabilitiesEvent=ff;var hf=class extends Tt.Event{constructor(e,t,n){super("progressStart"),this.body={progressId:e,title:t},typeof n=="string"&&(this.body.message=n)}};re.ProgressStartEvent=hf;var pf=class extends Tt.Event{constructor(e,t){super("progressUpdate"),this.body={progressId:e},typeof t=="string"&&(this.body.message=t)}};re.ProgressUpdateEvent=pf;var gf=class extends Tt.Event{constructor(e,t){super("progressEnd"),this.body={progressId:e},typeof t=="string"&&(this.body.message=t)}};re.ProgressEndEvent=gf;var mf=class extends Tt.Event{constructor(e,t,n){super("invalidated"),this.body={},e&&(this.body.areas=e),t&&(this.body.threadId=t),n&&(this.body.stackFrameId=n)}};re.InvalidatedEvent=mf;var vf=class extends Tt.Event{constructor(e,t,n){super("memory"),this.body={memoryReference:e,offset:t,count:n}}};re.MemoryEvent=vf;var Wi;(function(i){i[i.User=1]="User",i[i.Telemetry=2]="Telemetry"})(Wi=re.ErrorDestination||(re.ErrorDestination={}));var aa=class i extends FD.ProtocolServer{constructor(e,t){super();let n=typeof e=="boolean"?e:!1;this._debuggerLinesStartAt1=n,this._debuggerColumnsStartAt1=n,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer=typeof t=="boolean"?t:!1,this.on("close",()=>{this.shutdown()}),this.on("error",r=>{this.shutdown()})}setDebuggerPathFormat(e){this._debuggerPathsAreURIs=e!=="path"}setDebuggerLinesStartAt1(e){this._debuggerLinesStartAt1=e}setDebuggerColumnsStartAt1(e){this._debuggerColumnsStartAt1=e}setRunAsServer(e){this._isServer=e}static run(e){(0,LD.runDebugAdapter)(e)}shutdown(){this._isServer||this._isRunningInline()||setTimeout(()=>{process.exit(0)},100)}sendErrorResponse(e,t,n,r,s=Wi.User){let o;typeof t=="number"?(o={id:t,format:n},r&&(o.variables=r),s&Wi.User&&(o.showUser=!0),s&Wi.Telemetry&&(o.sendTelemetry=!0)):o=t,e.success=!1,e.message=i.formatPII(o.format,!0,o.variables),e.body||(e.body={}),e.body.error=o,this.sendResponse(e)}runInTerminalRequest(e,t,n){this.sendRequest("runInTerminal",e,t,n)}dispatchRequest(e){let t=new Tt.Response(e);try{if(e.command==="initialize"){var n=e.arguments;if(typeof n.linesStartAt1=="boolean"&&(this._clientLinesStartAt1=n.linesStartAt1),typeof n.columnsStartAt1=="boolean"&&(this._clientColumnsStartAt1=n.columnsStartAt1),n.pathFormat!=="path")this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null,Wi.Telemetry);else{let r=t;r.body={},this.initializeRequest(r,n)}}else e.command==="launch"?this.launchRequest(t,e.arguments,e):e.command==="attach"?this.attachRequest(t,e.arguments,e):e.command==="disconnect"?this.disconnectRequest(t,e.arguments,e):e.command==="terminate"?this.terminateRequest(t,e.arguments,e):e.command==="restart"?this.restartRequest(t,e.arguments,e):e.command==="setBreakpoints"?this.setBreakPointsRequest(t,e.arguments,e):e.command==="setFunctionBreakpoints"?this.setFunctionBreakPointsRequest(t,e.arguments,e):e.command==="setExceptionBreakpoints"?this.setExceptionBreakPointsRequest(t,e.arguments,e):e.command==="configurationDone"?this.configurationDoneRequest(t,e.arguments,e):e.command==="continue"?this.continueRequest(t,e.arguments,e):e.command==="next"?this.nextRequest(t,e.arguments,e):e.command==="stepIn"?this.stepInRequest(t,e.arguments,e):e.command==="stepOut"?this.stepOutRequest(t,e.arguments,e):e.command==="stepBack"?this.stepBackRequest(t,e.arguments,e):e.command==="reverseContinue"?this.reverseContinueRequest(t,e.arguments,e):e.command==="restartFrame"?this.restartFrameRequest(t,e.arguments,e):e.command==="goto"?this.gotoRequest(t,e.arguments,e):e.command==="pause"?this.pauseRequest(t,e.arguments,e):e.command==="stackTrace"?this.stackTraceRequest(t,e.arguments,e):e.command==="scopes"?this.scopesRequest(t,e.arguments,e):e.command==="variables"?this.variablesRequest(t,e.arguments,e):e.command==="setVariable"?this.setVariableRequest(t,e.arguments,e):e.command==="setExpression"?this.setExpressionRequest(t,e.arguments,e):e.command==="source"?this.sourceRequest(t,e.arguments,e):e.command==="threads"?this.threadsRequest(t,e):e.command==="terminateThreads"?this.terminateThreadsRequest(t,e.arguments,e):e.command==="evaluate"?this.evaluateRequest(t,e.arguments,e):e.command==="stepInTargets"?this.stepInTargetsRequest(t,e.arguments,e):e.command==="gotoTargets"?this.gotoTargetsRequest(t,e.arguments,e):e.command==="completions"?this.completionsRequest(t,e.arguments,e):e.command==="exceptionInfo"?this.exceptionInfoRequest(t,e.arguments,e):e.command==="loadedSources"?this.loadedSourcesRequest(t,e.arguments,e):e.command==="dataBreakpointInfo"?this.dataBreakpointInfoRequest(t,e.arguments,e):e.command==="setDataBreakpoints"?this.setDataBreakpointsRequest(t,e.arguments,e):e.command==="readMemory"?this.readMemoryRequest(t,e.arguments,e):e.command==="writeMemory"?this.writeMemoryRequest(t,e.arguments,e):e.command==="disassemble"?this.disassembleRequest(t,e.arguments,e):e.command==="cancel"?this.cancelRequest(t,e.arguments,e):e.command==="breakpointLocations"?this.breakpointLocationsRequest(t,e.arguments,e):e.command==="setInstructionBreakpoints"?this.setInstructionBreakpointsRequest(t,e.arguments,e):this.customRequest(e.command,t,e.arguments,e)}catch(r){this.sendErrorResponse(t,1104,"{_stack}",{_exception:r.message,_stack:r.stack},Wi.Telemetry)}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsRestartRequest=!1,e.body.supportsExceptionOptions=!1,e.body.supportsValueFormattingOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportTerminateDebuggee=!1,e.body.supportsDelayedStackTraceLoading=!1,e.body.supportsLoadedSourcesRequest=!1,e.body.supportsLogPoints=!1,e.body.supportsTerminateThreadsRequest=!1,e.body.supportsSetExpression=!1,e.body.supportsTerminateRequest=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsReadMemoryRequest=!1,e.body.supportsDisassembleRequest=!1,e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!1,e.body.supportsClipboardContext=!1,e.body.supportsSteppingGranularity=!1,e.body.supportsInstructionBreakpoints=!1,e.body.supportsExceptionFilterOptions=!1,this.sendResponse(e)}disconnectRequest(e,t,n){this.sendResponse(e),this.shutdown()}launchRequest(e,t,n){this.sendResponse(e)}attachRequest(e,t,n){this.sendResponse(e)}terminateRequest(e,t,n){this.sendResponse(e)}restartRequest(e,t,n){this.sendResponse(e)}setBreakPointsRequest(e,t,n){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,n){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t,n){this.sendResponse(e)}configurationDoneRequest(e,t,n){this.sendResponse(e)}continueRequest(e,t,n){this.sendResponse(e)}nextRequest(e,t,n){this.sendResponse(e)}stepInRequest(e,t,n){this.sendResponse(e)}stepOutRequest(e,t,n){this.sendResponse(e)}stepBackRequest(e,t,n){this.sendResponse(e)}reverseContinueRequest(e,t,n){this.sendResponse(e)}restartFrameRequest(e,t,n){this.sendResponse(e)}gotoRequest(e,t,n){this.sendResponse(e)}pauseRequest(e,t,n){this.sendResponse(e)}sourceRequest(e,t,n){this.sendResponse(e)}threadsRequest(e,t){this.sendResponse(e)}terminateThreadsRequest(e,t,n){this.sendResponse(e)}stackTraceRequest(e,t,n){this.sendResponse(e)}scopesRequest(e,t,n){this.sendResponse(e)}variablesRequest(e,t,n){this.sendResponse(e)}setVariableRequest(e,t,n){this.sendResponse(e)}setExpressionRequest(e,t,n){this.sendResponse(e)}evaluateRequest(e,t,n){this.sendResponse(e)}stepInTargetsRequest(e,t,n){this.sendResponse(e)}gotoTargetsRequest(e,t,n){this.sendResponse(e)}completionsRequest(e,t,n){this.sendResponse(e)}exceptionInfoRequest(e,t,n){this.sendResponse(e)}loadedSourcesRequest(e,t,n){this.sendResponse(e)}dataBreakpointInfoRequest(e,t,n){this.sendResponse(e)}setDataBreakpointsRequest(e,t,n){this.sendResponse(e)}readMemoryRequest(e,t,n){this.sendResponse(e)}writeMemoryRequest(e,t,n){this.sendResponse(e)}disassembleRequest(e,t,n){this.sendResponse(e)}cancelRequest(e,t,n){this.sendResponse(e)}breakpointLocationsRequest(e,t,n){this.sendResponse(e)}setInstructionBreakpointsRequest(e,t,n){this.sendResponse(e)}customRequest(e,t,n,r){this.sendErrorResponse(t,1014,"unrecognized request",null,Wi.Telemetry)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?i.uri2path(e):i.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?i.uri2path(e):i.path2uri(e):e}static path2uri(e){process.platform==="win32"&&(/^[A-Z]:/.test(e)&&(e=e[0].toLowerCase()+e.substr(1)),e=e.replace(/\\/g,"/")),e=encodeURI(e);let t=new Fm.URL("file:");return t.pathname=e,t.toString()}static uri2path(e){let t=new Fm.URL(e),n=decodeURIComponent(t.pathname);return process.platform==="win32"&&(/^\/[a-zA-Z]:/.test(n)&&(n=n[1].toLowerCase()+n.substr(2)),n=n.replace(/\//g,"\\")),n}static formatPII(e,t,n){return e.replace(i._formatPIIRegexp,function(r,s){return t&&s.length>0&&s[0]!=="_"?r:n[s]&&n.hasOwnProperty(s)?n[s]:r})}};re.DebugSession=aa;aa._formatPIIRegexp=/{([^}]+)}/g});var Am=F(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});la.InternalLogger=void 0;var Lm=require("fs"),Mm=require("path"),on=da(),yf=class{constructor(e,t){this.beforeExitCallback=()=>this.dispose(),this._logCallback=e,this._logToConsole=t,this._minLogLevel=on.LogLevel.Warn,this.disposeCallback=(n,r)=>{this.dispose(),r=r||2,r+=128,process.exit(r)}}async setup(e){if(this._minLogLevel=e.consoleMinLogLevel,this._prependTimestamp=e.prependTimestamp,e.logFilePath)if(!Mm.isAbsolute(e.logFilePath))this.log(`logFilePath must be an absolute path: ${e.logFilePath}`,on.LogLevel.Error);else{let t=n=>this.sendLog(`Error creating log file at path: ${e.logFilePath}. Error: ${n.toString()}
`,on.LogLevel.Error);try{await Lm.promises.mkdir(Mm.dirname(e.logFilePath),{recursive:!0}),this.log(`Verbose logs are written to:
`,on.LogLevel.Warn),this.log(e.logFilePath+`
`,on.LogLevel.Warn),this._logFileStream=Lm.createWriteStream(e.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",n=>{t(n)})}catch(n){t(n)}}}logDateTime(){let e=new Date,n=e.getUTCFullYear()+`-${e.getUTCMonth()+1}-`+e.getUTCDate()+", "+Nm();this.log(n+`
`,on.LogLevel.Verbose,!1)}setupShutdownListeners(){process.on("beforeExit",this.beforeExitCallback),process.on("SIGTERM",this.disposeCallback),process.on("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise(e=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(e),this._logFileStream=null):e()})}log(e,t,n=!0){if(this._minLogLevel!==on.LogLevel.Stop){if(t>=this._minLogLevel&&this.sendLog(e,t),this._logToConsole){let r=t===on.LogLevel.Error?console.error:t===on.LogLevel.Warn?console.warn:null;r&&r((0,on.trimLastNewline)(e))}t===on.LogLevel.Error&&(e=`[${on.LogLevel[t]}] ${e}`),this._prependTimestamp&&n&&(e="["+Nm()+"] "+e),this._logFileStream&&this._logFileStream.write(e)}}sendLog(e,t){if(e.length>1500){let n=!!e.match(/(\n|\r\n)$/);e=e.substr(0,1500)+"[...]",n&&(e=e+`
`)}if(this._logCallback){let n=new on.LogOutputEvent(e,t);this._logCallback(n)}}};la.InternalLogger=yf;function Nm(){let i=new Date,e=ua(2,String(i.getUTCHours())),t=ua(2,String(i.getUTCMinutes())),n=ua(2,String(i.getUTCSeconds())),r=ua(3,String(i.getUTCMilliseconds()));return e+":"+t+":"+n+"."+r+" UTC"}function ua(i,e){return e.length>=i?e:String("0".repeat(i)+e).slice(-i)}});var da=F(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.trimLastNewline=an.LogOutputEvent=an.logger=an.Logger=an.LogLevel=void 0;var MD=Am(),ND=ca(),Si;(function(i){i[i.Verbose=0]="Verbose",i[i.Log=1]="Log",i[i.Warn=2]="Warn",i[i.Error=3]="Error",i[i.Stop=4]="Stop"})(Si=an.LogLevel||(an.LogLevel={}));var fa=class{constructor(){this._pendingLogQ=[]}log(e,t=Si.Log){e=e+`
`,this._write(e,t)}verbose(e){this.log(e,Si.Verbose)}warn(e){this.log(e,Si.Warn)}error(e){this.log(e,Si.Error)}dispose(){if(this._currentLogger){let e=this._currentLogger.dispose();return this._currentLogger=null,e}else return Promise.resolve()}_write(e,t=Si.Log){e=e+"",this._pendingLogQ?this._pendingLogQ.push({msg:e,level:t}):this._currentLogger&&this._currentLogger.log(e,t)}setup(e,t,n=!0){let r=typeof t=="string"?t:t&&this._logFilePathFromInit;if(this._currentLogger){let s={consoleMinLogLevel:e,logFilePath:r,prependTimestamp:n};this._currentLogger.setup(s).then(()=>{if(this._pendingLogQ){let o=this._pendingLogQ;this._pendingLogQ=null,o.forEach(a=>this._write(a.msg,a.level))}})}}init(e,t,n){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new MD.InternalLogger(e,n),this._logFilePathFromInit=t}};an.Logger=fa;an.logger=new fa;var bf=class extends ND.OutputEvent{constructor(e,t){let n=t===Si.Error?"stderr":t===Si.Warn?"console":"stdout";super(e,n)}};an.LogOutputEvent=bf;function AD(i){return i.replace(/(\n|\r\n)$/,"")}an.trimLastNewline=AD});var Wm=F(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.LoggingDebugSession=void 0;var jm=da(),mr=jm.logger,$m=ca(),wf=class extends $m.DebugSession{constructor(e,t,n){super(t,n),this.obsolete_logFilePath=e,this.on("error",r=>{mr.error(r.body)})}start(e,t){super.start(e,t),mr.init(n=>this.sendEvent(n),this.obsolete_logFilePath,this._isServer)}sendEvent(e){if(!(e instanceof jm.LogOutputEvent)){let t=e;e instanceof $m.OutputEvent&&e.body&&e.body.data&&e.body.data.doNotLogOutput&&(delete e.body.data.doNotLogOutput,t={...e},t.body={...e.body,output:"<output not logged>"}),mr.verbose(`To client: ${JSON.stringify(t)}`)}super.sendEvent(e)}sendRequest(e,t,n,r){mr.verbose(`To client: ${JSON.stringify(e)}(${JSON.stringify(t)}), timeout: ${n}`),super.sendRequest(e,t,n,r)}sendResponse(e){mr.verbose(`To client: ${JSON.stringify(e)}`),super.sendResponse(e)}dispatchRequest(e){mr.verbose(`From client: ${e.command}(${JSON.stringify(e.arguments)})`),super.dispatchRequest(e)}};ha.LoggingDebugSession=wf});var Hm=F(pa=>{"use strict";Object.defineProperty(pa,"__esModule",{value:!0});pa.Handles=void 0;var Cf=class{constructor(e){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle=typeof e=="number"?e:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(e){var t=this._nextHandle++;return this._handleMap.set(t,e),t}get(e,t){return this._handleMap.get(e)||t}};pa.Handles=Cf});var zm=F(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.Handles=Z.Response=Z.Event=Z.ErrorDestination=Z.CompletionItem=Z.Module=Z.Source=Z.Breakpoint=Z.Variable=Z.Scope=Z.StackFrame=Z.Thread=Z.MemoryEvent=Z.InvalidatedEvent=Z.ProgressEndEvent=Z.ProgressUpdateEvent=Z.ProgressStartEvent=Z.CapabilitiesEvent=Z.LoadedSourceEvent=Z.ModuleEvent=Z.BreakpointEvent=Z.ThreadEvent=Z.OutputEvent=Z.ContinuedEvent=Z.StoppedEvent=Z.ExitedEvent=Z.TerminatedEvent=Z.InitializedEvent=Z.logger=Z.Logger=Z.LoggingDebugSession=Z.DebugSession=void 0;var He=ca();Object.defineProperty(Z,"DebugSession",{enumerable:!0,get:function(){return He.DebugSession}});Object.defineProperty(Z,"InitializedEvent",{enumerable:!0,get:function(){return He.InitializedEvent}});Object.defineProperty(Z,"TerminatedEvent",{enumerable:!0,get:function(){return He.TerminatedEvent}});Object.defineProperty(Z,"ExitedEvent",{enumerable:!0,get:function(){return He.ExitedEvent}});Object.defineProperty(Z,"StoppedEvent",{enumerable:!0,get:function(){return He.StoppedEvent}});Object.defineProperty(Z,"ContinuedEvent",{enumerable:!0,get:function(){return He.ContinuedEvent}});Object.defineProperty(Z,"OutputEvent",{enumerable:!0,get:function(){return He.OutputEvent}});Object.defineProperty(Z,"ThreadEvent",{enumerable:!0,get:function(){return He.ThreadEvent}});Object.defineProperty(Z,"BreakpointEvent",{enumerable:!0,get:function(){return He.BreakpointEvent}});Object.defineProperty(Z,"ModuleEvent",{enumerable:!0,get:function(){return He.ModuleEvent}});Object.defineProperty(Z,"LoadedSourceEvent",{enumerable:!0,get:function(){return He.LoadedSourceEvent}});Object.defineProperty(Z,"CapabilitiesEvent",{enumerable:!0,get:function(){return He.CapabilitiesEvent}});Object.defineProperty(Z,"ProgressStartEvent",{enumerable:!0,get:function(){return He.ProgressStartEvent}});Object.defineProperty(Z,"ProgressUpdateEvent",{enumerable:!0,get:function(){return He.ProgressUpdateEvent}});Object.defineProperty(Z,"ProgressEndEvent",{enumerable:!0,get:function(){return He.ProgressEndEvent}});Object.defineProperty(Z,"InvalidatedEvent",{enumerable:!0,get:function(){return He.InvalidatedEvent}});Object.defineProperty(Z,"MemoryEvent",{enumerable:!0,get:function(){return He.MemoryEvent}});Object.defineProperty(Z,"Thread",{enumerable:!0,get:function(){return He.Thread}});Object.defineProperty(Z,"StackFrame",{enumerable:!0,get:function(){return He.StackFrame}});Object.defineProperty(Z,"Scope",{enumerable:!0,get:function(){return He.Scope}});Object.defineProperty(Z,"Variable",{enumerable:!0,get:function(){return He.Variable}});Object.defineProperty(Z,"Breakpoint",{enumerable:!0,get:function(){return He.Breakpoint}});Object.defineProperty(Z,"Source",{enumerable:!0,get:function(){return He.Source}});Object.defineProperty(Z,"Module",{enumerable:!0,get:function(){return He.Module}});Object.defineProperty(Z,"CompletionItem",{enumerable:!0,get:function(){return He.CompletionItem}});Object.defineProperty(Z,"ErrorDestination",{enumerable:!0,get:function(){return He.ErrorDestination}});var $D=Wm();Object.defineProperty(Z,"LoggingDebugSession",{enumerable:!0,get:function(){return $D.LoggingDebugSession}});var Um=da();Z.Logger=Um;var Km=ia();Object.defineProperty(Z,"Event",{enumerable:!0,get:function(){return Km.Event}});Object.defineProperty(Z,"Response",{enumerable:!0,get:function(){return Km.Response}});var jD=Hm();Object.defineProperty(Z,"Handles",{enumerable:!0,get:function(){return jD.Handles}});var WD=Um.logger;Z.logger=WD});var XD={};dv(XD,{activate:()=>VD,deactivate:()=>GD});module.exports=fv(XD);var U=Me(require("vscode")),Ct=Me(require("path")),bs=Me(Pm());var ds=Me(require("vscode")),Hd=Me(require("child_process")),lt=Me(require("path"));var Pn=Me(require("path")),ls=Me(require("fs"));function gr(i,e,t,n){if(e!==i)return e;if(n){for(let c of n)if(c&&c!==Pn.basename(c)){let u=Pn.join(Pn.dirname(c),i);if(ls.existsSync(u))return u}}let r=Pn.join(t,"bin",i);if(ls.existsSync(r))return r;try{let{execFileSync:c}=require("child_process"),u=process.platform==="win32"?"where":"which",p=c(u,[i],{encoding:"utf8",timeout:3e3}).trim();if(p)return p.split(`
`)[0]}catch{}let s=Pn.resolve(t,".."),o=Pn.join(s,"target","release",i);if(ls.existsSync(o))return o;let a=Pn.join(s,"target","debug",i);return ls.existsSync(a)?a:i}var Qo=class{constructor(e,t){this.runningProcess=null;this.outputChannel=e,this.extensionPath=t}getCliPath(){if(this.resolvedCliPath)return this.resolvedCliPath;let t=ds.workspace.getConfiguration("skalp").get("cliPath")||"skalp";return this.resolvedCliPath=gr("skalp",t,this.extensionPath),this.resolvedCliPath}getResolvedCliPath(){return this.resolvedCliPath||this.getCliPath(),this.resolvedCliPath}getWorkspaceDir(){let e=ds.workspace.workspaceFolders;return e&&e.length>0?e[0].uri.fsPath:process.cwd()}async runBuild(e){let t=lt.dirname(e),n=lt.join(t,"build");return this.outputChannel.appendLine(`Building ${lt.basename(e)}...`),this.run(["build","-s",e,"--output",n],n)}async runSimulate(e,t){let r=ds.workspace.getConfiguration("skalp").get("simulation.defaultCycles")||1e3,s=t||r,o=lt.dirname(e),a=lt.join(o,"build",lt.basename(e,lt.extname(e))+".skw.gz");return this.outputChannel.appendLine(`Simulating ${lt.basename(e)} for ${s} cycles...`),this.run(["sim",e,"--duration",`${s}`,"--output",a],a)}async runSynth(e,t){let n=["synth",e];t&&n.push("-d",t),this.outputChannel.appendLine(`Synthesizing ${lt.basename(e)}...`);let r=lt.dirname(e);return this.run(n,lt.join(r,"build"))}async runFormat(e){return this.outputChannel.appendLine(`Formatting ${lt.basename(e)}...`),this.run(["fmt",e])}async runAnalyze(e){return this.outputChannel.appendLine(`Analyzing ${lt.basename(e)}...`),this.run(["analyze",e])}async runEc(e){let n=ds.workspace.getConfiguration("skalp").get("ec.outputDir")||"";return n||(n=lt.join(lt.dirname(e),"ec_output")),this.outputChannel.appendLine(`Running equivalence check on ${lt.basename(e)}...`),this.run(["ec",e,"--output",n,"--format","json"],lt.join(n,"ec_report.json"))}async runNewProject(e,t){return this.outputChannel.appendLine(`Creating new project '${e}' in ${t}...`),this.runInDir(["new",e],t)}cancel(){this.runningProcess&&(this.runningProcess.kill(),this.runningProcess=null,this.outputChannel.appendLine("Process cancelled."))}runInDir(e,t,n){return new Promise(r=>{let s=this.getCliPath();this.outputChannel.appendLine(`> ${s} ${e.join(" ")}`),this.outputChannel.show(!0);let o="",a="",c=Hd.spawn(s,e,{cwd:t});this.runningProcess=c,c.stdout.on("data",u=>{let p=u.toString();o+=p,this.outputChannel.append(p)}),c.stderr.on("data",u=>{let p=u.toString();a+=p,this.outputChannel.append(p)}),c.on("close",u=>{this.runningProcess=null;let p=u??1;p===0?this.outputChannel.appendLine("Done."):this.outputChannel.appendLine(`Exited with code ${p}`),r({exitCode:p,stdout:o,stderr:a,outputPath:n})}),c.on("error",u=>{this.runningProcess=null,this.outputChannel.appendLine(`Error: ${u.message}`),r({exitCode:1,stdout:o,stderr:u.message})})})}run(e,t){return new Promise(n=>{let r=this.getCliPath(),s=this.getWorkspaceDir();this.outputChannel.appendLine(`> ${r} ${e.join(" ")}`),this.outputChannel.show(!0);let o="",a="",c=Hd.spawn(r,e,{cwd:s});this.runningProcess=c,c.stdout.on("data",u=>{let p=u.toString();o+=p,this.outputChannel.append(p)}),c.stderr.on("data",u=>{let p=u.toString();a+=p,this.outputChannel.append(p)}),c.on("close",u=>{this.runningProcess=null;let p=u??1;p===0?this.outputChannel.appendLine("Done."):this.outputChannel.appendLine(`Exited with code ${p}`),n({exitCode:p,stdout:o,stderr:a,outputPath:t})}),c.on("error",u=>{this.runningProcess=null,this.outputChannel.appendLine(`Error: ${u.message}`),n({exitCode:1,stdout:o,stderr:u.message})})})}};var fs=Me(require("vscode")),Jo=class{constructor(e){this.context=e}getActivePanel(){return this.activePanel}postToWaveform(e){this.activePanel&&this.activePanel.webview.postMessage(e)}async openCustomDocument(e,t,n){return{uri:e,dispose:()=>{}}}async resolveCustomEditor(e,t,n){this.activePanel=t,t.onDidDispose(()=>{this.activePanel===t&&(this.activePanel=void 0)}),t.webview.options={enableScripts:!0};let r=t.webview.asWebviewUri(fs.Uri.joinPath(this.context.extensionUri,"media","waveform.js")),s=fs.workspace.getConfiguration("skalp.waveform").get("fontSize",12);t.webview.html=this.getHtml(r,s);let o=await fs.workspace.fs.readFile(e.uri),a=new TextDecoder().decode(o);if(o[0]===31&&o[1]===139){let u=new DecompressionStream("gzip"),p=u.writable.getWriter();p.write(o),p.close();let m=u.readable.getReader(),g=[],w=!1;for(;!w;){let S=await m.read();S.value&&g.push(S.value),w=S.done}let y=g.reduce((S,P)=>S+P.length,0),T=new Uint8Array(y),C=0;for(let S of g)T.set(S,C),C+=S.length;a=new TextDecoder().decode(T)}let c=JSON.parse(a);t.webview.postMessage({type:"loadWaveform",data:c}),t.webview.onDidReceiveMessage(u=>{u.type==="requestData"&&t.webview.postMessage({type:"loadWaveform",data:c})})}getHtml(e,t){let n=Math.round(t*2.2),r=Math.round(t*1.7),s=Math.max(8,t-1),o=Math.max(7,t-2),a=Math.max(10,t);return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKALP Waveform Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: var(--vscode-editor-background);
            color: var(--vscode-editor-foreground);
            font-family: var(--vscode-font-family);
            font-size: var(--vscode-font-size);
        }
        #toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            background: var(--vscode-titleBar-activeBackground);
            border-bottom: 1px solid var(--vscode-panel-border);
        }
        #toolbar button {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            font-size: ${a}px;
        }
        #toolbar button:hover {
            background: var(--vscode-button-hoverBackground);
        }
        #toolbar select, #toolbar input {
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            border: 1px solid var(--vscode-input-border);
            padding: 2px 4px;
            font-size: ${a}px;
        }
        #search {
            width: 180px;
        }
        #container {
            display: flex;
            height: calc(100vh - 32px);
        }
        #signal-list {
            width: ${Math.round(t*22)}px;
            min-width: 150px;
            overflow-y: auto;
            border-right: 1px solid var(--vscode-panel-border);
            user-select: none;
            padding-top: ${r}px;
        }
        .signal-row {
            display: flex;
            align-items: center;
            padding: 0 8px;
            cursor: pointer;
            white-space: nowrap;
            height: ${n}px;
            box-sizing: border-box;
            border-bottom: 1px solid var(--vscode-panel-border, rgba(128,128,128,0.2));
        }
        .signal-row:hover {
            background: var(--vscode-list-hoverBackground);
        }
        .signal-row.selected {
            background: var(--vscode-list-activeSelectionBackground);
            color: var(--vscode-list-activeSelectionForeground);
        }
        .signal-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: ${t}px;
        }
        .signal-value {
            font-family: var(--vscode-editor-fontFamily, monospace);
            font-size: ${t}px;
            margin-left: 8px;
            color: var(--vscode-descriptionForeground);
        }
        .group-header {
            font-weight: bold;
            padding: 0 8px;
            height: ${n}px;
            box-sizing: border-box;
            line-height: ${n}px;
            background: var(--vscode-sideBarSectionHeader-background);
            border-bottom: 1px solid var(--vscode-panel-border, rgba(128,128,128,0.2));
            cursor: pointer;
            font-size: ${t}px;
        }
        .group-header::before {
            content: '\\25BC ';
            font-size: ${o}px;
        }
        .group-header.collapsed::before {
            content: '\\25B6 ';
        }
        .group-count {
            font-weight: normal;
            opacity: 0.5;
            font-size: ${o}px;
        }
        #waveform-canvas {
            flex: 1;
        }
        #cursor-readout {
            position: absolute;
            bottom: 4px;
            right: 8px;
            background: var(--vscode-editorWidget-background);
            border: 1px solid var(--vscode-editorWidget-border);
            padding: 2px 8px;
            font-family: var(--vscode-editor-fontFamily, monospace);
            font-size: ${s}px;
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <button id="btn-zoom-in" title="Zoom In">+</button>
        <button id="btn-zoom-out" title="Zoom Out">-</button>
        <button id="btn-zoom-fit" title="Zoom to Fit">Fit</button>
        <span>|</span>
        <label>Radix:</label>
        <select id="radix-select">
            <option value="hex">Hex</option>
            <option value="binary">Binary</option>
            <option value="decimal">Decimal</option>
            <option value="signed">Signed</option>
            <option value="float">Float</option>
        </select>
        <span>|</span>
        <label>Input:</label>
        <select id="input-mode" title="Trackpad: pinch=zoom, swipe=pan. Mouse: wheel=zoom, drag=pan.">
            <option value="auto">Auto</option>
            <option value="trackpad">Trackpad</option>
            <option value="mouse">Mouse</option>
        </select>
        <span>|</span>
        <input id="search" type="text" placeholder="Filter signals..." />
        <span id="info"></span>
    </div>
    <div id="container">
        <div id="signal-list"></div>
        <canvas id="waveform-canvas"></canvas>
    </div>
    <div id="cursor-readout"></div>
    <script>
        window.skalpConfig = {
            fontSize: ${t},
            rowHeight: ${n},
            headerHeight: ${r},
            signalListWidth: ${Math.round(t*22)}
        };
    </script>
    <script src="${e}"></script>
</body>
</html>`}};var Ce=Me(require("vscode")),km=Me(require("fs")),Em=Me(require("path")),Zo=class extends Ce.TreeItem{constructor(t){super(t.design,Ce.TreeItemCollapsibleState.Expanded);this.report=t;this.iconPath=xm(t.status),this.description=`${t.status.toUpperCase()} (${(t.timing.total_ms/1e3).toFixed(1)}s)`}},hs=class extends Ce.TreeItem{constructor(t,n){super(t,Ce.TreeItemCollapsibleState.Collapsed);this.label=t;this.gates=n;let r=n.filter(a=>a.status==="pass").length,s=n.filter(a=>a.status==="fail").length,o=n.filter(a=>a.status==="unknown").length;this.description=`${r} pass, ${s} fail, ${o} unknown`,s>0?this.iconPath=new Ce.ThemeIcon("error",new Ce.ThemeColor("testing.iconFailed")):o>0?this.iconPath=new Ce.ThemeIcon("question",new Ce.ThemeColor("testing.iconQueued")):this.iconPath=new Ce.ThemeIcon("pass",new Ce.ThemeColor("testing.iconPassed"))}},Ud=class extends Ce.TreeItem{constructor(t){super(t.name,Ce.TreeItemCollapsibleState.None);this.gate=t;this.iconPath=xm(t.status),t.time_ms!==void 0&&(this.description=`${t.time_ms}ms`),t.counterexample&&(this.tooltip="Counterexample: "+JSON.stringify(t.counterexample,null,2))}};function xm(i){switch(i){case"pass":return new Ce.ThemeIcon("pass",new Ce.ThemeColor("testing.iconPassed"));case"fail":return new Ce.ThemeIcon("error",new Ce.ThemeColor("testing.iconFailed"));default:return new Ce.ThemeIcon("question",new Ce.ThemeColor("testing.iconQueued"))}}var Yo=class{constructor(){this._onDidChangeTreeData=new Ce.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.report=null;this.watcher=null}loadReport(e){try{let t=km.readFileSync(e,"utf-8");this.report=JSON.parse(t),this._onDidChangeTreeData.fire(void 0),this.watcher&&this.watcher.dispose();let n=Em.dirname(e);this.watcher=Ce.workspace.createFileSystemWatcher(new Ce.RelativePattern(n,"ec_report.json")),this.watcher.onDidChange(()=>this.loadReport(e))}catch{Ce.window.showErrorMessage(`Failed to load EC report: ${e}`)}}getTreeItem(e){return e}getChildren(e){if(!this.report)return[];if(!e)return[new Zo(this.report)];if(e instanceof Zo){let t=[];if(this.report.outputs.length>0&&t.push(new hs(`Outputs (${this.report.outputs.length})`,this.report.outputs)),this.report.latches.length>0&&t.push(new hs(`Latches (${this.report.latches.length})`,this.report.latches)),this.report.self_test){let n=this.report.self_test,r=new Ce.TreeItem(`Self-Test: ${n.bugs_detected}/${n.bugs_injected} detected (${(n.detection_rate*100).toFixed(0)}%)`,Ce.TreeItemCollapsibleState.None);r.iconPath=n.detection_rate>=.8?new Ce.ThemeIcon("pass",new Ce.ThemeColor("testing.iconPassed")):new Ce.ThemeIcon("warning",new Ce.ThemeColor("testing.iconQueued")),t.push(r)}return t}return e instanceof hs?e.gates.map(t=>new Ud(t)):[]}};var me=Me(require("vscode")),ps=Me(require("path")),ea=class{constructor(e){this.panel=null;this.currentFilePath="";this.context=e}show(){let e=me.window.activeTextEditor;if(!e||!e.document.fileName.endsWith(".sk")){me.window.showWarningMessage("Open a .sk file to view its schematic.");return}this.panel?this.panel.reveal(me.ViewColumn.Beside):(this.panel=me.window.createWebviewPanel("skalpSchematic","SKALP Schematic",me.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[me.Uri.file(ps.join(this.context.extensionPath,"media")),me.Uri.file(ps.join(this.context.extensionPath,"node_modules","elkjs","lib"))]}),this.panel.webview.html=this.getHtml(this.panel.webview),this.panel.webview.onDidReceiveMessage(r=>{r.type==="navigateToEntity"?this.navigateToEntity(r.entityType):r.type==="navigateToLine"&&this.navigateToLine(r.filePath,r.line)}),this.panel.onDidDispose(()=>{this.panel=null})),this.currentFilePath=e.document.fileName,this.updateSchematic(e);let t=null,n=me.window.onDidChangeTextEditorSelection(r=>{r.textEditor.document.fileName.endsWith(".sk")&&(this.currentFilePath=r.textEditor.document.fileName,t&&clearTimeout(t),t=setTimeout(()=>this.updateSchematic(r.textEditor),150))});this.panel.onDidDispose(()=>{n.dispose(),t&&clearTimeout(t)})}async navigateToEntity(e){if(!this.currentFilePath)return;let t=new RegExp(`^\\s*(pub\\s+)?entity\\s+${e}\\b`),n=async a=>{try{let c=await me.workspace.openTextDocument(a),p=c.getText().split(`
`);for(let m=0;m<p.length;m++)if(t.test(p[m])){let g=await me.window.showTextDocument(c,me.ViewColumn.One),w=new me.Position(m,0);return g.selection=new me.Selection(w,w),g.revealRange(new me.Range(w,w),me.TextEditorRevealType.InCenter),!0}}catch{}return!1},r=async(a,c)=>{if(c<=0)return[];let u=[];try{let p=await me.workspace.fs.readDirectory(a);for(let[m,g]of p){let w=me.Uri.joinPath(a,m);g===me.FileType.File&&m.endsWith(".sk")?u.push(w):g===me.FileType.Directory&&!m.startsWith(".")&&m!=="build"&&m!=="target"&&u.push(...await r(w,c-1))}}catch{}return u};if(await n(me.Uri.file(this.currentFilePath)))return;let s=new Set;s.add(this.currentFilePath);let o=this.currentFilePath.substring(0,this.currentFilePath.lastIndexOf("/"));for(let a=0;a<4;a++){let c=me.Uri.file(o),u=await r(c,3);for(let m of u)if(!s.has(m.fsPath)&&(s.add(m.fsPath),await n(m)))return;let p=o.substring(0,o.lastIndexOf("/"));if(p===o)break;o=p}}navigateToLine(e,t){if(!e||t<0)return;let n=me.Uri.file(e);me.workspace.openTextDocument(n).then(r=>{me.window.showTextDocument(r,me.ViewColumn.One).then(s=>{let o=new me.Position(t,0);s.selection=new me.Selection(o,o),s.revealRange(new me.Range(o,o),me.TextEditorRevealType.InCenter)})})}updateSchematic(e){if(!this.panel)return;let t=e.document.getText(),n=e.selection.active.line,r=this.parseEntityAtCursor(t,n);r&&this.panel.webview.postMessage({type:"updateSchematic",data:r})}parseEntityAtCursor(e,t){let n=e.split(`
`),r=[],s=-1,o="",a=0;for(let T=0;T<n.length;T++){let C=n[T],S=C.match(/^\s*(?:pub\s+)?entity\s+(\w+)/);if(S&&s<0&&(s=T,o=S[1],a=0),s>=0){for(let P of C)if(P==="{"&&a++,P==="}"&&(a--,a===0)){r.push({name:o,start:s,end:T}),s=-1;break}}}let c=[],u=-1,p="";a=0;for(let T=0;T<n.length;T++){let C=n[T],S=C.match(/^\s*impl\s+(\w+)/);if(S&&u<0&&(u=T,p=S[1],a=0),u>=0){for(let P of C)if(P==="{"&&a++,P==="}"&&(a--,a===0)){c.push({name:p,start:u,end:T}),u=-1;break}}}let m=null,g=-1,w=-1;for(let T of r)if(t>=T.start&&t<=T.end){m=T.name,g=T.start,w=T.end;break}if(!m){for(let T of c)if(t>=T.start&&t<=T.end){m=T.name;let C=r.find(S=>S.name===T.name);C&&(g=C.start,w=C.end);break}}if(!m&&r.length>0&&(m=r[0].name,g=r[0].start,w=r[0].end),!m||g<0)return null;let y=c.find(T=>T.name===m);return this.extractSchematic(m,n,g,w,y||null)}extractSchematic(e,t,n,r,s){let o=[],a=[],c=[],u=[];for(let S=n;S<=r;S++){let P=t[S].trim();if(P.startsWith("//"))continue;let q=P.replace(/\/\/.*$/,"").trim().match(/^\s*(in|out|inout)\s+(\w+)\s*:\s*(.+?)[\s,;]*$/);if(q){let A=this.inferWidth(q[3]);o.push({name:q[2],direction:q[1],type:q[3].trim(),width:A,line:S})}}let p=new Set,m=new Set,g=new Set;if(s){let S=this.parseImplBlock(t,s.start,s.end,o,a,c,u);p=S.onBlockInputPorts,m=S.onBlockOutputPorts,g=S.onBlockSignals}let w=new Set(o.filter(S=>S.direction==="in").map(S=>S.name));for(let S of u)for(let P of w)S.rhs.includes(P+".")&&p.add(P);let y=new Set(o.filter(S=>S.direction==="out").map(S=>S.name)),T=new Set(m);for(let S of u){if(!S.isOutputPort)continue;let P=S.lhs.split(".")[0];if(T.has(P))continue;let x=S.rhs.trim();/^\w+$/.test(x)||T.add(P)}let C=this.buildConnectionGraph(e,o,a,c,u,p,T,g);return{entity_name:e,ports:o,signals:a,instances:c,assignments:u,nets:C,filePath:this.currentFilePath,entityLine:n,implLine:s?s.start:-1}}parseImplBlock(e,t,n,r,s,o,a){let c=new Set(r.map(S=>S.name)),u=new Set(r.filter(S=>S.direction==="in").map(S=>S.name)),p=new Set(r.filter(S=>S.direction==="out").map(S=>S.name)),m=[],g=[],w=new Set,y=new Set,T=new Set,C=t+1;for(;C<=n;){if(e[C].trim().match(/^\s*on\s*\(/)){let P=C,x=0;for(let q=C;q<=n;q++){for(let A of e[q])if(A==="{"&&x++,A==="}"&&(x--,x===0)){g.push({start:P,end:q}),C=q;break}if(x===0)break}}C++}for(let S of g)for(let P=S.start;P<=S.end;P++){let x=e[P].replace(/\/\/.*$/,"").trim();if(!x)continue;let q=x.match(/^(\w+)\s*=/);if(q){let V=q[1];p.has(V)?y.add(V):!u.has(V)&&V!=="if"&&V!=="match"&&V!=="else"&&T.add(V)}let A=x.match(/\b\w+\b/g)||[];for(let V of A)u.has(V)&&w.add(V)}for(C=t+1;C<=n;){let P=e[C].trim();if(P.startsWith("//")){C++;continue}let x=P.match(/^\s*let\s+(\w+)\s*=\s*(\w+)(?:::<[^>]*>)?\s*\{/);if(x){let q=x[1],A=x[2],V=[],j=C,W=0,Y=!1;for(let ee=C;ee<=n&&!Y;ee++){let de=e[ee];for(let fe=0;fe<de.length;fe++)if(de[fe]==="{"&&W++,de[fe]==="}"&&(W--,W===0)){m.push({start:C,end:ee}),C=ee,Y=!0;break}}for(let ee=j;ee<=(m.length>0?m[m.length-1].end:C);ee++){let de=e[ee].replace(/\/\/.*$/,"").trim();if(de.match(/^\s*let\s+\w+\s*=/))continue;let fe=/(\w+)\s*:\s*([^,}]+)/g,Ue;for(;(Ue=fe.exec(de))!==null;){let Ge=Ue[1],rt=Ue[2].trim();Ge!==A&&V.push({port:Ge,signal:rt})}}o.push({name:q,entity_type:A,connections:V,line:j})}C++}for(let S=t+1;S<n;S++){if(m.some(A=>S>=A.start&&S<=A.end)||g.some(A=>S>=A.start&&S<=A.end))continue;let P=e[S].replace(/\/\/.*$/,"").trim();if(!P||P==="{"||P==="}")continue;let x=P.match(/^\s*signal\s+(\w+)\s*:\s*(.+?)[\s;]*$/);if(x){let A=this.inferWidth(x[2]);s.push({name:x[1],type:x[2].trim(),width:A,line:S});continue}if(P.startsWith("let ")||P.startsWith("signal ")||P.startsWith("on")||P.startsWith("if ")||P.startsWith("match ")||P.startsWith("generate ")||P.startsWith("impl ")||P.startsWith("entity ")||P.startsWith("}")||P.startsWith("{")||P.startsWith("else"))continue;let q=P.match(/^(\w+(?:\.\w+)*)\s*=\s*(.+)$/);if(q){let A=q[1].trim(),V=q[2].trim();if(V=V.replace(/[;,]\s*$/,"").trim(),V.endsWith("{")){let j=1;for(let W=S+1;W<n&&j>0;W++){let Y=e[W].replace(/\/\/.*$/,"").trim();for(let ee of Y)ee==="{"&&j++,ee==="}"&&j--;j>0&&(V+=" "+Y.replace(/[,}]/g,""))}}a.push({lhs:A,rhs:V,line:S,isOutputPort:c.has(A.split(".")[0])})}}return{onBlockInputPorts:w,onBlockOutputPorts:y,onBlockSignals:T}}buildConnectionGraph(e,t,n,r,s,o,a,c){let u=[],p=new Set(t.filter(C=>C.direction==="in").map(C=>C.name)),m=new Set(t.filter(C=>C.direction==="out").map(C=>C.name)),g=new Set;for(let C of s)g.add(C.lhs.split(".")[0]);for(let C of r)for(let S of C.connections){let P=S.signal,x=/^\w+$/.test(P),q="in";x?p.has(P)||g.has(P)?q="in":(m.has(P),q="out"):q="in",S.direction=q}for(let C of t){if(C.direction!=="in")continue;let S=[];for(let P of r)for(let x of P.connections)x.direction==="in"&&(x.signal===C.name||x.signal.startsWith(C.name+".")?S.push({type:"instance",name:P.name,port:x.port}):(x.signal.match(/\b\w+\b/g)||[]).includes(C.name)&&S.push({type:"instance",name:P.name,port:x.port}));S.length>0&&u.push({name:C.name,width:C.width,driver:{type:"entity_port",name:C.name,port:C.name},sinks:S})}for(let C of r)for(let S of C.connections){if(S.direction!=="out")continue;let P=S.signal,x=[];m.has(P)&&x.push({type:"entity_port",name:P,port:P});for(let q of s){if(!q.isOutputPort)continue;let A=q.lhs.split(".")[0];if(x.find(j=>j.type==="entity_port"&&j.name===A))continue;let V=q.rhs.match(/\b\w+\b/g)||[];(q.rhs===P||V.includes(P)||q.rhs.startsWith(P+".")||q.rhs.includes(" "+P+"."))&&x.push({type:"entity_port",name:A,port:A})}for(let q of s){if(q.isOutputPort)continue;if((q.rhs.match(/\b\w+\b/g)||[]).includes(P)||q.rhs.startsWith(P+".")||q.rhs.includes(" "+P+".")){let V=q.lhs.split(".")[0];for(let j of s){if(!j.isOutputPort)continue;let W=j.lhs.split(".")[0];if(x.find(ee=>ee.type==="entity_port"&&ee.name===W))continue;let Y=j.rhs.match(/\b\w+\b/g)||[];(j.rhs===V||Y.includes(V))&&x.push({type:"entity_port",name:W,port:W})}for(let j of r)if(j.name!==C.name)for(let W of j.connections)W.direction==="in"&&W.signal===V&&x.push({type:"instance",name:j.name,port:W.port})}}for(let q of r)if(q.name!==C.name)for(let A of q.connections)A.direction==="in"&&(x.find(V=>V.type==="instance"&&V.name===q.name&&V.port===A.port)||(A.signal===P?x.push({type:"instance",name:q.name,port:A.port}):(A.signal.match(/\b\w+\b/g)||[]).includes(P)&&x.push({type:"instance",name:q.name,port:A.port})));if(x.length>0){let q=n.find(A=>A.name===P);u.push({name:P,width:q?q.width:1,driver:{type:"instance",name:C.name,port:S.port},sinks:x})}}let w=new Set;for(let C of u)w.add(C.name);for(let C of t){if(C.direction!=="in"||w.has(C.name))continue;let S=new Set;for(let x of s){if(x.isOutputPort)continue;((x.rhs.match(/\b\w+\b/g)||[]).includes(C.name)||x.rhs.includes(C.name+"."))&&S.add(x.lhs.split(".")[0])}for(let x=0;x<4;x++){let q=[];for(let A of s){if(A.isOutputPort)continue;let V=A.lhs.split(".")[0];if(S.has(V))continue;let j=A.rhs.match(/\b\w+\b/g)||[];for(let W of S)if(j.includes(W)){q.push(V);break}}if(q.length===0)break;for(let A of q)S.add(A)}let P=[];for(let x of S)for(let q of r)for(let A of q.connections)A.signal===x&&A.direction==="in"&&P.push({type:"instance",name:q.name,port:A.port});P.length>0&&(u.push({name:C.name,width:C.width,driver:{type:"entity_port",name:C.name,port:C.name},sinks:P}),w.add(C.name))}for(let C of s){if(!C.isOutputPort)continue;let S=C.lhs.split(".")[0];if(w.has(S))continue;let P=t.find(ee=>ee.name===S&&ee.direction==="out");if(!P)continue;let x=C.rhs.trim(),q=/^\w+$/.test(x),A={type:"entity_port",name:S,port:S};if(q){let ee=!1;for(let de of r)for(let fe of de.connections)fe.signal===x&&fe.direction==="out"&&(ee=!0);if(ee)continue}let V=x.match(/\b\w+\b/g)||[],j=q?n.find(ee=>ee.name===x):void 0,W;for(let ee of r){for(let de of ee.connections){if(de.direction==="out"){if(V.includes(de.signal)){W={instName:ee.name,port:de.port};break}if(q)for(let fe of s)fe.lhs===x&&(fe.rhs.match(/\b\w+\b/g)||[]).includes(de.signal)&&(W={instName:ee.name,port:de.port})}if(W)break}if(W)break}let Y;if(!W){for(let ee of V){let de=t.find(fe=>fe.name===ee&&fe.direction==="in");if(de){Y=de;break}}if(!Y&&q)for(let ee of s){if(ee.lhs===x){let de=ee.rhs.match(/\b\w+\b/g)||[];for(let fe of de){let Ue=t.find(Ge=>Ge.name===fe&&Ge.direction==="in");if(Ue){Y=Ue;break}}}if(Y)break}}if(W)u.push({name:q?x:S,width:j?j.width:P.width,driver:{type:"instance",name:W.instName,port:W.port},sinks:[A]});else if(Y)u.push({name:q?x:S,width:Y.width,driver:{type:"entity_port",name:Y.name,port:Y.name},sinks:[A]});else{if(a.has(S))continue;u.push({name:q?x:S,width:j?j.width:P.width,driver:{type:"entity_port",name:q?x:S,port:q?x:S},sinks:[A]})}w.add(S)}let y=[];for(let C of s){if(C.isOutputPort)continue;let S=C.lhs.split(".")[0];if(w.has(S))continue;let P=[];for(let x of r)for(let q of x.connections)q.signal===S&&q.direction==="in"&&P.push({type:"instance",name:x.name,port:q.port});for(let x of s)if(x.isOutputPort&&x.rhs===S){let q=x.lhs.split(".")[0];P.push({type:"entity_port",name:q,port:q})}if(P.length>0){let x=!1;for(let q of r)for(let A of q.connections)A.signal===S&&A.direction==="out"&&(x=!0);if(!x){let q=n.find(A=>A.name===S);y.push({sig:S,sinks:P,width:q?q.width:1}),w.add(S)}}}for(let C of c){if(w.has(C))continue;let S=[];for(let P of r)for(let x of P.connections)x.direction==="in"&&(x.signal===C?S.push({type:"instance",name:P.name,port:x.port}):(x.signal.match(/\b\w+\b/g)||[]).includes(C)&&S.push({type:"instance",name:P.name,port:x.port}));for(let P of s)if((P.rhs.match(/\b\w+\b/g)||[]).includes(C)&&P.isOutputPort){let q=P.lhs.split(".")[0];S.push({type:"entity_port",name:q,port:q})}S.length>0&&(y.push({sig:C,sinks:S,width:1}),w.add(C))}let T=[];for(let C of o)w.has(C)||T.push({port:C,signal:C,direction:"in"});for(let C of a)w.has(C)||T.push({port:C,signal:C,direction:"out"});for(let C of y)T.push({port:C.sig,signal:C.sig,direction:"out"});if(T.length>0){let C={name:"logic",entity_type:"Logic",connections:T,line:-1};r.push(C);for(let S of T)if(S.direction==="in"){let P=t.find(x=>x.name===S.port&&x.direction==="in");P&&(u.push({name:P.name,width:P.width,driver:{type:"entity_port",name:P.name,port:P.name},sinks:[{type:"instance",name:"logic",port:S.port}]}),w.add(P.name))}else if(S.direction==="out"){let P=t.find(x=>x.name===S.port&&x.direction==="out");P&&(u.push({name:P.name,width:P.width,driver:{type:"instance",name:"logic",port:S.port},sinks:[{type:"entity_port",name:P.name,port:P.name}]}),w.add(P.name))}for(let S of y)u.push({name:S.sig,width:S.width,driver:{type:"instance",name:"logic",port:S.sig},sinks:S.sinks})}return u}inferWidth(e){if(e=e.trim(),e==="bit"||e==="bool"||e==="clock"||e==="reset"||e.startsWith("reset("))return 1;let t=e.match(/bit<(\d+)>/);if(t)return parseInt(t[1]);let n=e.match(/nat<(\d+)>|nat\[(\d+)\]/);if(n)return parseInt(n[1]||n[2]);let r=e.match(/int<(\d+)>|int\[(\d+)\]/);return r?parseInt(r[1]||r[2]):e==="fp32"?32:e==="fp16"?16:e==="fp64"?64:/^[A-Z]\w+$/.test(e)?8:1}getHtml(e){let t=e.asWebviewUri(me.Uri.file(ps.join(this.context.extensionPath,"node_modules","elkjs","lib","elk.bundled.js"))),n=e.asWebviewUri(me.Uri.file(ps.join(this.context.extensionPath,"media","schematic.js")));return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKALP Schematic</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background: var(--vscode-editor-background);
            color: var(--vscode-editor-foreground);
            font-family: var(--vscode-font-family);
            display: flex;
            flex-direction: column;
        }
        #toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            background: var(--vscode-titleBar-activeBackground);
            border-bottom: 1px solid var(--vscode-panel-border);
            font-size: 12px;
            flex-shrink: 0;
        }
        #toolbar button {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }
        #toolbar button:hover {
            background: var(--vscode-button-hoverBackground);
        }
        #entity-name {
            font-weight: bold;
        }
        #stats {
            color: var(--vscode-descriptionForeground);
            font-size: 11px;
        }
        canvas {
            display: block;
            flex: 1;
            min-height: 0;
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <span id="entity-name">No entity</span>
        <span id="stats"></span>
        <span>|</span>
        <button id="btn-zoom-in">+</button>
        <button id="btn-zoom-out">-</button>
        <button id="btn-zoom-fit">Fit</button>
    </div>
    <canvas id="schematic-canvas"></canvas>
    <script src="${t}"></script>
    <script src="${n}"></script>
</body>
</html>`}};var yt=Me(require("vscode")),gs=Me(require("path")),ta=class{constructor(e){this.panel=null;this.debounceTimer=null;this.context=e}show(){let e=yt.window.activeTextEditor;if(!e||!e.document.fileName.endsWith(".sk")&&!e.document.fileName.endsWith(".skalp")){yt.window.showWarningMessage("Open a SKALP file first.");return}if(this.panel){this.panel.reveal(yt.ViewColumn.Beside),this.updateExpression(e);return}this.panel=yt.window.createWebviewPanel("skalpExpressionViewer","Expression Viewer",yt.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[yt.Uri.file(gs.join(this.context.extensionPath,"media")),yt.Uri.file(gs.join(this.context.extensionPath,"node_modules","elkjs","lib"))]}),this.panel.webview.html=this.getHtml(this.panel.webview),this.panel.onDidDispose(()=>{this.panel=null}),this.context.subscriptions.push(yt.window.onDidChangeTextEditorSelection(()=>{this.scheduleUpdate()}),yt.workspace.onDidChangeTextDocument(()=>{this.scheduleUpdate()})),this.updateExpression(e)}scheduleUpdate(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{let e=yt.window.activeTextEditor;e&&this.panel&&this.updateExpression(e)},100)}async updateExpression(e){if(!this.panel)return;let t=e.document;if(!t.fileName.endsWith(".sk")&&!t.fileName.endsWith(".skalp")){this.panel.webview.postMessage({type:"clearExpression"});return}let n=e.selection.active;try{let r=await yt.commands.executeCommand("skalp.getExpressionCircuit",t.uri.toString(),n.line,n.character);r&&this.panel?this.panel.webview.postMessage({type:"updateExpression",data:r}):this.panel&&this.panel.webview.postMessage({type:"clearExpression"})}catch{this.panel&&this.panel.webview.postMessage({type:"clearExpression"})}}getHtml(e){let t=e.asWebviewUri(yt.Uri.file(gs.join(this.context.extensionPath,"node_modules","elkjs","lib","elk.bundled.js"))),n=e.asWebviewUri(yt.Uri.file(gs.join(this.context.extensionPath,"media","expression-viewer.js")));return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background: var(--vscode-editor-background);
            color: var(--vscode-editor-foreground);
            font-family: var(--vscode-font-family);
            display: flex;
            flex-direction: column;
        }
        #toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            background: var(--vscode-titleBar-activeBackground);
            border-bottom: 1px solid var(--vscode-panel-border);
            font-size: 12px;
            flex-shrink: 0;
        }
        #toolbar span {
            white-space: nowrap;
        }
        #target-name {
            font-weight: bold;
            color: var(--vscode-textLink-foreground);
        }
        #toolbar button {
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
            border: none;
            padding: 2px 8px;
            cursor: pointer;
            border-radius: 2px;
            font-size: 12px;
        }
        #toolbar button:hover {
            background: var(--vscode-button-secondaryHoverBackground);
        }
        canvas {
            display: block;
            flex: 1;
            min-height: 0;
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <span id="target-name">No expression</span>
        <span id="stats"></span>
        <span>|</span>
        <button id="btn-zoom-in">+</button>
        <button id="btn-zoom-out">&minus;</button>
        <button id="btn-zoom-fit">Fit</button>
    </div>
    <canvas id="expr-canvas"></canvas>
    <script src="${t}"></script>
    <script src="${n}"></script>
</body>
</html>`}};var bt=Me(require("vscode")),ms=class i{static{this.type="skalp"}async provideTasks(){let e=[],t=bt.workspace.workspaceFolders?.[0];if(!t)return e;let n=await bt.workspace.findFiles("**/*.sk","**/node_modules/**",1),r=await bt.workspace.findFiles("skalp.toml",void 0,1);return n.length===0&&r.length===0||(e.push(this.createTask({type:i.type,command:"build"},t,"build",bt.TaskGroup.Build)),e.push(this.createTask({type:i.type,command:"build",target:"gates"},t,"build (gates)",bt.TaskGroup.Build)),e.push(this.createTask({type:i.type,command:"simulate"},t,"simulate",void 0)),e.push(this.createTask({type:i.type,command:"synthesize"},t,"synthesize",void 0)),e.push(this.createTask({type:i.type,command:"ec"},t,"ec",void 0)),e.push(this.createTask({type:i.type,command:"format"},t,"format",void 0)),e.push(this.createTask({type:i.type,command:"analyze"},t,"analyze",void 0))),e}resolveTask(e){let t=e.definition;if(!t.command)return;let n=e.scope??bt.workspace.workspaceFolders?.[0];if(n)return this.createTask(t,n,t.command,e.group)}createTask(e,t,n,r){let s=this.buildArgs(e),o=bt.workspace.getConfiguration("skalp").get("cliPath")||"skalp",a=new bt.ShellExecution(o,s,{cwd:t.uri.fsPath}),c=new bt.Task(e,t,`skalp: ${n}`,"skalp",a,"$skalp");return r&&(c.group=r),c.presentationOptions={reveal:bt.TaskRevealKind.Always,panel:bt.TaskPanelKind.Shared},c}buildArgs(e){let t=[],n=e.file||"${file}";switch(e.command){case"build":{t.push("build","-s",n),e.target==="gates"?t.push("--target","gates"):e.target==="mir"&&t.push("--target","mir"),e.optimize&&t.push("--optimize",e.optimize);break}case"simulate":{let r=e.cycles||bt.workspace.getConfiguration("skalp").get("simulation.defaultCycles")||1e3;t.push("sim",n,"--duration",`${r}`,"--output","${fileDirname}/build/${fileBasenameNoExtension}.skw.gz");break}case"synthesize":{t.push("synth",n),e.device&&t.push("-d",e.device);break}case"ec":{t.push("ec",n);break}case"format":{t.push("fmt",n);break}case"analyze":{t.push("analyze",n);break}}return t}};var We=Me(require("vscode")),vt=Me(require("path")),wt=Me(require("fs")),qm=Me(require("child_process")),na=class{constructor(e){this.disposables=[];this.testWaveforms=new Map;this.log=e,this.log.appendLine("[TestController] Initializing..."),this.controller=We.tests.createTestController("skalpTests","SKALP Tests"),this.disposables.push(We.commands.registerCommand("skalp.openTestWaveform",t=>{let n=t?.id,r=n?this.testWaveforms.get(n):void 0;r&&wt.existsSync(r)?We.commands.executeCommand("vscode.openWith",We.Uri.file(r),"skalp.waveformViewer"):We.window.showWarningMessage("Waveform file not found. Run the test first.")})),this.controller.resolveHandler=async t=>{t||await this.discoverAllTests()},this.controller.createRunProfile("Run",We.TestRunProfileKind.Run,(t,n)=>this.runTests(t,n),!0),this.watcher=We.workspace.createFileSystemWatcher("**/tests/**/*.rs"),this.watcher.onDidCreate(()=>this.discoverAllTests()),this.watcher.onDidChange(t=>this.parseTestFile(t)),this.watcher.onDidDelete(t=>{this.controller.items.delete(t.toString())}),this.disposables.push(this.watcher),this.disposables.push(We.workspace.onDidChangeWorkspaceFolders(()=>this.discoverAllTests())),this.discoverAllTests(),setTimeout(()=>{this.controller.items.size===0&&this.discoverAllTests()},2e3)}dispose(){this.controller.dispose();for(let e of this.disposables)e.dispose()}async discoverAllTests(){let e=new Set,t=We.workspace.workspaceFolders;if(t)for(let n of t)e.add(n.uri.fsPath);for(let n of We.window.visibleTextEditors){let r=n.document.uri.fsPath,s=this.findCargoDir(r);s&&e.add(s)}if(We.workspace.rootPath&&e.add(We.workspace.rootPath),e.size===0){this.log.appendLine("[TestController] No workspace folders or open editors found");return}this.log.appendLine(`[TestController] Scanning ${e.size} root(s): ${[...e].join(", ")}`);for(let n of e)this.scanForTestDirs(n,0);this.log.appendLine(`[TestController] Discovery complete: ${this.controller.items.size} test file(s) found`)}scanForTestDirs(e,t){if(t>5)return;let n=vt.join(e,"Cargo.toml"),r=vt.join(e,"tests");wt.existsSync(n)&&wt.existsSync(r)&&(this.log.appendLine(`[TestController] Found Cargo project with tests: ${e}`),this.scanTestDir(r));try{let s=wt.readdirSync(e,{withFileTypes:!0});for(let o of s)o.isDirectory()&&(o.name.startsWith(".")||o.name==="target"||o.name==="node_modules"||o.name==="build"||o.name==="out"||this.scanForTestDirs(vt.join(e,o.name),t+1))}catch{}}scanTestDir(e){try{let n=wt.readdirSync(e).filter(r=>r.endsWith(".rs"));this.log.appendLine(`[TestController] Scanning ${e}: ${n.length} .rs file(s)`);for(let r of n){let s=vt.join(e,r),o=We.Uri.file(s);this.parseTestFileSync(o,s)}}catch(t){this.log.appendLine(`[TestController] Error scanning ${e}: ${t}`)}}parseTestFileSync(e,t){let n;try{n=wt.readFileSync(t,"utf-8")}catch{return}this.parseTestContent(e,n)}async parseTestFile(e){let t;try{let n=await We.workspace.fs.readFile(e);t=new TextDecoder().decode(n)}catch{return}this.parseTestContent(e,t)}parseTestContent(e,t){let n=t.split(`
`),r=[];for(let a=0;a<n.length;a++){let c=n[a].trim();if(c==="#[test]"||c==="#[tokio::test]")for(let u=a+1;u<Math.min(a+10,n.length);u++){let p=n[u].match(/^\s*(?:pub\s+)?(?:async\s+)?fn\s+(\w+)/);if(p){r.push({name:p[1],line:u});break}let m=n[u].trim();if(m.startsWith("#[")&&!m.includes("cfg")&&!m.includes("allow")&&!m.includes("ignore"))break}}if(r.length===0){this.controller.items.delete(e.toString());return}this.log.appendLine(`[TestController]   ${vt.basename(e.fsPath)}: ${r.length} test(s) \u2014 ${r.map(a=>a.name).join(", ")}`);let s=vt.basename(e.fsPath,".rs"),o=this.controller.createTestItem(e.toString(),s,e);o.canResolveChildren=!1,o.description=`${r.length} test${r.length!==1?"s":""}`;for(let a of r){let c=this.controller.createTestItem(`${e.toString()}::${a.name}`,a.name,e);c.range=new We.Range(a.line,0,a.line,0),o.children.add(c)}this.controller.items.add(o)}async runTests(e,t){let n=this.controller.createTestRun(e),r=[];if(e.include)for(let o of e.include)if(o.children.size>0){let a=[];o.children.forEach(c=>a.push(c)),r.push({fileItem:o,fnItems:a})}else o.parent&&r.push({fileItem:o.parent,fnItems:[o]});else this.controller.items.forEach(o=>{let a=[];o.children.forEach(c=>a.push(c)),r.push({fileItem:o,fnItems:a})});let s=new Set(e.exclude?.map(o=>o.id)??[]);for(let{fileItem:o,fnItems:a}of r){if(t.isCancellationRequested)break;let c=a.filter(T=>!s.has(T.id)&&!s.has(o.id));if(c.length===0)continue;for(let T of c)n.started(T);let u=o.uri,p=vt.basename(u.fsPath,".rs"),m=this.findCargoDir(u.fsPath);if(!m){for(let T of c)n.errored(T,new We.TestMessage("Could not find Cargo.toml"));continue}n.appendOutput(`\r
> cargo test --test ${p}\r
`);let g=["test","--test",p];if(c.length===1)g.push(c[0].label);else if(c.length<a.length){let T=c.map(C=>C.label).join("|");g.push(T)}g.push("--","--nocapture");let w=this.snapshotWaveforms(m),y=await this.execCargoTest(g,m,t,n);for(let T of c){let C=y.get(T.label);if(C)this.applyResult(n,T,C);else if(c.length===1&&y.size>0){let S=y.values().next().value;S?this.applyResult(n,T,S):n.skipped(T)}else n.skipped(T)}this.detectNewWaveforms(m,w,n,c)}n.end()}applyResult(e,t,n){switch(n.output&&e.appendOutput(n.output.replace(/\n/g,`\r
`)+`\r
`,void 0,t),n.status){case"ok":e.passed(t,n.duration);break;case"FAILED":e.failed(t,new We.TestMessage(n.output||"Test failed"),n.duration);break;case"ignored":e.skipped(t);break}}execCargoTest(e,t,n,r){return new Promise(s=>{let o=new Map,a="",c=qm.spawn("cargo",e,{cwd:t});n.onCancellationRequested(()=>{c.kill()}),c.stdout.on("data",u=>{let p=u.toString();a+=p,r&&r.appendOutput(p.replace(/\n/g,`\r
`))}),c.stderr.on("data",u=>{let p=u.toString();a+=p,r&&r.appendOutput(p.replace(/\n/g,`\r
`))}),c.on("close",()=>{let u=/^test\s+(\S+)\s+\.\.\.\s+(ok|FAILED|ignored)(?:\s+\(([^)]+)\))?/gm,p;for(;(p=u.exec(a))!==null;){let m=p[1],g=p[2],w=p[3],y;if(w){let C=parseFloat(w);isNaN(C)||(y=C*1e3)}let T=this.extractTestOutput(m,g,a);o.set(m,{status:g,output:T,duration:y})}o.size===0&&a.includes("error[E")&&o.set("__compile_error__",{status:"FAILED",output:a.slice(-3e3)}),s(o)}),c.on("error",()=>{s(o)})})}extractTestOutput(e,t,n){let r=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(t==="FAILED"){let p=new RegExp(`---- ${r} stdout ----\\n([\\s\\S]*?)(?=\\n---- |\\nfailures:)`,"g").exec(n);return p?p[1].trim():n.slice(-2e3)}let s=n.split(`
`),o=[],a=!1;for(let u of s){if(u.match(new RegExp(`^test ${r} \\.\\.\\.`))&&!u.match(/\.\.\. (ok|FAILED|ignored)/)){a=!0;continue}if(a&&u.match(/^test \S+ \.\.\. (ok|FAILED|ignored)/)){a=!1;continue}a&&o.push(u)}return o.length>0?o.join(`
`).trim():`${`test ${e} ... ${t==="ok"?"ok":t}`}

${n.trim()}`.slice(0,3e3)}findCargoDir(e){let t=vt.dirname(e);for(;t!==vt.dirname(t);){if(wt.existsSync(vt.join(t,"Cargo.toml")))return t;t=vt.dirname(t)}}snapshotWaveforms(e){let t=new Map,n=vt.join(e,"build");if(!wt.existsSync(n))return t;try{for(let r of wt.readdirSync(n))if(r.endsWith(".skw.gz")||r.endsWith(".skw")){let s=wt.statSync(vt.join(n,r));t.set(r,s.mtimeMs)}}catch{}return t}detectNewWaveforms(e,t,n,r){let s=vt.join(e,"build");if(this.log.appendLine(`[Waveform] Scanning ${s} (exists=${wt.existsSync(s)})`),!!wt.existsSync(s))try{let o=[];for(let c of wt.readdirSync(s)){if(!c.endsWith(".skw.gz")&&!c.endsWith(".skw"))continue;let u=wt.statSync(vt.join(s,c)),p=t.get(c);(p===void 0||u.mtimeMs>p)&&o.push({name:c,fullPath:vt.join(s,c)})}if(this.log.appendLine(`[Waveform] Found ${o.length} new/modified waveform files`),o.length===0)return;let a=[];for(let c of o){let u=c.name.replace(/\.skw(\.gz)?$/,"").toLowerCase(),p=r.find(m=>u===m.label.toLowerCase()||u.includes(m.label.toLowerCase())||m.label.toLowerCase().includes(u));this.log.appendLine(`[Waveform] ${c.name}: wfBase="${u}", matched=${p?.label??"none"} (test labels: ${r.map(m=>m.label).join(", ")})`),p&&(this.testWaveforms.set(p.id,c.fullPath),a.push(p.id),n.appendOutput(`\r
[Waveform] ${c.fullPath}\r
`,void 0,p))}this.log.appendLine(`[Waveform] Matched ${a.length} waveforms to tests. IDs: ${a.join(", ")}`),a.length>0&&We.commands.executeCommand("setContext","skalp.testsWithWaveforms",[...this.testWaveforms.keys()])}catch{}}};var Ym=Me(require("vscode"));var be=Me(zm()),vr=Me(require("vscode")),Hi=Me(require("path"));var Bm=Me(require("vscode")),Vm=Me(require("child_process")),Gm=require("events");var ga=class extends Gm.EventEmitter{constructor(t){super();this.process=null;this.buffer="";this.extensionPath=t}start(t){let n=this.getDebugBinaryPath();console.log("[SKALP Debug] Spawning:",n,"cwd:",t),this.process=Vm.spawn(n,[],{cwd:t,stdio:["pipe","pipe","pipe"],env:{...process.env,SKALP_CACHE:"0"}}),this.process.stdout.on("data",r=>{this.onStdoutData(r)}),this.process.stderr.on("data",r=>{this.emit("log",r.toString())}),this.process.on("close",r=>{this.emit("exit",r),this.process=null}),this.process.on("error",r=>{this.emit("error",r),this.process=null})}sendCommand(t){if(!this.process||!this.process.stdin)throw new Error("Debug server not running");let n=JSON.stringify(t)+`
`;this.process.stdin.write(n)}stop(){if(this.process){try{this.sendCommand({cmd:"disconnect"})}catch{}setTimeout(()=>{this.process&&(this.process.kill(),this.process=null)},2e3)}}waitForEvent(t,n=3e4){return new Promise((r,s)=>{let o=setTimeout(()=>{s(new Error(`Timeout waiting for event: ${t}`))},n),a=c=>{c.event===t&&(clearTimeout(o),this.removeListener("event",a),r(c))};this.on("event",a)})}onStdoutData(t){this.buffer+=t.toString();let n;for(;(n=this.buffer.indexOf(`
`))!==-1;){let r=this.buffer.substring(0,n).trim();if(this.buffer=this.buffer.substring(n+1),r.length!==0)try{let s=JSON.parse(r);this.emit("event",s)}catch{this.emit("log",`[skalp-debug] Invalid JSON: ${r}`)}}}getDebugBinaryPath(){let t=Bm.workspace.getConfiguration("skalp"),n=t.get("cliPath")||"skalp",r=t.get("serverPath")||"skalp-lsp";return gr("skalp-debug","skalp-debug",this.extensionPath,[n,r])}};var ni=Me(require("vscode")),ma=class{constructor(){this.active=!1;this.unchangedDecorationType=ni.window.createTextEditorDecorationType({after:{color:new ni.ThemeColor("editorCodeLens.foreground"),fontStyle:"italic",margin:"0 0 0 1.5em"},isWholeLine:!1}),this.changedDecorationType=ni.window.createTextEditorDecorationType({after:{color:"#ff9800",fontWeight:"bold",margin:"0 0 0 1.5em"},isWholeLine:!1})}applyValues(e,t){this.active=!0;let n=ni.window.visibleTextEditors.find(a=>a.document.uri.fsPath===e);if(!n)return;let r=new Map;for(let a of t){let c=a.line-1;if(c<0||c>=n.document.lineCount)continue;let u=r.get(c);u||(u={signals:[],anyChanged:!1},r.set(c,u)),u.signals.some(p=>p.signal===a.signal)||u.signals.push({signal:a.signal,value:a.value}),a.changed&&(u.anyChanged=!0)}let s=[],o=[];for(let[a,c]of r){let u=n.document.lineAt(a),p=new ni.Range(a,u.text.length,a,u.text.length),m=c.signals.map(w=>`${w.signal} = ${w.value}`).join("  "),g={range:p,renderOptions:{after:{contentText:`  ${m}`}}};c.anyChanged?o.push(g):s.push(g)}n.setDecorations(this.unchangedDecorationType,s),n.setDecorations(this.changedDecorationType,o)}clear(){if(this.active){this.active=!1;for(let e of ni.window.visibleTextEditors)e.setDecorations(this.unchangedDecorationType,[]),e.setDecorations(this.changedDecorationType,[])}}dispose(){this.clear(),this.unchangedDecorationType.dispose(),this.changedDecorationType.dispose()}};var Xm=1,Qm=2,Jm=3,Zm=4,HD={[Xm]:"inputs",[Qm]:"outputs",[Jm]:"registers",[Zm]:"signals"},va=class extends be.DebugSession{constructor(){super();this.server=null;this.sourceFile="";this.currentCycle=0;this.variableCache=new Map;this.extensionPath="";this.inlineDecorator=new ma;this.waveformPostMessage=null;this.sourceMap=new Map;this.signalToLine=new Map;this.activeBreakpointIds=new Map;this.bpIdToLine=new Map;this.entityLine=1;this.highlightLine=1;this.signalWidths={};this.setDebuggerColumnsStartAt1(!0),this.setDebuggerLinesStartAt1(!0)}setExtensionPath(t){this.extensionPath=t}setWaveformCallback(t){this.waveformPostMessage=t}initializeRequest(t,n){t.body=t.body||{},t.body.supportsConfigurationDoneRequest=!0,t.body.supportsEvaluateForHovers=!0,t.body.supportsStepBack=!0,t.body.supportsSetVariable=!1,t.body.supportsRestartRequest=!1,t.body.supportTerminateDebuggee=!0,t.body.supportsBreakpointLocationsRequest=!1,t.body.supportsConditionalBreakpoints=!0,this.sendResponse(t)}async launchRequest(t,n){console.log("[SKALP Debug] launchRequest:",n.program,"level:",n.level),this.sourceFile=n.program,this.server=new ga(this.extensionPath);let r=Hi.dirname(this.sourceFile);this.server.on("event",s=>{this.handleServerEvent(s)}),this.server.on("log",s=>{this.sendEvent(new be.OutputEvent(s,"console"))}),this.server.on("exit",s=>{this.sendEvent(new be.TerminatedEvent)}),this.server.on("error",s=>{this.sendEvent(new be.OutputEvent(`Debug server error: ${s.message}
`,"stderr")),this.sendEvent(new be.TerminatedEvent)}),this.server.start(r);try{this.server.sendCommand({cmd:"launch",file:this.sourceFile,level:n.level||"behavioral",top_module:n.topModule||null,max_cycles:n.maxCycles||1e5});let s=await this.server.waitForEvent("initialized",6e4);if(s.source_map){this.sourceMap.clear(),this.signalToLine.clear();for(let o of s.source_map)this.sourceMap.set(o.line,o.signal),this.signalToLine.has(o.signal)||this.signalToLine.set(o.signal,o.line)}if(s.entity_line&&(this.entityLine=s.entity_line),this.highlightLine=this.entityLine,this.signalWidths=s.signal_widths||{},Object.keys(this.signalWidths).length===0&&s.signals)for(let o of s.signals)this.signalWidths[o]=1;this.sendEvent(new be.OutputEvent(`Design loaded: ${s.inputs?.length||0} inputs, ${s.outputs?.length||0} outputs, ${s.signals?.length||0} signals, ${this.sourceMap.size} breakpoint locations
`,"console"))}catch(s){this.sendEvent(new be.OutputEvent(`Launch failed: ${s.message}
`,"stderr")),this.sendEvent(new be.TerminatedEvent)}this.sendResponse(t),this.sendEvent(new be.InitializedEvent),this.openDebugWaveform(),n.stopOnEntry!==!1&&this.sendEvent(new be.StoppedEvent("entry",1))}configurationDoneRequest(t,n){this.sendResponse(t)}threadsRequest(t){t.body={threads:[new be.Thread(1,"Simulation")]},this.sendResponse(t)}stackTraceRequest(t,n){let r=new be.Source(Hi.basename(this.sourceFile),this.sourceFile);t.body={stackFrames:[new be.StackFrame(0,`cycle ${this.currentCycle}`,r,this.highlightLine)],totalFrames:1},this.sendResponse(t)}scopesRequest(t,n){t.body={scopes:[new be.Scope("Inputs",Xm,!1),new be.Scope("Outputs",Qm,!1),new be.Scope("Registers",Jm,!1),new be.Scope("Signals",Zm,!1)]},this.sendResponse(t)}async variablesRequest(t,n){let r=HD[n.variablesReference];if(!r||!this.server){t.body={variables:[]},this.sendResponse(t);return}try{this.server.sendCommand({cmd:"get_variables",scope:r});let o=((await this.server.waitForEvent("variables",5e3)).vars||[]).map(a=>new be.Variable(a.name,a.value,0));t.body={variables:o}}catch{t.body={variables:[]}}this.sendResponse(t)}continueRequest(t,n){this.server&&this.server.sendCommand({cmd:"continue"}),t.body={allThreadsContinued:!0},this.sendResponse(t)}nextRequest(t,n){this.server&&this.server.sendCommand({cmd:"step",granularity:"cycle"}),this.sendResponse(t)}stepInRequest(t,n){this.server&&this.server.sendCommand({cmd:"step",granularity:"half_cycle"}),this.sendResponse(t)}pauseRequest(t,n){this.server&&this.server.sendCommand({cmd:"pause"}),this.sendResponse(t)}async setBreakPointsRequest(t,n){let r=[],s=new Set((n.breakpoints||[]).map(a=>a.line));if(this.server)for(let[a,c]of this.activeBreakpointIds)this.server.sendCommand({cmd:"remove_breakpoint",id:c});let o=new Map;if(this.server&&n.breakpoints)for(let a of n.breakpoints){let c=this.sourceMap.get(a.line);if(c){let u=this.parseBreakpointCondition(a.condition);this.server.sendCommand({cmd:"set_breakpoint",signal:c,condition:u.condition,value:u.value});try{let m=(await this.server.waitForEvent("breakpoint_set",3e3)).id;o.set(a.line,m);let g=new be.Breakpoint(!0,a.line);g.setId(m),r.push(g)}catch{r.push(new be.Breakpoint(!1,a.line))}}else r.push(new be.Breakpoint(!1,a.line))}this.activeBreakpointIds=o,this.bpIdToLine.clear();for(let[a,c]of o)this.bpIdToLine.set(c,a);t.body={breakpoints:r},this.sendResponse(t)}async evaluateRequest(t,n){if(!this.server){t.body={result:"No debug session",variablesReference:0},this.sendResponse(t);return}let r=n.expression.trim();if(r.startsWith("break ")){let s=r.substring(6).trim().split(/\s+/),o=s[0],a=s[1]||"any_change",c=s[2]?parseInt(s[2],10):void 0;this.server.sendCommand({cmd:"set_breakpoint",signal:o,condition:a,value:c});try{let u=await this.server.waitForEvent("breakpoint_set",3e3);t.body={result:`Breakpoint ${u.id} set on ${o} (${a})`,variablesReference:0}}catch{t.body={result:`Failed to set breakpoint on ${o}`,variablesReference:0}}this.sendResponse(t);return}if(r.startsWith("set ")){let s=r.substring(4).trim().split(/\s+/);if(s.length>=2){let o=s[0],a=parseInt(s[1],10);this.server.sendCommand({cmd:"set_input",name:o,value:a}),t.body={result:`Set ${o} = ${a}`,variablesReference:0},this.sendResponse(t);return}}this.server.sendCommand({cmd:"evaluate",expr:r});try{let o=(await this.server.waitForEvent("evaluate",3e3)).result;if(typeof o=="object"&&o.type!=="error")if(n.context==="hover"){let c=[];if(c.push(`${o.result}`),o.width!==void 0&&c.push(`  width: ${o.width}`),o.decimal!==void 0&&c.push(`  dec: ${o.decimal}`),o.binary!==void 0){let u=o.binary.length>32?o.binary.substring(0,32)+"...":o.binary;c.push(`  bin: ${u}`)}o.changed&&o.previous!==void 0&&c.push(`  prev: ${o.previous}`),t.body={result:c.join(`
`),variablesReference:0}}else t.body={result:o.result||JSON.stringify(o),variablesReference:0};else t.body={result:typeof o=="object"?o.result||JSON.stringify(o):String(o),variablesReference:0}}catch{t.body={result:"evaluation timeout",variablesReference:0}}this.sendResponse(t)}stepBackRequest(t,n){this.server&&this.server.sendCommand({cmd:"step_back"}),this.sendResponse(t)}parseBreakpointCondition(t){if(!t||t.trim()==="")return{condition:"any_change"};let n=t.trim().toLowerCase();if(n==="rising_edge"||n==="rising")return{condition:"rising_edge"};if(n==="falling_edge"||n==="falling")return{condition:"falling_edge"};if(n==="any_change"||n==="change")return{condition:"any_change"};if(n==="non_zero"||n==="nonzero")return{condition:"non_zero"};let r;return r=t.trim().match(/^==\s*(\d+)$/),r?{condition:"equals",value:parseInt(r[1],10)}:(r=t.trim().match(/^!=\s*(\d+)$/),r?{condition:"not_equals",value:parseInt(r[1],10)}:(r=t.trim().match(/^>\s*(\d+)$/),r?{condition:"greater_than",value:parseInt(r[1],10)}:(r=t.trim().match(/^<\s*(\d+)$/),r?{condition:"less_than",value:parseInt(r[1],10)}:(r=t.trim().match(/^==\s*0x([0-9a-fA-F]+)$/),r?{condition:"equals",value:parseInt(r[1],16)}:(r=t.trim().match(/^!=\s*0x([0-9a-fA-F]+)$/),r?{condition:"not_equals",value:parseInt(r[1],16)}:(r=t.trim().match(/^>\s*0x([0-9a-fA-F]+)$/),r?{condition:"greater_than",value:parseInt(r[1],16)}:(r=t.trim().match(/^<\s*0x([0-9a-fA-F]+)$/),r?{condition:"less_than",value:parseInt(r[1],16)}:{condition:t.trim()})))))))}handleServerEvent(t){switch(t.event){case"stopped":{this.currentCycle=t.cycle||0,this.variableCache.clear();let n=t.reason||"step";n==="max_cycles"&&(n="step");let r=t.hits||[],s=[];for(let a of r)a.bp_id!==void 0&&s.push(a.bp_id);if(n==="breakpoint"&&r.length>0){let a=r[0].bp_id;if(a!==void 0){let c=this.bpIdToLine.get(a);c!==void 0&&(this.highlightLine=c)}if(this.highlightLine===this.entityLine&&t.hit?.signal){let c=this.signalToLine.get(t.hit.signal);c!==void 0&&(this.highlightLine=c)}}else this.highlightLine=this.entityLine;let o=new be.StoppedEvent(n,1);if(n==="breakpoint"&&s.length>0&&(o.body.hitBreakpointIds=s),this.sendEvent(o),r.length>0){let a=r.map(u=>`${u.signal} = ${u.value}`),c=n==="breakpoint"?"breakpoint":"step";this.sendEvent(new be.OutputEvent(`[cycle ${this.currentCycle}] ${c} \u2014 ${a.join(", ")}
`,"console"))}else this.sendEvent(new be.OutputEvent(`[cycle ${this.currentCycle}] ${n}
`,"console"));this.requestInlineValues(),this.syncWaveformToCycle(t);break}case"continued":this.inlineDecorator.clear();break;case"terminated":this.inlineDecorator.clear(),this.sendEvent(new be.TerminatedEvent);break;case"error":this.sendEvent(new be.OutputEvent(`Error: ${t.message}
`,"stderr"));break;case"source_map":if(t.mappings){this.sourceMap.clear();for(let n of t.mappings)this.sourceMap.set(n.line,n.signal)}break;case"inline_values":t.file&&t.values&&this.inlineDecorator.applyValues(t.file,t.values);break}}requestInlineValues(){!this.server||!this.sourceFile||this.server.sendCommand({cmd:"get_inline_values",file:this.sourceFile})}syncWaveformToCycle(t){if(!this.waveformPostMessage)return;let n=t.waveform_time??this.currentCycle;if(t.waveform_changes){let r=t.signal_widths||this.signalWidths;t.signal_widths&&(this.signalWidths=t.signal_widths),this.waveformPostMessage({type:"addChanges",changes:t.waveform_changes,time:n,signalWidths:r})}this.waveformPostMessage({type:"jumpToCycle",cycle:n}),t.reason==="breakpoint"&&t.hit&&this.waveformPostMessage({type:"addBreakpointMarker",cycle:n,label:`BP: ${t.hit.signal}`})}openDebugWaveform(){let t=this.sourceFile.replace(/\.(sk|skalp)$/,".debug.skw"),n=require("fs"),r=Object.entries(this.signalWidths).map(([c,u])=>({name:c,width:u,type:u===1?"bit":"nat"})),s={};for(let c of Object.keys(this.signalWidths))s[c]=[];let o={version:1,design:Hi.basename(this.sourceFile,Hi.extname(this.sourceFile)),timescale:"1ns",endTime:100,simCycles:0,signals:r,changes:s,annotations:[],displayConfig:{defaultRadix:"hex",signalGroups:[]}};try{n.writeFileSync(t,JSON.stringify(o))}catch{return}let a=vr.Uri.file(t);vr.commands.executeCommand("vscode.openWith",a,"skalp.waveformViewer",vr.ViewColumn.Beside).then(void 0,()=>{})}disconnectRequest(t,n){this.inlineDecorator.dispose(),this.server&&(this.server.stop(),this.server=null),this.sendResponse(t)}};var ya=class{constructor(e){this.waveformPostMessage=null;this.extensionPath=e}setWaveformCallback(e){this.waveformPostMessage=e}createDebugAdapterDescriptor(e){console.log("[SKALP Debug] createDebugAdapterDescriptor called for",e.name);let t=new va;return t.setExtensionPath(this.extensionPath),this.waveformPostMessage&&t.setWaveformCallback(this.waveformPostMessage),console.log("[SKALP Debug] extensionPath:",this.extensionPath),new Ym.DebugAdapterInlineImplementation(t)}};function UD(i){let e=i.trim();if(e==="clock")return{rustType:"u8",width:1,isCustom:!1};if(e==="reset"||e.startsWith("reset("))return{rustType:"u8",width:1,isCustom:!1};if(e==="bit"||e==="bool")return{rustType:"u8",width:1,isCustom:!1};let t=e.match(/^bit\s*[\[<]\s*(\d+)\s*[\]>]$/);if(t){let o=parseInt(t[1],10);return{rustType:Sf(o),width:o,isCustom:!1}}let n=e.match(/^nat\s*[\[<]\s*(\d+)\s*[\]>]$/);if(n){let o=parseInt(n[1],10);return{rustType:Sf(o),width:o,isCustom:!1}}let r=e.match(/^int\s*[\[<]\s*(\d+)\s*[\]>]$/);if(r){let o=parseInt(r[1],10);return{rustType:KD(o),width:o,isCustom:!1}}let s=e.match(/^fp(\d+)$/);if(s){let o=parseInt(s[1],10);return{rustType:Sf(o),width:o,isCustom:!1}}return{rustType:"u32",width:null,isCustom:!0}}function Sf(i){return i<=8?"u8":i<=16?"u16":i<=32?"u32":"u64"}function KD(i){return i<=8?"i8":i<=16?"i16":i<=32?"i32":"i64"}function zD(i){let n=i.trim().replace(/,\s*$/,"").match(/^(in|out|inout)\s+(\w+)\s*:\s*(.+)$/);if(!n)return null;let r=n[1],s=n[2],o=n[3].trim(),{rustType:a,width:c,isCustom:u}=UD(o);return{direction:r,name:s,type:o,width:c,rustType:a,isCustomType:u}}function ev(i){let e=[],t=i.split(`
`),n=0;for(;n<t.length;){let r=t[n].match(/^\s*entity\s+(\w+)\s*(<[^>]+>)?\s*\{?\s*$/);if(!r){n++;continue}let s=r[1],o=r[2]?r[2].slice(1,-1):null,a=[],c=t[n].includes("{");if(n++,!c)for(;n<t.length;){if(t[n].includes("{")){c=!0,n++;break}n++}if(!c)continue;let u=1;for(;n<t.length&&u>0;){let p=t[n];for(let m of p)m==="{"&&u++,m==="}"&&u--;if(u<=0)break;if(u===1){let m=zD(p);m&&a.push(m)}n++}e.push({name:s,generics:o,ports:a}),n++}return e}function BD(i){return i.replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase()}function tv(i,e){let t=BD(i.name),n=i.ports.filter(u=>u.direction==="in"&&u.type!=="clock"),r=i.ports.filter(u=>u.direction==="out"),s=n.some(u=>u.type==="reset"||u.type.startsWith("reset(")),o=n.filter(u=>u.type!=="reset"&&!u.type.startsWith("reset(")),a=n.filter(u=>u.type==="reset"||u.type.startsWith("reset(")),c=[];if(c.push("use skalp_testing::testbench::*;"),c.push(""),c.push("#[tokio::test]"),c.push(`async fn test_${t}() {`),c.push("    let mut tb = Testbench::behavioral_with_top("),c.push(`        concat!(env!("CARGO_MANIFEST_DIR"), "/${e}"),`),c.push(`        "${i.name}",`),c.push('    ).await.expect("Failed to create testbench");'),c.push(""),s){c.push("    // Reset sequence");for(let u of a)c.push(`    tb.set("${u.name}", 1u8);`);c.push("    tb.clock(5).await;");for(let u of a)c.push(`    tb.set("${u.name}", 0u8);`);c.push("    tb.clock(1).await;"),c.push("")}if(o.length>0){c.push("    // --- Inputs ---");for(let u of o){let p=u.rustType,m=u.isCustomType?`    // TODO: set correct type for ${u.type}`:`    // ${u.type}`;c.push(`    tb.set("${u.name}", 0${p});${m}`)}c.push("")}if(c.push("    // Run simulation"),c.push("    tb.clock(10).await;"),c.push(""),r.length>0){c.push("    // --- Outputs ---");for(let u of r){let p=u.isCustomType?`    // TODO: set correct type for ${u.type}`:`    // ${u.type}`;c.push(`    let _${u.name}: ${u.rustType} = tb.get_as("${u.name}").await;${p}`)}c.push("")}return c.push("    // Export waveform"),c.push(`    tb.export_waveform(concat!(env!("CARGO_MANIFEST_DIR"), "/build/test_${t}.skw.gz")).ok();`),c.push("}"),c.push(""),c.join(`
`)}var br,ii,ct,nv;function VD(i){let e=U.window.createOutputChannel("SKALP");ii=new Qo(e,i.extensionPath),ct=U.window.createStatusBarItem(U.StatusBarAlignment.Left,50),ct.text="$(circuit-board) SKALP",ct.tooltip="SKALP \u2014 click for commands",ct.command="skalp.showMenu",ct.show(),i.subscriptions.push(ct);let t=U.workspace.getConfiguration("skalp"),n=gr("skalp-lsp",t.get("serverPath")||"skalp-lsp",i.extensionPath),r={run:{command:n,transport:bs.TransportKind.stdio},debug:{command:n,transport:bs.TransportKind.stdio,options:{env:{...process.env,RUST_LOG:"skalp_lsp=debug"}}}},s={documentSelector:[{scheme:"file",language:"skalp"}],synchronize:{fileEvents:U.workspace.createFileSystemWatcher("**/*.{sk,skalp}")}};br=new bs.LanguageClient("skalp","SKALP Language Server",r,s),br.start().catch(m=>{e.appendLine(`LSP server failed to start: ${m.message}`)});let o=new Yo;U.window.registerTreeDataProvider("skalpEc",o);let a=new Jo(i);i.subscriptions.push(U.window.registerCustomEditorProvider("skalp.waveformViewer",a,{webviewOptions:{retainContextWhenHidden:!0}}));let c=new ea(i),u=new ta(i);i.subscriptions.push(U.tasks.registerTaskProvider(ms.type,new ms)),nv=new na(e),i.subscriptions.push({dispose:()=>nv.dispose()});let p=new ya(i.extensionPath);p.setWaveformCallback(m=>a.postToWaveform(m)),i.subscriptions.push(U.debug.registerDebugAdapterDescriptorFactory("skalp",p)),i.subscriptions.push(U.commands.registerCommand("skalp.showMenu",async()=>{let m=[{label:"$(gear) Build",description:"Build to SystemVerilog"},{label:"$(play) Simulate",description:"Run simulation"},{label:"$(chip) Synthesize",description:"Synthesize for FPGA"},{label:"$(verified) Equivalence Check",description:"Verify RTL vs gates"},{label:"$(edit) Format",description:"Format source file"},{label:"$(search) Analyze",description:"Gate-level analysis"},{label:"$(graph-line) Open Waveform",description:"Open waveform viewer"},{label:"$(circuit-board) Show Schematic",description:"Show schematic view"},{label:"$(symbol-operator) Expression Viewer",description:"Show expression circuit diagram"},{label:"$(file-directory-create) New Project",description:"Create a new SKALP project"},{label:"$(beaker) Generate Testbench",description:"Generate Rust test from entity"}],g=await U.window.showQuickPick(m,{placeHolder:"Select SKALP command"});if(!g)return;let y={"$(gear) Build":"skalp.build","$(play) Simulate":"skalp.simulate","$(chip) Synthesize":"skalp.synthesize","$(verified) Equivalence Check":"skalp.ec","$(edit) Format":"skalp.format","$(search) Analyze":"skalp.analyze","$(graph-line) Open Waveform":"skalp.showWaveform","$(circuit-board) Show Schematic":"skalp.showSchematic","$(symbol-operator) Expression Viewer":"skalp.showExpressionViewer","$(file-directory-create) New Project":"skalp.newProject","$(beaker) Generate Testbench":"skalp.genTestbench"}[g.label];y&&U.commands.executeCommand(y)}),U.commands.registerCommand("skalp.restart",async()=>{await br.stop(),await br.start(),U.window.showInformationMessage("SKALP Language Server restarted")}),U.commands.registerCommand("skalp.build",async m=>{let g=yr(m);if(!g)return;ct.text="$(loading~spin) Building...";let w=await ii.runBuild(g);ct.text=w.exitCode===0?"$(check) Build OK":"$(error) Build Failed",setTimeout(()=>{ct.text="$(circuit-board) SKALP"},5e3),w.exitCode!==0&&U.window.showErrorMessage("SKALP build failed. See output for details.")}),U.commands.registerCommand("skalp.simulate",async m=>{let g=yr(m);if(!g)return;ct.text="$(loading~spin) Simulating...";let w=await ii.runSimulate(g);if(ct.text=w.exitCode===0?"$(check) Sim OK":"$(error) Sim Failed",setTimeout(()=>{ct.text="$(circuit-board) SKALP"},5e3),w.exitCode===0&&w.outputPath){if(await U.window.showInformationMessage("Simulation complete.","Open Waveform")==="Open Waveform"){let T=U.Uri.file(w.outputPath);U.commands.executeCommand("vscode.openWith",T,"skalp.waveformViewer")}}else w.exitCode!==0&&U.window.showErrorMessage("SKALP simulation failed. See output for details.")}),U.commands.registerCommand("skalp.ec",async m=>{let g=yr(m);if(!g)return;ct.text="$(loading~spin) EC running...";let w=await ii.runEc(g);ct.text=w.exitCode===0?"$(verified) EC PASS":"$(error) EC FAIL",setTimeout(()=>{ct.text="$(circuit-board) SKALP"},1e4),w.exitCode===0&&w.outputPath?o.loadReport(w.outputPath):w.exitCode!==0&&U.window.showErrorMessage("Equivalence check failed. See output for details.")}),U.commands.registerCommand("skalp.synthesize",async m=>{let g=yr(m);if(!g)return;ct.text="$(loading~spin) Synthesizing...";let w=await ii.runSynth(g);ct.text=w.exitCode===0?"$(check) Synth OK":"$(error) Synth Failed",setTimeout(()=>{ct.text="$(circuit-board) SKALP"},5e3),w.exitCode!==0&&U.window.showErrorMessage("SKALP synthesis failed. See output for details.")}),U.commands.registerCommand("skalp.format",async m=>{let g=yr(m);if(!g)return;(await ii.runFormat(g)).exitCode===0?U.window.showInformationMessage("SKALP: File formatted."):U.window.showErrorMessage("SKALP format failed. See output for details.")}),U.commands.registerCommand("skalp.analyze",async m=>{let g=yr(m);if(!g)return;ct.text="$(loading~spin) Analyzing...";let w=await ii.runAnalyze(g);ct.text="$(circuit-board) SKALP",w.exitCode!==0&&U.window.showErrorMessage("SKALP analysis failed. See output for details.")}),U.commands.registerCommand("skalp.showWaveform",async()=>{let m=await U.window.showOpenDialog({filters:{Waveform:["skw","skw.gz","vcd"]},canSelectMany:!1});m&&m.length>0&&U.commands.executeCommand("vscode.openWith",m[0],"skalp.waveformViewer")}),U.commands.registerCommand("skalp.showSchematic",async()=>{c.show()}),U.commands.registerCommand("skalp.showExpressionViewer",async()=>{u.show()}),U.commands.registerCommand("skalp.newProject",async()=>{let m=await U.window.showInputBox({prompt:"Project name",placeHolder:"my-design",validateInput:T=>/^[a-zA-Z][a-zA-Z0-9_-]*$/.test(T)?null:"Invalid project name (letters, digits, hyphens, underscores)"});if(!m)return;let g=await U.window.showOpenDialog({canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,openLabel:"Select parent directory",defaultUri:U.workspace.workspaceFolders?.[0]?.uri});if(!g||g.length===0)return;let w=g[0].fsPath;ct.text="$(loading~spin) Creating project...";let y=await ii.runNewProject(m,w);if(ct.text="$(circuit-board) SKALP",y.exitCode===0){let T=U.Uri.file(Ct.join(w,m));await U.window.showInformationMessage(`Project '${m}' created.`,"Open Project")==="Open Project"&&U.commands.executeCommand("vscode.openFolder",T)}else U.window.showErrorMessage("Failed to create project. See output for details.")}),U.commands.registerCommand("skalp.genTestbench",async m=>{let g,w;if(m)g=m.fsPath,w=(await U.workspace.openTextDocument(m)).getText();else{let W=U.window.activeTextEditor;if(!W||!(W.document.fileName.endsWith(".sk")||W.document.fileName.endsWith(".skalp"))){U.window.showWarningMessage("No SKALP file selected.");return}g=W.document.fileName,w=W.document.getText()}let y=ev(w);if(y.length===0){U.window.showWarningMessage("No entity declarations found in this file.");return}let T=y[0];if(y.length>1){let W=await U.window.showQuickPick(y.map(Y=>({label:Y.name,description:`${Y.ports.length} ports`,entity:Y})),{placeHolder:"Select entity for testbench"});if(!W)return;T=W.entity}let C=Ct.dirname(g),S=!1;for(let W=0;W<5;W++){let Y=Ct.join(C,"Cargo.toml");try{await U.workspace.fs.stat(U.Uri.file(Y)),S=!0;break}catch{let ee=Ct.dirname(C);if(ee===C)break;C=ee}}S||(C=Ct.dirname(g));let P=Ct.relative(C,g).replace(/\\/g,"/"),x=T.name.replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase(),q=tv(T,P),A=Ct.join(C,"tests"),V=Ct.join(A,`test_${x}.rs`);try{if(await U.workspace.fs.stat(U.Uri.file(V)),await U.window.showWarningMessage(`tests/test_${x}.rs already exists. Overwrite?`,"Overwrite","Cancel")!=="Overwrite")return}catch{}if(await U.workspace.fs.createDirectory(U.Uri.file(A)),await U.workspace.fs.writeFile(U.Uri.file(V),Buffer.from(q,"utf-8")),S){let W=Ct.join(C,"Cargo.toml"),Y=await U.workspace.openTextDocument(W),ee=Y.getText();if(!ee.includes("skalp-testing")&&await U.window.showInformationMessage("Cargo.toml is missing skalp-testing dev-dependency. Add it?","Add","Skip")==="Add"){let fe=ii.getResolvedCliPath(),Ue="";if(fe){let Je=Ct.join(Ct.dirname(fe),"..","..","crates","skalp-testing");try{await U.workspace.fs.stat(U.Uri.file(Je)),Ue=Ct.join(Ct.dirname(fe),"..","..","crates"),Ue=Ct.resolve(Ue)}catch{}}let Ge=Ue?`skalp-testing = { path = "${Ue}/skalp-testing" }`:`# TODO: set path to your skalp-testing crate
# skalp-testing = { path = "/path/to/hls/crates/skalp-testing" }`,rt='tokio = { version = "1", features = ["full", "test-util"] }';if(ee.includes("[dev-dependencies]")){let Je=new U.WorkspaceEdit,Ut=ee.indexOf("[dev-dependencies]"),Xe=ee.substring(0,Ut).split(`
`).length-1;Je.insert(U.Uri.file(W),new U.Position(Xe+1,0),`${rt}
${Ge}
`),await U.workspace.applyEdit(Je),await Y.save()}else{let Je=new U.WorkspaceEdit,Ut=Y.lineCount;Je.insert(U.Uri.file(W),new U.Position(Ut,0),`
[dev-dependencies]
${rt}
${Ge}
`),await U.workspace.applyEdit(Je),await Y.save()}}}let j=await U.workspace.openTextDocument(V);await U.window.showTextDocument(j),U.window.showInformationMessage(`Generated testbench: tests/test_${x}.rs`)})),i.subscriptions.push(U.workspace.onDidSaveTextDocument(async m=>{U.workspace.getConfiguration("skalp").get("buildOnSave")&&(m.fileName.endsWith(".sk")||m.fileName.endsWith(".skalp"))&&U.commands.executeCommand("skalp.build",U.Uri.file(m.fileName))}))}function yr(i){if(i)return i.fsPath;let e=U.window.activeTextEditor;if(e&&(e.document.fileName.endsWith(".sk")||e.document.fileName.endsWith(".skalp")))return e.document.fileName;U.window.showWarningMessage("No SKALP file selected.")}function GD(){if(br)return br.stop()}0&&(module.exports={activate,deactivate});
